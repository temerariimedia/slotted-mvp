var CN=Object.defineProperty;var kN=(r,e,t)=>e in r?CN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Jt=(r,e,t)=>kN(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();function vs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function eU(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var $m={exports:{}},Ho={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iw;function jN(){if(iw)return Ho;iw=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,a,o){var u=null;if(o!==void 0&&(u=""+o),a.key!==void 0&&(u=""+a.key),"key"in a){o={};for(var d in a)d!=="key"&&(o[d]=a[d])}else o=a;return a=o.ref,{$$typeof:r,type:n,key:u,ref:a!==void 0?a:null,props:o}}return Ho.Fragment=e,Ho.jsx=t,Ho.jsxs=t,Ho}var ow;function $N(){return ow||(ow=1,$m.exports=jN()),$m.exports}var O=$N(),Im={exports:{}},Te={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lw;function IN(){if(lw)return Te;lw=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.iterator;function _(N){return N===null||typeof N!="object"?null:(N=y&&N[y]||N["@@iterator"],typeof N=="function"?N:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,S={};function x(N,B,K){this.props=N,this.context=B,this.refs=S,this.updater=K||b}x.prototype.isReactComponent={},x.prototype.setState=function(N,B){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,B,"setState")},x.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function E(){}E.prototype=x.prototype;function R(N,B,K){this.props=N,this.context=B,this.refs=S,this.updater=K||b}var T=R.prototype=new E;T.constructor=R,v(T,x.prototype),T.isPureReactComponent=!0;var j=Array.isArray,$={H:null,A:null,T:null,S:null,V:null},q=Object.prototype.hasOwnProperty;function Z(N,B,K,Q,ie,he){return K=he.ref,{$$typeof:r,type:N,key:B,ref:K!==void 0?K:null,props:he}}function Y(N,B){return Z(N.type,B,void 0,void 0,void 0,N.props)}function oe(N){return typeof N=="object"&&N!==null&&N.$$typeof===r}function $e(N){var B={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(K){return B[K]})}var Se=/\/+/g;function Ge(N,B){return typeof N=="object"&&N!==null&&N.key!=null?$e(""+N.key):B.toString(36)}function At(){}function re(N){switch(N.status){case"fulfilled":return N.value;case"rejected":throw N.reason;default:switch(typeof N.status=="string"?N.then(At,At):(N.status="pending",N.then(function(B){N.status==="pending"&&(N.status="fulfilled",N.value=B)},function(B){N.status==="pending"&&(N.status="rejected",N.reason=B)})),N.status){case"fulfilled":return N.value;case"rejected":throw N.reason}}throw N}function ee(N,B,K,Q,ie){var he=typeof N;(he==="undefined"||he==="boolean")&&(N=null);var pe=!1;if(N===null)pe=!0;else switch(he){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(N.$$typeof){case r:case e:pe=!0;break;case p:return pe=N._init,ee(pe(N._payload),B,K,Q,ie)}}if(pe)return ie=ie(N),pe=Q===""?"."+Ge(N,0):Q,j(ie)?(K="",pe!=null&&(K=pe.replace(Se,"$&/")+"/"),ee(ie,B,K,"",function(jn){return jn})):ie!=null&&(oe(ie)&&(ie=Y(ie,K+(ie.key==null||N&&N.key===ie.key?"":(""+ie.key).replace(Se,"$&/")+"/")+pe)),B.push(ie)),1;pe=0;var ct=Q===""?".":Q+":";if(j(N))for(var et=0;et<N.length;et++)Q=N[et],he=ct+Ge(Q,et),pe+=ee(Q,B,K,he,ie);else if(et=_(N),typeof et=="function")for(N=et.call(N),et=0;!(Q=N.next()).done;)Q=Q.value,he=ct+Ge(Q,et++),pe+=ee(Q,B,K,he,ie);else if(he==="object"){if(typeof N.then=="function")return ee(re(N),B,K,Q,ie);throw B=String(N),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.")}return pe}function P(N,B,K){if(N==null)return N;var Q=[],ie=0;return ee(N,Q,"","",function(he){return B.call(K,he,ie++)}),Q}function H(N){if(N._status===-1){var B=N._result;B=B(),B.then(function(K){(N._status===0||N._status===-1)&&(N._status=1,N._result=K)},function(K){(N._status===0||N._status===-1)&&(N._status=2,N._result=K)}),N._status===-1&&(N._status=0,N._result=B)}if(N._status===1)return N._result.default;throw N._result}var X=typeof reportError=="function"?reportError:function(N){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var B=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof N=="object"&&N!==null&&typeof N.message=="string"?String(N.message):String(N),error:N});if(!window.dispatchEvent(B))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",N);return}console.error(N)};function ne(){}return Te.Children={map:P,forEach:function(N,B,K){P(N,function(){B.apply(this,arguments)},K)},count:function(N){var B=0;return P(N,function(){B++}),B},toArray:function(N){return P(N,function(B){return B})||[]},only:function(N){if(!oe(N))throw Error("React.Children.only expected to receive a single React element child.");return N}},Te.Component=x,Te.Fragment=t,Te.Profiler=a,Te.PureComponent=R,Te.StrictMode=n,Te.Suspense=f,Te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Te.__COMPILER_RUNTIME={__proto__:null,c:function(N){return $.H.useMemoCache(N)}},Te.cache=function(N){return function(){return N.apply(null,arguments)}},Te.cloneElement=function(N,B,K){if(N==null)throw Error("The argument must be a React element, but you passed "+N+".");var Q=v({},N.props),ie=N.key,he=void 0;if(B!=null)for(pe in B.ref!==void 0&&(he=void 0),B.key!==void 0&&(ie=""+B.key),B)!q.call(B,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&B.ref===void 0||(Q[pe]=B[pe]);var pe=arguments.length-2;if(pe===1)Q.children=K;else if(1<pe){for(var ct=Array(pe),et=0;et<pe;et++)ct[et]=arguments[et+2];Q.children=ct}return Z(N.type,ie,void 0,void 0,he,Q)},Te.createContext=function(N){return N={$$typeof:u,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null},N.Provider=N,N.Consumer={$$typeof:o,_context:N},N},Te.createElement=function(N,B,K){var Q,ie={},he=null;if(B!=null)for(Q in B.key!==void 0&&(he=""+B.key),B)q.call(B,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(ie[Q]=B[Q]);var pe=arguments.length-2;if(pe===1)ie.children=K;else if(1<pe){for(var ct=Array(pe),et=0;et<pe;et++)ct[et]=arguments[et+2];ie.children=ct}if(N&&N.defaultProps)for(Q in pe=N.defaultProps,pe)ie[Q]===void 0&&(ie[Q]=pe[Q]);return Z(N,he,void 0,void 0,null,ie)},Te.createRef=function(){return{current:null}},Te.forwardRef=function(N){return{$$typeof:d,render:N}},Te.isValidElement=oe,Te.lazy=function(N){return{$$typeof:p,_payload:{_status:-1,_result:N},_init:H}},Te.memo=function(N,B){return{$$typeof:h,type:N,compare:B===void 0?null:B}},Te.startTransition=function(N){var B=$.T,K={};$.T=K;try{var Q=N(),ie=$.S;ie!==null&&ie(K,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(ne,X)}catch(he){X(he)}finally{$.T=B}},Te.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Te.use=function(N){return $.H.use(N)},Te.useActionState=function(N,B,K){return $.H.useActionState(N,B,K)},Te.useCallback=function(N,B){return $.H.useCallback(N,B)},Te.useContext=function(N){return $.H.useContext(N)},Te.useDebugValue=function(){},Te.useDeferredValue=function(N,B){return $.H.useDeferredValue(N,B)},Te.useEffect=function(N,B,K){var Q=$.H;if(typeof K=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Q.useEffect(N,B)},Te.useId=function(){return $.H.useId()},Te.useImperativeHandle=function(N,B,K){return $.H.useImperativeHandle(N,B,K)},Te.useInsertionEffect=function(N,B){return $.H.useInsertionEffect(N,B)},Te.useLayoutEffect=function(N,B){return $.H.useLayoutEffect(N,B)},Te.useMemo=function(N,B){return $.H.useMemo(N,B)},Te.useOptimistic=function(N,B){return $.H.useOptimistic(N,B)},Te.useReducer=function(N,B,K){return $.H.useReducer(N,B,K)},Te.useRef=function(N){return $.H.useRef(N)},Te.useState=function(N){return $.H.useState(N)},Te.useSyncExternalStore=function(N,B,K){return $.H.useSyncExternalStore(N,B,K)},Te.useTransition=function(){return $.H.useTransition()},Te.version="19.1.0",Te}var uw;function _y(){return uw||(uw=1,Im.exports=IN()),Im.exports}var St=_y();const PN=vs(St);var Pm={exports:{}},Go={},Mm={exports:{}},Lm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cw;function MN(){return cw||(cw=1,function(r){function e(P,H){var X=P.length;P.push(H);e:for(;0<X;){var ne=X-1>>>1,N=P[ne];if(0<a(N,H))P[ne]=H,P[X]=N,X=ne;else break e}}function t(P){return P.length===0?null:P[0]}function n(P){if(P.length===0)return null;var H=P[0],X=P.pop();if(X!==H){P[0]=X;e:for(var ne=0,N=P.length,B=N>>>1;ne<B;){var K=2*(ne+1)-1,Q=P[K],ie=K+1,he=P[ie];if(0>a(Q,X))ie<N&&0>a(he,Q)?(P[ne]=he,P[ie]=X,ne=ie):(P[ne]=Q,P[K]=X,ne=K);else if(ie<N&&0>a(he,X))P[ne]=he,P[ie]=X,ne=ie;else break e}}return H}function a(P,H){var X=P.sortIndex-H.sortIndex;return X!==0?X:P.id-H.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var u=Date,d=u.now();r.unstable_now=function(){return u.now()-d}}var f=[],h=[],p=1,y=null,_=3,b=!1,v=!1,S=!1,x=!1,E=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function j(P){for(var H=t(h);H!==null;){if(H.callback===null)n(h);else if(H.startTime<=P)n(h),H.sortIndex=H.expirationTime,e(f,H);else break;H=t(h)}}function $(P){if(S=!1,j(P),!v)if(t(f)!==null)v=!0,q||(q=!0,Ge());else{var H=t(h);H!==null&&ee($,H.startTime-P)}}var q=!1,Z=-1,Y=5,oe=-1;function $e(){return x?!0:!(r.unstable_now()-oe<Y)}function Se(){if(x=!1,q){var P=r.unstable_now();oe=P;var H=!0;try{e:{v=!1,S&&(S=!1,R(Z),Z=-1),b=!0;var X=_;try{t:{for(j(P),y=t(f);y!==null&&!(y.expirationTime>P&&$e());){var ne=y.callback;if(typeof ne=="function"){y.callback=null,_=y.priorityLevel;var N=ne(y.expirationTime<=P);if(P=r.unstable_now(),typeof N=="function"){y.callback=N,j(P),H=!0;break t}y===t(f)&&n(f),j(P)}else n(f);y=t(f)}if(y!==null)H=!0;else{var B=t(h);B!==null&&ee($,B.startTime-P),H=!1}}break e}finally{y=null,_=X,b=!1}H=void 0}}finally{H?Ge():q=!1}}}var Ge;if(typeof T=="function")Ge=function(){T(Se)};else if(typeof MessageChannel<"u"){var At=new MessageChannel,re=At.port2;At.port1.onmessage=Se,Ge=function(){re.postMessage(null)}}else Ge=function(){E(Se,0)};function ee(P,H){Z=E(function(){P(r.unstable_now())},H)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(P){P.callback=null},r.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<P?Math.floor(1e3/P):5},r.unstable_getCurrentPriorityLevel=function(){return _},r.unstable_next=function(P){switch(_){case 1:case 2:case 3:var H=3;break;default:H=_}var X=_;_=H;try{return P()}finally{_=X}},r.unstable_requestPaint=function(){x=!0},r.unstable_runWithPriority=function(P,H){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var X=_;_=P;try{return H()}finally{_=X}},r.unstable_scheduleCallback=function(P,H,X){var ne=r.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?ne+X:ne):X=ne,P){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=X+N,P={id:p++,callback:H,priorityLevel:P,startTime:X,expirationTime:N,sortIndex:-1},X>ne?(P.sortIndex=X,e(h,P),t(f)===null&&P===t(h)&&(S?(R(Z),Z=-1):S=!0,ee($,X-ne))):(P.sortIndex=N,e(f,P),v||b||(v=!0,q||(q=!0,Ge()))),P},r.unstable_shouldYield=$e,r.unstable_wrapCallback=function(P){var H=_;return function(){var X=_;_=H;try{return P.apply(this,arguments)}finally{_=X}}}}(Lm)),Lm}var dw;function LN(){return dw||(dw=1,Mm.exports=MN()),Mm.exports}var Dm={exports:{}},Gt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fw;function DN(){if(fw)return Gt;fw=1;var r=_y();function e(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(f,h,p){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:y==null?null:""+y,children:f,containerInfo:h,implementation:p}}var u=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Gt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Gt.createPortal=function(f,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return o(f,h,null,p)},Gt.flushSync=function(f){var h=u.T,p=n.p;try{if(u.T=null,n.p=2,f)return f()}finally{u.T=h,n.p=p,n.d.f()}},Gt.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(f,h))},Gt.prefetchDNS=function(f){typeof f=="string"&&n.d.D(f)},Gt.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var p=h.as,y=d(p,h.crossOrigin),_=typeof h.integrity=="string"?h.integrity:void 0,b=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?n.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:y,integrity:_,fetchPriority:b}):p==="script"&&n.d.X(f,{crossOrigin:y,integrity:_,fetchPriority:b,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Gt.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=d(h.as,h.crossOrigin);n.d.M(f,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(f)},Gt.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,y=d(p,h.crossOrigin);n.d.L(f,p,{crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Gt.preloadModule=function(f,h){if(typeof f=="string")if(h){var p=d(h.as,h.crossOrigin);n.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(f)},Gt.requestFormReset=function(f){n.d.r(f)},Gt.unstable_batchedUpdates=function(f,h){return f(h)},Gt.useFormState=function(f,h,p){return u.H.useFormState(f,h,p)},Gt.useFormStatus=function(){return u.H.useHostTransitionStatus()},Gt.version="19.1.0",Gt}var hw;function UN(){if(hw)return Dm.exports;hw=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Dm.exports=DN(),Dm.exports}var mw;function zN(){if(mw)return Go;mw=1;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=LN(),e=_y(),t=UN();function n(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function u(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function d(s){if(o(s)!==s)throw Error(n(188))}function f(s){var i=s.alternate;if(!i){if(i=o(s),i===null)throw Error(n(188));return i!==s?null:s}for(var l=s,c=i;;){var m=l.return;if(m===null)break;var g=m.alternate;if(g===null){if(c=m.return,c!==null){l=c;continue}break}if(m.child===g.child){for(g=m.child;g;){if(g===l)return d(m),s;if(g===c)return d(m),i;g=g.sibling}throw Error(n(188))}if(l.return!==c.return)l=m,c=g;else{for(var w=!1,A=m.child;A;){if(A===l){w=!0,l=m,c=g;break}if(A===c){w=!0,c=m,l=g;break}A=A.sibling}if(!w){for(A=g.child;A;){if(A===l){w=!0,l=g,c=m;break}if(A===c){w=!0,c=g,l=m;break}A=A.sibling}if(!w)throw Error(n(189))}}if(l.alternate!==c)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?s:i}function h(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=h(s),i!==null)return i;s=s.sibling}return null}var p=Object.assign,y=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),R=Symbol.for("react.consumer"),T=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),Z=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),oe=Symbol.for("react.activity"),$e=Symbol.for("react.memo_cache_sentinel"),Se=Symbol.iterator;function Ge(s){return s===null||typeof s!="object"?null:(s=Se&&s[Se]||s["@@iterator"],typeof s=="function"?s:null)}var At=Symbol.for("react.client.reference");function re(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===At?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case v:return"Fragment";case x:return"Profiler";case S:return"StrictMode";case $:return"Suspense";case q:return"SuspenseList";case oe:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case b:return"Portal";case T:return(s.displayName||"Context")+".Provider";case R:return(s._context.displayName||"Context")+".Consumer";case j:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case Z:return i=s.displayName||null,i!==null?i:re(s.type)||"Memo";case Y:i=s._payload,s=s._init;try{return re(s(i))}catch{}}return null}var ee=Array.isArray,P=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X={pending:!1,data:null,method:null,action:null},ne=[],N=-1;function B(s){return{current:s}}function K(s){0>N||(s.current=ne[N],ne[N]=null,N--)}function Q(s,i){N++,ne[N]=s.current,s.current=i}var ie=B(null),he=B(null),pe=B(null),ct=B(null);function et(s,i){switch(Q(pe,i),Q(he,s),Q(ie,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?I0(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=I0(i),s=P0(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}K(ie),Q(ie,s)}function jn(){K(ie),K(he),K(pe)}function qa(s){s.memoizedState!==null&&Q(ct,s);var i=ie.current,l=P0(i,s.type);i!==l&&(Q(he,s),Q(ie,l))}function ws(s){he.current===s&&(K(ie),K(he)),ct.current===s&&(K(ct),Do._currentValue=X)}var bf=Object.prototype.hasOwnProperty,vf=r.unstable_scheduleCallback,wf=r.unstable_cancelCallback,lT=r.unstable_shouldYield,uT=r.unstable_requestPaint,fr=r.unstable_now,cT=r.unstable_getCurrentPriorityLevel,m_=r.unstable_ImmediatePriority,p_=r.unstable_UserBlockingPriority,au=r.unstable_NormalPriority,dT=r.unstable_LowPriority,g_=r.unstable_IdlePriority,fT=r.log,hT=r.unstable_setDisableYieldValue,Fi=null,mn=null;function ta(s){if(typeof fT=="function"&&hT(s),mn&&typeof mn.setStrictMode=="function")try{mn.setStrictMode(Fi,s)}catch{}}var pn=Math.clz32?Math.clz32:gT,mT=Math.log,pT=Math.LN2;function gT(s){return s>>>=0,s===0?32:31-(mT(s)/pT|0)|0}var su=256,iu=4194304;function Ha(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ou(s,i,l){var c=s.pendingLanes;if(c===0)return 0;var m=0,g=s.suspendedLanes,w=s.pingedLanes;s=s.warmLanes;var A=c&134217727;return A!==0?(c=A&~g,c!==0?m=Ha(c):(w&=A,w!==0?m=Ha(w):l||(l=A&~s,l!==0&&(m=Ha(l))))):(A=c&~g,A!==0?m=Ha(A):w!==0?m=Ha(w):l||(l=c&~s,l!==0&&(m=Ha(l)))),m===0?0:i!==0&&i!==m&&(i&g)===0&&(g=m&-m,l=i&-i,g>=l||g===32&&(l&4194048)!==0)?i:m}function Zi(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function yT(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function y_(){var s=su;return su<<=1,(su&4194048)===0&&(su=256),s}function __(){var s=iu;return iu<<=1,(iu&62914560)===0&&(iu=4194304),s}function Sf(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function Vi(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function _T(s,i,l,c,m,g){var w=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var A=s.entanglements,C=s.expirationTimes,L=s.hiddenUpdates;for(l=w&~l;0<l;){var F=31-pn(l),J=1<<F;A[F]=0,C[F]=-1;var U=L[F];if(U!==null)for(L[F]=null,F=0;F<U.length;F++){var z=U[F];z!==null&&(z.lane&=-536870913)}l&=~J}c!==0&&b_(s,c,0),g!==0&&m===0&&s.tag!==0&&(s.suspendedLanes|=g&~(w&~i))}function b_(s,i,l){s.pendingLanes|=i,s.suspendedLanes&=~i;var c=31-pn(i);s.entangledLanes|=i,s.entanglements[c]=s.entanglements[c]|1073741824|l&4194090}function v_(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var c=31-pn(l),m=1<<c;m&i|s[c]&i&&(s[c]|=i),l&=~m}}function xf(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Ef(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function w_(){var s=H.p;return s!==0?s:(s=window.event,s===void 0?32:ew(s.type))}function bT(s,i){var l=H.p;try{return H.p=s,i()}finally{H.p=l}}var na=Math.random().toString(36).slice(2),qt="__reactFiber$"+na,nn="__reactProps$"+na,Ss="__reactContainer$"+na,Af="__reactEvents$"+na,vT="__reactListeners$"+na,wT="__reactHandles$"+na,S_="__reactResources$"+na,Ji="__reactMarker$"+na;function Of(s){delete s[qt],delete s[nn],delete s[Af],delete s[vT],delete s[wT]}function xs(s){var i=s[qt];if(i)return i;for(var l=s.parentNode;l;){if(i=l[Ss]||l[qt]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=U0(s);s!==null;){if(l=s[qt])return l;s=U0(s)}return i}s=l,l=s.parentNode}return null}function Es(s){if(s=s[qt]||s[Ss]){var i=s.tag;if(i===5||i===6||i===13||i===26||i===27||i===3)return s}return null}function Ki(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(n(33))}function As(s){var i=s[S_];return i||(i=s[S_]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Ot(s){s[Ji]=!0}var x_=new Set,E_={};function Ga(s,i){Os(s,i),Os(s+"Capture",i)}function Os(s,i){for(E_[s]=i,s=0;s<i.length;s++)x_.add(i[s])}var ST=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),A_={},O_={};function xT(s){return bf.call(O_,s)?!0:bf.call(A_,s)?!1:ST.test(s)?O_[s]=!0:(A_[s]=!0,!1)}function lu(s,i,l){if(xT(i))if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var c=i.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+l)}}function uu(s,i,l){if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+l)}}function Rr(s,i,l,c){if(c===null)s.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(i,l,""+c)}}var Tf,T_;function Ts(s){if(Tf===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);Tf=i&&i[1]||"",T_=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Tf+s+T_}var Rf=!1;function Nf(s,i){if(!s||Rf)return"";Rf=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(i){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(z){var U=z}Reflect.construct(s,[],J)}else{try{J.call()}catch(z){U=z}s.call(J.prototype)}}else{try{throw Error()}catch(z){U=z}(J=s())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(z){if(z&&U&&typeof z.stack=="string")return[z.stack,U.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),w=g[0],A=g[1];if(w&&A){var C=w.split(`
`),L=A.split(`
`);for(m=c=0;c<C.length&&!C[c].includes("DetermineComponentFrameRoot");)c++;for(;m<L.length&&!L[m].includes("DetermineComponentFrameRoot");)m++;if(c===C.length||m===L.length)for(c=C.length-1,m=L.length-1;1<=c&&0<=m&&C[c]!==L[m];)m--;for(;1<=c&&0<=m;c--,m--)if(C[c]!==L[m]){if(c!==1||m!==1)do if(c--,m--,0>m||C[c]!==L[m]){var F=`
`+C[c].replace(" at new "," at ");return s.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",s.displayName)),F}while(1<=c&&0<=m);break}}}finally{Rf=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?Ts(l):""}function ET(s){switch(s.tag){case 26:case 27:case 5:return Ts(s.type);case 16:return Ts("Lazy");case 13:return Ts("Suspense");case 19:return Ts("SuspenseList");case 0:case 15:return Nf(s.type,!1);case 11:return Nf(s.type.render,!1);case 1:return Nf(s.type,!0);case 31:return Ts("Activity");default:return""}}function R_(s){try{var i="";do i+=ET(s),s=s.return;while(s);return i}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function $n(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function N_(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function AT(s){var i=N_(s)?"checked":"value",l=Object.getOwnPropertyDescriptor(s.constructor.prototype,i),c=""+s[i];if(!s.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var m=l.get,g=l.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return m.call(this)},set:function(w){c=""+w,g.call(this,w)}}),Object.defineProperty(s,i,{enumerable:l.enumerable}),{getValue:function(){return c},setValue:function(w){c=""+w},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function cu(s){s._valueTracker||(s._valueTracker=AT(s))}function C_(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),c="";return s&&(c=N_(s)?s.checked?"true":"false":s.value),s=c,s!==l?(i.setValue(s),!0):!1}function du(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var OT=/[\n"\\]/g;function In(s){return s.replace(OT,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Cf(s,i,l,c,m,g,w,A){s.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?s.type=w:s.removeAttribute("type"),i!=null?w==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+$n(i)):s.value!==""+$n(i)&&(s.value=""+$n(i)):w!=="submit"&&w!=="reset"||s.removeAttribute("value"),i!=null?kf(s,w,$n(i)):l!=null?kf(s,w,$n(l)):c!=null&&s.removeAttribute("value"),m==null&&g!=null&&(s.defaultChecked=!!g),m!=null&&(s.checked=m&&typeof m!="function"&&typeof m!="symbol"),A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?s.name=""+$n(A):s.removeAttribute("name")}function k_(s,i,l,c,m,g,w,A){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(s.type=g),i!=null||l!=null){if(!(g!=="submit"&&g!=="reset"||i!=null))return;l=l!=null?""+$n(l):"",i=i!=null?""+$n(i):l,A||i===s.value||(s.value=i),s.defaultValue=i}c=c??m,c=typeof c!="function"&&typeof c!="symbol"&&!!c,s.checked=A?s.checked:!!c,s.defaultChecked=!!c,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.name=w)}function kf(s,i,l){i==="number"&&du(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function Rs(s,i,l,c){if(s=s.options,i){i={};for(var m=0;m<l.length;m++)i["$"+l[m]]=!0;for(l=0;l<s.length;l++)m=i.hasOwnProperty("$"+s[l].value),s[l].selected!==m&&(s[l].selected=m),m&&c&&(s[l].defaultSelected=!0)}else{for(l=""+$n(l),i=null,m=0;m<s.length;m++){if(s[m].value===l){s[m].selected=!0,c&&(s[m].defaultSelected=!0);return}i!==null||s[m].disabled||(i=s[m])}i!==null&&(i.selected=!0)}}function j_(s,i,l){if(i!=null&&(i=""+$n(i),i!==s.value&&(s.value=i),l==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=l!=null?""+$n(l):""}function $_(s,i,l,c){if(i==null){if(c!=null){if(l!=null)throw Error(n(92));if(ee(c)){if(1<c.length)throw Error(n(93));c=c[0]}l=c}l==null&&(l=""),i=l}l=$n(i),s.defaultValue=l,c=s.textContent,c===l&&c!==""&&c!==null&&(s.value=c)}function Ns(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var TT=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function I_(s,i,l){var c=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":c?s.setProperty(i,l):typeof l!="number"||l===0||TT.has(i)?i==="float"?s.cssFloat=l:s[i]=(""+l).trim():s[i]=l+"px"}function P_(s,i,l){if(i!=null&&typeof i!="object")throw Error(n(62));if(s=s.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||i!=null&&i.hasOwnProperty(c)||(c.indexOf("--")===0?s.setProperty(c,""):c==="float"?s.cssFloat="":s[c]="");for(var m in i)c=i[m],i.hasOwnProperty(m)&&l[m]!==c&&I_(s,m,c)}else for(var g in i)i.hasOwnProperty(g)&&I_(s,g,i[g])}function jf(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var RT=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),NT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function fu(s){return NT.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var $f=null;function If(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Cs=null,ks=null;function M_(s){var i=Es(s);if(i&&(s=i.stateNode)){var l=s[nn]||null;e:switch(s=i.stateNode,i.type){case"input":if(Cf(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+In(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var c=l[i];if(c!==s&&c.form===s.form){var m=c[nn]||null;if(!m)throw Error(n(90));Cf(c,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(i=0;i<l.length;i++)c=l[i],c.form===s.form&&C_(c)}break e;case"textarea":j_(s,l.value,l.defaultValue);break e;case"select":i=l.value,i!=null&&Rs(s,!!l.multiple,i,!1)}}}var Pf=!1;function L_(s,i,l){if(Pf)return s(i,l);Pf=!0;try{var c=s(i);return c}finally{if(Pf=!1,(Cs!==null||ks!==null)&&(Xu(),Cs&&(i=Cs,s=ks,ks=Cs=null,M_(i),s)))for(i=0;i<s.length;i++)M_(s[i])}}function Yi(s,i){var l=s.stateNode;if(l===null)return null;var c=l[nn]||null;if(c===null)return null;l=c[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(s=s.type,c=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!c;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(n(231,i,typeof l));return l}var Nr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mf=!1;if(Nr)try{var Xi={};Object.defineProperty(Xi,"passive",{get:function(){Mf=!0}}),window.addEventListener("test",Xi,Xi),window.removeEventListener("test",Xi,Xi)}catch{Mf=!1}var ra=null,Lf=null,hu=null;function D_(){if(hu)return hu;var s,i=Lf,l=i.length,c,m="value"in ra?ra.value:ra.textContent,g=m.length;for(s=0;s<l&&i[s]===m[s];s++);var w=l-s;for(c=1;c<=w&&i[l-c]===m[g-c];c++);return hu=m.slice(s,1<c?1-c:void 0)}function mu(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function pu(){return!0}function U_(){return!1}function rn(s){function i(l,c,m,g,w){this._reactName=l,this._targetInst=m,this.type=c,this.nativeEvent=g,this.target=w,this.currentTarget=null;for(var A in s)s.hasOwnProperty(A)&&(l=s[A],this[A]=l?l(g):g[A]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?pu:U_,this.isPropagationStopped=U_,this}return p(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=pu)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=pu)},persist:function(){},isPersistent:pu}),i}var Fa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gu=rn(Fa),Qi=p({},Fa,{view:0,detail:0}),CT=rn(Qi),Df,Uf,Wi,yu=p({},Qi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bf,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Wi&&(Wi&&s.type==="mousemove"?(Df=s.screenX-Wi.screenX,Uf=s.screenY-Wi.screenY):Uf=Df=0,Wi=s),Df)},movementY:function(s){return"movementY"in s?s.movementY:Uf}}),z_=rn(yu),kT=p({},yu,{dataTransfer:0}),jT=rn(kT),$T=p({},Qi,{relatedTarget:0}),zf=rn($T),IT=p({},Fa,{animationName:0,elapsedTime:0,pseudoElement:0}),PT=rn(IT),MT=p({},Fa,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),LT=rn(MT),DT=p({},Fa,{data:0}),B_=rn(DT),UT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qT(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=BT[s])?!!i[s]:!1}function Bf(){return qT}var HT=p({},Qi,{key:function(s){if(s.key){var i=UT[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=mu(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?zT[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bf,charCode:function(s){return s.type==="keypress"?mu(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?mu(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),GT=rn(HT),FT=p({},yu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),q_=rn(FT),ZT=p({},Qi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bf}),VT=rn(ZT),JT=p({},Fa,{propertyName:0,elapsedTime:0,pseudoElement:0}),KT=rn(JT),YT=p({},yu,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),XT=rn(YT),QT=p({},Fa,{newState:0,oldState:0}),WT=rn(QT),eR=[9,13,27,32],qf=Nr&&"CompositionEvent"in window,eo=null;Nr&&"documentMode"in document&&(eo=document.documentMode);var tR=Nr&&"TextEvent"in window&&!eo,H_=Nr&&(!qf||eo&&8<eo&&11>=eo),G_=" ",F_=!1;function Z_(s,i){switch(s){case"keyup":return eR.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function V_(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var js=!1;function nR(s,i){switch(s){case"compositionend":return V_(i);case"keypress":return i.which!==32?null:(F_=!0,G_);case"textInput":return s=i.data,s===G_&&F_?null:s;default:return null}}function rR(s,i){if(js)return s==="compositionend"||!qf&&Z_(s,i)?(s=D_(),hu=Lf=ra=null,js=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return H_&&i.locale!=="ko"?null:i.data;default:return null}}var aR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function J_(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!aR[s.type]:i==="textarea"}function K_(s,i,l,c){Cs?ks?ks.push(c):ks=[c]:Cs=c,i=rc(i,"onChange"),0<i.length&&(l=new gu("onChange","change",null,l,c),s.push({event:l,listeners:i}))}var to=null,no=null;function sR(s){N0(s,0)}function _u(s){var i=Ki(s);if(C_(i))return s}function Y_(s,i){if(s==="change")return i}var X_=!1;if(Nr){var Hf;if(Nr){var Gf="oninput"in document;if(!Gf){var Q_=document.createElement("div");Q_.setAttribute("oninput","return;"),Gf=typeof Q_.oninput=="function"}Hf=Gf}else Hf=!1;X_=Hf&&(!document.documentMode||9<document.documentMode)}function W_(){to&&(to.detachEvent("onpropertychange",eb),no=to=null)}function eb(s){if(s.propertyName==="value"&&_u(no)){var i=[];K_(i,no,s,If(s)),L_(sR,i)}}function iR(s,i,l){s==="focusin"?(W_(),to=i,no=l,to.attachEvent("onpropertychange",eb)):s==="focusout"&&W_()}function oR(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return _u(no)}function lR(s,i){if(s==="click")return _u(i)}function uR(s,i){if(s==="input"||s==="change")return _u(i)}function cR(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var gn=typeof Object.is=="function"?Object.is:cR;function ro(s,i){if(gn(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),c=Object.keys(i);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var m=l[c];if(!bf.call(i,m)||!gn(s[m],i[m]))return!1}return!0}function tb(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function nb(s,i){var l=tb(s);s=0;for(var c;l;){if(l.nodeType===3){if(c=s+l.textContent.length,s<=i&&c>=i)return{node:l,offset:i-s};s=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=tb(l)}}function rb(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?rb(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function ab(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=du(s.document);i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=du(s.document)}return i}function Ff(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var dR=Nr&&"documentMode"in document&&11>=document.documentMode,$s=null,Zf=null,ao=null,Vf=!1;function sb(s,i,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Vf||$s==null||$s!==du(c)||(c=$s,"selectionStart"in c&&Ff(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),ao&&ro(ao,c)||(ao=c,c=rc(Zf,"onSelect"),0<c.length&&(i=new gu("onSelect","select",null,i,l),s.push({event:i,listeners:c}),i.target=$s)))}function Za(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var Is={animationend:Za("Animation","AnimationEnd"),animationiteration:Za("Animation","AnimationIteration"),animationstart:Za("Animation","AnimationStart"),transitionrun:Za("Transition","TransitionRun"),transitionstart:Za("Transition","TransitionStart"),transitioncancel:Za("Transition","TransitionCancel"),transitionend:Za("Transition","TransitionEnd")},Jf={},ib={};Nr&&(ib=document.createElement("div").style,"AnimationEvent"in window||(delete Is.animationend.animation,delete Is.animationiteration.animation,delete Is.animationstart.animation),"TransitionEvent"in window||delete Is.transitionend.transition);function Va(s){if(Jf[s])return Jf[s];if(!Is[s])return s;var i=Is[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in ib)return Jf[s]=i[l];return s}var ob=Va("animationend"),lb=Va("animationiteration"),ub=Va("animationstart"),fR=Va("transitionrun"),hR=Va("transitionstart"),mR=Va("transitioncancel"),cb=Va("transitionend"),db=new Map,Kf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Kf.push("scrollEnd");function Jn(s,i){db.set(s,i),Ga(i,[s])}var fb=new WeakMap;function Pn(s,i){if(typeof s=="object"&&s!==null){var l=fb.get(s);return l!==void 0?l:(i={value:s,source:i,stack:R_(i)},fb.set(s,i),i)}return{value:s,source:i,stack:R_(i)}}var Mn=[],Ps=0,Yf=0;function bu(){for(var s=Ps,i=Yf=Ps=0;i<s;){var l=Mn[i];Mn[i++]=null;var c=Mn[i];Mn[i++]=null;var m=Mn[i];Mn[i++]=null;var g=Mn[i];if(Mn[i++]=null,c!==null&&m!==null){var w=c.pending;w===null?m.next=m:(m.next=w.next,w.next=m),c.pending=m}g!==0&&hb(l,m,g)}}function vu(s,i,l,c){Mn[Ps++]=s,Mn[Ps++]=i,Mn[Ps++]=l,Mn[Ps++]=c,Yf|=c,s.lanes|=c,s=s.alternate,s!==null&&(s.lanes|=c)}function Xf(s,i,l,c){return vu(s,i,l,c),wu(s)}function Ms(s,i){return vu(s,null,null,i),wu(s)}function hb(s,i,l){s.lanes|=l;var c=s.alternate;c!==null&&(c.lanes|=l);for(var m=!1,g=s.return;g!==null;)g.childLanes|=l,c=g.alternate,c!==null&&(c.childLanes|=l),g.tag===22&&(s=g.stateNode,s===null||s._visibility&1||(m=!0)),s=g,g=g.return;return s.tag===3?(g=s.stateNode,m&&i!==null&&(m=31-pn(l),s=g.hiddenUpdates,c=s[m],c===null?s[m]=[i]:c.push(i),i.lane=l|536870912),g):null}function wu(s){if(50<Co)throw Co=0,rm=null,Error(n(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var Ls={};function pR(s,i,l,c){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yn(s,i,l,c){return new pR(s,i,l,c)}function Qf(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Cr(s,i){var l=s.alternate;return l===null?(l=yn(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function mb(s,i){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function Su(s,i,l,c,m,g){var w=0;if(c=s,typeof s=="function")Qf(s)&&(w=1);else if(typeof s=="string")w=yN(s,l,ie.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case oe:return s=yn(31,l,i,m),s.elementType=oe,s.lanes=g,s;case v:return Ja(l.children,m,g,i);case S:w=8,m|=24;break;case x:return s=yn(12,l,i,m|2),s.elementType=x,s.lanes=g,s;case $:return s=yn(13,l,i,m),s.elementType=$,s.lanes=g,s;case q:return s=yn(19,l,i,m),s.elementType=q,s.lanes=g,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case E:case T:w=10;break e;case R:w=9;break e;case j:w=11;break e;case Z:w=14;break e;case Y:w=16,c=null;break e}w=29,l=Error(n(130,s===null?"null":typeof s,"")),c=null}return i=yn(w,l,i,m),i.elementType=s,i.type=c,i.lanes=g,i}function Ja(s,i,l,c){return s=yn(7,s,c,i),s.lanes=l,s}function Wf(s,i,l){return s=yn(6,s,null,i),s.lanes=l,s}function eh(s,i,l){return i=yn(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var Ds=[],Us=0,xu=null,Eu=0,Ln=[],Dn=0,Ka=null,kr=1,jr="";function Ya(s,i){Ds[Us++]=Eu,Ds[Us++]=xu,xu=s,Eu=i}function pb(s,i,l){Ln[Dn++]=kr,Ln[Dn++]=jr,Ln[Dn++]=Ka,Ka=s;var c=kr;s=jr;var m=32-pn(c)-1;c&=~(1<<m),l+=1;var g=32-pn(i)+m;if(30<g){var w=m-m%5;g=(c&(1<<w)-1).toString(32),c>>=w,m-=w,kr=1<<32-pn(i)+m|l<<m|c,jr=g+s}else kr=1<<g|l<<m|c,jr=s}function th(s){s.return!==null&&(Ya(s,1),pb(s,1,0))}function nh(s){for(;s===xu;)xu=Ds[--Us],Ds[Us]=null,Eu=Ds[--Us],Ds[Us]=null;for(;s===Ka;)Ka=Ln[--Dn],Ln[Dn]=null,jr=Ln[--Dn],Ln[Dn]=null,kr=Ln[--Dn],Ln[Dn]=null}var Vt=null,it=null,He=!1,Xa=null,hr=!1,rh=Error(n(519));function Qa(s){var i=Error(n(418,""));throw oo(Pn(i,s)),rh}function gb(s){var i=s.stateNode,l=s.type,c=s.memoizedProps;switch(i[qt]=s,i[nn]=c,l){case"dialog":Me("cancel",i),Me("close",i);break;case"iframe":case"object":case"embed":Me("load",i);break;case"video":case"audio":for(l=0;l<jo.length;l++)Me(jo[l],i);break;case"source":Me("error",i);break;case"img":case"image":case"link":Me("error",i),Me("load",i);break;case"details":Me("toggle",i);break;case"input":Me("invalid",i),k_(i,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0),cu(i);break;case"select":Me("invalid",i);break;case"textarea":Me("invalid",i),$_(i,c.value,c.defaultValue,c.children),cu(i)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||c.suppressHydrationWarning===!0||$0(i.textContent,l)?(c.popover!=null&&(Me("beforetoggle",i),Me("toggle",i)),c.onScroll!=null&&Me("scroll",i),c.onScrollEnd!=null&&Me("scrollend",i),c.onClick!=null&&(i.onclick=ac),i=!0):i=!1,i||Qa(s)}function yb(s){for(Vt=s.return;Vt;)switch(Vt.tag){case 5:case 13:hr=!1;return;case 27:case 3:hr=!0;return;default:Vt=Vt.return}}function so(s){if(s!==Vt)return!1;if(!He)return yb(s),He=!0,!1;var i=s.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||bm(s.type,s.memoizedProps)),l=!l),l&&it&&Qa(s),yb(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));e:{for(s=s.nextSibling,i=0;s;){if(s.nodeType===8)if(l=s.data,l==="/$"){if(i===0){it=Yn(s.nextSibling);break e}i--}else l!=="$"&&l!=="$!"&&l!=="$?"||i++;s=s.nextSibling}it=null}}else i===27?(i=it,ba(s.type)?(s=xm,xm=null,it=s):it=i):it=Vt?Yn(s.stateNode.nextSibling):null;return!0}function io(){it=Vt=null,He=!1}function _b(){var s=Xa;return s!==null&&(on===null?on=s:on.push.apply(on,s),Xa=null),s}function oo(s){Xa===null?Xa=[s]:Xa.push(s)}var ah=B(null),Wa=null,$r=null;function aa(s,i,l){Q(ah,i._currentValue),i._currentValue=l}function Ir(s){s._currentValue=ah.current,K(ah)}function sh(s,i,l){for(;s!==null;){var c=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,c!==null&&(c.childLanes|=i)):c!==null&&(c.childLanes&i)!==i&&(c.childLanes|=i),s===l)break;s=s.return}}function ih(s,i,l,c){var m=s.child;for(m!==null&&(m.return=s);m!==null;){var g=m.dependencies;if(g!==null){var w=m.child;g=g.firstContext;e:for(;g!==null;){var A=g;g=m;for(var C=0;C<i.length;C++)if(A.context===i[C]){g.lanes|=l,A=g.alternate,A!==null&&(A.lanes|=l),sh(g.return,l,s),c||(w=null);break e}g=A.next}}else if(m.tag===18){if(w=m.return,w===null)throw Error(n(341));w.lanes|=l,g=w.alternate,g!==null&&(g.lanes|=l),sh(w,l,s),w=null}else w=m.child;if(w!==null)w.return=m;else for(w=m;w!==null;){if(w===s){w=null;break}if(m=w.sibling,m!==null){m.return=w.return,w=m;break}w=w.return}m=w}}function lo(s,i,l,c){s=null;for(var m=i,g=!1;m!==null;){if(!g){if((m.flags&524288)!==0)g=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var w=m.alternate;if(w===null)throw Error(n(387));if(w=w.memoizedProps,w!==null){var A=m.type;gn(m.pendingProps.value,w.value)||(s!==null?s.push(A):s=[A])}}else if(m===ct.current){if(w=m.alternate,w===null)throw Error(n(387));w.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(s!==null?s.push(Do):s=[Do])}m=m.return}s!==null&&ih(i,s,l,c),i.flags|=262144}function Au(s){for(s=s.firstContext;s!==null;){if(!gn(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function es(s){Wa=s,$r=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Ht(s){return bb(Wa,s)}function Ou(s,i){return Wa===null&&es(s),bb(s,i)}function bb(s,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},$r===null){if(s===null)throw Error(n(308));$r=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else $r=$r.next=i;return l}var gR=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(l,c){s.push(c)}};this.abort=function(){i.aborted=!0,s.forEach(function(l){return l()})}},yR=r.unstable_scheduleCallback,_R=r.unstable_NormalPriority,yt={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function oh(){return{controller:new gR,data:new Map,refCount:0}}function uo(s){s.refCount--,s.refCount===0&&yR(_R,function(){s.controller.abort()})}var co=null,lh=0,zs=0,Bs=null;function bR(s,i){if(co===null){var l=co=[];lh=0,zs=cm(),Bs={status:"pending",value:void 0,then:function(c){l.push(c)}}}return lh++,i.then(vb,vb),i}function vb(){if(--lh===0&&co!==null){Bs!==null&&(Bs.status="fulfilled");var s=co;co=null,zs=0,Bs=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function vR(s,i){var l=[],c={status:"pending",value:null,reason:null,then:function(m){l.push(m)}};return s.then(function(){c.status="fulfilled",c.value=i;for(var m=0;m<l.length;m++)(0,l[m])(i)},function(m){for(c.status="rejected",c.reason=m,m=0;m<l.length;m++)(0,l[m])(void 0)}),c}var wb=P.S;P.S=function(s,i){typeof i=="object"&&i!==null&&typeof i.then=="function"&&bR(s,i),wb!==null&&wb(s,i)};var ts=B(null);function uh(){var s=ts.current;return s!==null?s:nt.pooledCache}function Tu(s,i){i===null?Q(ts,ts.current):Q(ts,i.pool)}function Sb(){var s=uh();return s===null?null:{parent:yt._currentValue,pool:s}}var fo=Error(n(460)),xb=Error(n(474)),Ru=Error(n(542)),ch={then:function(){}};function Eb(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Nu(){}function Ab(s,i,l){switch(l=s[l],l===void 0?s.push(i):l!==i&&(i.then(Nu,Nu),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,Tb(s),s;default:if(typeof i.status=="string")i.then(Nu,Nu);else{if(s=nt,s!==null&&100<s.shellSuspendCounter)throw Error(n(482));s=i,s.status="pending",s.then(function(c){if(i.status==="pending"){var m=i;m.status="fulfilled",m.value=c}},function(c){if(i.status==="pending"){var m=i;m.status="rejected",m.reason=c}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,Tb(s),s}throw ho=i,fo}}var ho=null;function Ob(){if(ho===null)throw Error(n(459));var s=ho;return ho=null,s}function Tb(s){if(s===fo||s===Ru)throw Error(n(483))}var sa=!1;function dh(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fh(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function ia(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function oa(s,i,l){var c=s.updateQueue;if(c===null)return null;if(c=c.shared,(Ve&2)!==0){var m=c.pending;return m===null?i.next=i:(i.next=m.next,m.next=i),c.pending=i,i=wu(s),hb(s,null,l),i}return vu(s,c,i,l),wu(s)}function mo(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var c=i.lanes;c&=s.pendingLanes,l|=c,i.lanes=l,v_(s,l)}}function hh(s,i){var l=s.updateQueue,c=s.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var m=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var w={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};g===null?m=g=w:g=g.next=w,l=l.next}while(l!==null);g===null?m=g=i:g=g.next=i}else m=g=i;l={baseState:c.baseState,firstBaseUpdate:m,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}var mh=!1;function po(){if(mh){var s=Bs;if(s!==null)throw s}}function go(s,i,l,c){mh=!1;var m=s.updateQueue;sa=!1;var g=m.firstBaseUpdate,w=m.lastBaseUpdate,A=m.shared.pending;if(A!==null){m.shared.pending=null;var C=A,L=C.next;C.next=null,w===null?g=L:w.next=L,w=C;var F=s.alternate;F!==null&&(F=F.updateQueue,A=F.lastBaseUpdate,A!==w&&(A===null?F.firstBaseUpdate=L:A.next=L,F.lastBaseUpdate=C))}if(g!==null){var J=m.baseState;w=0,F=L=C=null,A=g;do{var U=A.lane&-536870913,z=U!==A.lane;if(z?(Ue&U)===U:(c&U)===U){U!==0&&U===zs&&(mh=!0),F!==null&&(F=F.next={lane:0,tag:A.tag,payload:A.payload,callback:null,next:null});e:{var _e=s,ge=A;U=i;var We=l;switch(ge.tag){case 1:if(_e=ge.payload,typeof _e=="function"){J=_e.call(We,J,U);break e}J=_e;break e;case 3:_e.flags=_e.flags&-65537|128;case 0:if(_e=ge.payload,U=typeof _e=="function"?_e.call(We,J,U):_e,U==null)break e;J=p({},J,U);break e;case 2:sa=!0}}U=A.callback,U!==null&&(s.flags|=64,z&&(s.flags|=8192),z=m.callbacks,z===null?m.callbacks=[U]:z.push(U))}else z={lane:U,tag:A.tag,payload:A.payload,callback:A.callback,next:null},F===null?(L=F=z,C=J):F=F.next=z,w|=U;if(A=A.next,A===null){if(A=m.shared.pending,A===null)break;z=A,A=z.next,z.next=null,m.lastBaseUpdate=z,m.shared.pending=null}}while(!0);F===null&&(C=J),m.baseState=C,m.firstBaseUpdate=L,m.lastBaseUpdate=F,g===null&&(m.shared.lanes=0),pa|=w,s.lanes=w,s.memoizedState=J}}function Rb(s,i){if(typeof s!="function")throw Error(n(191,s));s.call(i)}function Nb(s,i){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)Rb(l[s],i)}var qs=B(null),Cu=B(0);function Cb(s,i){s=Br,Q(Cu,s),Q(qs,i),Br=s|i.baseLanes}function ph(){Q(Cu,Br),Q(qs,qs.current)}function gh(){Br=Cu.current,K(qs),K(Cu)}var la=0,ke=null,Xe=null,dt=null,ku=!1,Hs=!1,ns=!1,ju=0,yo=0,Gs=null,wR=0;function lt(){throw Error(n(321))}function yh(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!gn(s[l],i[l]))return!1;return!0}function _h(s,i,l,c,m,g){return la=g,ke=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,P.H=s===null||s.memoizedState===null?hv:mv,ns=!1,g=l(c,m),ns=!1,Hs&&(g=jb(i,l,c,m)),kb(s),g}function kb(s){P.H=Du;var i=Xe!==null&&Xe.next!==null;if(la=0,dt=Xe=ke=null,ku=!1,yo=0,Gs=null,i)throw Error(n(300));s===null||Tt||(s=s.dependencies,s!==null&&Au(s)&&(Tt=!0))}function jb(s,i,l,c){ke=s;var m=0;do{if(Hs&&(Gs=null),yo=0,Hs=!1,25<=m)throw Error(n(301));if(m+=1,dt=Xe=null,s.updateQueue!=null){var g=s.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}P.H=RR,g=i(l,c)}while(Hs);return g}function SR(){var s=P.H,i=s.useState()[0];return i=typeof i.then=="function"?_o(i):i,s=s.useState()[0],(Xe!==null?Xe.memoizedState:null)!==s&&(ke.flags|=1024),i}function bh(){var s=ju!==0;return ju=0,s}function vh(s,i,l){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~l}function wh(s){if(ku){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}ku=!1}la=0,dt=Xe=ke=null,Hs=!1,yo=ju=0,Gs=null}function an(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dt===null?ke.memoizedState=dt=s:dt=dt.next=s,dt}function ft(){if(Xe===null){var s=ke.alternate;s=s!==null?s.memoizedState:null}else s=Xe.next;var i=dt===null?ke.memoizedState:dt.next;if(i!==null)dt=i,Xe=s;else{if(s===null)throw ke.alternate===null?Error(n(467)):Error(n(310));Xe=s,s={memoizedState:Xe.memoizedState,baseState:Xe.baseState,baseQueue:Xe.baseQueue,queue:Xe.queue,next:null},dt===null?ke.memoizedState=dt=s:dt=dt.next=s}return dt}function Sh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function _o(s){var i=yo;return yo+=1,Gs===null&&(Gs=[]),s=Ab(Gs,s,i),i=ke,(dt===null?i.memoizedState:dt.next)===null&&(i=i.alternate,P.H=i===null||i.memoizedState===null?hv:mv),s}function $u(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return _o(s);if(s.$$typeof===T)return Ht(s)}throw Error(n(438,String(s)))}function xh(s){var i=null,l=ke.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var c=ke.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(i={data:c.data.map(function(m){return m.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=Sh(),ke.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(s),c=0;c<s;c++)l[c]=$e;return i.index++,l}function Pr(s,i){return typeof i=="function"?i(s):i}function Iu(s){var i=ft();return Eh(i,Xe,s)}function Eh(s,i,l){var c=s.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=l;var m=s.baseQueue,g=c.pending;if(g!==null){if(m!==null){var w=m.next;m.next=g.next,g.next=w}i.baseQueue=m=g,c.pending=null}if(g=s.baseState,m===null)s.memoizedState=g;else{i=m.next;var A=w=null,C=null,L=i,F=!1;do{var J=L.lane&-536870913;if(J!==L.lane?(Ue&J)===J:(la&J)===J){var U=L.revertLane;if(U===0)C!==null&&(C=C.next={lane:0,revertLane:0,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null}),J===zs&&(F=!0);else if((la&U)===U){L=L.next,U===zs&&(F=!0);continue}else J={lane:0,revertLane:L.revertLane,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null},C===null?(A=C=J,w=g):C=C.next=J,ke.lanes|=U,pa|=U;J=L.action,ns&&l(g,J),g=L.hasEagerState?L.eagerState:l(g,J)}else U={lane:J,revertLane:L.revertLane,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null},C===null?(A=C=U,w=g):C=C.next=U,ke.lanes|=J,pa|=J;L=L.next}while(L!==null&&L!==i);if(C===null?w=g:C.next=A,!gn(g,s.memoizedState)&&(Tt=!0,F&&(l=Bs,l!==null)))throw l;s.memoizedState=g,s.baseState=w,s.baseQueue=C,c.lastRenderedState=g}return m===null&&(c.lanes=0),[s.memoizedState,c.dispatch]}function Ah(s){var i=ft(),l=i.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=s;var c=l.dispatch,m=l.pending,g=i.memoizedState;if(m!==null){l.pending=null;var w=m=m.next;do g=s(g,w.action),w=w.next;while(w!==m);gn(g,i.memoizedState)||(Tt=!0),i.memoizedState=g,i.baseQueue===null&&(i.baseState=g),l.lastRenderedState=g}return[g,c]}function $b(s,i,l){var c=ke,m=ft(),g=He;if(g){if(l===void 0)throw Error(n(407));l=l()}else l=i();var w=!gn((Xe||m).memoizedState,l);w&&(m.memoizedState=l,Tt=!0),m=m.queue;var A=Mb.bind(null,c,m,s);if(bo(2048,8,A,[s]),m.getSnapshot!==i||w||dt!==null&&dt.memoizedState.tag&1){if(c.flags|=2048,Fs(9,Pu(),Pb.bind(null,c,m,l,i),null),nt===null)throw Error(n(349));g||(la&124)!==0||Ib(c,i,l)}return l}function Ib(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=ke.updateQueue,i===null?(i=Sh(),ke.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function Pb(s,i,l,c){i.value=l,i.getSnapshot=c,Lb(i)&&Db(s)}function Mb(s,i,l){return l(function(){Lb(i)&&Db(s)})}function Lb(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!gn(s,l)}catch{return!0}}function Db(s){var i=Ms(s,2);i!==null&&Sn(i,s,2)}function Oh(s){var i=an();if(typeof s=="function"){var l=s;if(s=l(),ns){ta(!0);try{l()}finally{ta(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:s},i}function Ub(s,i,l,c){return s.baseState=l,Eh(s,Xe,typeof c=="function"?c:Pr)}function xR(s,i,l,c,m){if(Lu(s))throw Error(n(485));if(s=i.action,s!==null){var g={payload:m,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){g.listeners.push(w)}};P.T!==null?l(!0):g.isTransition=!1,c(g),l=i.pending,l===null?(g.next=i.pending=g,zb(i,g)):(g.next=l.next,i.pending=l.next=g)}}function zb(s,i){var l=i.action,c=i.payload,m=s.state;if(i.isTransition){var g=P.T,w={};P.T=w;try{var A=l(m,c),C=P.S;C!==null&&C(w,A),Bb(s,i,A)}catch(L){Th(s,i,L)}finally{P.T=g}}else try{g=l(m,c),Bb(s,i,g)}catch(L){Th(s,i,L)}}function Bb(s,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){qb(s,i,c)},function(c){return Th(s,i,c)}):qb(s,i,l)}function qb(s,i,l){i.status="fulfilled",i.value=l,Hb(i),s.state=l,i=s.pending,i!==null&&(l=i.next,l===i?s.pending=null:(l=l.next,i.next=l,zb(s,l)))}function Th(s,i,l){var c=s.pending;if(s.pending=null,c!==null){c=c.next;do i.status="rejected",i.reason=l,Hb(i),i=i.next;while(i!==c)}s.action=null}function Hb(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function Gb(s,i){return i}function Fb(s,i){if(He){var l=nt.formState;if(l!==null){e:{var c=ke;if(He){if(it){t:{for(var m=it,g=hr;m.nodeType!==8;){if(!g){m=null;break t}if(m=Yn(m.nextSibling),m===null){m=null;break t}}g=m.data,m=g==="F!"||g==="F"?m:null}if(m){it=Yn(m.nextSibling),c=m.data==="F!";break e}}Qa(c)}c=!1}c&&(i=l[0])}}return l=an(),l.memoizedState=l.baseState=i,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gb,lastRenderedState:i},l.queue=c,l=cv.bind(null,ke,c),c.dispatch=l,c=Oh(!1),g=jh.bind(null,ke,!1,c.queue),c=an(),m={state:i,dispatch:null,action:s,pending:null},c.queue=m,l=xR.bind(null,ke,m,g,l),m.dispatch=l,c.memoizedState=s,[i,l,!1]}function Zb(s){var i=ft();return Vb(i,Xe,s)}function Vb(s,i,l){if(i=Eh(s,i,Gb)[0],s=Iu(Pr)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var c=_o(i)}catch(w){throw w===fo?Ru:w}else c=i;i=ft();var m=i.queue,g=m.dispatch;return l!==i.memoizedState&&(ke.flags|=2048,Fs(9,Pu(),ER.bind(null,m,l),null)),[c,g,s]}function ER(s,i){s.action=i}function Jb(s){var i=ft(),l=Xe;if(l!==null)return Vb(i,l,s);ft(),i=i.memoizedState,l=ft();var c=l.queue.dispatch;return l.memoizedState=s,[i,c,!1]}function Fs(s,i,l,c){return s={tag:s,create:l,deps:c,inst:i,next:null},i=ke.updateQueue,i===null&&(i=Sh(),ke.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=s.next=s:(c=l.next,l.next=s,s.next=c,i.lastEffect=s),s}function Pu(){return{destroy:void 0,resource:void 0}}function Kb(){return ft().memoizedState}function Mu(s,i,l,c){var m=an();c=c===void 0?null:c,ke.flags|=s,m.memoizedState=Fs(1|i,Pu(),l,c)}function bo(s,i,l,c){var m=ft();c=c===void 0?null:c;var g=m.memoizedState.inst;Xe!==null&&c!==null&&yh(c,Xe.memoizedState.deps)?m.memoizedState=Fs(i,g,l,c):(ke.flags|=s,m.memoizedState=Fs(1|i,g,l,c))}function Yb(s,i){Mu(8390656,8,s,i)}function Xb(s,i){bo(2048,8,s,i)}function Qb(s,i){return bo(4,2,s,i)}function Wb(s,i){return bo(4,4,s,i)}function ev(s,i){if(typeof i=="function"){s=s();var l=i(s);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function tv(s,i,l){l=l!=null?l.concat([s]):null,bo(4,4,ev.bind(null,i,s),l)}function Rh(){}function nv(s,i){var l=ft();i=i===void 0?null:i;var c=l.memoizedState;return i!==null&&yh(i,c[1])?c[0]:(l.memoizedState=[s,i],s)}function rv(s,i){var l=ft();i=i===void 0?null:i;var c=l.memoizedState;if(i!==null&&yh(i,c[1]))return c[0];if(c=s(),ns){ta(!0);try{s()}finally{ta(!1)}}return l.memoizedState=[c,i],c}function Nh(s,i,l){return l===void 0||(la&1073741824)!==0?s.memoizedState=i:(s.memoizedState=l,s=i0(),ke.lanes|=s,pa|=s,l)}function av(s,i,l,c){return gn(l,i)?l:qs.current!==null?(s=Nh(s,l,c),gn(s,i)||(Tt=!0),s):(la&42)===0?(Tt=!0,s.memoizedState=l):(s=i0(),ke.lanes|=s,pa|=s,i)}function sv(s,i,l,c,m){var g=H.p;H.p=g!==0&&8>g?g:8;var w=P.T,A={};P.T=A,jh(s,!1,i,l);try{var C=m(),L=P.S;if(L!==null&&L(A,C),C!==null&&typeof C=="object"&&typeof C.then=="function"){var F=vR(C,c);vo(s,i,F,wn(s))}else vo(s,i,c,wn(s))}catch(J){vo(s,i,{then:function(){},status:"rejected",reason:J},wn())}finally{H.p=g,P.T=w}}function AR(){}function Ch(s,i,l,c){if(s.tag!==5)throw Error(n(476));var m=iv(s).queue;sv(s,m,i,X,l===null?AR:function(){return ov(s),l(c)})}function iv(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:X,baseState:X,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:X},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:l},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function ov(s){var i=iv(s).next.queue;vo(s,i,{},wn())}function kh(){return Ht(Do)}function lv(){return ft().memoizedState}function uv(){return ft().memoizedState}function OR(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var l=wn();s=ia(l);var c=oa(i,s,l);c!==null&&(Sn(c,i,l),mo(c,i,l)),i={cache:oh()},s.payload=i;return}i=i.return}}function TR(s,i,l){var c=wn();l={lane:c,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},Lu(s)?dv(i,l):(l=Xf(s,i,l,c),l!==null&&(Sn(l,s,c),fv(l,i,c)))}function cv(s,i,l){var c=wn();vo(s,i,l,c)}function vo(s,i,l,c){var m={lane:c,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(Lu(s))dv(i,m);else{var g=s.alternate;if(s.lanes===0&&(g===null||g.lanes===0)&&(g=i.lastRenderedReducer,g!==null))try{var w=i.lastRenderedState,A=g(w,l);if(m.hasEagerState=!0,m.eagerState=A,gn(A,w))return vu(s,i,m,0),nt===null&&bu(),!1}catch{}finally{}if(l=Xf(s,i,m,c),l!==null)return Sn(l,s,c),fv(l,i,c),!0}return!1}function jh(s,i,l,c){if(c={lane:2,revertLane:cm(),action:c,hasEagerState:!1,eagerState:null,next:null},Lu(s)){if(i)throw Error(n(479))}else i=Xf(s,l,c,2),i!==null&&Sn(i,s,2)}function Lu(s){var i=s.alternate;return s===ke||i!==null&&i===ke}function dv(s,i){Hs=ku=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function fv(s,i,l){if((l&4194048)!==0){var c=i.lanes;c&=s.pendingLanes,l|=c,i.lanes=l,v_(s,l)}}var Du={readContext:Ht,use:$u,useCallback:lt,useContext:lt,useEffect:lt,useImperativeHandle:lt,useLayoutEffect:lt,useInsertionEffect:lt,useMemo:lt,useReducer:lt,useRef:lt,useState:lt,useDebugValue:lt,useDeferredValue:lt,useTransition:lt,useSyncExternalStore:lt,useId:lt,useHostTransitionStatus:lt,useFormState:lt,useActionState:lt,useOptimistic:lt,useMemoCache:lt,useCacheRefresh:lt},hv={readContext:Ht,use:$u,useCallback:function(s,i){return an().memoizedState=[s,i===void 0?null:i],s},useContext:Ht,useEffect:Yb,useImperativeHandle:function(s,i,l){l=l!=null?l.concat([s]):null,Mu(4194308,4,ev.bind(null,i,s),l)},useLayoutEffect:function(s,i){return Mu(4194308,4,s,i)},useInsertionEffect:function(s,i){Mu(4,2,s,i)},useMemo:function(s,i){var l=an();i=i===void 0?null:i;var c=s();if(ns){ta(!0);try{s()}finally{ta(!1)}}return l.memoizedState=[c,i],c},useReducer:function(s,i,l){var c=an();if(l!==void 0){var m=l(i);if(ns){ta(!0);try{l(i)}finally{ta(!1)}}}else m=i;return c.memoizedState=c.baseState=m,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:m},c.queue=s,s=s.dispatch=TR.bind(null,ke,s),[c.memoizedState,s]},useRef:function(s){var i=an();return s={current:s},i.memoizedState=s},useState:function(s){s=Oh(s);var i=s.queue,l=cv.bind(null,ke,i);return i.dispatch=l,[s.memoizedState,l]},useDebugValue:Rh,useDeferredValue:function(s,i){var l=an();return Nh(l,s,i)},useTransition:function(){var s=Oh(!1);return s=sv.bind(null,ke,s.queue,!0,!1),an().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,l){var c=ke,m=an();if(He){if(l===void 0)throw Error(n(407));l=l()}else{if(l=i(),nt===null)throw Error(n(349));(Ue&124)!==0||Ib(c,i,l)}m.memoizedState=l;var g={value:l,getSnapshot:i};return m.queue=g,Yb(Mb.bind(null,c,g,s),[s]),c.flags|=2048,Fs(9,Pu(),Pb.bind(null,c,g,l,i),null),l},useId:function(){var s=an(),i=nt.identifierPrefix;if(He){var l=jr,c=kr;l=(c&~(1<<32-pn(c)-1)).toString(32)+l,i="«"+i+"R"+l,l=ju++,0<l&&(i+="H"+l.toString(32)),i+="»"}else l=wR++,i="«"+i+"r"+l.toString(32)+"»";return s.memoizedState=i},useHostTransitionStatus:kh,useFormState:Fb,useActionState:Fb,useOptimistic:function(s){var i=an();i.memoizedState=i.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=jh.bind(null,ke,!0,l),l.dispatch=i,[s,i]},useMemoCache:xh,useCacheRefresh:function(){return an().memoizedState=OR.bind(null,ke)}},mv={readContext:Ht,use:$u,useCallback:nv,useContext:Ht,useEffect:Xb,useImperativeHandle:tv,useInsertionEffect:Qb,useLayoutEffect:Wb,useMemo:rv,useReducer:Iu,useRef:Kb,useState:function(){return Iu(Pr)},useDebugValue:Rh,useDeferredValue:function(s,i){var l=ft();return av(l,Xe.memoizedState,s,i)},useTransition:function(){var s=Iu(Pr)[0],i=ft().memoizedState;return[typeof s=="boolean"?s:_o(s),i]},useSyncExternalStore:$b,useId:lv,useHostTransitionStatus:kh,useFormState:Zb,useActionState:Zb,useOptimistic:function(s,i){var l=ft();return Ub(l,Xe,s,i)},useMemoCache:xh,useCacheRefresh:uv},RR={readContext:Ht,use:$u,useCallback:nv,useContext:Ht,useEffect:Xb,useImperativeHandle:tv,useInsertionEffect:Qb,useLayoutEffect:Wb,useMemo:rv,useReducer:Ah,useRef:Kb,useState:function(){return Ah(Pr)},useDebugValue:Rh,useDeferredValue:function(s,i){var l=ft();return Xe===null?Nh(l,s,i):av(l,Xe.memoizedState,s,i)},useTransition:function(){var s=Ah(Pr)[0],i=ft().memoizedState;return[typeof s=="boolean"?s:_o(s),i]},useSyncExternalStore:$b,useId:lv,useHostTransitionStatus:kh,useFormState:Jb,useActionState:Jb,useOptimistic:function(s,i){var l=ft();return Xe!==null?Ub(l,Xe,s,i):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:xh,useCacheRefresh:uv},Zs=null,wo=0;function Uu(s){var i=wo;return wo+=1,Zs===null&&(Zs=[]),Ab(Zs,s,i)}function So(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function zu(s,i){throw i.$$typeof===y?Error(n(525)):(s=Object.prototype.toString.call(i),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function pv(s){var i=s._init;return i(s._payload)}function gv(s){function i(I,k){if(s){var M=I.deletions;M===null?(I.deletions=[k],I.flags|=16):M.push(k)}}function l(I,k){if(!s)return null;for(;k!==null;)i(I,k),k=k.sibling;return null}function c(I){for(var k=new Map;I!==null;)I.key!==null?k.set(I.key,I):k.set(I.index,I),I=I.sibling;return k}function m(I,k){return I=Cr(I,k),I.index=0,I.sibling=null,I}function g(I,k,M){return I.index=M,s?(M=I.alternate,M!==null?(M=M.index,M<k?(I.flags|=67108866,k):M):(I.flags|=67108866,k)):(I.flags|=1048576,k)}function w(I){return s&&I.alternate===null&&(I.flags|=67108866),I}function A(I,k,M,V){return k===null||k.tag!==6?(k=Wf(M,I.mode,V),k.return=I,k):(k=m(k,M),k.return=I,k)}function C(I,k,M,V){var le=M.type;return le===v?F(I,k,M.props.children,V,M.key):k!==null&&(k.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===Y&&pv(le)===k.type)?(k=m(k,M.props),So(k,M),k.return=I,k):(k=Su(M.type,M.key,M.props,null,I.mode,V),So(k,M),k.return=I,k)}function L(I,k,M,V){return k===null||k.tag!==4||k.stateNode.containerInfo!==M.containerInfo||k.stateNode.implementation!==M.implementation?(k=eh(M,I.mode,V),k.return=I,k):(k=m(k,M.children||[]),k.return=I,k)}function F(I,k,M,V,le){return k===null||k.tag!==7?(k=Ja(M,I.mode,V,le),k.return=I,k):(k=m(k,M),k.return=I,k)}function J(I,k,M){if(typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint")return k=Wf(""+k,I.mode,M),k.return=I,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case _:return M=Su(k.type,k.key,k.props,null,I.mode,M),So(M,k),M.return=I,M;case b:return k=eh(k,I.mode,M),k.return=I,k;case Y:var V=k._init;return k=V(k._payload),J(I,k,M)}if(ee(k)||Ge(k))return k=Ja(k,I.mode,M,null),k.return=I,k;if(typeof k.then=="function")return J(I,Uu(k),M);if(k.$$typeof===T)return J(I,Ou(I,k),M);zu(I,k)}return null}function U(I,k,M,V){var le=k!==null?k.key:null;if(typeof M=="string"&&M!==""||typeof M=="number"||typeof M=="bigint")return le!==null?null:A(I,k,""+M,V);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case _:return M.key===le?C(I,k,M,V):null;case b:return M.key===le?L(I,k,M,V):null;case Y:return le=M._init,M=le(M._payload),U(I,k,M,V)}if(ee(M)||Ge(M))return le!==null?null:F(I,k,M,V,null);if(typeof M.then=="function")return U(I,k,Uu(M),V);if(M.$$typeof===T)return U(I,k,Ou(I,M),V);zu(I,M)}return null}function z(I,k,M,V,le){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return I=I.get(M)||null,A(k,I,""+V,le);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case _:return I=I.get(V.key===null?M:V.key)||null,C(k,I,V,le);case b:return I=I.get(V.key===null?M:V.key)||null,L(k,I,V,le);case Y:var Ie=V._init;return V=Ie(V._payload),z(I,k,M,V,le)}if(ee(V)||Ge(V))return I=I.get(M)||null,F(k,I,V,le,null);if(typeof V.then=="function")return z(I,k,M,Uu(V),le);if(V.$$typeof===T)return z(I,k,M,Ou(k,V),le);zu(k,V)}return null}function _e(I,k,M,V){for(var le=null,Ie=null,de=k,ye=k=0,Nt=null;de!==null&&ye<M.length;ye++){de.index>ye?(Nt=de,de=null):Nt=de.sibling;var ze=U(I,de,M[ye],V);if(ze===null){de===null&&(de=Nt);break}s&&de&&ze.alternate===null&&i(I,de),k=g(ze,k,ye),Ie===null?le=ze:Ie.sibling=ze,Ie=ze,de=Nt}if(ye===M.length)return l(I,de),He&&Ya(I,ye),le;if(de===null){for(;ye<M.length;ye++)de=J(I,M[ye],V),de!==null&&(k=g(de,k,ye),Ie===null?le=de:Ie.sibling=de,Ie=de);return He&&Ya(I,ye),le}for(de=c(de);ye<M.length;ye++)Nt=z(de,I,ye,M[ye],V),Nt!==null&&(s&&Nt.alternate!==null&&de.delete(Nt.key===null?ye:Nt.key),k=g(Nt,k,ye),Ie===null?le=Nt:Ie.sibling=Nt,Ie=Nt);return s&&de.forEach(function(Ea){return i(I,Ea)}),He&&Ya(I,ye),le}function ge(I,k,M,V){if(M==null)throw Error(n(151));for(var le=null,Ie=null,de=k,ye=k=0,Nt=null,ze=M.next();de!==null&&!ze.done;ye++,ze=M.next()){de.index>ye?(Nt=de,de=null):Nt=de.sibling;var Ea=U(I,de,ze.value,V);if(Ea===null){de===null&&(de=Nt);break}s&&de&&Ea.alternate===null&&i(I,de),k=g(Ea,k,ye),Ie===null?le=Ea:Ie.sibling=Ea,Ie=Ea,de=Nt}if(ze.done)return l(I,de),He&&Ya(I,ye),le;if(de===null){for(;!ze.done;ye++,ze=M.next())ze=J(I,ze.value,V),ze!==null&&(k=g(ze,k,ye),Ie===null?le=ze:Ie.sibling=ze,Ie=ze);return He&&Ya(I,ye),le}for(de=c(de);!ze.done;ye++,ze=M.next())ze=z(de,I,ye,ze.value,V),ze!==null&&(s&&ze.alternate!==null&&de.delete(ze.key===null?ye:ze.key),k=g(ze,k,ye),Ie===null?le=ze:Ie.sibling=ze,Ie=ze);return s&&de.forEach(function(NN){return i(I,NN)}),He&&Ya(I,ye),le}function We(I,k,M,V){if(typeof M=="object"&&M!==null&&M.type===v&&M.key===null&&(M=M.props.children),typeof M=="object"&&M!==null){switch(M.$$typeof){case _:e:{for(var le=M.key;k!==null;){if(k.key===le){if(le=M.type,le===v){if(k.tag===7){l(I,k.sibling),V=m(k,M.props.children),V.return=I,I=V;break e}}else if(k.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===Y&&pv(le)===k.type){l(I,k.sibling),V=m(k,M.props),So(V,M),V.return=I,I=V;break e}l(I,k);break}else i(I,k);k=k.sibling}M.type===v?(V=Ja(M.props.children,I.mode,V,M.key),V.return=I,I=V):(V=Su(M.type,M.key,M.props,null,I.mode,V),So(V,M),V.return=I,I=V)}return w(I);case b:e:{for(le=M.key;k!==null;){if(k.key===le)if(k.tag===4&&k.stateNode.containerInfo===M.containerInfo&&k.stateNode.implementation===M.implementation){l(I,k.sibling),V=m(k,M.children||[]),V.return=I,I=V;break e}else{l(I,k);break}else i(I,k);k=k.sibling}V=eh(M,I.mode,V),V.return=I,I=V}return w(I);case Y:return le=M._init,M=le(M._payload),We(I,k,M,V)}if(ee(M))return _e(I,k,M,V);if(Ge(M)){if(le=Ge(M),typeof le!="function")throw Error(n(150));return M=le.call(M),ge(I,k,M,V)}if(typeof M.then=="function")return We(I,k,Uu(M),V);if(M.$$typeof===T)return We(I,k,Ou(I,M),V);zu(I,M)}return typeof M=="string"&&M!==""||typeof M=="number"||typeof M=="bigint"?(M=""+M,k!==null&&k.tag===6?(l(I,k.sibling),V=m(k,M),V.return=I,I=V):(l(I,k),V=Wf(M,I.mode,V),V.return=I,I=V),w(I)):l(I,k)}return function(I,k,M,V){try{wo=0;var le=We(I,k,M,V);return Zs=null,le}catch(de){if(de===fo||de===Ru)throw de;var Ie=yn(29,de,null,I.mode);return Ie.lanes=V,Ie.return=I,Ie}finally{}}}var Vs=gv(!0),yv=gv(!1),Un=B(null),mr=null;function ua(s){var i=s.alternate;Q(_t,_t.current&1),Q(Un,s),mr===null&&(i===null||qs.current!==null||i.memoizedState!==null)&&(mr=s)}function _v(s){if(s.tag===22){if(Q(_t,_t.current),Q(Un,s),mr===null){var i=s.alternate;i!==null&&i.memoizedState!==null&&(mr=s)}}else ca()}function ca(){Q(_t,_t.current),Q(Un,Un.current)}function Mr(s){K(Un),mr===s&&(mr=null),K(_t)}var _t=B(0);function Bu(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||Sm(l)))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}function $h(s,i,l,c){i=s.memoizedState,l=l(c,i),l=l==null?i:p({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var Ih={enqueueSetState:function(s,i,l){s=s._reactInternals;var c=wn(),m=ia(c);m.payload=i,l!=null&&(m.callback=l),i=oa(s,m,c),i!==null&&(Sn(i,s,c),mo(i,s,c))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var c=wn(),m=ia(c);m.tag=1,m.payload=i,l!=null&&(m.callback=l),i=oa(s,m,c),i!==null&&(Sn(i,s,c),mo(i,s,c))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=wn(),c=ia(l);c.tag=2,i!=null&&(c.callback=i),i=oa(s,c,l),i!==null&&(Sn(i,s,l),mo(i,s,l))}};function bv(s,i,l,c,m,g,w){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(c,g,w):i.prototype&&i.prototype.isPureReactComponent?!ro(l,c)||!ro(m,g):!0}function vv(s,i,l,c){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,c),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,c),i.state!==s&&Ih.enqueueReplaceState(i,i.state,null)}function rs(s,i){var l=i;if("ref"in i){l={};for(var c in i)c!=="ref"&&(l[c]=i[c])}if(s=s.defaultProps){l===i&&(l=p({},l));for(var m in s)l[m]===void 0&&(l[m]=s[m])}return l}var qu=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function wv(s){qu(s)}function Sv(s){console.error(s)}function xv(s){qu(s)}function Hu(s,i){try{var l=s.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(c){setTimeout(function(){throw c})}}function Ev(s,i,l){try{var c=s.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Ph(s,i,l){return l=ia(l),l.tag=3,l.payload={element:null},l.callback=function(){Hu(s,i)},l}function Av(s){return s=ia(s),s.tag=3,s}function Ov(s,i,l,c){var m=l.type.getDerivedStateFromError;if(typeof m=="function"){var g=c.value;s.payload=function(){return m(g)},s.callback=function(){Ev(i,l,c)}}var w=l.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(s.callback=function(){Ev(i,l,c),typeof m!="function"&&(ga===null?ga=new Set([this]):ga.add(this));var A=c.stack;this.componentDidCatch(c.value,{componentStack:A!==null?A:""})})}function NR(s,i,l,c,m){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(i=l.alternate,i!==null&&lo(i,l,m,!0),l=Un.current,l!==null){switch(l.tag){case 13:return mr===null?sm():l.alternate===null&&ot===0&&(ot=3),l.flags&=-257,l.flags|=65536,l.lanes=m,c===ch?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([c]):i.add(c),om(s,c,m)),!1;case 22:return l.flags|=65536,c===ch?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([c]):l.add(c)),om(s,c,m)),!1}throw Error(n(435,l.tag))}return om(s,c,m),sm(),!1}if(He)return i=Un.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=m,c!==rh&&(s=Error(n(422),{cause:c}),oo(Pn(s,l)))):(c!==rh&&(i=Error(n(423),{cause:c}),oo(Pn(i,l))),s=s.current.alternate,s.flags|=65536,m&=-m,s.lanes|=m,c=Pn(c,l),m=Ph(s.stateNode,c,m),hh(s,m),ot!==4&&(ot=2)),!1;var g=Error(n(520),{cause:c});if(g=Pn(g,l),No===null?No=[g]:No.push(g),ot!==4&&(ot=2),i===null)return!0;c=Pn(c,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,s=m&-m,l.lanes|=s,s=Ph(l.stateNode,c,s),hh(l,s),!1;case 1:if(i=l.type,g=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ga===null||!ga.has(g))))return l.flags|=65536,m&=-m,l.lanes|=m,m=Av(m),Ov(m,s,l,c),hh(l,m),!1}l=l.return}while(l!==null);return!1}var Tv=Error(n(461)),Tt=!1;function Pt(s,i,l,c){i.child=s===null?yv(i,null,l,c):Vs(i,s.child,l,c)}function Rv(s,i,l,c,m){l=l.render;var g=i.ref;if("ref"in c){var w={};for(var A in c)A!=="ref"&&(w[A]=c[A])}else w=c;return es(i),c=_h(s,i,l,w,g,m),A=bh(),s!==null&&!Tt?(vh(s,i,m),Lr(s,i,m)):(He&&A&&th(i),i.flags|=1,Pt(s,i,c,m),i.child)}function Nv(s,i,l,c,m){if(s===null){var g=l.type;return typeof g=="function"&&!Qf(g)&&g.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=g,Cv(s,i,g,c,m)):(s=Su(l.type,null,c,i,i.mode,m),s.ref=i.ref,s.return=i,i.child=s)}if(g=s.child,!Hh(s,m)){var w=g.memoizedProps;if(l=l.compare,l=l!==null?l:ro,l(w,c)&&s.ref===i.ref)return Lr(s,i,m)}return i.flags|=1,s=Cr(g,c),s.ref=i.ref,s.return=i,i.child=s}function Cv(s,i,l,c,m){if(s!==null){var g=s.memoizedProps;if(ro(g,c)&&s.ref===i.ref)if(Tt=!1,i.pendingProps=c=g,Hh(s,m))(s.flags&131072)!==0&&(Tt=!0);else return i.lanes=s.lanes,Lr(s,i,m)}return Mh(s,i,l,c,m)}function kv(s,i,l){var c=i.pendingProps,m=c.children,g=s!==null?s.memoizedState:null;if(c.mode==="hidden"){if((i.flags&128)!==0){if(c=g!==null?g.baseLanes|l:l,s!==null){for(m=i.child=s.child,g=0;m!==null;)g=g|m.lanes|m.childLanes,m=m.sibling;i.childLanes=g&~c}else i.childLanes=0,i.child=null;return jv(s,i,c,l)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&Tu(i,g!==null?g.cachePool:null),g!==null?Cb(i,g):ph(),_v(i);else return i.lanes=i.childLanes=536870912,jv(s,i,g!==null?g.baseLanes|l:l,l)}else g!==null?(Tu(i,g.cachePool),Cb(i,g),ca(),i.memoizedState=null):(s!==null&&Tu(i,null),ph(),ca());return Pt(s,i,m,l),i.child}function jv(s,i,l,c){var m=uh();return m=m===null?null:{parent:yt._currentValue,pool:m},i.memoizedState={baseLanes:l,cachePool:m},s!==null&&Tu(i,null),ph(),_v(i),s!==null&&lo(s,i,c,!0),null}function Gu(s,i){var l=i.ref;if(l===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(n(284));(s===null||s.ref!==l)&&(i.flags|=4194816)}}function Mh(s,i,l,c,m){return es(i),l=_h(s,i,l,c,void 0,m),c=bh(),s!==null&&!Tt?(vh(s,i,m),Lr(s,i,m)):(He&&c&&th(i),i.flags|=1,Pt(s,i,l,m),i.child)}function $v(s,i,l,c,m,g){return es(i),i.updateQueue=null,l=jb(i,c,l,m),kb(s),c=bh(),s!==null&&!Tt?(vh(s,i,g),Lr(s,i,g)):(He&&c&&th(i),i.flags|=1,Pt(s,i,l,g),i.child)}function Iv(s,i,l,c,m){if(es(i),i.stateNode===null){var g=Ls,w=l.contextType;typeof w=="object"&&w!==null&&(g=Ht(w)),g=new l(c,g),i.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Ih,i.stateNode=g,g._reactInternals=i,g=i.stateNode,g.props=c,g.state=i.memoizedState,g.refs={},dh(i),w=l.contextType,g.context=typeof w=="object"&&w!==null?Ht(w):Ls,g.state=i.memoizedState,w=l.getDerivedStateFromProps,typeof w=="function"&&($h(i,l,w,c),g.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(w=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),w!==g.state&&Ih.enqueueReplaceState(g,g.state,null),go(i,c,g,m),po(),g.state=i.memoizedState),typeof g.componentDidMount=="function"&&(i.flags|=4194308),c=!0}else if(s===null){g=i.stateNode;var A=i.memoizedProps,C=rs(l,A);g.props=C;var L=g.context,F=l.contextType;w=Ls,typeof F=="object"&&F!==null&&(w=Ht(F));var J=l.getDerivedStateFromProps;F=typeof J=="function"||typeof g.getSnapshotBeforeUpdate=="function",A=i.pendingProps!==A,F||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(A||L!==w)&&vv(i,g,c,w),sa=!1;var U=i.memoizedState;g.state=U,go(i,c,g,m),po(),L=i.memoizedState,A||U!==L||sa?(typeof J=="function"&&($h(i,l,J,c),L=i.memoizedState),(C=sa||bv(i,l,C,c,U,L,w))?(F||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(i.flags|=4194308)):(typeof g.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=c,i.memoizedState=L),g.props=c,g.state=L,g.context=w,c=C):(typeof g.componentDidMount=="function"&&(i.flags|=4194308),c=!1)}else{g=i.stateNode,fh(s,i),w=i.memoizedProps,F=rs(l,w),g.props=F,J=i.pendingProps,U=g.context,L=l.contextType,C=Ls,typeof L=="object"&&L!==null&&(C=Ht(L)),A=l.getDerivedStateFromProps,(L=typeof A=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(w!==J||U!==C)&&vv(i,g,c,C),sa=!1,U=i.memoizedState,g.state=U,go(i,c,g,m),po();var z=i.memoizedState;w!==J||U!==z||sa||s!==null&&s.dependencies!==null&&Au(s.dependencies)?(typeof A=="function"&&($h(i,l,A,c),z=i.memoizedState),(F=sa||bv(i,l,F,c,U,z,C)||s!==null&&s.dependencies!==null&&Au(s.dependencies))?(L||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,z,C),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,z,C)),typeof g.componentDidUpdate=="function"&&(i.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof g.componentDidUpdate!="function"||w===s.memoizedProps&&U===s.memoizedState||(i.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||w===s.memoizedProps&&U===s.memoizedState||(i.flags|=1024),i.memoizedProps=c,i.memoizedState=z),g.props=c,g.state=z,g.context=C,c=F):(typeof g.componentDidUpdate!="function"||w===s.memoizedProps&&U===s.memoizedState||(i.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||w===s.memoizedProps&&U===s.memoizedState||(i.flags|=1024),c=!1)}return g=c,Gu(s,i),c=(i.flags&128)!==0,g||c?(g=i.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:g.render(),i.flags|=1,s!==null&&c?(i.child=Vs(i,s.child,null,m),i.child=Vs(i,null,l,m)):Pt(s,i,l,m),i.memoizedState=g.state,s=i.child):s=Lr(s,i,m),s}function Pv(s,i,l,c){return io(),i.flags|=256,Pt(s,i,l,c),i.child}var Lh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Dh(s){return{baseLanes:s,cachePool:Sb()}}function Uh(s,i,l){return s=s!==null?s.childLanes&~l:0,i&&(s|=zn),s}function Mv(s,i,l){var c=i.pendingProps,m=!1,g=(i.flags&128)!==0,w;if((w=g)||(w=s!==null&&s.memoizedState===null?!1:(_t.current&2)!==0),w&&(m=!0,i.flags&=-129),w=(i.flags&32)!==0,i.flags&=-33,s===null){if(He){if(m?ua(i):ca(),He){var A=it,C;if(C=A){e:{for(C=A,A=hr;C.nodeType!==8;){if(!A){A=null;break e}if(C=Yn(C.nextSibling),C===null){A=null;break e}}A=C}A!==null?(i.memoizedState={dehydrated:A,treeContext:Ka!==null?{id:kr,overflow:jr}:null,retryLane:536870912,hydrationErrors:null},C=yn(18,null,null,0),C.stateNode=A,C.return=i,i.child=C,Vt=i,it=null,C=!0):C=!1}C||Qa(i)}if(A=i.memoizedState,A!==null&&(A=A.dehydrated,A!==null))return Sm(A)?i.lanes=32:i.lanes=536870912,null;Mr(i)}return A=c.children,c=c.fallback,m?(ca(),m=i.mode,A=Fu({mode:"hidden",children:A},m),c=Ja(c,m,l,null),A.return=i,c.return=i,A.sibling=c,i.child=A,m=i.child,m.memoizedState=Dh(l),m.childLanes=Uh(s,w,l),i.memoizedState=Lh,c):(ua(i),zh(i,A))}if(C=s.memoizedState,C!==null&&(A=C.dehydrated,A!==null)){if(g)i.flags&256?(ua(i),i.flags&=-257,i=Bh(s,i,l)):i.memoizedState!==null?(ca(),i.child=s.child,i.flags|=128,i=null):(ca(),m=c.fallback,A=i.mode,c=Fu({mode:"visible",children:c.children},A),m=Ja(m,A,l,null),m.flags|=2,c.return=i,m.return=i,c.sibling=m,i.child=c,Vs(i,s.child,null,l),c=i.child,c.memoizedState=Dh(l),c.childLanes=Uh(s,w,l),i.memoizedState=Lh,i=m);else if(ua(i),Sm(A)){if(w=A.nextSibling&&A.nextSibling.dataset,w)var L=w.dgst;w=L,c=Error(n(419)),c.stack="",c.digest=w,oo({value:c,source:null,stack:null}),i=Bh(s,i,l)}else if(Tt||lo(s,i,l,!1),w=(l&s.childLanes)!==0,Tt||w){if(w=nt,w!==null&&(c=l&-l,c=(c&42)!==0?1:xf(c),c=(c&(w.suspendedLanes|l))!==0?0:c,c!==0&&c!==C.retryLane))throw C.retryLane=c,Ms(s,c),Sn(w,s,c),Tv;A.data==="$?"||sm(),i=Bh(s,i,l)}else A.data==="$?"?(i.flags|=192,i.child=s.child,i=null):(s=C.treeContext,it=Yn(A.nextSibling),Vt=i,He=!0,Xa=null,hr=!1,s!==null&&(Ln[Dn++]=kr,Ln[Dn++]=jr,Ln[Dn++]=Ka,kr=s.id,jr=s.overflow,Ka=i),i=zh(i,c.children),i.flags|=4096);return i}return m?(ca(),m=c.fallback,A=i.mode,C=s.child,L=C.sibling,c=Cr(C,{mode:"hidden",children:c.children}),c.subtreeFlags=C.subtreeFlags&65011712,L!==null?m=Cr(L,m):(m=Ja(m,A,l,null),m.flags|=2),m.return=i,c.return=i,c.sibling=m,i.child=c,c=m,m=i.child,A=s.child.memoizedState,A===null?A=Dh(l):(C=A.cachePool,C!==null?(L=yt._currentValue,C=C.parent!==L?{parent:L,pool:L}:C):C=Sb(),A={baseLanes:A.baseLanes|l,cachePool:C}),m.memoizedState=A,m.childLanes=Uh(s,w,l),i.memoizedState=Lh,c):(ua(i),l=s.child,s=l.sibling,l=Cr(l,{mode:"visible",children:c.children}),l.return=i,l.sibling=null,s!==null&&(w=i.deletions,w===null?(i.deletions=[s],i.flags|=16):w.push(s)),i.child=l,i.memoizedState=null,l)}function zh(s,i){return i=Fu({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function Fu(s,i){return s=yn(22,s,null,i),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function Bh(s,i,l){return Vs(i,s.child,null,l),s=zh(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function Lv(s,i,l){s.lanes|=i;var c=s.alternate;c!==null&&(c.lanes|=i),sh(s.return,i,l)}function qh(s,i,l,c,m){var g=s.memoizedState;g===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:m}:(g.isBackwards=i,g.rendering=null,g.renderingStartTime=0,g.last=c,g.tail=l,g.tailMode=m)}function Dv(s,i,l){var c=i.pendingProps,m=c.revealOrder,g=c.tail;if(Pt(s,i,c.children,l),c=_t.current,(c&2)!==0)c=c&1|2,i.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Lv(s,l,i);else if(s.tag===19)Lv(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}c&=1}switch(Q(_t,c),m){case"forwards":for(l=i.child,m=null;l!==null;)s=l.alternate,s!==null&&Bu(s)===null&&(m=l),l=l.sibling;l=m,l===null?(m=i.child,i.child=null):(m=l.sibling,l.sibling=null),qh(i,!1,m,l,g);break;case"backwards":for(l=null,m=i.child,i.child=null;m!==null;){if(s=m.alternate,s!==null&&Bu(s)===null){i.child=m;break}s=m.sibling,m.sibling=l,l=m,m=s}qh(i,!0,l,null,g);break;case"together":qh(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Lr(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),pa|=i.lanes,(l&i.childLanes)===0)if(s!==null){if(lo(s,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(n(153));if(i.child!==null){for(s=i.child,l=Cr(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=Cr(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function Hh(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&Au(s)))}function CR(s,i,l){switch(i.tag){case 3:et(i,i.stateNode.containerInfo),aa(i,yt,s.memoizedState.cache),io();break;case 27:case 5:qa(i);break;case 4:et(i,i.stateNode.containerInfo);break;case 10:aa(i,i.type,i.memoizedProps.value);break;case 13:var c=i.memoizedState;if(c!==null)return c.dehydrated!==null?(ua(i),i.flags|=128,null):(l&i.child.childLanes)!==0?Mv(s,i,l):(ua(i),s=Lr(s,i,l),s!==null?s.sibling:null);ua(i);break;case 19:var m=(s.flags&128)!==0;if(c=(l&i.childLanes)!==0,c||(lo(s,i,l,!1),c=(l&i.childLanes)!==0),m){if(c)return Dv(s,i,l);i.flags|=128}if(m=i.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Q(_t,_t.current),c)break;return null;case 22:case 23:return i.lanes=0,kv(s,i,l);case 24:aa(i,yt,s.memoizedState.cache)}return Lr(s,i,l)}function Uv(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps)Tt=!0;else{if(!Hh(s,l)&&(i.flags&128)===0)return Tt=!1,CR(s,i,l);Tt=(s.flags&131072)!==0}else Tt=!1,He&&(i.flags&1048576)!==0&&pb(i,Eu,i.index);switch(i.lanes=0,i.tag){case 16:e:{s=i.pendingProps;var c=i.elementType,m=c._init;if(c=m(c._payload),i.type=c,typeof c=="function")Qf(c)?(s=rs(c,s),i.tag=1,i=Iv(null,i,c,s,l)):(i.tag=0,i=Mh(null,i,c,s,l));else{if(c!=null){if(m=c.$$typeof,m===j){i.tag=11,i=Rv(null,i,c,s,l);break e}else if(m===Z){i.tag=14,i=Nv(null,i,c,s,l);break e}}throw i=re(c)||c,Error(n(306,i,""))}}return i;case 0:return Mh(s,i,i.type,i.pendingProps,l);case 1:return c=i.type,m=rs(c,i.pendingProps),Iv(s,i,c,m,l);case 3:e:{if(et(i,i.stateNode.containerInfo),s===null)throw Error(n(387));c=i.pendingProps;var g=i.memoizedState;m=g.element,fh(s,i),go(i,c,null,l);var w=i.memoizedState;if(c=w.cache,aa(i,yt,c),c!==g.cache&&ih(i,[yt],l,!0),po(),c=w.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:w.cache},i.updateQueue.baseState=g,i.memoizedState=g,i.flags&256){i=Pv(s,i,c,l);break e}else if(c!==m){m=Pn(Error(n(424)),i),oo(m),i=Pv(s,i,c,l);break e}else{switch(s=i.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(it=Yn(s.firstChild),Vt=i,He=!0,Xa=null,hr=!0,l=yv(i,null,c,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(io(),c===m){i=Lr(s,i,l);break e}Pt(s,i,c,l)}i=i.child}return i;case 26:return Gu(s,i),s===null?(l=H0(i.type,null,i.pendingProps,null))?i.memoizedState=l:He||(l=i.type,s=i.pendingProps,c=sc(pe.current).createElement(l),c[qt]=i,c[nn]=s,Lt(c,l,s),Ot(c),i.stateNode=c):i.memoizedState=H0(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return qa(i),s===null&&He&&(c=i.stateNode=z0(i.type,i.pendingProps,pe.current),Vt=i,hr=!0,m=it,ba(i.type)?(xm=m,it=Yn(c.firstChild)):it=m),Pt(s,i,i.pendingProps.children,l),Gu(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&He&&((m=c=it)&&(c=aN(c,i.type,i.pendingProps,hr),c!==null?(i.stateNode=c,Vt=i,it=Yn(c.firstChild),hr=!1,m=!0):m=!1),m||Qa(i)),qa(i),m=i.type,g=i.pendingProps,w=s!==null?s.memoizedProps:null,c=g.children,bm(m,g)?c=null:w!==null&&bm(m,w)&&(i.flags|=32),i.memoizedState!==null&&(m=_h(s,i,SR,null,null,l),Do._currentValue=m),Gu(s,i),Pt(s,i,c,l),i.child;case 6:return s===null&&He&&((s=l=it)&&(l=sN(l,i.pendingProps,hr),l!==null?(i.stateNode=l,Vt=i,it=null,s=!0):s=!1),s||Qa(i)),null;case 13:return Mv(s,i,l);case 4:return et(i,i.stateNode.containerInfo),c=i.pendingProps,s===null?i.child=Vs(i,null,c,l):Pt(s,i,c,l),i.child;case 11:return Rv(s,i,i.type,i.pendingProps,l);case 7:return Pt(s,i,i.pendingProps,l),i.child;case 8:return Pt(s,i,i.pendingProps.children,l),i.child;case 12:return Pt(s,i,i.pendingProps.children,l),i.child;case 10:return c=i.pendingProps,aa(i,i.type,c.value),Pt(s,i,c.children,l),i.child;case 9:return m=i.type._context,c=i.pendingProps.children,es(i),m=Ht(m),c=c(m),i.flags|=1,Pt(s,i,c,l),i.child;case 14:return Nv(s,i,i.type,i.pendingProps,l);case 15:return Cv(s,i,i.type,i.pendingProps,l);case 19:return Dv(s,i,l);case 31:return c=i.pendingProps,l=i.mode,c={mode:c.mode,children:c.children},s===null?(l=Fu(c,l),l.ref=i.ref,i.child=l,l.return=i,i=l):(l=Cr(s.child,c),l.ref=i.ref,i.child=l,l.return=i,i=l),i;case 22:return kv(s,i,l);case 24:return es(i),c=Ht(yt),s===null?(m=uh(),m===null&&(m=nt,g=oh(),m.pooledCache=g,g.refCount++,g!==null&&(m.pooledCacheLanes|=l),m=g),i.memoizedState={parent:c,cache:m},dh(i),aa(i,yt,m)):((s.lanes&l)!==0&&(fh(s,i),go(i,null,null,l),po()),m=s.memoizedState,g=i.memoizedState,m.parent!==c?(m={parent:c,cache:c},i.memoizedState=m,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=m),aa(i,yt,c)):(c=g.cache,aa(i,yt,c),c!==m.cache&&ih(i,[yt],l,!0))),Pt(s,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(n(156,i.tag))}function Dr(s){s.flags|=4}function zv(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!J0(i)){if(i=Un.current,i!==null&&((Ue&4194048)===Ue?mr!==null:(Ue&62914560)!==Ue&&(Ue&536870912)===0||i!==mr))throw ho=ch,xb;s.flags|=8192}}function Zu(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?__():536870912,s.lanes|=i,Xs|=i)}function xo(s,i){if(!He)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:c.sibling=null}}function st(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,c=0;if(i)for(var m=s.child;m!==null;)l|=m.lanes|m.childLanes,c|=m.subtreeFlags&65011712,c|=m.flags&65011712,m.return=s,m=m.sibling;else for(m=s.child;m!==null;)l|=m.lanes|m.childLanes,c|=m.subtreeFlags,c|=m.flags,m.return=s,m=m.sibling;return s.subtreeFlags|=c,s.childLanes=l,i}function kR(s,i,l){var c=i.pendingProps;switch(nh(i),i.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return st(i),null;case 1:return st(i),null;case 3:return l=i.stateNode,c=null,s!==null&&(c=s.memoizedState.cache),i.memoizedState.cache!==c&&(i.flags|=2048),Ir(yt),jn(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(so(i)?Dr(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,_b())),st(i),null;case 26:return l=i.memoizedState,s===null?(Dr(i),l!==null?(st(i),zv(i,l)):(st(i),i.flags&=-16777217)):l?l!==s.memoizedState?(Dr(i),st(i),zv(i,l)):(st(i),i.flags&=-16777217):(s.memoizedProps!==c&&Dr(i),st(i),i.flags&=-16777217),null;case 27:ws(i),l=pe.current;var m=i.type;if(s!==null&&i.stateNode!=null)s.memoizedProps!==c&&Dr(i);else{if(!c){if(i.stateNode===null)throw Error(n(166));return st(i),null}s=ie.current,so(i)?gb(i):(s=z0(m,c,l),i.stateNode=s,Dr(i))}return st(i),null;case 5:if(ws(i),l=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==c&&Dr(i);else{if(!c){if(i.stateNode===null)throw Error(n(166));return st(i),null}if(s=ie.current,so(i))gb(i);else{switch(m=sc(pe.current),s){case 1:s=m.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:s=m.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":s=m.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":s=m.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":s=m.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof c.is=="string"?m.createElement("select",{is:c.is}):m.createElement("select"),c.multiple?s.multiple=!0:c.size&&(s.size=c.size);break;default:s=typeof c.is=="string"?m.createElement(l,{is:c.is}):m.createElement(l)}}s[qt]=i,s[nn]=c;e:for(m=i.child;m!==null;){if(m.tag===5||m.tag===6)s.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===i)break e;for(;m.sibling===null;){if(m.return===null||m.return===i)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}i.stateNode=s;e:switch(Lt(s,l,c),l){case"button":case"input":case"select":case"textarea":s=!!c.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Dr(i)}}return st(i),i.flags&=-16777217,null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==c&&Dr(i);else{if(typeof c!="string"&&i.stateNode===null)throw Error(n(166));if(s=pe.current,so(i)){if(s=i.stateNode,l=i.memoizedProps,c=null,m=Vt,m!==null)switch(m.tag){case 27:case 5:c=m.memoizedProps}s[qt]=i,s=!!(s.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||$0(s.nodeValue,l)),s||Qa(i)}else s=sc(s).createTextNode(c),s[qt]=i,i.stateNode=s}return st(i),null;case 13:if(c=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(m=so(i),c!==null&&c.dehydrated!==null){if(s===null){if(!m)throw Error(n(318));if(m=i.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(n(317));m[qt]=i}else io(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;st(i),m=!1}else m=_b(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=m),m=!0;if(!m)return i.flags&256?(Mr(i),i):(Mr(i),null)}if(Mr(i),(i.flags&128)!==0)return i.lanes=l,i;if(l=c!==null,s=s!==null&&s.memoizedState!==null,l){c=i.child,m=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(m=c.alternate.memoizedState.cachePool.pool);var g=null;c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==m&&(c.flags|=2048)}return l!==s&&l&&(i.child.flags|=8192),Zu(i,i.updateQueue),st(i),null;case 4:return jn(),s===null&&mm(i.stateNode.containerInfo),st(i),null;case 10:return Ir(i.type),st(i),null;case 19:if(K(_t),m=i.memoizedState,m===null)return st(i),null;if(c=(i.flags&128)!==0,g=m.rendering,g===null)if(c)xo(m,!1);else{if(ot!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(g=Bu(s),g!==null){for(i.flags|=128,xo(m,!1),s=g.updateQueue,i.updateQueue=s,Zu(i,s),i.subtreeFlags=0,s=l,l=i.child;l!==null;)mb(l,s),l=l.sibling;return Q(_t,_t.current&1|2),i.child}s=s.sibling}m.tail!==null&&fr()>Ku&&(i.flags|=128,c=!0,xo(m,!1),i.lanes=4194304)}else{if(!c)if(s=Bu(g),s!==null){if(i.flags|=128,c=!0,s=s.updateQueue,i.updateQueue=s,Zu(i,s),xo(m,!0),m.tail===null&&m.tailMode==="hidden"&&!g.alternate&&!He)return st(i),null}else 2*fr()-m.renderingStartTime>Ku&&l!==536870912&&(i.flags|=128,c=!0,xo(m,!1),i.lanes=4194304);m.isBackwards?(g.sibling=i.child,i.child=g):(s=m.last,s!==null?s.sibling=g:i.child=g,m.last=g)}return m.tail!==null?(i=m.tail,m.rendering=i,m.tail=i.sibling,m.renderingStartTime=fr(),i.sibling=null,s=_t.current,Q(_t,c?s&1|2:s&1),i):(st(i),null);case 22:case 23:return Mr(i),gh(),c=i.memoizedState!==null,s!==null?s.memoizedState!==null!==c&&(i.flags|=8192):c&&(i.flags|=8192),c?(l&536870912)!==0&&(i.flags&128)===0&&(st(i),i.subtreeFlags&6&&(i.flags|=8192)):st(i),l=i.updateQueue,l!==null&&Zu(i,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),c=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),c!==l&&(i.flags|=2048),s!==null&&K(ts),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),Ir(yt),st(i),null;case 25:return null;case 30:return null}throw Error(n(156,i.tag))}function jR(s,i){switch(nh(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return Ir(yt),jn(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return ws(i),null;case 13:if(Mr(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(n(340));io()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return K(_t),null;case 4:return jn(),null;case 10:return Ir(i.type),null;case 22:case 23:return Mr(i),gh(),s!==null&&K(ts),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return Ir(yt),null;case 25:return null;default:return null}}function Bv(s,i){switch(nh(i),i.tag){case 3:Ir(yt),jn();break;case 26:case 27:case 5:ws(i);break;case 4:jn();break;case 13:Mr(i);break;case 19:K(_t);break;case 10:Ir(i.type);break;case 22:case 23:Mr(i),gh(),s!==null&&K(ts);break;case 24:Ir(yt)}}function Eo(s,i){try{var l=i.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var m=c.next;l=m;do{if((l.tag&s)===s){c=void 0;var g=l.create,w=l.inst;c=g(),w.destroy=c}l=l.next}while(l!==m)}}catch(A){tt(i,i.return,A)}}function da(s,i,l){try{var c=i.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var g=m.next;c=g;do{if((c.tag&s)===s){var w=c.inst,A=w.destroy;if(A!==void 0){w.destroy=void 0,m=i;var C=l,L=A;try{L()}catch(F){tt(m,C,F)}}}c=c.next}while(c!==g)}}catch(F){tt(i,i.return,F)}}function qv(s){var i=s.updateQueue;if(i!==null){var l=s.stateNode;try{Nb(i,l)}catch(c){tt(s,s.return,c)}}}function Hv(s,i,l){l.props=rs(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(c){tt(s,i,c)}}function Ao(s,i){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var c=s.stateNode;break;case 30:c=s.stateNode;break;default:c=s.stateNode}typeof l=="function"?s.refCleanup=l(c):l.current=c}}catch(m){tt(s,i,m)}}function pr(s,i){var l=s.ref,c=s.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(m){tt(s,i,m)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(m){tt(s,i,m)}else l.current=null}function Gv(s){var i=s.type,l=s.memoizedProps,c=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(m){tt(s,s.return,m)}}function Gh(s,i,l){try{var c=s.stateNode;WR(c,s.type,l,i),c[nn]=i}catch(m){tt(s,s.return,m)}}function Fv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ba(s.type)||s.tag===4}function Fh(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Fv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ba(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Zh(s,i,l){var c=s.tag;if(c===5||c===6)s=s.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(s),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=ac));else if(c!==4&&(c===27&&ba(s.type)&&(l=s.stateNode,i=null),s=s.child,s!==null))for(Zh(s,i,l),s=s.sibling;s!==null;)Zh(s,i,l),s=s.sibling}function Vu(s,i,l){var c=s.tag;if(c===5||c===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(c!==4&&(c===27&&ba(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(Vu(s,i,l),s=s.sibling;s!==null;)Vu(s,i,l),s=s.sibling}function Zv(s){var i=s.stateNode,l=s.memoizedProps;try{for(var c=s.type,m=i.attributes;m.length;)i.removeAttributeNode(m[0]);Lt(i,c,l),i[qt]=s,i[nn]=l}catch(g){tt(s,s.return,g)}}var Ur=!1,ut=!1,Vh=!1,Vv=typeof WeakSet=="function"?WeakSet:Set,Rt=null;function $R(s,i){if(s=s.containerInfo,ym=dc,s=ab(s),Ff(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var m=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var w=0,A=-1,C=-1,L=0,F=0,J=s,U=null;t:for(;;){for(var z;J!==l||m!==0&&J.nodeType!==3||(A=w+m),J!==g||c!==0&&J.nodeType!==3||(C=w+c),J.nodeType===3&&(w+=J.nodeValue.length),(z=J.firstChild)!==null;)U=J,J=z;for(;;){if(J===s)break t;if(U===l&&++L===m&&(A=w),U===g&&++F===c&&(C=w),(z=J.nextSibling)!==null)break;J=U,U=J.parentNode}J=z}l=A===-1||C===-1?null:{start:A,end:C}}else l=null}l=l||{start:0,end:0}}else l=null;for(_m={focusedElem:s,selectionRange:l},dc=!1,Rt=i;Rt!==null;)if(i=Rt,s=i.child,(i.subtreeFlags&1024)!==0&&s!==null)s.return=i,Rt=s;else for(;Rt!==null;){switch(i=Rt,g=i.alternate,s=i.flags,i.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&g!==null){s=void 0,l=i,m=g.memoizedProps,g=g.memoizedState,c=l.stateNode;try{var _e=rs(l.type,m,l.elementType===l.type);s=c.getSnapshotBeforeUpdate(_e,g),c.__reactInternalSnapshotBeforeUpdate=s}catch(ge){tt(l,l.return,ge)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,l=s.nodeType,l===9)wm(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":wm(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(n(163))}if(s=i.sibling,s!==null){s.return=i.return,Rt=s;break}Rt=i.return}}function Jv(s,i,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:fa(s,l),c&4&&Eo(5,l);break;case 1:if(fa(s,l),c&4)if(s=l.stateNode,i===null)try{s.componentDidMount()}catch(w){tt(l,l.return,w)}else{var m=rs(l.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(m,i,s.__reactInternalSnapshotBeforeUpdate)}catch(w){tt(l,l.return,w)}}c&64&&qv(l),c&512&&Ao(l,l.return);break;case 3:if(fa(s,l),c&64&&(s=l.updateQueue,s!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{Nb(s,i)}catch(w){tt(l,l.return,w)}}break;case 27:i===null&&c&4&&Zv(l);case 26:case 5:fa(s,l),i===null&&c&4&&Gv(l),c&512&&Ao(l,l.return);break;case 12:fa(s,l);break;case 13:fa(s,l),c&4&&Xv(s,l),c&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=qR.bind(null,l),iN(s,l))));break;case 22:if(c=l.memoizedState!==null||Ur,!c){i=i!==null&&i.memoizedState!==null||ut,m=Ur;var g=ut;Ur=c,(ut=i)&&!g?ha(s,l,(l.subtreeFlags&8772)!==0):fa(s,l),Ur=m,ut=g}break;case 30:break;default:fa(s,l)}}function Kv(s){var i=s.alternate;i!==null&&(s.alternate=null,Kv(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&Of(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var rt=null,sn=!1;function zr(s,i,l){for(l=l.child;l!==null;)Yv(s,i,l),l=l.sibling}function Yv(s,i,l){if(mn&&typeof mn.onCommitFiberUnmount=="function")try{mn.onCommitFiberUnmount(Fi,l)}catch{}switch(l.tag){case 26:ut||pr(l,i),zr(s,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:ut||pr(l,i);var c=rt,m=sn;ba(l.type)&&(rt=l.stateNode,sn=!1),zr(s,i,l),Io(l.stateNode),rt=c,sn=m;break;case 5:ut||pr(l,i);case 6:if(c=rt,m=sn,rt=null,zr(s,i,l),rt=c,sn=m,rt!==null)if(sn)try{(rt.nodeType===9?rt.body:rt.nodeName==="HTML"?rt.ownerDocument.body:rt).removeChild(l.stateNode)}catch(g){tt(l,i,g)}else try{rt.removeChild(l.stateNode)}catch(g){tt(l,i,g)}break;case 18:rt!==null&&(sn?(s=rt,D0(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),qo(s)):D0(rt,l.stateNode));break;case 4:c=rt,m=sn,rt=l.stateNode.containerInfo,sn=!0,zr(s,i,l),rt=c,sn=m;break;case 0:case 11:case 14:case 15:ut||da(2,l,i),ut||da(4,l,i),zr(s,i,l);break;case 1:ut||(pr(l,i),c=l.stateNode,typeof c.componentWillUnmount=="function"&&Hv(l,i,c)),zr(s,i,l);break;case 21:zr(s,i,l);break;case 22:ut=(c=ut)||l.memoizedState!==null,zr(s,i,l),ut=c;break;default:zr(s,i,l)}}function Xv(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{qo(s)}catch(l){tt(i,i.return,l)}}function IR(s){switch(s.tag){case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Vv),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Vv),i;default:throw Error(n(435,s.tag))}}function Jh(s,i){var l=IR(s);i.forEach(function(c){var m=HR.bind(null,s,c);l.has(c)||(l.add(c),c.then(m,m))})}function _n(s,i){var l=i.deletions;if(l!==null)for(var c=0;c<l.length;c++){var m=l[c],g=s,w=i,A=w;e:for(;A!==null;){switch(A.tag){case 27:if(ba(A.type)){rt=A.stateNode,sn=!1;break e}break;case 5:rt=A.stateNode,sn=!1;break e;case 3:case 4:rt=A.stateNode.containerInfo,sn=!0;break e}A=A.return}if(rt===null)throw Error(n(160));Yv(g,w,m),rt=null,sn=!1,g=m.alternate,g!==null&&(g.return=null),m.return=null}if(i.subtreeFlags&13878)for(i=i.child;i!==null;)Qv(i,s),i=i.sibling}var Kn=null;function Qv(s,i){var l=s.alternate,c=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:_n(i,s),bn(s),c&4&&(da(3,s,s.return),Eo(3,s),da(5,s,s.return));break;case 1:_n(i,s),bn(s),c&512&&(ut||l===null||pr(l,l.return)),c&64&&Ur&&(s=s.updateQueue,s!==null&&(c=s.callbacks,c!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var m=Kn;if(_n(i,s),bn(s),c&512&&(ut||l===null||pr(l,l.return)),c&4){var g=l!==null?l.memoizedState:null;if(c=s.memoizedState,l===null)if(c===null)if(s.stateNode===null){e:{c=s.type,l=s.memoizedProps,m=m.ownerDocument||m;t:switch(c){case"title":g=m.getElementsByTagName("title")[0],(!g||g[Ji]||g[qt]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=m.createElement(c),m.head.insertBefore(g,m.querySelector("head > title"))),Lt(g,c,l),g[qt]=s,Ot(g),c=g;break e;case"link":var w=Z0("link","href",m).get(c+(l.href||""));if(w){for(var A=0;A<w.length;A++)if(g=w[A],g.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&g.getAttribute("rel")===(l.rel==null?null:l.rel)&&g.getAttribute("title")===(l.title==null?null:l.title)&&g.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){w.splice(A,1);break t}}g=m.createElement(c),Lt(g,c,l),m.head.appendChild(g);break;case"meta":if(w=Z0("meta","content",m).get(c+(l.content||""))){for(A=0;A<w.length;A++)if(g=w[A],g.getAttribute("content")===(l.content==null?null:""+l.content)&&g.getAttribute("name")===(l.name==null?null:l.name)&&g.getAttribute("property")===(l.property==null?null:l.property)&&g.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&g.getAttribute("charset")===(l.charSet==null?null:l.charSet)){w.splice(A,1);break t}}g=m.createElement(c),Lt(g,c,l),m.head.appendChild(g);break;default:throw Error(n(468,c))}g[qt]=s,Ot(g),c=g}s.stateNode=c}else V0(m,s.type,s.stateNode);else s.stateNode=F0(m,c,s.memoizedProps);else g!==c?(g===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):g.count--,c===null?V0(m,s.type,s.stateNode):F0(m,c,s.memoizedProps)):c===null&&s.stateNode!==null&&Gh(s,s.memoizedProps,l.memoizedProps)}break;case 27:_n(i,s),bn(s),c&512&&(ut||l===null||pr(l,l.return)),l!==null&&c&4&&Gh(s,s.memoizedProps,l.memoizedProps);break;case 5:if(_n(i,s),bn(s),c&512&&(ut||l===null||pr(l,l.return)),s.flags&32){m=s.stateNode;try{Ns(m,"")}catch(z){tt(s,s.return,z)}}c&4&&s.stateNode!=null&&(m=s.memoizedProps,Gh(s,m,l!==null?l.memoizedProps:m)),c&1024&&(Vh=!0);break;case 6:if(_n(i,s),bn(s),c&4){if(s.stateNode===null)throw Error(n(162));c=s.memoizedProps,l=s.stateNode;try{l.nodeValue=c}catch(z){tt(s,s.return,z)}}break;case 3:if(lc=null,m=Kn,Kn=ic(i.containerInfo),_n(i,s),Kn=m,bn(s),c&4&&l!==null&&l.memoizedState.isDehydrated)try{qo(i.containerInfo)}catch(z){tt(s,s.return,z)}Vh&&(Vh=!1,Wv(s));break;case 4:c=Kn,Kn=ic(s.stateNode.containerInfo),_n(i,s),bn(s),Kn=c;break;case 12:_n(i,s),bn(s);break;case 13:_n(i,s),bn(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(em=fr()),c&4&&(c=s.updateQueue,c!==null&&(s.updateQueue=null,Jh(s,c)));break;case 22:m=s.memoizedState!==null;var C=l!==null&&l.memoizedState!==null,L=Ur,F=ut;if(Ur=L||m,ut=F||C,_n(i,s),ut=F,Ur=L,bn(s),c&8192)e:for(i=s.stateNode,i._visibility=m?i._visibility&-2:i._visibility|1,m&&(l===null||C||Ur||ut||as(s)),l=null,i=s;;){if(i.tag===5||i.tag===26){if(l===null){C=l=i;try{if(g=C.stateNode,m)w=g.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none";else{A=C.stateNode;var J=C.memoizedProps.style,U=J!=null&&J.hasOwnProperty("display")?J.display:null;A.style.display=U==null||typeof U=="boolean"?"":(""+U).trim()}}catch(z){tt(C,C.return,z)}}}else if(i.tag===6){if(l===null){C=i;try{C.stateNode.nodeValue=m?"":C.memoizedProps}catch(z){tt(C,C.return,z)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}c&4&&(c=s.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,Jh(s,l))));break;case 19:_n(i,s),bn(s),c&4&&(c=s.updateQueue,c!==null&&(s.updateQueue=null,Jh(s,c)));break;case 30:break;case 21:break;default:_n(i,s),bn(s)}}function bn(s){var i=s.flags;if(i&2){try{for(var l,c=s.return;c!==null;){if(Fv(c)){l=c;break}c=c.return}if(l==null)throw Error(n(160));switch(l.tag){case 27:var m=l.stateNode,g=Fh(s);Vu(s,g,m);break;case 5:var w=l.stateNode;l.flags&32&&(Ns(w,""),l.flags&=-33);var A=Fh(s);Vu(s,A,w);break;case 3:case 4:var C=l.stateNode.containerInfo,L=Fh(s);Zh(s,L,C);break;default:throw Error(n(161))}}catch(F){tt(s,s.return,F)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function Wv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;Wv(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function fa(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Jv(s,i.alternate,i),i=i.sibling}function as(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:da(4,i,i.return),as(i);break;case 1:pr(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&Hv(i,i.return,l),as(i);break;case 27:Io(i.stateNode);case 26:case 5:pr(i,i.return),as(i);break;case 22:i.memoizedState===null&&as(i);break;case 30:as(i);break;default:as(i)}s=s.sibling}}function ha(s,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var c=i.alternate,m=s,g=i,w=g.flags;switch(g.tag){case 0:case 11:case 15:ha(m,g,l),Eo(4,g);break;case 1:if(ha(m,g,l),c=g,m=c.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(L){tt(c,c.return,L)}if(c=g,m=c.updateQueue,m!==null){var A=c.stateNode;try{var C=m.shared.hiddenCallbacks;if(C!==null)for(m.shared.hiddenCallbacks=null,m=0;m<C.length;m++)Rb(C[m],A)}catch(L){tt(c,c.return,L)}}l&&w&64&&qv(g),Ao(g,g.return);break;case 27:Zv(g);case 26:case 5:ha(m,g,l),l&&c===null&&w&4&&Gv(g),Ao(g,g.return);break;case 12:ha(m,g,l);break;case 13:ha(m,g,l),l&&w&4&&Xv(m,g);break;case 22:g.memoizedState===null&&ha(m,g,l),Ao(g,g.return);break;case 30:break;default:ha(m,g,l)}i=i.sibling}}function Kh(s,i){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&uo(l))}function Yh(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&uo(s))}function gr(s,i,l,c){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)e0(s,i,l,c),i=i.sibling}function e0(s,i,l,c){var m=i.flags;switch(i.tag){case 0:case 11:case 15:gr(s,i,l,c),m&2048&&Eo(9,i);break;case 1:gr(s,i,l,c);break;case 3:gr(s,i,l,c),m&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&uo(s)));break;case 12:if(m&2048){gr(s,i,l,c),s=i.stateNode;try{var g=i.memoizedProps,w=g.id,A=g.onPostCommit;typeof A=="function"&&A(w,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(C){tt(i,i.return,C)}}else gr(s,i,l,c);break;case 13:gr(s,i,l,c);break;case 23:break;case 22:g=i.stateNode,w=i.alternate,i.memoizedState!==null?g._visibility&2?gr(s,i,l,c):Oo(s,i):g._visibility&2?gr(s,i,l,c):(g._visibility|=2,Js(s,i,l,c,(i.subtreeFlags&10256)!==0)),m&2048&&Kh(w,i);break;case 24:gr(s,i,l,c),m&2048&&Yh(i.alternate,i);break;default:gr(s,i,l,c)}}function Js(s,i,l,c,m){for(m=m&&(i.subtreeFlags&10256)!==0,i=i.child;i!==null;){var g=s,w=i,A=l,C=c,L=w.flags;switch(w.tag){case 0:case 11:case 15:Js(g,w,A,C,m),Eo(8,w);break;case 23:break;case 22:var F=w.stateNode;w.memoizedState!==null?F._visibility&2?Js(g,w,A,C,m):Oo(g,w):(F._visibility|=2,Js(g,w,A,C,m)),m&&L&2048&&Kh(w.alternate,w);break;case 24:Js(g,w,A,C,m),m&&L&2048&&Yh(w.alternate,w);break;default:Js(g,w,A,C,m)}i=i.sibling}}function Oo(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=s,c=i,m=c.flags;switch(c.tag){case 22:Oo(l,c),m&2048&&Kh(c.alternate,c);break;case 24:Oo(l,c),m&2048&&Yh(c.alternate,c);break;default:Oo(l,c)}i=i.sibling}}var To=8192;function Ks(s){if(s.subtreeFlags&To)for(s=s.child;s!==null;)t0(s),s=s.sibling}function t0(s){switch(s.tag){case 26:Ks(s),s.flags&To&&s.memoizedState!==null&&bN(Kn,s.memoizedState,s.memoizedProps);break;case 5:Ks(s);break;case 3:case 4:var i=Kn;Kn=ic(s.stateNode.containerInfo),Ks(s),Kn=i;break;case 22:s.memoizedState===null&&(i=s.alternate,i!==null&&i.memoizedState!==null?(i=To,To=16777216,Ks(s),To=i):Ks(s));break;default:Ks(s)}}function n0(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function Ro(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var c=i[l];Rt=c,a0(c,s)}n0(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)r0(s),s=s.sibling}function r0(s){switch(s.tag){case 0:case 11:case 15:Ro(s),s.flags&2048&&da(9,s,s.return);break;case 3:Ro(s);break;case 12:Ro(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,Ju(s)):Ro(s);break;default:Ro(s)}}function Ju(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var c=i[l];Rt=c,a0(c,s)}n0(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:da(8,i,i.return),Ju(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,Ju(i));break;default:Ju(i)}s=s.sibling}}function a0(s,i){for(;Rt!==null;){var l=Rt;switch(l.tag){case 0:case 11:case 15:da(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:uo(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,Rt=c;else e:for(l=s;Rt!==null;){c=Rt;var m=c.sibling,g=c.return;if(Kv(c),c===l){Rt=null;break e}if(m!==null){m.return=g,Rt=m;break e}Rt=g}}}var PR={getCacheForType:function(s){var i=Ht(yt),l=i.data.get(s);return l===void 0&&(l=s(),i.data.set(s,l)),l}},MR=typeof WeakMap=="function"?WeakMap:Map,Ve=0,nt=null,Pe=null,Ue=0,Je=0,vn=null,ma=!1,Ys=!1,Xh=!1,Br=0,ot=0,pa=0,ss=0,Qh=0,zn=0,Xs=0,No=null,on=null,Wh=!1,em=0,Ku=1/0,Yu=null,ga=null,Mt=0,ya=null,Qs=null,Ws=0,tm=0,nm=null,s0=null,Co=0,rm=null;function wn(){if((Ve&2)!==0&&Ue!==0)return Ue&-Ue;if(P.T!==null){var s=zs;return s!==0?s:cm()}return w_()}function i0(){zn===0&&(zn=(Ue&536870912)===0||He?y_():536870912);var s=Un.current;return s!==null&&(s.flags|=32),zn}function Sn(s,i,l){(s===nt&&(Je===2||Je===9)||s.cancelPendingCommit!==null)&&(ei(s,0),_a(s,Ue,zn,!1)),Vi(s,l),((Ve&2)===0||s!==nt)&&(s===nt&&((Ve&2)===0&&(ss|=l),ot===4&&_a(s,Ue,zn,!1)),yr(s))}function o0(s,i,l){if((Ve&6)!==0)throw Error(n(327));var c=!l&&(i&124)===0&&(i&s.expiredLanes)===0||Zi(s,i),m=c?UR(s,i):im(s,i,!0),g=c;do{if(m===0){Ys&&!c&&_a(s,i,0,!1);break}else{if(l=s.current.alternate,g&&!LR(l)){m=im(s,i,!1),g=!1;continue}if(m===2){if(g=i,s.errorRecoveryDisabledLanes&g)var w=0;else w=s.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){i=w;e:{var A=s;m=No;var C=A.current.memoizedState.isDehydrated;if(C&&(ei(A,w).flags|=256),w=im(A,w,!1),w!==2){if(Xh&&!C){A.errorRecoveryDisabledLanes|=g,ss|=g,m=4;break e}g=on,on=m,g!==null&&(on===null?on=g:on.push.apply(on,g))}m=w}if(g=!1,m!==2)continue}}if(m===1){ei(s,0),_a(s,i,0,!0);break}e:{switch(c=s,g=m,g){case 0:case 1:throw Error(n(345));case 4:if((i&4194048)!==i)break;case 6:_a(c,i,zn,!ma);break e;case 2:on=null;break;case 3:case 5:break;default:throw Error(n(329))}if((i&62914560)===i&&(m=em+300-fr(),10<m)){if(_a(c,i,zn,!ma),ou(c,0,!0)!==0)break e;c.timeoutHandle=M0(l0.bind(null,c,l,on,Yu,Wh,i,zn,ss,Xs,ma,g,2,-0,0),m);break e}l0(c,l,on,Yu,Wh,i,zn,ss,Xs,ma,g,0,-0,0)}}break}while(!0);yr(s)}function l0(s,i,l,c,m,g,w,A,C,L,F,J,U,z){if(s.timeoutHandle=-1,J=i.subtreeFlags,(J&8192||(J&16785408)===16785408)&&(Lo={stylesheets:null,count:0,unsuspend:_N},t0(i),J=vN(),J!==null)){s.cancelPendingCommit=J(p0.bind(null,s,i,g,l,c,m,w,A,C,F,1,U,z)),_a(s,g,w,!L);return}p0(s,i,g,l,c,m,w,A,C)}function LR(s){for(var i=s;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var m=l[c],g=m.getSnapshot;m=m.value;try{if(!gn(g(),m))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function _a(s,i,l,c){i&=~Qh,i&=~ss,s.suspendedLanes|=i,s.pingedLanes&=~i,c&&(s.warmLanes|=i),c=s.expirationTimes;for(var m=i;0<m;){var g=31-pn(m),w=1<<g;c[g]=-1,m&=~w}l!==0&&b_(s,l,i)}function Xu(){return(Ve&6)===0?(ko(0),!1):!0}function am(){if(Pe!==null){if(Je===0)var s=Pe.return;else s=Pe,$r=Wa=null,wh(s),Zs=null,wo=0,s=Pe;for(;s!==null;)Bv(s.alternate,s),s=s.return;Pe=null}}function ei(s,i){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,tN(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),am(),nt=s,Pe=l=Cr(s.current,null),Ue=i,Je=0,vn=null,ma=!1,Ys=Zi(s,i),Xh=!1,Xs=zn=Qh=ss=pa=ot=0,on=No=null,Wh=!1,(i&8)!==0&&(i|=i&32);var c=s.entangledLanes;if(c!==0)for(s=s.entanglements,c&=i;0<c;){var m=31-pn(c),g=1<<m;i|=s[m],c&=~g}return Br=i,bu(),l}function u0(s,i){ke=null,P.H=Du,i===fo||i===Ru?(i=Ob(),Je=3):i===xb?(i=Ob(),Je=4):Je=i===Tv?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,vn=i,Pe===null&&(ot=1,Hu(s,Pn(i,s.current)))}function c0(){var s=P.H;return P.H=Du,s===null?Du:s}function d0(){var s=P.A;return P.A=PR,s}function sm(){ot=4,ma||(Ue&4194048)!==Ue&&Un.current!==null||(Ys=!0),(pa&134217727)===0&&(ss&134217727)===0||nt===null||_a(nt,Ue,zn,!1)}function im(s,i,l){var c=Ve;Ve|=2;var m=c0(),g=d0();(nt!==s||Ue!==i)&&(Yu=null,ei(s,i)),i=!1;var w=ot;e:do try{if(Je!==0&&Pe!==null){var A=Pe,C=vn;switch(Je){case 8:am(),w=6;break e;case 3:case 2:case 9:case 6:Un.current===null&&(i=!0);var L=Je;if(Je=0,vn=null,ti(s,A,C,L),l&&Ys){w=0;break e}break;default:L=Je,Je=0,vn=null,ti(s,A,C,L)}}DR(),w=ot;break}catch(F){u0(s,F)}while(!0);return i&&s.shellSuspendCounter++,$r=Wa=null,Ve=c,P.H=m,P.A=g,Pe===null&&(nt=null,Ue=0,bu()),w}function DR(){for(;Pe!==null;)f0(Pe)}function UR(s,i){var l=Ve;Ve|=2;var c=c0(),m=d0();nt!==s||Ue!==i?(Yu=null,Ku=fr()+500,ei(s,i)):Ys=Zi(s,i);e:do try{if(Je!==0&&Pe!==null){i=Pe;var g=vn;t:switch(Je){case 1:Je=0,vn=null,ti(s,i,g,1);break;case 2:case 9:if(Eb(g)){Je=0,vn=null,h0(i);break}i=function(){Je!==2&&Je!==9||nt!==s||(Je=7),yr(s)},g.then(i,i);break e;case 3:Je=7;break e;case 4:Je=5;break e;case 7:Eb(g)?(Je=0,vn=null,h0(i)):(Je=0,vn=null,ti(s,i,g,7));break;case 5:var w=null;switch(Pe.tag){case 26:w=Pe.memoizedState;case 5:case 27:var A=Pe;if(!w||J0(w)){Je=0,vn=null;var C=A.sibling;if(C!==null)Pe=C;else{var L=A.return;L!==null?(Pe=L,Qu(L)):Pe=null}break t}}Je=0,vn=null,ti(s,i,g,5);break;case 6:Je=0,vn=null,ti(s,i,g,6);break;case 8:am(),ot=6;break e;default:throw Error(n(462))}}zR();break}catch(F){u0(s,F)}while(!0);return $r=Wa=null,P.H=c,P.A=m,Ve=l,Pe!==null?0:(nt=null,Ue=0,bu(),ot)}function zR(){for(;Pe!==null&&!lT();)f0(Pe)}function f0(s){var i=Uv(s.alternate,s,Br);s.memoizedProps=s.pendingProps,i===null?Qu(s):Pe=i}function h0(s){var i=s,l=i.alternate;switch(i.tag){case 15:case 0:i=$v(l,i,i.pendingProps,i.type,void 0,Ue);break;case 11:i=$v(l,i,i.pendingProps,i.type.render,i.ref,Ue);break;case 5:wh(i);default:Bv(l,i),i=Pe=mb(i,Br),i=Uv(l,i,Br)}s.memoizedProps=s.pendingProps,i===null?Qu(s):Pe=i}function ti(s,i,l,c){$r=Wa=null,wh(i),Zs=null,wo=0;var m=i.return;try{if(NR(s,m,i,l,Ue)){ot=1,Hu(s,Pn(l,s.current)),Pe=null;return}}catch(g){if(m!==null)throw Pe=m,g;ot=1,Hu(s,Pn(l,s.current)),Pe=null;return}i.flags&32768?(He||c===1?s=!0:Ys||(Ue&536870912)!==0?s=!1:(ma=s=!0,(c===2||c===9||c===3||c===6)&&(c=Un.current,c!==null&&c.tag===13&&(c.flags|=16384))),m0(i,s)):Qu(i)}function Qu(s){var i=s;do{if((i.flags&32768)!==0){m0(i,ma);return}s=i.return;var l=kR(i.alternate,i,Br);if(l!==null){Pe=l;return}if(i=i.sibling,i!==null){Pe=i;return}Pe=i=s}while(i!==null);ot===0&&(ot=5)}function m0(s,i){do{var l=jR(s.alternate,s);if(l!==null){l.flags&=32767,Pe=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(s=s.sibling,s!==null)){Pe=s;return}Pe=s=l}while(s!==null);ot=6,Pe=null}function p0(s,i,l,c,m,g,w,A,C){s.cancelPendingCommit=null;do Wu();while(Mt!==0);if((Ve&6)!==0)throw Error(n(327));if(i!==null){if(i===s.current)throw Error(n(177));if(g=i.lanes|i.childLanes,g|=Yf,_T(s,l,g,w,A,C),s===nt&&(Pe=nt=null,Ue=0),Qs=i,ya=s,Ws=l,tm=g,nm=m,s0=c,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,GR(au,function(){return v0(),null})):(s.callbackNode=null,s.callbackPriority=0),c=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||c){c=P.T,P.T=null,m=H.p,H.p=2,w=Ve,Ve|=4;try{$R(s,i,l)}finally{Ve=w,H.p=m,P.T=c}}Mt=1,g0(),y0(),_0()}}function g0(){if(Mt===1){Mt=0;var s=ya,i=Qs,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=P.T,P.T=null;var c=H.p;H.p=2;var m=Ve;Ve|=4;try{Qv(i,s);var g=_m,w=ab(s.containerInfo),A=g.focusedElem,C=g.selectionRange;if(w!==A&&A&&A.ownerDocument&&rb(A.ownerDocument.documentElement,A)){if(C!==null&&Ff(A)){var L=C.start,F=C.end;if(F===void 0&&(F=L),"selectionStart"in A)A.selectionStart=L,A.selectionEnd=Math.min(F,A.value.length);else{var J=A.ownerDocument||document,U=J&&J.defaultView||window;if(U.getSelection){var z=U.getSelection(),_e=A.textContent.length,ge=Math.min(C.start,_e),We=C.end===void 0?ge:Math.min(C.end,_e);!z.extend&&ge>We&&(w=We,We=ge,ge=w);var I=nb(A,ge),k=nb(A,We);if(I&&k&&(z.rangeCount!==1||z.anchorNode!==I.node||z.anchorOffset!==I.offset||z.focusNode!==k.node||z.focusOffset!==k.offset)){var M=J.createRange();M.setStart(I.node,I.offset),z.removeAllRanges(),ge>We?(z.addRange(M),z.extend(k.node,k.offset)):(M.setEnd(k.node,k.offset),z.addRange(M))}}}}for(J=[],z=A;z=z.parentNode;)z.nodeType===1&&J.push({element:z,left:z.scrollLeft,top:z.scrollTop});for(typeof A.focus=="function"&&A.focus(),A=0;A<J.length;A++){var V=J[A];V.element.scrollLeft=V.left,V.element.scrollTop=V.top}}dc=!!ym,_m=ym=null}finally{Ve=m,H.p=c,P.T=l}}s.current=i,Mt=2}}function y0(){if(Mt===2){Mt=0;var s=ya,i=Qs,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=P.T,P.T=null;var c=H.p;H.p=2;var m=Ve;Ve|=4;try{Jv(s,i.alternate,i)}finally{Ve=m,H.p=c,P.T=l}}Mt=3}}function _0(){if(Mt===4||Mt===3){Mt=0,uT();var s=ya,i=Qs,l=Ws,c=s0;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?Mt=5:(Mt=0,Qs=ya=null,b0(s,s.pendingLanes));var m=s.pendingLanes;if(m===0&&(ga=null),Ef(l),i=i.stateNode,mn&&typeof mn.onCommitFiberRoot=="function")try{mn.onCommitFiberRoot(Fi,i,void 0,(i.current.flags&128)===128)}catch{}if(c!==null){i=P.T,m=H.p,H.p=2,P.T=null;try{for(var g=s.onRecoverableError,w=0;w<c.length;w++){var A=c[w];g(A.value,{componentStack:A.stack})}}finally{P.T=i,H.p=m}}(Ws&3)!==0&&Wu(),yr(s),m=s.pendingLanes,(l&4194090)!==0&&(m&42)!==0?s===rm?Co++:(Co=0,rm=s):Co=0,ko(0)}}function b0(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,uo(i)))}function Wu(s){return g0(),y0(),_0(),v0()}function v0(){if(Mt!==5)return!1;var s=ya,i=tm;tm=0;var l=Ef(Ws),c=P.T,m=H.p;try{H.p=32>l?32:l,P.T=null,l=nm,nm=null;var g=ya,w=Ws;if(Mt=0,Qs=ya=null,Ws=0,(Ve&6)!==0)throw Error(n(331));var A=Ve;if(Ve|=4,r0(g.current),e0(g,g.current,w,l),Ve=A,ko(0,!1),mn&&typeof mn.onPostCommitFiberRoot=="function")try{mn.onPostCommitFiberRoot(Fi,g)}catch{}return!0}finally{H.p=m,P.T=c,b0(s,i)}}function w0(s,i,l){i=Pn(l,i),i=Ph(s.stateNode,i,2),s=oa(s,i,2),s!==null&&(Vi(s,2),yr(s))}function tt(s,i,l){if(s.tag===3)w0(s,s,l);else for(;i!==null;){if(i.tag===3){w0(i,s,l);break}else if(i.tag===1){var c=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(ga===null||!ga.has(c))){s=Pn(l,s),l=Av(2),c=oa(i,l,2),c!==null&&(Ov(l,c,i,s),Vi(c,2),yr(c));break}}i=i.return}}function om(s,i,l){var c=s.pingCache;if(c===null){c=s.pingCache=new MR;var m=new Set;c.set(i,m)}else m=c.get(i),m===void 0&&(m=new Set,c.set(i,m));m.has(l)||(Xh=!0,m.add(l),s=BR.bind(null,s,i,l),i.then(s,s))}function BR(s,i,l){var c=s.pingCache;c!==null&&c.delete(i),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,nt===s&&(Ue&l)===l&&(ot===4||ot===3&&(Ue&62914560)===Ue&&300>fr()-em?(Ve&2)===0&&ei(s,0):Qh|=l,Xs===Ue&&(Xs=0)),yr(s)}function S0(s,i){i===0&&(i=__()),s=Ms(s,i),s!==null&&(Vi(s,i),yr(s))}function qR(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),S0(s,l)}function HR(s,i){var l=0;switch(s.tag){case 13:var c=s.stateNode,m=s.memoizedState;m!==null&&(l=m.retryLane);break;case 19:c=s.stateNode;break;case 22:c=s.stateNode._retryCache;break;default:throw Error(n(314))}c!==null&&c.delete(i),S0(s,l)}function GR(s,i){return vf(s,i)}var ec=null,ni=null,lm=!1,tc=!1,um=!1,is=0;function yr(s){s!==ni&&s.next===null&&(ni===null?ec=ni=s:ni=ni.next=s),tc=!0,lm||(lm=!0,ZR())}function ko(s,i){if(!um&&tc){um=!0;do for(var l=!1,c=ec;c!==null;){if(s!==0){var m=c.pendingLanes;if(m===0)var g=0;else{var w=c.suspendedLanes,A=c.pingedLanes;g=(1<<31-pn(42|s)+1)-1,g&=m&~(w&~A),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(l=!0,O0(c,g))}else g=Ue,g=ou(c,c===nt?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||Zi(c,g)||(l=!0,O0(c,g));c=c.next}while(l);um=!1}}function FR(){x0()}function x0(){tc=lm=!1;var s=0;is!==0&&(eN()&&(s=is),is=0);for(var i=fr(),l=null,c=ec;c!==null;){var m=c.next,g=E0(c,i);g===0?(c.next=null,l===null?ec=m:l.next=m,m===null&&(ni=l)):(l=c,(s!==0||(g&3)!==0)&&(tc=!0)),c=m}ko(s)}function E0(s,i){for(var l=s.suspendedLanes,c=s.pingedLanes,m=s.expirationTimes,g=s.pendingLanes&-62914561;0<g;){var w=31-pn(g),A=1<<w,C=m[w];C===-1?((A&l)===0||(A&c)!==0)&&(m[w]=yT(A,i)):C<=i&&(s.expiredLanes|=A),g&=~A}if(i=nt,l=Ue,l=ou(s,s===i?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),c=s.callbackNode,l===0||s===i&&(Je===2||Je===9)||s.cancelPendingCommit!==null)return c!==null&&c!==null&&wf(c),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||Zi(s,l)){if(i=l&-l,i===s.callbackPriority)return i;switch(c!==null&&wf(c),Ef(l)){case 2:case 8:l=p_;break;case 32:l=au;break;case 268435456:l=g_;break;default:l=au}return c=A0.bind(null,s),l=vf(l,c),s.callbackPriority=i,s.callbackNode=l,i}return c!==null&&c!==null&&wf(c),s.callbackPriority=2,s.callbackNode=null,2}function A0(s,i){if(Mt!==0&&Mt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(Wu()&&s.callbackNode!==l)return null;var c=Ue;return c=ou(s,s===nt?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),c===0?null:(o0(s,c,i),E0(s,fr()),s.callbackNode!=null&&s.callbackNode===l?A0.bind(null,s):null)}function O0(s,i){if(Wu())return null;o0(s,i,!0)}function ZR(){nN(function(){(Ve&6)!==0?vf(m_,FR):x0()})}function cm(){return is===0&&(is=y_()),is}function T0(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:fu(""+s)}function R0(s,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,s.id&&l.setAttribute("form",s.id),i.parentNode.insertBefore(l,i),s=new FormData(s),l.parentNode.removeChild(l),s}function VR(s,i,l,c,m){if(i==="submit"&&l&&l.stateNode===m){var g=T0((m[nn]||null).action),w=c.submitter;w&&(i=(i=w[nn]||null)?T0(i.formAction):w.getAttribute("formAction"),i!==null&&(g=i,w=null));var A=new gu("action","action",null,c,m);s.push({event:A,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(is!==0){var C=w?R0(m,w):new FormData(m);Ch(l,{pending:!0,data:C,method:m.method,action:g},null,C)}}else typeof g=="function"&&(A.preventDefault(),C=w?R0(m,w):new FormData(m),Ch(l,{pending:!0,data:C,method:m.method,action:g},g,C))},currentTarget:m}]})}}for(var dm=0;dm<Kf.length;dm++){var fm=Kf[dm],JR=fm.toLowerCase(),KR=fm[0].toUpperCase()+fm.slice(1);Jn(JR,"on"+KR)}Jn(ob,"onAnimationEnd"),Jn(lb,"onAnimationIteration"),Jn(ub,"onAnimationStart"),Jn("dblclick","onDoubleClick"),Jn("focusin","onFocus"),Jn("focusout","onBlur"),Jn(fR,"onTransitionRun"),Jn(hR,"onTransitionStart"),Jn(mR,"onTransitionCancel"),Jn(cb,"onTransitionEnd"),Os("onMouseEnter",["mouseout","mouseover"]),Os("onMouseLeave",["mouseout","mouseover"]),Os("onPointerEnter",["pointerout","pointerover"]),Os("onPointerLeave",["pointerout","pointerover"]),Ga("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ga("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ga("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ga("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ga("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ga("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YR=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jo));function N0(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var c=s[l],m=c.event;c=c.listeners;e:{var g=void 0;if(i)for(var w=c.length-1;0<=w;w--){var A=c[w],C=A.instance,L=A.currentTarget;if(A=A.listener,C!==g&&m.isPropagationStopped())break e;g=A,m.currentTarget=L;try{g(m)}catch(F){qu(F)}m.currentTarget=null,g=C}else for(w=0;w<c.length;w++){if(A=c[w],C=A.instance,L=A.currentTarget,A=A.listener,C!==g&&m.isPropagationStopped())break e;g=A,m.currentTarget=L;try{g(m)}catch(F){qu(F)}m.currentTarget=null,g=C}}}}function Me(s,i){var l=i[Af];l===void 0&&(l=i[Af]=new Set);var c=s+"__bubble";l.has(c)||(C0(i,s,2,!1),l.add(c))}function hm(s,i,l){var c=0;i&&(c|=4),C0(l,s,c,i)}var nc="_reactListening"+Math.random().toString(36).slice(2);function mm(s){if(!s[nc]){s[nc]=!0,x_.forEach(function(l){l!=="selectionchange"&&(YR.has(l)||hm(l,!1,s),hm(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[nc]||(i[nc]=!0,hm("selectionchange",!1,i))}}function C0(s,i,l,c){switch(ew(i)){case 2:var m=xN;break;case 8:m=EN;break;default:m=Rm}l=m.bind(null,i,l,s),m=void 0,!Mf||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(m=!0),c?m!==void 0?s.addEventListener(i,l,{capture:!0,passive:m}):s.addEventListener(i,l,!0):m!==void 0?s.addEventListener(i,l,{passive:m}):s.addEventListener(i,l,!1)}function pm(s,i,l,c,m){var g=c;if((i&1)===0&&(i&2)===0&&c!==null)e:for(;;){if(c===null)return;var w=c.tag;if(w===3||w===4){var A=c.stateNode.containerInfo;if(A===m)break;if(w===4)for(w=c.return;w!==null;){var C=w.tag;if((C===3||C===4)&&w.stateNode.containerInfo===m)return;w=w.return}for(;A!==null;){if(w=xs(A),w===null)return;if(C=w.tag,C===5||C===6||C===26||C===27){c=g=w;continue e}A=A.parentNode}}c=c.return}L_(function(){var L=g,F=If(l),J=[];e:{var U=db.get(s);if(U!==void 0){var z=gu,_e=s;switch(s){case"keypress":if(mu(l)===0)break e;case"keydown":case"keyup":z=GT;break;case"focusin":_e="focus",z=zf;break;case"focusout":_e="blur",z=zf;break;case"beforeblur":case"afterblur":z=zf;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":z=z_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":z=jT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":z=VT;break;case ob:case lb:case ub:z=PT;break;case cb:z=KT;break;case"scroll":case"scrollend":z=CT;break;case"wheel":z=XT;break;case"copy":case"cut":case"paste":z=LT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":z=q_;break;case"toggle":case"beforetoggle":z=WT}var ge=(i&4)!==0,We=!ge&&(s==="scroll"||s==="scrollend"),I=ge?U!==null?U+"Capture":null:U;ge=[];for(var k=L,M;k!==null;){var V=k;if(M=V.stateNode,V=V.tag,V!==5&&V!==26&&V!==27||M===null||I===null||(V=Yi(k,I),V!=null&&ge.push($o(k,V,M))),We)break;k=k.return}0<ge.length&&(U=new z(U,_e,null,l,F),J.push({event:U,listeners:ge}))}}if((i&7)===0){e:{if(U=s==="mouseover"||s==="pointerover",z=s==="mouseout"||s==="pointerout",U&&l!==$f&&(_e=l.relatedTarget||l.fromElement)&&(xs(_e)||_e[Ss]))break e;if((z||U)&&(U=F.window===F?F:(U=F.ownerDocument)?U.defaultView||U.parentWindow:window,z?(_e=l.relatedTarget||l.toElement,z=L,_e=_e?xs(_e):null,_e!==null&&(We=o(_e),ge=_e.tag,_e!==We||ge!==5&&ge!==27&&ge!==6)&&(_e=null)):(z=null,_e=L),z!==_e)){if(ge=z_,V="onMouseLeave",I="onMouseEnter",k="mouse",(s==="pointerout"||s==="pointerover")&&(ge=q_,V="onPointerLeave",I="onPointerEnter",k="pointer"),We=z==null?U:Ki(z),M=_e==null?U:Ki(_e),U=new ge(V,k+"leave",z,l,F),U.target=We,U.relatedTarget=M,V=null,xs(F)===L&&(ge=new ge(I,k+"enter",_e,l,F),ge.target=M,ge.relatedTarget=We,V=ge),We=V,z&&_e)t:{for(ge=z,I=_e,k=0,M=ge;M;M=ri(M))k++;for(M=0,V=I;V;V=ri(V))M++;for(;0<k-M;)ge=ri(ge),k--;for(;0<M-k;)I=ri(I),M--;for(;k--;){if(ge===I||I!==null&&ge===I.alternate)break t;ge=ri(ge),I=ri(I)}ge=null}else ge=null;z!==null&&k0(J,U,z,ge,!1),_e!==null&&We!==null&&k0(J,We,_e,ge,!0)}}e:{if(U=L?Ki(L):window,z=U.nodeName&&U.nodeName.toLowerCase(),z==="select"||z==="input"&&U.type==="file")var le=Y_;else if(J_(U))if(X_)le=uR;else{le=oR;var Ie=iR}else z=U.nodeName,!z||z.toLowerCase()!=="input"||U.type!=="checkbox"&&U.type!=="radio"?L&&jf(L.elementType)&&(le=Y_):le=lR;if(le&&(le=le(s,L))){K_(J,le,l,F);break e}Ie&&Ie(s,U,L),s==="focusout"&&L&&U.type==="number"&&L.memoizedProps.value!=null&&kf(U,"number",U.value)}switch(Ie=L?Ki(L):window,s){case"focusin":(J_(Ie)||Ie.contentEditable==="true")&&($s=Ie,Zf=L,ao=null);break;case"focusout":ao=Zf=$s=null;break;case"mousedown":Vf=!0;break;case"contextmenu":case"mouseup":case"dragend":Vf=!1,sb(J,l,F);break;case"selectionchange":if(dR)break;case"keydown":case"keyup":sb(J,l,F)}var de;if(qf)e:{switch(s){case"compositionstart":var ye="onCompositionStart";break e;case"compositionend":ye="onCompositionEnd";break e;case"compositionupdate":ye="onCompositionUpdate";break e}ye=void 0}else js?Z_(s,l)&&(ye="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(ye="onCompositionStart");ye&&(H_&&l.locale!=="ko"&&(js||ye!=="onCompositionStart"?ye==="onCompositionEnd"&&js&&(de=D_()):(ra=F,Lf="value"in ra?ra.value:ra.textContent,js=!0)),Ie=rc(L,ye),0<Ie.length&&(ye=new B_(ye,s,null,l,F),J.push({event:ye,listeners:Ie}),de?ye.data=de:(de=V_(l),de!==null&&(ye.data=de)))),(de=tR?nR(s,l):rR(s,l))&&(ye=rc(L,"onBeforeInput"),0<ye.length&&(Ie=new B_("onBeforeInput","beforeinput",null,l,F),J.push({event:Ie,listeners:ye}),Ie.data=de)),VR(J,s,L,l,F)}N0(J,i)})}function $o(s,i,l){return{instance:s,listener:i,currentTarget:l}}function rc(s,i){for(var l=i+"Capture",c=[];s!==null;){var m=s,g=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||g===null||(m=Yi(s,l),m!=null&&c.unshift($o(s,m,g)),m=Yi(s,i),m!=null&&c.push($o(s,m,g))),s.tag===3)return c;s=s.return}return[]}function ri(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function k0(s,i,l,c,m){for(var g=i._reactName,w=[];l!==null&&l!==c;){var A=l,C=A.alternate,L=A.stateNode;if(A=A.tag,C!==null&&C===c)break;A!==5&&A!==26&&A!==27||L===null||(C=L,m?(L=Yi(l,g),L!=null&&w.unshift($o(l,L,C))):m||(L=Yi(l,g),L!=null&&w.push($o(l,L,C)))),l=l.return}w.length!==0&&s.push({event:i,listeners:w})}var XR=/\r\n?/g,QR=/\u0000|\uFFFD/g;function j0(s){return(typeof s=="string"?s:""+s).replace(XR,`
`).replace(QR,"")}function $0(s,i){return i=j0(i),j0(s)===i}function ac(){}function Qe(s,i,l,c,m,g){switch(l){case"children":typeof c=="string"?i==="body"||i==="textarea"&&c===""||Ns(s,c):(typeof c=="number"||typeof c=="bigint")&&i!=="body"&&Ns(s,""+c);break;case"className":uu(s,"class",c);break;case"tabIndex":uu(s,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":uu(s,l,c);break;case"style":P_(s,c,g);break;case"data":if(i!=="object"){uu(s,"data",c);break}case"src":case"href":if(c===""&&(i!=="a"||l!=="href")){s.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){s.removeAttribute(l);break}c=fu(""+c),s.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(l==="formAction"?(i!=="input"&&Qe(s,i,"name",m.name,m,null),Qe(s,i,"formEncType",m.formEncType,m,null),Qe(s,i,"formMethod",m.formMethod,m,null),Qe(s,i,"formTarget",m.formTarget,m,null)):(Qe(s,i,"encType",m.encType,m,null),Qe(s,i,"method",m.method,m,null),Qe(s,i,"target",m.target,m,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){s.removeAttribute(l);break}c=fu(""+c),s.setAttribute(l,c);break;case"onClick":c!=null&&(s.onclick=ac);break;case"onScroll":c!=null&&Me("scroll",s);break;case"onScrollEnd":c!=null&&Me("scrollend",s);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(n(61));if(l=c.__html,l!=null){if(m.children!=null)throw Error(n(60));s.innerHTML=l}}break;case"multiple":s.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":s.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){s.removeAttribute("xlink:href");break}l=fu(""+c),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?s.setAttribute(l,""+c):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":c===!0?s.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?s.setAttribute(l,c):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?s.setAttribute(l,c):s.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?s.removeAttribute(l):s.setAttribute(l,c);break;case"popover":Me("beforetoggle",s),Me("toggle",s),lu(s,"popover",c);break;case"xlinkActuate":Rr(s,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Rr(s,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Rr(s,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Rr(s,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Rr(s,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Rr(s,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":lu(s,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=RT.get(l)||l,lu(s,l,c))}}function gm(s,i,l,c,m,g){switch(l){case"style":P_(s,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(n(61));if(l=c.__html,l!=null){if(m.children!=null)throw Error(n(60));s.innerHTML=l}}break;case"children":typeof c=="string"?Ns(s,c):(typeof c=="number"||typeof c=="bigint")&&Ns(s,""+c);break;case"onScroll":c!=null&&Me("scroll",s);break;case"onScrollEnd":c!=null&&Me("scrollend",s);break;case"onClick":c!=null&&(s.onclick=ac);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!E_.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(m=l.endsWith("Capture"),i=l.slice(2,m?l.length-7:void 0),g=s[nn]||null,g=g!=null?g[l]:null,typeof g=="function"&&s.removeEventListener(i,g,m),typeof c=="function")){typeof g!="function"&&g!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(i,c,m);break e}l in s?s[l]=c:c===!0?s.setAttribute(l,""):lu(s,l,c)}}}function Lt(s,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Me("error",s),Me("load",s);var c=!1,m=!1,g;for(g in l)if(l.hasOwnProperty(g)){var w=l[g];if(w!=null)switch(g){case"src":c=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,i));default:Qe(s,i,g,w,l,null)}}m&&Qe(s,i,"srcSet",l.srcSet,l,null),c&&Qe(s,i,"src",l.src,l,null);return;case"input":Me("invalid",s);var A=g=w=m=null,C=null,L=null;for(c in l)if(l.hasOwnProperty(c)){var F=l[c];if(F!=null)switch(c){case"name":m=F;break;case"type":w=F;break;case"checked":C=F;break;case"defaultChecked":L=F;break;case"value":g=F;break;case"defaultValue":A=F;break;case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(n(137,i));break;default:Qe(s,i,c,F,l,null)}}k_(s,g,A,C,L,w,m,!1),cu(s);return;case"select":Me("invalid",s),c=w=g=null;for(m in l)if(l.hasOwnProperty(m)&&(A=l[m],A!=null))switch(m){case"value":g=A;break;case"defaultValue":w=A;break;case"multiple":c=A;default:Qe(s,i,m,A,l,null)}i=g,l=w,s.multiple=!!c,i!=null?Rs(s,!!c,i,!1):l!=null&&Rs(s,!!c,l,!0);return;case"textarea":Me("invalid",s),g=m=c=null;for(w in l)if(l.hasOwnProperty(w)&&(A=l[w],A!=null))switch(w){case"value":c=A;break;case"defaultValue":m=A;break;case"children":g=A;break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(n(91));break;default:Qe(s,i,w,A,l,null)}$_(s,c,m,g),cu(s);return;case"option":for(C in l)if(l.hasOwnProperty(C)&&(c=l[C],c!=null))switch(C){case"selected":s.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:Qe(s,i,C,c,l,null)}return;case"dialog":Me("beforetoggle",s),Me("toggle",s),Me("cancel",s),Me("close",s);break;case"iframe":case"object":Me("load",s);break;case"video":case"audio":for(c=0;c<jo.length;c++)Me(jo[c],s);break;case"image":Me("error",s),Me("load",s);break;case"details":Me("toggle",s);break;case"embed":case"source":case"link":Me("error",s),Me("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(L in l)if(l.hasOwnProperty(L)&&(c=l[L],c!=null))switch(L){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,i));default:Qe(s,i,L,c,l,null)}return;default:if(jf(i)){for(F in l)l.hasOwnProperty(F)&&(c=l[F],c!==void 0&&gm(s,i,F,c,l,void 0));return}}for(A in l)l.hasOwnProperty(A)&&(c=l[A],c!=null&&Qe(s,i,A,c,l,null))}function WR(s,i,l,c){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,g=null,w=null,A=null,C=null,L=null,F=null;for(z in l){var J=l[z];if(l.hasOwnProperty(z)&&J!=null)switch(z){case"checked":break;case"value":break;case"defaultValue":C=J;default:c.hasOwnProperty(z)||Qe(s,i,z,null,c,J)}}for(var U in c){var z=c[U];if(J=l[U],c.hasOwnProperty(U)&&(z!=null||J!=null))switch(U){case"type":g=z;break;case"name":m=z;break;case"checked":L=z;break;case"defaultChecked":F=z;break;case"value":w=z;break;case"defaultValue":A=z;break;case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(n(137,i));break;default:z!==J&&Qe(s,i,U,z,c,J)}}Cf(s,w,A,C,L,F,g,m);return;case"select":z=w=A=U=null;for(g in l)if(C=l[g],l.hasOwnProperty(g)&&C!=null)switch(g){case"value":break;case"multiple":z=C;default:c.hasOwnProperty(g)||Qe(s,i,g,null,c,C)}for(m in c)if(g=c[m],C=l[m],c.hasOwnProperty(m)&&(g!=null||C!=null))switch(m){case"value":U=g;break;case"defaultValue":A=g;break;case"multiple":w=g;default:g!==C&&Qe(s,i,m,g,c,C)}i=A,l=w,c=z,U!=null?Rs(s,!!l,U,!1):!!c!=!!l&&(i!=null?Rs(s,!!l,i,!0):Rs(s,!!l,l?[]:"",!1));return;case"textarea":z=U=null;for(A in l)if(m=l[A],l.hasOwnProperty(A)&&m!=null&&!c.hasOwnProperty(A))switch(A){case"value":break;case"children":break;default:Qe(s,i,A,null,c,m)}for(w in c)if(m=c[w],g=l[w],c.hasOwnProperty(w)&&(m!=null||g!=null))switch(w){case"value":U=m;break;case"defaultValue":z=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(n(91));break;default:m!==g&&Qe(s,i,w,m,c,g)}j_(s,U,z);return;case"option":for(var _e in l)if(U=l[_e],l.hasOwnProperty(_e)&&U!=null&&!c.hasOwnProperty(_e))switch(_e){case"selected":s.selected=!1;break;default:Qe(s,i,_e,null,c,U)}for(C in c)if(U=c[C],z=l[C],c.hasOwnProperty(C)&&U!==z&&(U!=null||z!=null))switch(C){case"selected":s.selected=U&&typeof U!="function"&&typeof U!="symbol";break;default:Qe(s,i,C,U,c,z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ge in l)U=l[ge],l.hasOwnProperty(ge)&&U!=null&&!c.hasOwnProperty(ge)&&Qe(s,i,ge,null,c,U);for(L in c)if(U=c[L],z=l[L],c.hasOwnProperty(L)&&U!==z&&(U!=null||z!=null))switch(L){case"children":case"dangerouslySetInnerHTML":if(U!=null)throw Error(n(137,i));break;default:Qe(s,i,L,U,c,z)}return;default:if(jf(i)){for(var We in l)U=l[We],l.hasOwnProperty(We)&&U!==void 0&&!c.hasOwnProperty(We)&&gm(s,i,We,void 0,c,U);for(F in c)U=c[F],z=l[F],!c.hasOwnProperty(F)||U===z||U===void 0&&z===void 0||gm(s,i,F,U,c,z);return}}for(var I in l)U=l[I],l.hasOwnProperty(I)&&U!=null&&!c.hasOwnProperty(I)&&Qe(s,i,I,null,c,U);for(J in c)U=c[J],z=l[J],!c.hasOwnProperty(J)||U===z||U==null&&z==null||Qe(s,i,J,U,c,z)}var ym=null,_m=null;function sc(s){return s.nodeType===9?s:s.ownerDocument}function I0(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function P0(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function bm(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var vm=null;function eN(){var s=window.event;return s&&s.type==="popstate"?s===vm?!1:(vm=s,!0):(vm=null,!1)}var M0=typeof setTimeout=="function"?setTimeout:void 0,tN=typeof clearTimeout=="function"?clearTimeout:void 0,L0=typeof Promise=="function"?Promise:void 0,nN=typeof queueMicrotask=="function"?queueMicrotask:typeof L0<"u"?function(s){return L0.resolve(null).then(s).catch(rN)}:M0;function rN(s){setTimeout(function(){throw s})}function ba(s){return s==="head"}function D0(s,i){var l=i,c=0,m=0;do{var g=l.nextSibling;if(s.removeChild(l),g&&g.nodeType===8)if(l=g.data,l==="/$"){if(0<c&&8>c){l=c;var w=s.ownerDocument;if(l&1&&Io(w.documentElement),l&2&&Io(w.body),l&4)for(l=w.head,Io(l),w=l.firstChild;w;){var A=w.nextSibling,C=w.nodeName;w[Ji]||C==="SCRIPT"||C==="STYLE"||C==="LINK"&&w.rel.toLowerCase()==="stylesheet"||l.removeChild(w),w=A}}if(m===0){s.removeChild(g),qo(i);return}m--}else l==="$"||l==="$?"||l==="$!"?m++:c=l.charCodeAt(0)-48;else c=0;l=g}while(l);qo(i)}function wm(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":wm(l),Of(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function aN(s,i,l,c){for(;s.nodeType===1;){var m=l;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!c&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(c){if(!s[Ji])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(g=s.getAttribute("rel"),g==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(g!==m.rel||s.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||s.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||s.getAttribute("title")!==(m.title==null?null:m.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(g=s.getAttribute("src"),(g!==(m.src==null?null:m.src)||s.getAttribute("type")!==(m.type==null?null:m.type)||s.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&g&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var g=m.name==null?null:""+m.name;if(m.type==="hidden"&&s.getAttribute("name")===g)return s}else return s;if(s=Yn(s.nextSibling),s===null)break}return null}function sN(s,i,l){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=Yn(s.nextSibling),s===null))return null;return s}function Sm(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function iN(s,i){var l=s.ownerDocument;if(s.data!=="$?"||l.readyState==="complete")i();else{var c=function(){i(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),s._reactRetry=c}}function Yn(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="F!"||i==="F")break;if(i==="/$")return null}}return s}var xm=null;function U0(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"){if(i===0)return s;i--}else l==="/$"&&i++}s=s.previousSibling}return null}function z0(s,i,l){switch(i=sc(l),s){case"html":if(s=i.documentElement,!s)throw Error(n(452));return s;case"head":if(s=i.head,!s)throw Error(n(453));return s;case"body":if(s=i.body,!s)throw Error(n(454));return s;default:throw Error(n(451))}}function Io(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);Of(s)}var Bn=new Map,B0=new Set;function ic(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var qr=H.d;H.d={f:oN,r:lN,D:uN,C:cN,L:dN,m:fN,X:mN,S:hN,M:pN};function oN(){var s=qr.f(),i=Xu();return s||i}function lN(s){var i=Es(s);i!==null&&i.tag===5&&i.type==="form"?ov(i):qr.r(s)}var ai=typeof document>"u"?null:document;function q0(s,i,l){var c=ai;if(c&&typeof i=="string"&&i){var m=In(i);m='link[rel="'+s+'"][href="'+m+'"]',typeof l=="string"&&(m+='[crossorigin="'+l+'"]'),B0.has(m)||(B0.add(m),s={rel:s,crossOrigin:l,href:i},c.querySelector(m)===null&&(i=c.createElement("link"),Lt(i,"link",s),Ot(i),c.head.appendChild(i)))}}function uN(s){qr.D(s),q0("dns-prefetch",s,null)}function cN(s,i){qr.C(s,i),q0("preconnect",s,i)}function dN(s,i,l){qr.L(s,i,l);var c=ai;if(c&&s&&i){var m='link[rel="preload"][as="'+In(i)+'"]';i==="image"&&l&&l.imageSrcSet?(m+='[imagesrcset="'+In(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(m+='[imagesizes="'+In(l.imageSizes)+'"]')):m+='[href="'+In(s)+'"]';var g=m;switch(i){case"style":g=si(s);break;case"script":g=ii(s)}Bn.has(g)||(s=p({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:s,as:i},l),Bn.set(g,s),c.querySelector(m)!==null||i==="style"&&c.querySelector(Po(g))||i==="script"&&c.querySelector(Mo(g))||(i=c.createElement("link"),Lt(i,"link",s),Ot(i),c.head.appendChild(i)))}}function fN(s,i){qr.m(s,i);var l=ai;if(l&&s){var c=i&&typeof i.as=="string"?i.as:"script",m='link[rel="modulepreload"][as="'+In(c)+'"][href="'+In(s)+'"]',g=m;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=ii(s)}if(!Bn.has(g)&&(s=p({rel:"modulepreload",href:s},i),Bn.set(g,s),l.querySelector(m)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Mo(g)))return}c=l.createElement("link"),Lt(c,"link",s),Ot(c),l.head.appendChild(c)}}}function hN(s,i,l){qr.S(s,i,l);var c=ai;if(c&&s){var m=As(c).hoistableStyles,g=si(s);i=i||"default";var w=m.get(g);if(!w){var A={loading:0,preload:null};if(w=c.querySelector(Po(g)))A.loading=5;else{s=p({rel:"stylesheet",href:s,"data-precedence":i},l),(l=Bn.get(g))&&Em(s,l);var C=w=c.createElement("link");Ot(C),Lt(C,"link",s),C._p=new Promise(function(L,F){C.onload=L,C.onerror=F}),C.addEventListener("load",function(){A.loading|=1}),C.addEventListener("error",function(){A.loading|=2}),A.loading|=4,oc(w,i,c)}w={type:"stylesheet",instance:w,count:1,state:A},m.set(g,w)}}}function mN(s,i){qr.X(s,i);var l=ai;if(l&&s){var c=As(l).hoistableScripts,m=ii(s),g=c.get(m);g||(g=l.querySelector(Mo(m)),g||(s=p({src:s,async:!0},i),(i=Bn.get(m))&&Am(s,i),g=l.createElement("script"),Ot(g),Lt(g,"link",s),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(m,g))}}function pN(s,i){qr.M(s,i);var l=ai;if(l&&s){var c=As(l).hoistableScripts,m=ii(s),g=c.get(m);g||(g=l.querySelector(Mo(m)),g||(s=p({src:s,async:!0,type:"module"},i),(i=Bn.get(m))&&Am(s,i),g=l.createElement("script"),Ot(g),Lt(g,"link",s),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(m,g))}}function H0(s,i,l,c){var m=(m=pe.current)?ic(m):null;if(!m)throw Error(n(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=si(l.href),l=As(m).hoistableStyles,c=l.get(i),c||(c={type:"style",instance:null,count:0,state:null},l.set(i,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=si(l.href);var g=As(m).hoistableStyles,w=g.get(s);if(w||(m=m.ownerDocument||m,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(s,w),(g=m.querySelector(Po(s)))&&!g._p&&(w.instance=g,w.state.loading=5),Bn.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Bn.set(s,l),g||gN(m,s,l,w.state))),i&&c===null)throw Error(n(528,""));return w}if(i&&c!==null)throw Error(n(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=ii(l),l=As(m).hoistableScripts,c=l.get(i),c||(c={type:"script",instance:null,count:0,state:null},l.set(i,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,s))}}function si(s){return'href="'+In(s)+'"'}function Po(s){return'link[rel="stylesheet"]['+s+"]"}function G0(s){return p({},s,{"data-precedence":s.precedence,precedence:null})}function gN(s,i,l,c){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?c.loading=1:(i=s.createElement("link"),c.preload=i,i.addEventListener("load",function(){return c.loading|=1}),i.addEventListener("error",function(){return c.loading|=2}),Lt(i,"link",l),Ot(i),s.head.appendChild(i))}function ii(s){return'[src="'+In(s)+'"]'}function Mo(s){return"script[async]"+s}function F0(s,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var c=s.querySelector('style[data-href~="'+In(l.href)+'"]');if(c)return i.instance=c,Ot(c),c;var m=p({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(s.ownerDocument||s).createElement("style"),Ot(c),Lt(c,"style",m),oc(c,l.precedence,s),i.instance=c;case"stylesheet":m=si(l.href);var g=s.querySelector(Po(m));if(g)return i.state.loading|=4,i.instance=g,Ot(g),g;c=G0(l),(m=Bn.get(m))&&Em(c,m),g=(s.ownerDocument||s).createElement("link"),Ot(g);var w=g;return w._p=new Promise(function(A,C){w.onload=A,w.onerror=C}),Lt(g,"link",c),i.state.loading|=4,oc(g,l.precedence,s),i.instance=g;case"script":return g=ii(l.src),(m=s.querySelector(Mo(g)))?(i.instance=m,Ot(m),m):(c=l,(m=Bn.get(g))&&(c=p({},l),Am(c,m)),s=s.ownerDocument||s,m=s.createElement("script"),Ot(m),Lt(m,"link",c),s.head.appendChild(m),i.instance=m);case"void":return null;default:throw Error(n(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(c=i.instance,i.state.loading|=4,oc(c,l.precedence,s));return i.instance}function oc(s,i,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=c.length?c[c.length-1]:null,g=m,w=0;w<c.length;w++){var A=c[w];if(A.dataset.precedence===i)g=A;else if(g!==m)break}g?g.parentNode.insertBefore(s,g.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(s,i.firstChild))}function Em(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function Am(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var lc=null;function Z0(s,i,l){if(lc===null){var c=new Map,m=lc=new Map;m.set(l,c)}else m=lc,c=m.get(l),c||(c=new Map,m.set(l,c));if(c.has(s))return c;for(c.set(s,null),l=l.getElementsByTagName(s),m=0;m<l.length;m++){var g=l[m];if(!(g[Ji]||g[qt]||s==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var w=g.getAttribute(i)||"";w=s+w;var A=c.get(w);A?A.push(g):c.set(w,[g])}}return c}function V0(s,i,l){s=s.ownerDocument||s,s.head.insertBefore(l,i==="title"?s.querySelector("head > title"):null)}function yN(s,i,l){if(l===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return s=i.disabled,typeof i.precedence=="string"&&s==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function J0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var Lo=null;function _N(){}function bN(s,i,l){if(Lo===null)throw Error(n(475));var c=Lo;if(i.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var m=si(l.href),g=s.querySelector(Po(m));if(g){s=g._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(c.count++,c=uc.bind(c),s.then(c,c)),i.state.loading|=4,i.instance=g,Ot(g);return}g=s.ownerDocument||s,l=G0(l),(m=Bn.get(m))&&Em(l,m),g=g.createElement("link"),Ot(g);var w=g;w._p=new Promise(function(A,C){w.onload=A,w.onerror=C}),Lt(g,"link",l),i.instance=g}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(i,s),(s=i.state.preload)&&(i.state.loading&3)===0&&(c.count++,i=uc.bind(c),s.addEventListener("load",i),s.addEventListener("error",i))}}function vN(){if(Lo===null)throw Error(n(475));var s=Lo;return s.stylesheets&&s.count===0&&Om(s,s.stylesheets),0<s.count?function(i){var l=setTimeout(function(){if(s.stylesheets&&Om(s,s.stylesheets),s.unsuspend){var c=s.unsuspend;s.unsuspend=null,c()}},6e4);return s.unsuspend=i,function(){s.unsuspend=null,clearTimeout(l)}}:null}function uc(){if(this.count--,this.count===0){if(this.stylesheets)Om(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var cc=null;function Om(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,cc=new Map,i.forEach(wN,s),cc=null,uc.call(s))}function wN(s,i){if(!(i.state.loading&4)){var l=cc.get(s);if(l)var c=l.get(null);else{l=new Map,cc.set(s,l);for(var m=s.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<m.length;g++){var w=m[g];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(l.set(w.dataset.precedence,w),c=w)}c&&l.set(null,c)}m=i.instance,w=m.getAttribute("data-precedence"),g=l.get(w)||c,g===c&&l.set(null,m),l.set(w,m),this.count++,c=uc.bind(this),m.addEventListener("load",c),m.addEventListener("error",c),g?g.parentNode.insertBefore(m,g.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(m,s.firstChild)),i.state.loading|=4}}var Do={$$typeof:T,Provider:null,Consumer:null,_currentValue:X,_currentValue2:X,_threadCount:0};function SN(s,i,l,c,m,g,w,A){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Sf(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Sf(0),this.hiddenUpdates=Sf(null),this.identifierPrefix=c,this.onUncaughtError=m,this.onCaughtError=g,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=A,this.incompleteTransitions=new Map}function K0(s,i,l,c,m,g,w,A,C,L,F,J){return s=new SN(s,i,l,w,A,C,L,J),i=1,g===!0&&(i|=24),g=yn(3,null,null,i),s.current=g,g.stateNode=s,i=oh(),i.refCount++,s.pooledCache=i,i.refCount++,g.memoizedState={element:c,isDehydrated:l,cache:i},dh(g),s}function Y0(s){return s?(s=Ls,s):Ls}function X0(s,i,l,c,m,g){m=Y0(m),c.context===null?c.context=m:c.pendingContext=m,c=ia(i),c.payload={element:l},g=g===void 0?null:g,g!==null&&(c.callback=g),l=oa(s,c,i),l!==null&&(Sn(l,s,i),mo(l,s,i))}function Q0(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function Tm(s,i){Q0(s,i),(s=s.alternate)&&Q0(s,i)}function W0(s){if(s.tag===13){var i=Ms(s,67108864);i!==null&&Sn(i,s,67108864),Tm(s,67108864)}}var dc=!0;function xN(s,i,l,c){var m=P.T;P.T=null;var g=H.p;try{H.p=2,Rm(s,i,l,c)}finally{H.p=g,P.T=m}}function EN(s,i,l,c){var m=P.T;P.T=null;var g=H.p;try{H.p=8,Rm(s,i,l,c)}finally{H.p=g,P.T=m}}function Rm(s,i,l,c){if(dc){var m=Nm(c);if(m===null)pm(s,i,c,fc,l),tw(s,c);else if(ON(m,s,i,l,c))c.stopPropagation();else if(tw(s,c),i&4&&-1<AN.indexOf(s)){for(;m!==null;){var g=Es(m);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var w=Ha(g.pendingLanes);if(w!==0){var A=g;for(A.pendingLanes|=2,A.entangledLanes|=2;w;){var C=1<<31-pn(w);A.entanglements[1]|=C,w&=~C}yr(g),(Ve&6)===0&&(Ku=fr()+500,ko(0))}}break;case 13:A=Ms(g,2),A!==null&&Sn(A,g,2),Xu(),Tm(g,2)}if(g=Nm(c),g===null&&pm(s,i,c,fc,l),g===m)break;m=g}m!==null&&c.stopPropagation()}else pm(s,i,c,null,l)}}function Nm(s){return s=If(s),Cm(s)}var fc=null;function Cm(s){if(fc=null,s=xs(s),s!==null){var i=o(s);if(i===null)s=null;else{var l=i.tag;if(l===13){if(s=u(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return fc=s,null}function ew(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(cT()){case m_:return 2;case p_:return 8;case au:case dT:return 32;case g_:return 268435456;default:return 32}default:return 32}}var km=!1,va=null,wa=null,Sa=null,Uo=new Map,zo=new Map,xa=[],AN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function tw(s,i){switch(s){case"focusin":case"focusout":va=null;break;case"dragenter":case"dragleave":wa=null;break;case"mouseover":case"mouseout":Sa=null;break;case"pointerover":case"pointerout":Uo.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":zo.delete(i.pointerId)}}function Bo(s,i,l,c,m,g){return s===null||s.nativeEvent!==g?(s={blockedOn:i,domEventName:l,eventSystemFlags:c,nativeEvent:g,targetContainers:[m]},i!==null&&(i=Es(i),i!==null&&W0(i)),s):(s.eventSystemFlags|=c,i=s.targetContainers,m!==null&&i.indexOf(m)===-1&&i.push(m),s)}function ON(s,i,l,c,m){switch(i){case"focusin":return va=Bo(va,s,i,l,c,m),!0;case"dragenter":return wa=Bo(wa,s,i,l,c,m),!0;case"mouseover":return Sa=Bo(Sa,s,i,l,c,m),!0;case"pointerover":var g=m.pointerId;return Uo.set(g,Bo(Uo.get(g)||null,s,i,l,c,m)),!0;case"gotpointercapture":return g=m.pointerId,zo.set(g,Bo(zo.get(g)||null,s,i,l,c,m)),!0}return!1}function nw(s){var i=xs(s.target);if(i!==null){var l=o(i);if(l!==null){if(i=l.tag,i===13){if(i=u(l),i!==null){s.blockedOn=i,bT(s.priority,function(){if(l.tag===13){var c=wn();c=xf(c);var m=Ms(l,c);m!==null&&Sn(m,l,c),Tm(l,c)}});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function hc(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=Nm(s.nativeEvent);if(l===null){l=s.nativeEvent;var c=new l.constructor(l.type,l);$f=c,l.target.dispatchEvent(c),$f=null}else return i=Es(l),i!==null&&W0(i),s.blockedOn=l,!1;i.shift()}return!0}function rw(s,i,l){hc(s)&&l.delete(i)}function TN(){km=!1,va!==null&&hc(va)&&(va=null),wa!==null&&hc(wa)&&(wa=null),Sa!==null&&hc(Sa)&&(Sa=null),Uo.forEach(rw),zo.forEach(rw)}function mc(s,i){s.blockedOn===i&&(s.blockedOn=null,km||(km=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,TN)))}var pc=null;function aw(s){pc!==s&&(pc=s,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){pc===s&&(pc=null);for(var i=0;i<s.length;i+=3){var l=s[i],c=s[i+1],m=s[i+2];if(typeof c!="function"){if(Cm(c||l)===null)continue;break}var g=Es(l);g!==null&&(s.splice(i,3),i-=3,Ch(g,{pending:!0,data:m,method:l.method,action:c},c,m))}}))}function qo(s){function i(C){return mc(C,s)}va!==null&&mc(va,s),wa!==null&&mc(wa,s),Sa!==null&&mc(Sa,s),Uo.forEach(i),zo.forEach(i);for(var l=0;l<xa.length;l++){var c=xa[l];c.blockedOn===s&&(c.blockedOn=null)}for(;0<xa.length&&(l=xa[0],l.blockedOn===null);)nw(l),l.blockedOn===null&&xa.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var m=l[c],g=l[c+1],w=m[nn]||null;if(typeof g=="function")w||aw(l);else if(w){var A=null;if(g&&g.hasAttribute("formAction")){if(m=g,w=g[nn]||null)A=w.formAction;else if(Cm(m)!==null)continue}else A=w.action;typeof A=="function"?l[c+1]=A:(l.splice(c,3),c-=3),aw(l)}}}function jm(s){this._internalRoot=s}gc.prototype.render=jm.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(n(409));var l=i.current,c=wn();X0(l,c,s,i,null,null)},gc.prototype.unmount=jm.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;X0(s.current,2,null,s,null,null),Xu(),i[Ss]=null}};function gc(s){this._internalRoot=s}gc.prototype.unstable_scheduleHydration=function(s){if(s){var i=w_();s={blockedOn:null,target:s,priority:i};for(var l=0;l<xa.length&&i!==0&&i<xa[l].priority;l++);xa.splice(l,0,s),l===0&&nw(s)}};var sw=e.version;if(sw!=="19.1.0")throw Error(n(527,sw,"19.1.0"));H.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=f(i),s=s!==null?h(s):null,s=s===null?null:s.stateNode,s};var RN={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yc.isDisabled&&yc.supportsFiber)try{Fi=yc.inject(RN),mn=yc}catch{}}return Go.createRoot=function(s,i){if(!a(s))throw Error(n(299));var l=!1,c="",m=wv,g=Sv,w=xv,A=null;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(m=i.onUncaughtError),i.onCaughtError!==void 0&&(g=i.onCaughtError),i.onRecoverableError!==void 0&&(w=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(A=i.unstable_transitionCallbacks)),i=K0(s,1,!1,null,null,l,c,m,g,w,A,null),s[Ss]=i.current,mm(s),new jm(i)},Go.hydrateRoot=function(s,i,l){if(!a(s))throw Error(n(299));var c=!1,m="",g=wv,w=Sv,A=xv,C=null,L=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(g=l.onUncaughtError),l.onCaughtError!==void 0&&(w=l.onCaughtError),l.onRecoverableError!==void 0&&(A=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(C=l.unstable_transitionCallbacks),l.formState!==void 0&&(L=l.formState)),i=K0(s,1,!0,i,l??null,c,m,g,w,A,C,L),i.context=Y0(null),l=i.current,c=wn(),c=xf(c),m=ia(c),m.callback=null,oa(l,m,c),l=c,i.current.lanes=l,Vi(i,l),yr(i),s[Ss]=i.current,mm(s),new gc(i)},Go.version="19.1.0",Go}var pw;function BN(){if(pw)return Pm.exports;pw=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Pm.exports=zN(),Pm.exports}var qN=BN();const HN=vs(qN);var Be;(function(r){r.assertEqual=a=>{};function e(a){}r.assertIs=e;function t(a){throw new Error}r.assertNever=t,r.arrayToEnum=a=>{const o={};for(const u of a)o[u]=u;return o},r.getValidEnumValues=a=>{const o=r.objectKeys(a).filter(d=>typeof a[a[d]]!="number"),u={};for(const d of o)u[d]=a[d];return r.objectValues(u)},r.objectValues=a=>r.objectKeys(a).map(function(o){return a[o]}),r.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const o=[];for(const u in a)Object.prototype.hasOwnProperty.call(a,u)&&o.push(u);return o},r.find=(a,o)=>{for(const u of a)if(o(u))return u},r.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,o=" | "){return a.map(u=>typeof u=="string"?`'${u}'`:u).join(o)}r.joinValues=n,r.jsonStringifyReplacer=(a,o)=>typeof o=="bigint"?o.toString():o})(Be||(Be={}));var gw;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(gw||(gw={}));const ue=Be.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ka=r=>{switch(typeof r){case"undefined":return ue.undefined;case"string":return ue.string;case"number":return Number.isNaN(r)?ue.nan:ue.number;case"boolean":return ue.boolean;case"function":return ue.function;case"bigint":return ue.bigint;case"symbol":return ue.symbol;case"object":return Array.isArray(r)?ue.array:r===null?ue.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?ue.promise:typeof Map<"u"&&r instanceof Map?ue.map:typeof Set<"u"&&r instanceof Set?ue.set:typeof Date<"u"&&r instanceof Date?ue.date:ue.object;default:return ue.unknown}},te=Be.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ar extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(o){return o.message},n={_errors:[]},a=o=>{for(const u of o.issues)if(u.code==="invalid_union")u.unionErrors.map(a);else if(u.code==="invalid_return_type")a(u.returnTypeError);else if(u.code==="invalid_arguments")a(u.argumentsError);else if(u.path.length===0)n._errors.push(t(u));else{let d=n,f=0;for(;f<u.path.length;){const h=u.path[f];f===u.path.length-1?(d[h]=d[h]||{_errors:[]},d[h]._errors.push(t(u))):d[h]=d[h]||{_errors:[]},d=d[h],f++}}};return a(this),n}static assert(e){if(!(e instanceof Ar))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Be.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const a of this.issues)if(a.path.length>0){const o=a.path[0];t[o]=t[o]||[],t[o].push(e(a))}else n.push(e(a));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Ar.create=r=>new Ar(r);const Ag=(r,e)=>{let t;switch(r.code){case te.invalid_type:r.received===ue.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case te.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,Be.jsonStringifyReplacer)}`;break;case te.unrecognized_keys:t=`Unrecognized key(s) in object: ${Be.joinValues(r.keys,", ")}`;break;case te.invalid_union:t="Invalid input";break;case te.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Be.joinValues(r.options)}`;break;case te.invalid_enum_value:t=`Invalid enum value. Expected ${Be.joinValues(r.options)}, received '${r.received}'`;break;case te.invalid_arguments:t="Invalid function arguments";break;case te.invalid_return_type:t="Invalid function return type";break;case te.invalid_date:t="Invalid date";break;case te.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:Be.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case te.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case te.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case te.custom:t="Invalid input";break;case te.invalid_intersection_types:t="Intersection results could not be merged";break;case te.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case te.not_finite:t="Number must be finite";break;default:t=e.defaultError,Be.assertNever(r)}return{message:t}};let GN=Ag;function FN(){return GN}const ZN=r=>{const{data:e,path:t,errorMaps:n,issueData:a}=r,o=[...t,...a.path||[]],u={...a,path:o};if(a.message!==void 0)return{...a,path:o,message:a.message};let d="";const f=n.filter(h=>!!h).slice().reverse();for(const h of f)d=h(u,{data:e,defaultError:d}).message;return{...a,path:o,message:d}};function se(r,e){const t=FN(),n=ZN({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Ag?void 0:Ag].filter(a=>!!a)});r.common.issues.push(n)}class Wt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const a of t){if(a.status==="aborted")return Ee;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const a of t){const o=await a.key,u=await a.value;n.push({key:o,value:u})}return Wt.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const a of t){const{key:o,value:u}=a;if(o.status==="aborted"||u.status==="aborted")return Ee;o.status==="dirty"&&e.dirty(),u.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof u.value<"u"||a.alwaysSet)&&(n[o.value]=u.value)}return{status:e.value,value:n}}}const Ee=Object.freeze({status:"aborted"}),ol=r=>({status:"dirty",value:r}),Vn=r=>({status:"valid",value:r}),yw=r=>r.status==="aborted",_w=r=>r.status==="dirty",Oi=r=>r.status==="valid",gd=r=>typeof Promise<"u"&&r instanceof Promise;var ce;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ce||(ce={}));class Or{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const bw=(r,e)=>{if(Oi(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ar(r.common.issues);return this._error=t,this._error}}};function Ce(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:a}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(u,d)=>{const{message:f}=r;return u.code==="invalid_enum_value"?{message:f??d.defaultError}:typeof d.data>"u"?{message:f??n??d.defaultError}:u.code!=="invalid_type"?{message:d.defaultError}:{message:f??t??d.defaultError}},description:a}}class De{get description(){return this._def.description}_getType(e){return ka(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ka(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Wt,ctx:{common:e.parent.common,data:e.data,parsedType:ka(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(gd(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ka(e)},a=this._parseSync({data:e,path:n.path,parent:n});return bw(n,a)}"~validate"(e){var n,a;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ka(e)};if(!this["~standard"].async)try{const o=this._parseSync({data:e,path:[],parent:t});return Oi(o)?{value:o.value}:{issues:t.common.issues}}catch(o){(a=(n=o==null?void 0:o.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(o=>Oi(o)?{value:o.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ka(e)},a=this._parse({data:e,path:n.path,parent:n}),o=await(gd(a)?a:Promise.resolve(a));return bw(n,o)}refine(e,t){const n=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,o)=>{const u=e(a),d=()=>o.addIssue({code:te.custom,...n(a)});return typeof Promise<"u"&&u instanceof Promise?u.then(f=>f?!0:(d(),!1)):u?!0:(d(),!1)})}refinement(e,t){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof t=="function"?t(n,a):t),!1))}_refinement(e){return new Ni({schema:this,typeName:G.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Pa.create(this,this._def)}nullable(){return Ci.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Er.create(this)}promise(){return wd.create(this,this._def)}or(e){return _d.create([this,e],this._def)}and(e){return bd.create(this,e,this._def)}transform(e){return new Ni({...Ce(this._def),schema:this,typeName:G.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Cg({...Ce(this._def),innerType:this,defaultValue:t,typeName:G.ZodDefault})}brand(){return new pC({typeName:G.ZodBranded,type:this,...Ce(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new kg({...Ce(this._def),innerType:this,catchValue:t,typeName:G.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return by.create(this,e)}readonly(){return jg.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const VN=/^c[^\s-]{8,}$/i,JN=/^[0-9a-z]+$/,KN=/^[0-9A-HJKMNP-TV-Z]{26}$/i,YN=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,XN=/^[a-z0-9_-]{21}$/i,QN=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,WN=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,eC=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tC="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Um;const nC=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,rC=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aC=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sC=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,iC=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,oC=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,QE="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",lC=new RegExp(`^${QE}$`);function WE(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function uC(r){return new RegExp(`^${WE(r)}$`)}function cC(r){let e=`${QE}T${WE(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function dC(r,e){return!!((e==="v4"||!e)&&nC.test(r)||(e==="v6"||!e)&&aC.test(r))}function fC(r,e){if(!QN.test(r))return!1;try{const[t]=r.split(".");if(!t)return!1;const n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function hC(r,e){return!!((e==="v4"||!e)&&rC.test(r)||(e==="v6"||!e)&&sC.test(r))}class Yr extends De{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ue.string){const o=this._getOrReturnCtx(e);return se(o,{code:te.invalid_type,expected:ue.string,received:o.parsedType}),Ee}const n=new Wt;let a;for(const o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(a=this._getOrReturnCtx(e,a),se(a,{code:te.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")e.data.length>o.value&&(a=this._getOrReturnCtx(e,a),se(a,{code:te.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){const u=e.data.length>o.value,d=e.data.length<o.value;(u||d)&&(a=this._getOrReturnCtx(e,a),u?se(a,{code:te.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):d&&se(a,{code:te.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")eC.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"email",code:te.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")Um||(Um=new RegExp(tC,"u")),Um.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"emoji",code:te.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")YN.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"uuid",code:te.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")XN.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"nanoid",code:te.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")VN.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"cuid",code:te.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")JN.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"cuid2",code:te.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")KN.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"ulid",code:te.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),se(a,{validation:"url",code:te.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"regex",code:te.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(a=this._getOrReturnCtx(e,a),se(a,{code:te.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(a=this._getOrReturnCtx(e,a),se(a,{code:te.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(a=this._getOrReturnCtx(e,a),se(a,{code:te.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?cC(o).test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{code:te.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?lC.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{code:te.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?uC(o).test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{code:te.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?WN.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"duration",code:te.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?dC(e.data,o.version)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"ip",code:te.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?fC(e.data,o.alg)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"jwt",code:te.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?hC(e.data,o.version)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"cidr",code:te.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?iC.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"base64",code:te.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?oC.test(e.data)||(a=this._getOrReturnCtx(e,a),se(a,{validation:"base64url",code:te.invalid_string,message:o.message}),n.dirty()):Be.assertNever(o);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(a=>e.test(a),{validation:t,code:te.invalid_string,...ce.errToObj(n)})}_addCheck(e){return new Yr({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ce.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ce.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ce.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ce.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ce.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ce.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ce.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ce.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ce.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ce.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ce.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ce.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ce.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...ce.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ce.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ce.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ce.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...ce.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ce.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ce.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ce.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ce.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ce.errToObj(t)})}nonempty(e){return this.min(1,ce.errToObj(e))}trim(){return new Yr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Yr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Yr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Yr.create=r=>new Yr({checks:[],typeName:G.ZodString,coerce:(r==null?void 0:r.coerce)??!1,...Ce(r)});function mC(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=t>n?t:n,o=Number.parseInt(r.toFixed(a).replace(".","")),u=Number.parseInt(e.toFixed(a).replace(".",""));return o%u/10**a}class Ti extends De{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ue.number){const o=this._getOrReturnCtx(e);return se(o,{code:te.invalid_type,expected:ue.number,received:o.parsedType}),Ee}let n;const a=new Wt;for(const o of this._def.checks)o.kind==="int"?Be.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),se(n,{code:te.invalid_type,expected:"integer",received:"float",message:o.message}),a.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),se(n,{code:te.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),a.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),se(n,{code:te.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),a.dirty()):o.kind==="multipleOf"?mC(e.data,o.value)!==0&&(n=this._getOrReturnCtx(e,n),se(n,{code:te.not_multiple_of,multipleOf:o.value,message:o.message}),a.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),se(n,{code:te.not_finite,message:o.message}),a.dirty()):Be.assertNever(o);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ce.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ce.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ce.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ce.toString(t))}setLimit(e,t,n,a){return new Ti({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:ce.toString(a)}]})}_addCheck(e){return new Ti({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ce.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ce.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ce.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ce.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ce.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ce.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ce.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ce.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ce.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Be.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ti.create=r=>new Ti({checks:[],typeName:G.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...Ce(r)});class kl extends De{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ue.bigint)return this._getInvalidInput(e);let n;const a=new Wt;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),se(n,{code:te.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),a.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),se(n,{code:te.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),a.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),se(n,{code:te.not_multiple_of,multipleOf:o.value,message:o.message}),a.dirty()):Be.assertNever(o);return{status:a.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return se(t,{code:te.invalid_type,expected:ue.bigint,received:t.parsedType}),Ee}gte(e,t){return this.setLimit("min",e,!0,ce.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ce.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ce.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ce.toString(t))}setLimit(e,t,n,a){return new kl({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:ce.toString(a)}]})}_addCheck(e){return new kl({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ce.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ce.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ce.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ce.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ce.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}kl.create=r=>new kl({checks:[],typeName:G.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,...Ce(r)});class Og extends De{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ue.boolean){const n=this._getOrReturnCtx(e);return se(n,{code:te.invalid_type,expected:ue.boolean,received:n.parsedType}),Ee}return Vn(e.data)}}Og.create=r=>new Og({typeName:G.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...Ce(r)});class yd extends De{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ue.date){const o=this._getOrReturnCtx(e);return se(o,{code:te.invalid_type,expected:ue.date,received:o.parsedType}),Ee}if(Number.isNaN(e.data.getTime())){const o=this._getOrReturnCtx(e);return se(o,{code:te.invalid_date}),Ee}const n=new Wt;let a;for(const o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(a=this._getOrReturnCtx(e,a),se(a,{code:te.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(a=this._getOrReturnCtx(e,a),se(a,{code:te.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):Be.assertNever(o);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new yd({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ce.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ce.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}yd.create=r=>new yd({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:G.ZodDate,...Ce(r)});class vw extends De{_parse(e){if(this._getType(e)!==ue.symbol){const n=this._getOrReturnCtx(e);return se(n,{code:te.invalid_type,expected:ue.symbol,received:n.parsedType}),Ee}return Vn(e.data)}}vw.create=r=>new vw({typeName:G.ZodSymbol,...Ce(r)});class ww extends De{_parse(e){if(this._getType(e)!==ue.undefined){const n=this._getOrReturnCtx(e);return se(n,{code:te.invalid_type,expected:ue.undefined,received:n.parsedType}),Ee}return Vn(e.data)}}ww.create=r=>new ww({typeName:G.ZodUndefined,...Ce(r)});class Sw extends De{_parse(e){if(this._getType(e)!==ue.null){const n=this._getOrReturnCtx(e);return se(n,{code:te.invalid_type,expected:ue.null,received:n.parsedType}),Ee}return Vn(e.data)}}Sw.create=r=>new Sw({typeName:G.ZodNull,...Ce(r)});class Tg extends De{constructor(){super(...arguments),this._any=!0}_parse(e){return Vn(e.data)}}Tg.create=r=>new Tg({typeName:G.ZodAny,...Ce(r)});class xw extends De{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Vn(e.data)}}xw.create=r=>new xw({typeName:G.ZodUnknown,...Ce(r)});class La extends De{_parse(e){const t=this._getOrReturnCtx(e);return se(t,{code:te.invalid_type,expected:ue.never,received:t.parsedType}),Ee}}La.create=r=>new La({typeName:G.ZodNever,...Ce(r)});class Ew extends De{_parse(e){if(this._getType(e)!==ue.undefined){const n=this._getOrReturnCtx(e);return se(n,{code:te.invalid_type,expected:ue.void,received:n.parsedType}),Ee}return Vn(e.data)}}Ew.create=r=>new Ew({typeName:G.ZodVoid,...Ce(r)});class Er extends De{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==ue.array)return se(t,{code:te.invalid_type,expected:ue.array,received:t.parsedType}),Ee;if(a.exactLength!==null){const u=t.data.length>a.exactLength.value,d=t.data.length<a.exactLength.value;(u||d)&&(se(t,{code:u?te.too_big:te.too_small,minimum:d?a.exactLength.value:void 0,maximum:u?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(se(t,{code:te.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(se(t,{code:te.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((u,d)=>a.type._parseAsync(new Or(t,u,t.path,d)))).then(u=>Wt.mergeArray(n,u));const o=[...t.data].map((u,d)=>a.type._parseSync(new Or(t,u,t.path,d)));return Wt.mergeArray(n,o)}get element(){return this._def.type}min(e,t){return new Er({...this._def,minLength:{value:e,message:ce.toString(t)}})}max(e,t){return new Er({...this._def,maxLength:{value:e,message:ce.toString(t)}})}length(e,t){return new Er({...this._def,exactLength:{value:e,message:ce.toString(t)}})}nonempty(e){return this.min(1,e)}}Er.create=(r,e)=>new Er({type:r,minLength:null,maxLength:null,exactLength:null,typeName:G.ZodArray,...Ce(e)});function mi(r){if(r instanceof ht){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=Pa.create(mi(n))}return new ht({...r._def,shape:()=>e})}else return r instanceof Er?new Er({...r._def,type:mi(r.element)}):r instanceof Pa?Pa.create(mi(r.unwrap())):r instanceof Ci?Ci.create(mi(r.unwrap())):r instanceof ps?ps.create(r.items.map(e=>mi(e))):r}class ht extends De{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Be.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==ue.object){const h=this._getOrReturnCtx(e);return se(h,{code:te.invalid_type,expected:ue.object,received:h.parsedType}),Ee}const{status:n,ctx:a}=this._processInputParams(e),{shape:o,keys:u}=this._getCached(),d=[];if(!(this._def.catchall instanceof La&&this._def.unknownKeys==="strip"))for(const h in a.data)u.includes(h)||d.push(h);const f=[];for(const h of u){const p=o[h],y=a.data[h];f.push({key:{status:"valid",value:h},value:p._parse(new Or(a,y,a.path,h)),alwaysSet:h in a.data})}if(this._def.catchall instanceof La){const h=this._def.unknownKeys;if(h==="passthrough")for(const p of d)f.push({key:{status:"valid",value:p},value:{status:"valid",value:a.data[p]}});else if(h==="strict")d.length>0&&(se(a,{code:te.unrecognized_keys,keys:d}),n.dirty());else if(h!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const h=this._def.catchall;for(const p of d){const y=a.data[p];f.push({key:{status:"valid",value:p},value:h._parse(new Or(a,y,a.path,p)),alwaysSet:p in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const h=[];for(const p of f){const y=await p.key,_=await p.value;h.push({key:y,value:_,alwaysSet:p.alwaysSet})}return h}).then(h=>Wt.mergeObjectSync(n,h)):Wt.mergeObjectSync(n,f)}get shape(){return this._def.shape()}strict(e){return ce.errToObj,new ht({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var o,u;const a=((u=(o=this._def).errorMap)==null?void 0:u.call(o,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:ce.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new ht({...this._def,unknownKeys:"strip"})}passthrough(){return new ht({...this._def,unknownKeys:"passthrough"})}extend(e){return new ht({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ht({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:G.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ht({...this._def,catchall:e})}pick(e){const t={};for(const n of Be.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new ht({...this._def,shape:()=>t})}omit(e){const t={};for(const n of Be.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new ht({...this._def,shape:()=>t})}deepPartial(){return mi(this)}partial(e){const t={};for(const n of Be.objectKeys(this.shape)){const a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional()}return new ht({...this._def,shape:()=>t})}required(e){const t={};for(const n of Be.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof Pa;)o=o._def.innerType;t[n]=o}return new ht({...this._def,shape:()=>t})}keyof(){return eA(Be.objectKeys(this.shape))}}ht.create=(r,e)=>new ht({shape:()=>r,unknownKeys:"strip",catchall:La.create(),typeName:G.ZodObject,...Ce(e)});ht.strictCreate=(r,e)=>new ht({shape:()=>r,unknownKeys:"strict",catchall:La.create(),typeName:G.ZodObject,...Ce(e)});ht.lazycreate=(r,e)=>new ht({shape:r,unknownKeys:"strip",catchall:La.create(),typeName:G.ZodObject,...Ce(e)});class _d extends De{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function a(o){for(const d of o)if(d.result.status==="valid")return d.result;for(const d of o)if(d.result.status==="dirty")return t.common.issues.push(...d.ctx.common.issues),d.result;const u=o.map(d=>new Ar(d.ctx.common.issues));return se(t,{code:te.invalid_union,unionErrors:u}),Ee}if(t.common.async)return Promise.all(n.map(async o=>{const u={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:u}),ctx:u}})).then(a);{let o;const u=[];for(const f of n){const h={...t,common:{...t.common,issues:[]},parent:null},p=f._parseSync({data:t.data,path:t.path,parent:h});if(p.status==="valid")return p;p.status==="dirty"&&!o&&(o={result:p,ctx:h}),h.common.issues.length&&u.push(h.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;const d=u.map(f=>new Ar(f));return se(t,{code:te.invalid_union,unionErrors:d}),Ee}}get options(){return this._def.options}}_d.create=(r,e)=>new _d({options:r,typeName:G.ZodUnion,...Ce(e)});function Rg(r,e){const t=ka(r),n=ka(e);if(r===e)return{valid:!0,data:r};if(t===ue.object&&n===ue.object){const a=Be.objectKeys(e),o=Be.objectKeys(r).filter(d=>a.indexOf(d)!==-1),u={...r,...e};for(const d of o){const f=Rg(r[d],e[d]);if(!f.valid)return{valid:!1};u[d]=f.data}return{valid:!0,data:u}}else if(t===ue.array&&n===ue.array){if(r.length!==e.length)return{valid:!1};const a=[];for(let o=0;o<r.length;o++){const u=r[o],d=e[o],f=Rg(u,d);if(!f.valid)return{valid:!1};a.push(f.data)}return{valid:!0,data:a}}else return t===ue.date&&n===ue.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class bd extends De{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=(o,u)=>{if(yw(o)||yw(u))return Ee;const d=Rg(o.value,u.value);return d.valid?((_w(o)||_w(u))&&t.dirty(),{status:t.value,value:d.data}):(se(n,{code:te.invalid_intersection_types}),Ee)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,u])=>a(o,u)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}bd.create=(r,e,t)=>new bd({left:r,right:e,typeName:G.ZodIntersection,...Ce(t)});class ps extends De{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ue.array)return se(n,{code:te.invalid_type,expected:ue.array,received:n.parsedType}),Ee;if(n.data.length<this._def.items.length)return se(n,{code:te.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ee;!this._def.rest&&n.data.length>this._def.items.length&&(se(n,{code:te.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const o=[...n.data].map((u,d)=>{const f=this._def.items[d]||this._def.rest;return f?f._parse(new Or(n,u,n.path,d)):null}).filter(u=>!!u);return n.common.async?Promise.all(o).then(u=>Wt.mergeArray(t,u)):Wt.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new ps({...this._def,rest:e})}}ps.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ps({items:r,typeName:G.ZodTuple,rest:null,...Ce(e)})};class vd extends De{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ue.object)return se(n,{code:te.invalid_type,expected:ue.object,received:n.parsedType}),Ee;const a=[],o=this._def.keyType,u=this._def.valueType;for(const d in n.data)a.push({key:o._parse(new Or(n,d,n.path,d)),value:u._parse(new Or(n,n.data[d],n.path,d)),alwaysSet:d in n.data});return n.common.async?Wt.mergeObjectAsync(t,a):Wt.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof De?new vd({keyType:e,valueType:t,typeName:G.ZodRecord,...Ce(n)}):new vd({keyType:Yr.create(),valueType:e,typeName:G.ZodRecord,...Ce(t)})}}class Aw extends De{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ue.map)return se(n,{code:te.invalid_type,expected:ue.map,received:n.parsedType}),Ee;const a=this._def.keyType,o=this._def.valueType,u=[...n.data.entries()].map(([d,f],h)=>({key:a._parse(new Or(n,d,n.path,[h,"key"])),value:o._parse(new Or(n,f,n.path,[h,"value"]))}));if(n.common.async){const d=new Map;return Promise.resolve().then(async()=>{for(const f of u){const h=await f.key,p=await f.value;if(h.status==="aborted"||p.status==="aborted")return Ee;(h.status==="dirty"||p.status==="dirty")&&t.dirty(),d.set(h.value,p.value)}return{status:t.value,value:d}})}else{const d=new Map;for(const f of u){const h=f.key,p=f.value;if(h.status==="aborted"||p.status==="aborted")return Ee;(h.status==="dirty"||p.status==="dirty")&&t.dirty(),d.set(h.value,p.value)}return{status:t.value,value:d}}}}Aw.create=(r,e,t)=>new Aw({valueType:e,keyType:r,typeName:G.ZodMap,...Ce(t)});class jl extends De{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ue.set)return se(n,{code:te.invalid_type,expected:ue.set,received:n.parsedType}),Ee;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(se(n,{code:te.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(se(n,{code:te.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const o=this._def.valueType;function u(f){const h=new Set;for(const p of f){if(p.status==="aborted")return Ee;p.status==="dirty"&&t.dirty(),h.add(p.value)}return{status:t.value,value:h}}const d=[...n.data.values()].map((f,h)=>o._parse(new Or(n,f,n.path,h)));return n.common.async?Promise.all(d).then(f=>u(f)):u(d)}min(e,t){return new jl({...this._def,minSize:{value:e,message:ce.toString(t)}})}max(e,t){return new jl({...this._def,maxSize:{value:e,message:ce.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}jl.create=(r,e)=>new jl({valueType:r,minSize:null,maxSize:null,typeName:G.ZodSet,...Ce(e)});class Ow extends De{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ow.create=(r,e)=>new Ow({getter:r,typeName:G.ZodLazy,...Ce(e)});class Ng extends De{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return se(t,{received:t.data,code:te.invalid_literal,expected:this._def.value}),Ee}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ng.create=(r,e)=>new Ng({value:r,typeName:G.ZodLiteral,...Ce(e)});function eA(r,e){return new Ri({values:r,typeName:G.ZodEnum,...Ce(e)})}class Ri extends De{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return se(t,{expected:Be.joinValues(n),received:t.parsedType,code:te.invalid_type}),Ee}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return se(t,{received:t.data,code:te.invalid_enum_value,options:n}),Ee}return Vn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ri.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ri.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}Ri.create=eA;class Tw extends De{_parse(e){const t=Be.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==ue.string&&n.parsedType!==ue.number){const a=Be.objectValues(t);return se(n,{expected:Be.joinValues(a),received:n.parsedType,code:te.invalid_type}),Ee}if(this._cache||(this._cache=new Set(Be.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const a=Be.objectValues(t);return se(n,{received:n.data,code:te.invalid_enum_value,options:a}),Ee}return Vn(e.data)}get enum(){return this._def.values}}Tw.create=(r,e)=>new Tw({values:r,typeName:G.ZodNativeEnum,...Ce(e)});class wd extends De{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ue.promise&&t.common.async===!1)return se(t,{code:te.invalid_type,expected:ue.promise,received:t.parsedType}),Ee;const n=t.parsedType===ue.promise?t.data:Promise.resolve(t.data);return Vn(n.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}}wd.create=(r,e)=>new wd({type:r,typeName:G.ZodPromise,...Ce(e)});class Ni extends De{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===G.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,o={addIssue:u=>{se(n,u),u.fatal?t.abort():t.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),a.type==="preprocess"){const u=a.transform(n.data,o);if(n.common.async)return Promise.resolve(u).then(async d=>{if(t.value==="aborted")return Ee;const f=await this._def.schema._parseAsync({data:d,path:n.path,parent:n});return f.status==="aborted"?Ee:f.status==="dirty"||t.value==="dirty"?ol(f.value):f});{if(t.value==="aborted")return Ee;const d=this._def.schema._parseSync({data:u,path:n.path,parent:n});return d.status==="aborted"?Ee:d.status==="dirty"||t.value==="dirty"?ol(d.value):d}}if(a.type==="refinement"){const u=d=>{const f=a.refinement(d,o);if(n.common.async)return Promise.resolve(f);if(f instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return d};if(n.common.async===!1){const d=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return d.status==="aborted"?Ee:(d.status==="dirty"&&t.dirty(),u(d.value),{status:t.value,value:d.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(d=>d.status==="aborted"?Ee:(d.status==="dirty"&&t.dirty(),u(d.value).then(()=>({status:t.value,value:d.value}))))}if(a.type==="transform")if(n.common.async===!1){const u=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Oi(u))return Ee;const d=a.transform(u.value,o);if(d instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:d}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(u=>Oi(u)?Promise.resolve(a.transform(u.value,o)).then(d=>({status:t.value,value:d})):Ee);Be.assertNever(a)}}Ni.create=(r,e,t)=>new Ni({schema:r,typeName:G.ZodEffects,effect:e,...Ce(t)});Ni.createWithPreprocess=(r,e,t)=>new Ni({schema:e,effect:{type:"preprocess",transform:r},typeName:G.ZodEffects,...Ce(t)});class Pa extends De{_parse(e){return this._getType(e)===ue.undefined?Vn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Pa.create=(r,e)=>new Pa({innerType:r,typeName:G.ZodOptional,...Ce(e)});class Ci extends De{_parse(e){return this._getType(e)===ue.null?Vn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ci.create=(r,e)=>new Ci({innerType:r,typeName:G.ZodNullable,...Ce(e)});class Cg extends De{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===ue.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Cg.create=(r,e)=>new Cg({innerType:r,typeName:G.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ce(e)});class kg extends De{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return gd(a)?a.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Ar(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ar(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}kg.create=(r,e)=>new kg({innerType:r,typeName:G.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ce(e)});class Rw extends De{_parse(e){if(this._getType(e)!==ue.nan){const n=this._getOrReturnCtx(e);return se(n,{code:te.invalid_type,expected:ue.nan,received:n.parsedType}),Ee}return{status:"valid",value:e.data}}}Rw.create=r=>new Rw({typeName:G.ZodNaN,...Ce(r)});class pC extends De{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class by extends De{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?Ee:o.status==="dirty"?(t.dirty(),ol(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?Ee:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,t){return new by({in:e,out:t,typeName:G.ZodPipeline})}}class jg extends De{_parse(e){const t=this._def.innerType._parse(e),n=a=>(Oi(a)&&(a.value=Object.freeze(a.value)),a);return gd(t)?t.then(a=>n(a)):n(t)}unwrap(){return this._def.innerType}}jg.create=(r,e)=>new jg({innerType:r,typeName:G.ZodReadonly,...Ce(e)});var G;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(G||(G={}));const xe=Yr.create,$l=Ti.create,$g=Og.create,Il=Tg.create;La.create;const vr=Er.create,jt=ht.create;_d.create;bd.create;ps.create;const vy=vd.create,tA=Ng.create,Pl=Ri.create;wd.create;Pa.create;Ci.create;const gC="modulepreload",yC=function(r){return"/"+r},Nw={},nA=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let u=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));a=u(t.map(h=>{if(h=yC(h),h in Nw)return;Nw[h]=!0;const p=h.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${y}`))return;const _=document.createElement("link");if(_.rel=p?"stylesheet":gC,p||(_.as="script"),_.crossOrigin="",_.href=h,f&&_.setAttribute("nonce",f),document.head.appendChild(_),p)return new Promise((b,v)=>{_.addEventListener("load",b),_.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return a.then(u=>{for(const d of u||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})};function be(r,e,t,n,a){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}function D(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}let rA=function(){const{crypto:r}=globalThis;if(r!=null&&r.randomUUID)return rA=r.randomUUID.bind(r),r.randomUUID();const e=new Uint8Array(1),t=r?()=>r.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function Ig(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}const Pg=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){const e=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(e.stack=r.stack),r.cause&&!e.cause&&(e.cause=r.cause),r.name&&(e.name=r.name),e}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)};class ve extends Error{}let hn=class Mg extends ve{constructor(e,t,n,a){super(`${Mg.makeMessage(e,t,n)}`),this.status=e,this.headers=a,this.requestID=a==null?void 0:a.get("x-request-id"),this.error=t;const o=t;this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(e,t,n){const a=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,n,a){if(!e||!a)return new Zd({message:n,cause:Pg(t)});const o=t==null?void 0:t.error;return e===400?new aA(e,o,n,a):e===401?new sA(e,o,n,a):e===403?new iA(e,o,n,a):e===404?new oA(e,o,n,a):e===409?new lA(e,o,n,a):e===422?new uA(e,o,n,a):e===429?new cA(e,o,n,a):e>=500?new dA(e,o,n,a):new Mg(e,o,n,a)}},Nn=class extends hn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Zd=class extends hn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Vd=class extends Zd{constructor({message:e}={}){super({message:e??"Request timed out."})}},aA=class extends hn{},sA=class extends hn{},iA=class extends hn{},oA=class extends hn{},lA=class extends hn{},uA=class extends hn{},cA=class extends hn{},dA=class extends hn{};class fA extends ve{constructor(){super("Could not parse response content as the length limit was reached")}}class hA extends ve{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class ll extends Error{constructor(e){super(e)}}const _C=/^[a-z][a-z0-9+.-]*:/i,bC=r=>_C.test(r);let cn=r=>(cn=Array.isArray,cn(r)),Cw=cn;function vC(r){return typeof r!="object"?{}:r??{}}function wC(r){if(!r)return!0;for(const e in r)return!1;return!0}function SC(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function zm(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}const xC=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ve(`${r} must be an integer`);if(e<0)throw new ve(`${r} must be a positive integer`);return e},EC=r=>{try{return JSON.parse(r)}catch{return}},Zl=r=>new Promise(e=>setTimeout(e,r)),pi="5.9.0",AC=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function OC(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const TC=()=>{var t;const r=OC();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":jw(Deno.build.os),"X-Stainless-Arch":kw(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":jw(globalThis.process.platform??"unknown"),"X-Stainless-Arch":kw(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=RC();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function RC(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const a=n[1]||0,o=n[2]||0,u=n[3]||0;return{browser:e,version:`${a}.${o}.${u}`}}}return null}const kw=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",jw=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let $w;const NC=()=>$w??($w=TC());function CC(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function mA(...r){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...r)}function pA(r){let e=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return mA({start(){},async pull(t){const{done:n,value:a}=await e.next();n?t.close():t.enqueue(a)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function gA(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function kC(r){var n,a;if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await((a=(n=r[Symbol.asyncIterator]()).return)==null?void 0:a.call(n));return}const e=r.getReader(),t=e.cancel();e.releaseLock(),await t}const jC=({headers:r,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),yA="RFC3986",_A=r=>String(r),Iw={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:_A},$C="RFC1738";let Lg=(r,e)=>(Lg=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Lg(r,e));const _r=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),Bm=1024,IC=(r,e,t,n,a)=>{if(r.length===0)return r;let o=r;if(typeof r=="symbol"?o=Symbol.prototype.toString.call(r):typeof r!="string"&&(o=String(r)),t==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(d){return"%26%23"+parseInt(d.slice(2),16)+"%3B"});let u="";for(let d=0;d<o.length;d+=Bm){const f=o.length>=Bm?o.slice(d,d+Bm):o,h=[];for(let p=0;p<f.length;++p){let y=f.charCodeAt(p);if(y===45||y===46||y===95||y===126||y>=48&&y<=57||y>=65&&y<=90||y>=97&&y<=122||a===$C&&(y===40||y===41)){h[h.length]=f.charAt(p);continue}if(y<128){h[h.length]=_r[y];continue}if(y<2048){h[h.length]=_r[192|y>>6]+_r[128|y&63];continue}if(y<55296||y>=57344){h[h.length]=_r[224|y>>12]+_r[128|y>>6&63]+_r[128|y&63];continue}p+=1,y=65536+((y&1023)<<10|f.charCodeAt(p)&1023),h[h.length]=_r[240|y>>18]+_r[128|y>>12&63]+_r[128|y>>6&63]+_r[128|y&63]}u+=h.join("")}return u};function PC(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Pw(r,e){if(cn(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const bA={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},vA=function(r,e){Array.prototype.push.apply(r,cn(e)?e:[e])};let Mw;const wt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:IC,encodeValuesOnly:!1,format:yA,formatter:_A,indices:!1,serializeDate(r){return(Mw??(Mw=Function.prototype.call.bind(Date.prototype.toISOString)))(r)},skipNulls:!1,strictNullHandling:!1};function MC(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const qm={};function wA(r,e,t,n,a,o,u,d,f,h,p,y,_,b,v,S,x,E){let R=r,T=E,j=0,$=!1;for(;(T=T.get(qm))!==void 0&&!$;){const $e=T.get(r);if(j+=1,typeof $e<"u"){if($e===j)throw new RangeError("Cyclic object value");$=!0}typeof T.get(qm)>"u"&&(j=0)}if(typeof h=="function"?R=h(e,R):R instanceof Date?R=_==null?void 0:_(R):t==="comma"&&cn(R)&&(R=Pw(R,function($e){return $e instanceof Date?_==null?void 0:_($e):$e})),R===null){if(o)return f&&!S?f(e,wt.encoder,x,"key",b):e;R=""}if(MC(R)||PC(R)){if(f){const $e=S?e:f(e,wt.encoder,x,"key",b);return[(v==null?void 0:v($e))+"="+(v==null?void 0:v(f(R,wt.encoder,x,"value",b)))]}return[(v==null?void 0:v(e))+"="+(v==null?void 0:v(String(R)))]}const q=[];if(typeof R>"u")return q;let Z;if(t==="comma"&&cn(R))S&&f&&(R=Pw(R,f)),Z=[{value:R.length>0?R.join(",")||null:void 0}];else if(cn(h))Z=h;else{const $e=Object.keys(R);Z=p?$e.sort(p):$e}const Y=d?String(e).replace(/\./g,"%2E"):String(e),oe=n&&cn(R)&&R.length===1?Y+"[]":Y;if(a&&cn(R)&&R.length===0)return oe+"[]";for(let $e=0;$e<Z.length;++$e){const Se=Z[$e],Ge=typeof Se=="object"&&typeof Se.value<"u"?Se.value:R[Se];if(u&&Ge===null)continue;const At=y&&d?Se.replace(/\./g,"%2E"):Se,re=cn(R)?typeof t=="function"?t(oe,At):oe:oe+(y?"."+At:"["+At+"]");E.set(r,j);const ee=new WeakMap;ee.set(qm,E),vA(q,wA(Ge,re,t,n,a,o,u,d,t==="comma"&&S&&cn(R)?null:f,h,p,y,_,b,v,S,x,ee))}return q}function LC(r=wt){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||wt.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=yA;if(typeof r.format<"u"){if(!Lg(Iw,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=Iw[t];let a=wt.filter;(typeof r.filter=="function"||cn(r.filter))&&(a=r.filter);let o;if(r.arrayFormat&&r.arrayFormat in bA?o=r.arrayFormat:"indices"in r?o=r.indices?"indices":"repeat":o=wt.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const u=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:wt.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:wt.addQueryPrefix,allowDots:u,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:wt.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:wt.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?wt.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:wt.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:wt.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:wt.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:wt.encodeValuesOnly,filter:a,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:wt.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:wt.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:wt.strictNullHandling}}function DC(r,e={}){let t=r;const n=LC(e);let a,o;typeof n.filter=="function"?(o=n.filter,t=o("",t)):cn(n.filter)&&(o=n.filter,a=o);const u=[];if(typeof t!="object"||t===null)return"";const d=bA[n.arrayFormat],f=d==="comma"&&n.commaRoundTrip;a||(a=Object.keys(t)),n.sort&&a.sort(n.sort);const h=new WeakMap;for(let _=0;_<a.length;++_){const b=a[_];n.skipNulls&&t[b]===null||vA(u,wA(t[b],b,d,f,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,h))}const p=u.join(n.delimiter);let y=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),p.length>0?y+p:""}function UC(r){let e=0;for(const a of r)e+=a.length;const t=new Uint8Array(e);let n=0;for(const a of r)t.set(a,n),n+=a.length;return t}let Lw;function wy(r){let e;return(Lw??(e=new globalThis.TextEncoder,Lw=e.encode.bind(e)))(r)}let Dw;function Uw(r){let e;return(Dw??(e=new globalThis.TextDecoder,Dw=e.decode.bind(e)))(r)}var xn,En;let Jd=class{constructor(){xn.set(this,void 0),En.set(this,void 0),be(this,xn,new Uint8Array),be(this,En,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?wy(e):e;be(this,xn,UC([D(this,xn,"f"),t]));const n=[];let a;for(;(a=zC(D(this,xn,"f"),D(this,En,"f")))!=null;){if(a.carriage&&D(this,En,"f")==null){be(this,En,a.index);continue}if(D(this,En,"f")!=null&&(a.index!==D(this,En,"f")+1||a.carriage)){n.push(Uw(D(this,xn,"f").subarray(0,D(this,En,"f")-1))),be(this,xn,D(this,xn,"f").subarray(D(this,En,"f"))),be(this,En,null);continue}const o=D(this,En,"f")!==null?a.preceding-1:a.preceding,u=Uw(D(this,xn,"f").subarray(0,o));n.push(u),be(this,xn,D(this,xn,"f").subarray(a.index)),be(this,En,null)}return n}flush(){return D(this,xn,"f").length?this.decode(`
`):[]}};xn=new WeakMap,En=new WeakMap;Jd.NEWLINE_CHARS=new Set([`
`,"\r"]);Jd.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function zC(r,e){for(let a=e??0;a<r.length;a++){if(r[a]===10)return{preceding:a,index:a+1,carriage:!1};if(r[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function BC(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}const Sd={off:0,error:200,warn:300,info:400,debug:500},zw=(r,e,t)=>{if(r){if(SC(Sd,r))return r;zt(t).warn(`${e} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(Sd))}`)}};function ul(){}function _c(r,e,t){return!e||Sd[r]>Sd[t]?ul:e[r].bind(e)}const qC={error:ul,warn:ul,info:ul,debug:ul};let Bw=new WeakMap;function zt(r){const e=r.logger,t=r.logLevel??"off";if(!e)return qC;const n=Bw.get(e);if(n&&n[0]===t)return n[1];const a={error:_c("error",e,t),warn:_c("warn",e,t),info:_c("info",e,t),debug:_c("debug",e,t)};return Bw.set(e,[t,a]),a}const ls=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r);var Fo;let Ml=class cl{constructor(e,t,n){this.iterator=e,Fo.set(this,void 0),this.controller=t,be(this,Fo,n)}static fromSSEResponse(e,t,n){let a=!1;const o=n?zt(n):console;async function*u(){if(a)throw new ve("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let d=!1;try{for await(const f of HC(e,t))if(!d){if(f.data.startsWith("[DONE]")){d=!0;continue}if(f.event===null||f.event.startsWith("response.")||f.event.startsWith("transcript.")){let h;try{h=JSON.parse(f.data)}catch(p){throw o.error("Could not parse message into JSON:",f.data),o.error("From chunk:",f.raw),p}if(h&&h.error)throw new hn(void 0,h.error,void 0,e.headers);yield h}else{let h;try{h=JSON.parse(f.data)}catch(p){throw console.error("Could not parse message into JSON:",f.data),console.error("From chunk:",f.raw),p}if(f.event=="error")throw new hn(void 0,h.error,h.message,void 0);yield{event:f.event,data:h}}}d=!0}catch(f){if(Ig(f))return;throw f}finally{d||t.abort()}}return new cl(u,t,n)}static fromReadableStream(e,t,n){let a=!1;async function*o(){const d=new Jd,f=gA(e);for await(const h of f)for(const p of d.decode(h))yield p;for(const h of d.flush())yield h}async function*u(){if(a)throw new ve("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let d=!1;try{for await(const f of o())d||f&&(yield JSON.parse(f));d=!0}catch(f){if(Ig(f))return;throw f}finally{d||t.abort()}}return new cl(u,t,n)}[(Fo=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),a=o=>({next:()=>{if(o.length===0){const u=n.next();e.push(u),t.push(u)}return o.shift()}});return[new cl(()=>a(e),this.controller,D(this,Fo,"f")),new cl(()=>a(t),this.controller,D(this,Fo,"f"))]}toReadableStream(){const e=this;let t;return mA({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:a,done:o}=await t.next();if(o)return n.close();const u=wy(JSON.stringify(a)+`
`);n.enqueue(u)}catch(a){n.error(a)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}};async function*HC(r,e){if(!r.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new ve("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new ve("Attempted to iterate over a response with no body");const t=new FC,n=new Jd,a=gA(r.body);for await(const o of GC(a))for(const u of n.decode(o)){const d=t.decode(u);d&&(yield d)}for(const o of n.flush()){const u=t.decode(o);u&&(yield u)}}async function*GC(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?wy(t):t;let a=new Uint8Array(e.length+n.length);a.set(e),a.set(n,e.length),e=a;let o;for(;(o=BC(e))!==-1;)yield e.slice(0,o),e=e.slice(o)}e.length>0&&(yield e)}let FC=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,a]=ZC(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}};function ZC(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}async function SA(r,e){const{response:t,requestLogID:n,retryOfRequestLogID:a,startTime:o}=e,u=await(async()=>{var y;if(e.options.stream)return zt(r).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,r):Ml.fromSSEResponse(t,e.controller,r);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const d=t.headers.get("content-type"),f=(y=d==null?void 0:d.split(";")[0])==null?void 0:y.trim();if((f==null?void 0:f.includes("application/json"))||(f==null?void 0:f.endsWith("+json"))){const _=await t.json();return xA(_,t)}return await t.text()})();return zt(r).debug(`[${n}] response parsed`,ls({retryOfRequestLogID:a,url:t.url,status:t.status,body:u,durationMs:Date.now()-o})),u}function xA(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var dl;let EA=class AA extends Promise{constructor(e,t,n=SA){super(a=>{a(null)}),this.responsePromise=t,this.parseResponse=n,dl.set(this,void 0),be(this,dl,e)}_thenUnwrap(e){return new AA(D(this,dl,"f"),this.responsePromise,async(t,n)=>xA(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(D(this,dl,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};dl=new WeakMap;var bc;let OA=class{constructor(e,t,n,a){bc.set(this,void 0),be(this,bc,e),this.options=a,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new ve("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await D(this,bc,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(bc=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},VC=class extends EA{constructor(e,t,n){super(e,t,async(a,o)=>new n(a,o.response,await SA(a,o),o.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}},Kd=class extends OA{constructor(e,t,n,a){super(e,t,n,a),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}};class pt extends OA{constructor(e,t,n,a){super(e,t,n,a),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var n;const e=this.getPaginatedItems(),t=(n=e[e.length-1])==null?void 0:n.id;return t?{...this.options,query:{...vC(this.options.query),after:t}}:null}}const TA=()=>{var r;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((r=e==null?void 0:e.versions)==null?void 0:r.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Sl(r,e,t){return TA(),new File(r,e??"unknown_file",t)}function ed(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}const RA=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",gs=async(r,e)=>({...r,body:await KC(r.body,e)}),qw=new WeakMap;function JC(r){const e=typeof r=="function"?r:r.fetch,t=qw.get(e);if(t)return t;const n=(async()=>{try{const a="Response"in e?e.Response:(await e("data:,")).constructor,o=new FormData;return o.toString()!==await new a(o).text()}catch{return!0}})();return qw.set(e,n),n}const KC=async(r,e)=>{if(!await JC(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(r||{}).map(([n,a])=>Dg(t,n,a))),t},YC=r=>r instanceof Blob&&"name"in r,Dg=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(t instanceof Response)r.append(e,Sl([await t.blob()],ed(t)));else if(RA(t))r.append(e,Sl([await new Response(pA(t)).blob()],ed(t)));else if(YC(t))r.append(e,t,ed(t));else if(Array.isArray(t))await Promise.all(t.map(n=>Dg(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,a])=>Dg(r,`${e}[${n}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},NA=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",XC=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&NA(r),QC=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function";async function WC(r,e,t){if(TA(),r=await r,XC(r))return r instanceof File?r:Sl([await r.arrayBuffer()],r.name);if(QC(r)){const a=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()),Sl(await Ug(a),e,t)}const n=await Ug(r);if(e||(e=ed(r)),!(t!=null&&t.type)){const a=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof a=="string"&&(t={...t,type:a})}return Sl(n,e,t)}async function Ug(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(NA(r))e.push(r instanceof Blob?r:await r.arrayBuffer());else if(RA(r))for await(const n of r)e.push(...await Ug(n));else{const n=(t=r==null?void 0:r.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof r}${n?`; constructor: ${n}`:""}${ek(r)}`)}return e}function ek(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}let we=class{constructor(e){this._client=e}};function CA(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Hw=Object.freeze(Object.create(null)),tk=(r=CA)=>function(t,...n){if(t.length===1)return t[0];let a=!1;const o=[],u=t.reduce((p,y,_)=>{var S;/[?#]/.test(y)&&(a=!0);const b=n[_];let v=(a?encodeURIComponent:r)(""+b);return _!==n.length&&(b==null||typeof b=="object"&&b.toString===((S=Object.getPrototypeOf(Object.getPrototypeOf(b.hasOwnProperty??Hw)??Hw))==null?void 0:S.toString))&&(v=b+"",o.push({start:p.length+y.length,length:v.length,error:`Value of type ${Object.prototype.toString.call(b).slice(8,-1)} is not a valid path parameter`})),p+y+(_===n.length?"":v)},""),d=u.split(/[?#]/,1)[0],f=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let h;for(;(h=f.exec(d))!==null;)o.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(o.sort((p,y)=>p.start-y.start),o.length>0){let p=0;const y=o.reduce((_,b)=>{const v=" ".repeat(b.start-p),S="^".repeat(b.length);return p=b.start+b.length,_+v+S},"");throw new ve(`Path parameters result in path with invalid segments:
${o.map(_=>_.error).join(`
`)}
${u}
${y}`)}return u},ae=tk(CA);let kA=class extends we{list(e,t={},n){return this._client.getAPIList(ae`/chat/completions/${e}/messages`,pt,{query:t,...n})}};function nk(r){return typeof r.parse=="function"}const xd=r=>(r==null?void 0:r.role)==="assistant",jA=r=>(r==null?void 0:r.role)==="tool";var zg,td,nd,fl,hl,rd,ml,Vr,pl,Ed,Ad,gi,$A;class Sy{constructor(){zg.add(this),this.controller=new AbortController,td.set(this,void 0),nd.set(this,()=>{}),fl.set(this,()=>{}),hl.set(this,void 0),rd.set(this,()=>{}),ml.set(this,()=>{}),Vr.set(this,{}),pl.set(this,!1),Ed.set(this,!1),Ad.set(this,!1),gi.set(this,!1),be(this,td,new Promise((e,t)=>{be(this,nd,e,"f"),be(this,fl,t,"f")})),be(this,hl,new Promise((e,t)=>{be(this,rd,e,"f"),be(this,ml,t,"f")})),D(this,td,"f").catch(()=>{}),D(this,hl,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},D(this,zg,"m",$A).bind(this))},0)}_connected(){this.ended||(D(this,nd,"f").call(this),this._emit("connect"))}get ended(){return D(this,pl,"f")}get errored(){return D(this,Ed,"f")}get aborted(){return D(this,Ad,"f")}abort(){this.controller.abort()}on(e,t){return(D(this,Vr,"f")[e]||(D(this,Vr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=D(this,Vr,"f")[e];if(!n)return this;const a=n.findIndex(o=>o.listener===t);return a>=0&&n.splice(a,1),this}once(e,t){return(D(this,Vr,"f")[e]||(D(this,Vr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{be(this,gi,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){be(this,gi,!0),await D(this,hl,"f")}_emit(e,...t){if(D(this,pl,"f"))return;e==="end"&&(be(this,pl,!0),D(this,rd,"f").call(this));const n=D(this,Vr,"f")[e];if(n&&(D(this,Vr,"f")[e]=n.filter(a=>!a.once),n.forEach(({listener:a})=>a(...t))),e==="abort"){const a=t[0];!D(this,gi,"f")&&!(n!=null&&n.length)&&Promise.reject(a),D(this,fl,"f").call(this,a),D(this,ml,"f").call(this,a),this._emit("end");return}if(e==="error"){const a=t[0];!D(this,gi,"f")&&!(n!=null&&n.length)&&Promise.reject(a),D(this,fl,"f").call(this,a),D(this,ml,"f").call(this,a),this._emit("end")}}_emitFinal(){}}td=new WeakMap,nd=new WeakMap,fl=new WeakMap,hl=new WeakMap,rd=new WeakMap,ml=new WeakMap,Vr=new WeakMap,pl=new WeakMap,Ed=new WeakMap,Ad=new WeakMap,gi=new WeakMap,zg=new WeakSet,$A=function(e){if(be(this,Ed,!0),e instanceof Error&&e.name==="AbortError"&&(e=new Nn),e instanceof Nn)return be(this,Ad,!0),this._emit("abort",e);if(e instanceof ve)return this._emit("error",e);if(e instanceof Error){const t=new ve(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ve(String(e)))};function rk(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function xy(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function Vl(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function ak(r,e){return!e||!IA(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Ey(r,e)}function Ey(r,e){const t=r.choices.map(n=>{var a;if(n.finish_reason==="length")throw new fA;if(n.finish_reason==="content_filter")throw new hA;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((a=n.message.tool_calls)==null?void 0:a.map(o=>ik(e,o)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?sk(e,n.message.content):null}}});return{...r,choices:t}}function sk(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function ik(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(a=>{var o;return((o=a.function)==null?void 0:o.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Vl(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function ok(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(a=>{var o;return((o=a.function)==null?void 0:o.name)===e.function.name});return Vl(t)||(t==null?void 0:t.function.strict)||!1}function IA(r){var e;return xy(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>Vl(t)||t.type==="function"&&t.function.strict===!0))??!1}function lk(r){for(const e of r??[]){if(e.type!=="function")throw new ve(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new ve(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Xt,Bg,Od,qg,Hg,Gg,PA,MA;const uk=10;class LA extends Sy{constructor(){super(...arguments),Xt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),jA(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(xd(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ve("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),D(this,Xt,"m",Bg).call(this)}async finalMessage(){return await this.done(),D(this,Xt,"m",Od).call(this)}async finalFunctionToolCall(){return await this.done(),D(this,Xt,"m",qg).call(this)}async finalFunctionToolCallResult(){return await this.done(),D(this,Xt,"m",Hg).call(this)}async totalUsage(){return await this.done(),D(this,Xt,"m",Gg).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=D(this,Xt,"m",Od).call(this);t&&this._emit("finalMessage",t);const n=D(this,Xt,"m",Bg).call(this);n&&this._emit("finalContent",n);const a=D(this,Xt,"m",qg).call(this);a&&this._emit("finalFunctionToolCall",a);const o=D(this,Xt,"m",Hg).call(this);o!=null&&this._emit("finalFunctionToolCallResult",o),this._chatCompletions.some(u=>u.usage)&&this._emit("totalUsage",D(this,Xt,"m",Gg).call(this))}async _createChatCompletion(e,t,n){const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),D(this,Xt,"m",PA).call(this,t);const o=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ey(o,t))}async _runChatCompletion(e,t,n){for(const a of t.messages)this._addMessage(a,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){var b,v,S;const a="tool",{tool_choice:o="auto",stream:u,...d}=t,f=typeof o!="string"&&((b=o==null?void 0:o.function)==null?void 0:b.name),{maxChatCompletions:h=uk}=n||{},p=t.tools.map(x=>{if(Vl(x)){if(!x.$callback)throw new ve("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:x.$callback,name:x.function.name,description:x.function.description||"",parameters:x.function.parameters,parse:x.$parseRaw,strict:!0}}}return x}),y={};for(const x of p)x.type==="function"&&(y[x.function.name||x.function.function.name]=x.function);const _="tools"in t?p.map(x=>x.type==="function"?{type:"function",function:{name:x.function.name||x.function.function.name,parameters:x.function.parameters,description:x.function.description,strict:x.function.strict}}:x):void 0;for(const x of t.messages)this._addMessage(x,!1);for(let x=0;x<h;++x){const R=(v=(await this._createChatCompletion(e,{...d,tool_choice:o,tools:_,messages:[...this.messages]},n)).choices[0])==null?void 0:v.message;if(!R)throw new ve("missing message in ChatCompletion response");if(!((S=R.tool_calls)!=null&&S.length))return;for(const T of R.tool_calls){if(T.type!=="function")continue;const j=T.id,{name:$,arguments:q}=T.function,Z=y[$];if(Z){if(f&&f!==$){const Se=`Invalid tool_call: ${JSON.stringify($)}. ${JSON.stringify(f)} requested. Please try again`;this._addMessage({role:a,tool_call_id:j,content:Se});continue}}else{const Se=`Invalid tool_call: ${JSON.stringify($)}. Available options are: ${Object.keys(y).map(Ge=>JSON.stringify(Ge)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:j,content:Se});continue}let Y;try{Y=nk(Z)?await Z.parse(q):q}catch(Se){const Ge=Se instanceof Error?Se.message:String(Se);this._addMessage({role:a,tool_call_id:j,content:Ge});continue}const oe=await Z.function(Y,this),$e=D(this,Xt,"m",MA).call(this,oe);if(this._addMessage({role:a,tool_call_id:j,content:$e}),f)return}}}}Xt=new WeakSet,Bg=function(){return D(this,Xt,"m",Od).call(this).content??null},Od=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(xd(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new ve("stream ended without producing a ChatCompletionMessage with role=assistant")},qg=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const a=this.messages[n];if(xd(a)&&((e=a==null?void 0:a.tool_calls)!=null&&e.length))return(t=a.tool_calls.at(-1))==null?void 0:t.function}},Hg=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(jA(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var a;return n.role==="assistant"&&((a=n.tool_calls)==null?void 0:a.some(o=>o.type==="function"&&o.id===t.tool_call_id))}))return t.content}},Gg=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},PA=function(e){if(e.n!=null&&e.n>1)throw new ve("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},MA=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Ay extends LA{static runTools(e,t,n){const a=new Ay,o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,o)),a}_addMessage(e,t=!0){super._addMessage(e,t),xd(e)&&e.content&&this._emit("content",e.content)}}const DA=1,UA=2,zA=4,BA=8,qA=16,HA=32,GA=64,FA=128,ZA=256,VA=FA|ZA,JA=qA|HA|VA|GA,KA=DA|UA|JA,YA=zA|BA,ck=KA|YA,kt={STR:DA,NUM:UA,ARR:zA,OBJ:BA,NULL:qA,BOOL:HA,NAN:GA,INFINITY:FA,MINUS_INFINITY:ZA,INF:VA,SPECIAL:JA,ATOM:KA,COLLECTION:YA,ALL:ck};class dk extends Error{}class fk extends Error{}function hk(r,e=kt.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return mk(r.trim(),e)}const mk=(r,e)=>{const t=r.length;let n=0;const a=_=>{throw new dk(`${_} at position ${n}`)},o=_=>{throw new fk(`${_} at position ${n}`)},u=()=>(y(),n>=t&&a("Unexpected end of input"),r[n]==='"'?d():r[n]==="{"?f():r[n]==="["?h():r.substring(n,n+4)==="null"||kt.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||kt.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||kt.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||kt.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||kt.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||kt.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):p()),d=()=>{const _=n;let b=!1;for(n++;n<t&&(r[n]!=='"'||b&&r[n-1]==="\\");)b=r[n]==="\\"?!b:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(_,++n-Number(b)))}catch(v){o(String(v))}else if(kt.STR&e)try{return JSON.parse(r.substring(_,n-Number(b))+'"')}catch{return JSON.parse(r.substring(_,r.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},f=()=>{n++,y();const _={};try{for(;r[n]!=="}";){if(y(),n>=t&&kt.OBJ&e)return _;const b=d();y(),n++;try{const v=u();Object.defineProperty(_,b,{value:v,writable:!0,enumerable:!0,configurable:!0})}catch(v){if(kt.OBJ&e)return _;throw v}y(),r[n]===","&&n++}}catch{if(kt.OBJ&e)return _;a("Expected '}' at end of object")}return n++,_},h=()=>{n++;const _=[];try{for(;r[n]!=="]";)_.push(u()),y(),r[n]===","&&n++}catch{if(kt.ARR&e)return _;a("Expected ']' at end of array")}return n++,_},p=()=>{if(n===0){r==="-"&&kt.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(r)}catch(b){if(kt.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}o(String(b))}}const _=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(kt.NUM&e)&&a("Unterminated number literal");try{return JSON.parse(r.substring(_,n))}catch{r.substring(_,n)==="-"&&kt.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(r.substring(_,r.lastIndexOf("e")))}catch(v){o(String(v))}}},y=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return u()},Gw=r=>hk(r,kt.ALL^kt.NUM);var bt,Hr,oi,Aa,Hm,vc,Gm,Fm,Zm,wc,Vm,Fw;class Ll extends LA{constructor(e){super(),bt.add(this),Hr.set(this,void 0),oi.set(this,void 0),Aa.set(this,void 0),be(this,Hr,e),be(this,oi,[])}get currentChatCompletionSnapshot(){return D(this,Aa,"f")}static fromReadableStream(e){const t=new Ll(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const a=new Ll(t);return a._run(()=>a._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,t,n){var u;super._createChatCompletion;const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),D(this,bt,"m",Hm).call(this);const o=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const d of o)D(this,bt,"m",Gm).call(this,d);if((u=o.controller.signal)!=null&&u.aborted)throw new Nn;return this._addChatCompletion(D(this,bt,"m",wc).call(this))}async _fromReadableStream(e,t){var u;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),D(this,bt,"m",Hm).call(this),this._connected();const a=Ml.fromReadableStream(e,this.controller);let o;for await(const d of a)o&&o!==d.id&&this._addChatCompletion(D(this,bt,"m",wc).call(this)),D(this,bt,"m",Gm).call(this,d),o=d.id;if((u=a.controller.signal)!=null&&u.aborted)throw new Nn;return this._addChatCompletion(D(this,bt,"m",wc).call(this))}[(Hr=new WeakMap,oi=new WeakMap,Aa=new WeakMap,bt=new WeakSet,Hm=function(){this.ended||be(this,Aa,void 0)},vc=function(t){let n=D(this,oi,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},D(this,oi,"f")[t.index]=n,n)},Gm=function(t){var a,o,u,d,f,h,p,y,_,b,v,S,x,E,R;if(this.ended)return;const n=D(this,bt,"m",Fw).call(this,t);this._emit("chunk",t,n);for(const T of t.choices){const j=n.choices[T.index];T.delta.content!=null&&((a=j.message)==null?void 0:a.role)==="assistant"&&((o=j.message)!=null&&o.content)&&(this._emit("content",T.delta.content,j.message.content),this._emit("content.delta",{delta:T.delta.content,snapshot:j.message.content,parsed:j.message.parsed})),T.delta.refusal!=null&&((u=j.message)==null?void 0:u.role)==="assistant"&&((d=j.message)!=null&&d.refusal)&&this._emit("refusal.delta",{delta:T.delta.refusal,snapshot:j.message.refusal}),((f=T.logprobs)==null?void 0:f.content)!=null&&((h=j.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(p=T.logprobs)==null?void 0:p.content,snapshot:((y=j.logprobs)==null?void 0:y.content)??[]}),((_=T.logprobs)==null?void 0:_.refusal)!=null&&((b=j.message)==null?void 0:b.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(v=T.logprobs)==null?void 0:v.refusal,snapshot:((S=j.logprobs)==null?void 0:S.refusal)??[]});const $=D(this,bt,"m",vc).call(this,j);j.finish_reason&&(D(this,bt,"m",Zm).call(this,j),$.current_tool_call_index!=null&&D(this,bt,"m",Fm).call(this,j,$.current_tool_call_index));for(const q of T.delta.tool_calls??[])$.current_tool_call_index!==q.index&&(D(this,bt,"m",Zm).call(this,j),$.current_tool_call_index!=null&&D(this,bt,"m",Fm).call(this,j,$.current_tool_call_index)),$.current_tool_call_index=q.index;for(const q of T.delta.tool_calls??[]){const Z=(x=j.message.tool_calls)==null?void 0:x[q.index];Z!=null&&Z.type&&((Z==null?void 0:Z.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(E=Z.function)==null?void 0:E.name,index:q.index,arguments:Z.function.arguments,parsed_arguments:Z.function.parsed_arguments,arguments_delta:((R=q.function)==null?void 0:R.arguments)??""}):(Z==null||Z.type,void 0))}}},Fm=function(t,n){var u,d,f;if(D(this,bt,"m",vc).call(this,t).done_tool_calls.has(n))return;const o=(u=t.message.tool_calls)==null?void 0:u[n];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){const h=(f=(d=D(this,Hr,"f"))==null?void 0:d.tools)==null?void 0:f.find(p=>p.type==="function"&&p.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:n,arguments:o.function.arguments,parsed_arguments:Vl(h)?h.$parseRaw(o.function.arguments):h!=null&&h.function.strict?JSON.parse(o.function.arguments):null})}else o.type},Zm=function(t){var a,o;const n=D(this,bt,"m",vc).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const u=D(this,bt,"m",Vm).call(this);this._emit("content.done",{content:t.message.content,parsed:u?u.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(a=t.logprobs)!=null&&a.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(o=t.logprobs)!=null&&o.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},wc=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=D(this,Aa,"f");if(!t)throw new ve("request ended without sending any chunks");return be(this,Aa,void 0),be(this,oi,[]),pk(t,D(this,Hr,"f"))},Vm=function(){var n;const t=(n=D(this,Hr,"f"))==null?void 0:n.response_format;return xy(t)?t:null},Fw=function(t){var n,a,o,u;let d=D(this,Aa,"f");const{choices:f,...h}=t;d?Object.assign(d,h):d=be(this,Aa,{...h,choices:[]});for(const{delta:p,finish_reason:y,index:_,logprobs:b=null,...v}of t.choices){let S=d.choices[_];if(S||(S=d.choices[_]={finish_reason:y,index:_,message:{},logprobs:b,...v}),b)if(!S.logprobs)S.logprobs=Object.assign({},b);else{const{content:q,refusal:Z,...Y}=b;Object.assign(S.logprobs,Y),q&&((n=S.logprobs).content??(n.content=[]),S.logprobs.content.push(...q)),Z&&((a=S.logprobs).refusal??(a.refusal=[]),S.logprobs.refusal.push(...Z))}if(y&&(S.finish_reason=y,D(this,Hr,"f")&&IA(D(this,Hr,"f")))){if(y==="length")throw new fA;if(y==="content_filter")throw new hA}if(Object.assign(S,v),!p)continue;const{content:x,refusal:E,function_call:R,role:T,tool_calls:j,...$}=p;if(Object.assign(S.message,$),E&&(S.message.refusal=(S.message.refusal||"")+E),T&&(S.message.role=T),R&&(S.message.function_call?(R.name&&(S.message.function_call.name=R.name),R.arguments&&((o=S.message.function_call).arguments??(o.arguments=""),S.message.function_call.arguments+=R.arguments)):S.message.function_call=R),x&&(S.message.content=(S.message.content||"")+x,!S.message.refusal&&D(this,bt,"m",Vm).call(this)&&(S.message.parsed=Gw(S.message.content))),j){S.message.tool_calls||(S.message.tool_calls=[]);for(const{index:q,id:Z,type:Y,function:oe,...$e}of j){const Se=(u=S.message.tool_calls)[q]??(u[q]={});Object.assign(Se,$e),Z&&(Se.id=Z),Y&&(Se.type=Y),oe&&(Se.function??(Se.function={name:oe.name??"",arguments:""})),oe!=null&&oe.name&&(Se.function.name=oe.name),oe!=null&&oe.arguments&&(Se.function.arguments+=oe.arguments,ok(D(this,Hr,"f"),Se)&&(Se.function.parsed_arguments=Gw(Se.function.arguments)))}}}return d},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",a=>{const o=t.shift();o?o.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,u)=>t.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ml(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function pk(r,e){const{id:t,choices:n,created:a,model:o,system_fingerprint:u,...d}=r,f={...d,id:t,choices:n.map(({message:h,finish_reason:p,index:y,logprobs:_,...b})=>{if(!p)throw new ve(`missing finish_reason for choice ${y}`);const{content:v=null,function_call:S,tool_calls:x,...E}=h,R=h.role;if(!R)throw new ve(`missing role for choice ${y}`);if(S){const{arguments:T,name:j}=S;if(T==null)throw new ve(`missing function_call.arguments for choice ${y}`);if(!j)throw new ve(`missing function_call.name for choice ${y}`);return{...b,message:{content:v,function_call:{arguments:T,name:j},role:R,refusal:h.refusal??null},finish_reason:p,index:y,logprobs:_}}return x?{...b,index:y,finish_reason:p,logprobs:_,message:{...E,role:R,content:v,refusal:h.refusal??null,tool_calls:x.map((T,j)=>{const{function:$,type:q,id:Z,...Y}=T,{arguments:oe,name:$e,...Se}=$||{};if(Z==null)throw new ve(`missing choices[${y}].tool_calls[${j}].id
${Sc(r)}`);if(q==null)throw new ve(`missing choices[${y}].tool_calls[${j}].type
${Sc(r)}`);if($e==null)throw new ve(`missing choices[${y}].tool_calls[${j}].function.name
${Sc(r)}`);if(oe==null)throw new ve(`missing choices[${y}].tool_calls[${j}].function.arguments
${Sc(r)}`);return{...Y,id:Z,type:q,function:{...Se,name:$e,arguments:oe}}})}}:{...b,message:{...E,content:v,role:R,refusal:h.refusal??null},finish_reason:p,index:y,logprobs:_}}),created:a,model:o,object:"chat.completion",...u?{system_fingerprint:u}:{}};return ak(f,e)}function Sc(r){return JSON.stringify(r)}class Td extends Ll{static fromReadableStream(e){const t=new Td(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const a=new Td(t),o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,o)),a}}let Oy=class extends we{constructor(){super(...arguments),this.messages=new kA(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(ae`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(ae`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",pt,{query:e,...t})}delete(e,t){return this._client.delete(ae`/chat/completions/${e}`,t)}parse(e,t){return lk(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Ey(n,e))}runTools(e,t){return e.stream?Td.runTools(this._client,e,t):Ay.runTools(this._client,e,t)}stream(e,t){return Ll.createChatCompletion(this._client,e,t)}};Oy.Messages=kA;class Ty extends we{constructor(){super(...arguments),this.completions=new Oy(this._client)}}Ty.Completions=Oy;const XA=Symbol("brand.privateNullableHeaders");function*gk(r){if(!r)return;if(XA in r){const{values:n,nulls:a}=r;yield*n.entries();for(const o of a)yield[o,null];return}let e=!1,t;r instanceof Headers?t=r.entries():Cw(r)?t=r:(e=!0,t=Object.entries(r??{}));for(let n of t){const a=n[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");const o=Cw(n[1])?n[1]:[n[1]];let u=!1;for(const d of o)d!==void 0&&(e&&!u&&(u=!0,yield[a,null]),yield[a,d])}}const me=r=>{const e=new Headers,t=new Set;for(const n of r){const a=new Set;for(const[o,u]of gk(n)){const d=o.toLowerCase();a.has(d)||(e.delete(o),a.add(d)),u===null?(e.delete(o),t.add(d)):(e.append(o,u),t.delete(d))}}return{[XA]:!0,values:e,nulls:t}};class QA extends we{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:me([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class WA extends we{create(e,t){return this._client.post("/audio/transcriptions",gs({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class e1 extends we{create(e,t){return this._client.post("/audio/translations",gs({body:e,...t,__metadata:{model:e.model}},this._client))}}class Jl extends we{constructor(){super(...arguments),this.transcriptions=new WA(this._client),this.translations=new e1(this._client),this.speech=new QA(this._client)}}Jl.Transcriptions=WA;Jl.Translations=e1;Jl.Speech=QA;let t1=class extends we{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(ae`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",pt,{query:e,...t})}cancel(e,t){return this._client.post(ae`/batches/${e}/cancel`,t)}};class n1 extends we{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(ae`/assistants/${e}`,{...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(ae`/assistants/${e}`,{body:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},t){return this._client.getAPIList("/assistants",pt,{query:e,...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(ae`/assistants/${e}`,{...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class r1 extends we{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class a1 extends we{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class Yd extends we{constructor(){super(...arguments),this.sessions=new r1(this._client),this.transcriptionSessions=new a1(this._client)}}Yd.Sessions=r1;Yd.TranscriptionSessions=a1;let s1=class extends we{create(e,t,n){return this._client.post(ae`/threads/${e}/messages`,{body:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{thread_id:a}=t;return this._client.get(ae`/threads/${a}/messages/${e}`,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{thread_id:a,...o}=t;return this._client.post(ae`/threads/${a}/messages/${e}`,{body:o,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(ae`/threads/${e}/messages`,pt,{query:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t,n){const{thread_id:a}=t;return this._client.delete(ae`/threads/${a}/messages/${e}`,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}};class i1 extends we{retrieve(e,t,n){const{thread_id:a,run_id:o,...u}=t;return this._client.get(ae`/threads/${a}/runs/${o}/steps/${e}`,{query:u,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t,n){const{thread_id:a,...o}=t;return this._client.getAPIList(ae`/threads/${a}/runs/${e}/steps`,pt,{query:o,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}const yk=r=>{if(typeof Buffer<"u"){const e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(r),t=e.length,n=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=e.charCodeAt(a);return Array.from(new Float32Array(n.buffer))}};var Jm={};const li=r=>{var e,t,n,a;if(typeof globalThis.process<"u")return((e=Jm==null?void 0:Jm[r])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(a=(n=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:a.trim()};var Bt,ds,Fg,br,ad,nr,fs,wi,cs,Rd,Rn,sd,id,xl,gl,yl,Zw,Vw,Jw,Kw,Yw,Xw,Qw;class El extends Sy{constructor(){super(...arguments),Bt.add(this),Fg.set(this,[]),br.set(this,{}),ad.set(this,{}),nr.set(this,void 0),fs.set(this,void 0),wi.set(this,void 0),cs.set(this,void 0),Rd.set(this,void 0),Rn.set(this,void 0),sd.set(this,void 0),id.set(this,void 0),xl.set(this,void 0)}[(Fg=new WeakMap,br=new WeakMap,ad=new WeakMap,nr=new WeakMap,fs=new WeakMap,wi=new WeakMap,cs=new WeakMap,Rd=new WeakMap,Rn=new WeakMap,sd=new WeakMap,id=new WeakMap,xl=new WeakMap,Bt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",a=>{const o=t.shift();o?o.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,u)=>t.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new ds;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var o;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const a=Ml.fromReadableStream(e,this.controller);for await(const u of a)D(this,Bt,"m",gl).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new Nn;return this._addRun(D(this,Bt,"m",yl).call(this))}toReadableStream(){return new Ml(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,a){const o=new ds;return o._run(()=>o._runToolAssistantStream(e,t,n,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(e,t,n,a){var f;const o=a==null?void 0:a.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const u={...n,stream:!0},d=await e.submitToolOutputs(t,u,{...a,signal:this.controller.signal});this._connected();for await(const h of d)D(this,Bt,"m",gl).call(this,h);if((f=d.controller.signal)!=null&&f.aborted)throw new Nn;return this._addRun(D(this,Bt,"m",yl).call(this))}static createThreadAssistantStream(e,t,n){const a=new ds;return a._run(()=>a._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,t,n,a){const o=new ds;return o._run(()=>o._runAssistantStream(e,t,n,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return D(this,sd,"f")}currentRun(){return D(this,id,"f")}currentMessageSnapshot(){return D(this,nr,"f")}currentRunStepSnapshot(){return D(this,xl,"f")}async finalRunSteps(){return await this.done(),Object.values(D(this,br,"f"))}async finalMessages(){return await this.done(),Object.values(D(this,ad,"f"))}async finalRun(){if(await this.done(),!D(this,fs,"f"))throw Error("Final run was not received.");return D(this,fs,"f")}async _createThreadAssistantStream(e,t,n){var d;const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...t,stream:!0},u=await e.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(const f of u)D(this,Bt,"m",gl).call(this,f);if((d=u.controller.signal)!=null&&d.aborted)throw new Nn;return this._addRun(D(this,Bt,"m",yl).call(this))}async _createAssistantStream(e,t,n,a){var f;const o=a==null?void 0:a.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const u={...n,stream:!0},d=await e.create(t,u,{...a,signal:this.controller.signal});this._connected();for await(const h of d)D(this,Bt,"m",gl).call(this,h);if((f=d.controller.signal)!=null&&f.aborted)throw new Nn;return this._addRun(D(this,Bt,"m",yl).call(this))}static accumulateDelta(e,t){for(const[n,a]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=a;continue}let o=e[n];if(o==null){e[n]=a;continue}if(n==="index"||n==="type"){e[n]=a;continue}if(typeof o=="string"&&typeof a=="string")o+=a;else if(typeof o=="number"&&typeof a=="number")o+=a;else if(zm(o)&&zm(a))o=this.accumulateDelta(o,a);else if(Array.isArray(o)&&Array.isArray(a)){if(o.every(u=>typeof u=="string"||typeof u=="number")){o.push(...a);continue}for(const u of a){if(!zm(u))throw new Error(`Expected array delta entry to be an object but got: ${u}`);const d=u.index;if(d==null)throw console.error(u),new Error("Expected array delta entry to have an `index` property");if(typeof d!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${d}`);const f=o[d];f==null?o.push(u):o[d]=this.accumulateDelta(f,u)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${a}, accValue: ${o}`);e[n]=o}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,a){return await this._createAssistantStream(t,e,n,a)}async _runToolAssistantStream(e,t,n,a){return await this._createToolAssistantStream(t,e,n,a)}}ds=El,gl=function(e){if(!this.ended)switch(be(this,sd,e),D(this,Bt,"m",Jw).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":D(this,Bt,"m",Qw).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":D(this,Bt,"m",Vw).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":D(this,Bt,"m",Zw).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},yl=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");if(!D(this,fs,"f"))throw Error("Final run has not been received");return D(this,fs,"f")},Zw=function(e){const[t,n]=D(this,Bt,"m",Yw).call(this,e,D(this,nr,"f"));be(this,nr,t),D(this,ad,"f")[t.id]=t;for(const a of n){const o=t.content[a.index];(o==null?void 0:o.type)=="text"&&this._emit("textCreated",o.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const a of e.data.delta.content){if(a.type=="text"&&a.text){let o=a.text,u=t.content[a.index];if(u&&u.type=="text")this._emit("textDelta",o,u.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(a.index!=D(this,wi,"f")){if(D(this,cs,"f"))switch(D(this,cs,"f").type){case"text":this._emit("textDone",D(this,cs,"f").text,D(this,nr,"f"));break;case"image_file":this._emit("imageFileDone",D(this,cs,"f").image_file,D(this,nr,"f"));break}be(this,wi,a.index)}be(this,cs,t.content[a.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(D(this,wi,"f")!==void 0){const a=e.data.content[D(this,wi,"f")];if(a)switch(a.type){case"image_file":this._emit("imageFileDone",a.image_file,D(this,nr,"f"));break;case"text":this._emit("textDone",a.text,D(this,nr,"f"));break}}D(this,nr,"f")&&this._emit("messageDone",e.data),be(this,nr,void 0)}},Vw=function(e){const t=D(this,Bt,"m",Kw).call(this,e);switch(be(this,xl,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const o of n.step_details.tool_calls)o.index==D(this,Rd,"f")?this._emit("toolCallDelta",o,t.step_details.tool_calls[o.index]):(D(this,Rn,"f")&&this._emit("toolCallDone",D(this,Rn,"f")),be(this,Rd,o.index),be(this,Rn,t.step_details.tool_calls[o.index]),D(this,Rn,"f")&&this._emit("toolCallCreated",D(this,Rn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":be(this,xl,void 0),e.data.step_details.type=="tool_calls"&&D(this,Rn,"f")&&(this._emit("toolCallDone",D(this,Rn,"f")),be(this,Rn,void 0)),this._emit("runStepDone",e.data,t);break}},Jw=function(e){D(this,Fg,"f").push(e),this._emit("event",e)},Kw=function(e){switch(e.event){case"thread.run.step.created":return D(this,br,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=D(this,br,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const a=ds.accumulateDelta(t,n.delta);D(this,br,"f")[e.data.id]=a}return D(this,br,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":D(this,br,"f")[e.data.id]=e.data;break}if(D(this,br,"f")[e.data.id])return D(this,br,"f")[e.data.id];throw new Error("No snapshot available")},Yw=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(const o of a.delta.content)if(o.index in t.content){let u=t.content[o.index];t.content[o.index]=D(this,Bt,"m",Xw).call(this,o,u)}else t.content[o.index]=o,n.push(o);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Xw=function(e,t){return ds.accumulateDelta(t,e)},Qw=function(e){switch(be(this,id,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":be(this,fs,e.data),D(this,Rn,"f")&&(this._emit("toolCallDone",D(this,Rn,"f")),be(this,Rn,void 0));break}};let Ry=class extends we{constructor(){super(...arguments),this.steps=new i1(this._client)}create(e,t,n){const{include:a,...o}=t;return this._client.post(ae`/threads/${e}/runs`,{query:{include:a},body:o,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:a}=t;return this._client.get(ae`/threads/${a}/runs/${e}`,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{thread_id:a,...o}=t;return this._client.post(ae`/threads/${a}/runs/${e}`,{body:o,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(ae`/threads/${e}/runs`,pt,{query:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,t,n){const{thread_id:a}=t;return this._client.post(ae`/threads/${a}/runs/${e}/cancel`,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const a=await this.create(e,t,n);return await this.poll(a.id,{thread_id:e},n)}createAndStream(e,t,n){return El.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){var o;const a=me([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((o=n==null?void 0:n.pollIntervalMs)==null?void 0:o.toString())??void 0}]);for(;;){const{data:u,response:d}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...a}}).withResponse();switch(u.status){case"queued":case"in_progress":case"cancelling":let f=5e3;if(n!=null&&n.pollIntervalMs)f=n.pollIntervalMs;else{const h=d.headers.get("openai-poll-after-ms");if(h){const p=parseInt(h);isNaN(p)||(f=p)}}await Zl(f);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return u}}}stream(e,t,n){return El.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:a,...o}=t;return this._client.post(ae`/threads/${a}/runs/${e}/submit_tool_outputs`,{body:o,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const a=await this.submitToolOutputs(e,t,n);return await this.poll(a.id,t,n)}submitToolOutputsStream(e,t,n){return El.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};Ry.Steps=i1;class Xd extends we{constructor(){super(...arguments),this.runs=new Ry(this._client),this.messages=new s1(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(ae`/threads/${e}`,{...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(ae`/threads/${e}`,{body:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t){return this._client.delete(ae`/threads/${e}`,{...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return El.createThreadAssistantStream(e,this._client.beta.threads,t)}}Xd.Runs=Ry;Xd.Messages=s1;let Kl=class extends we{constructor(){super(...arguments),this.realtime=new Yd(this._client),this.assistants=new n1(this._client),this.threads=new Xd(this._client)}};Kl.Realtime=Yd;Kl.Assistants=n1;Kl.Threads=Xd;let o1=class extends we{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class l1 extends we{retrieve(e,t,n){const{container_id:a}=t;return this._client.get(ae`/containers/${a}/files/${e}/content`,{...n,headers:me([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}}let Ny=class extends we{constructor(){super(...arguments),this.content=new l1(this._client)}create(e,t,n){return this._client.post(ae`/containers/${e}/files`,gs({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:a}=t;return this._client.get(ae`/containers/${a}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(ae`/containers/${e}/files`,pt,{query:t,...n})}delete(e,t,n){const{container_id:a}=t;return this._client.delete(ae`/containers/${a}/files/${e}`,{...n,headers:me([{Accept:"*/*"},n==null?void 0:n.headers])})}};Ny.Content=l1;class Cy extends we{constructor(){super(...arguments),this.files=new Ny(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(ae`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",pt,{query:e,...t})}delete(e,t){return this._client.delete(ae`/containers/${e}`,{...t,headers:me([{Accept:"*/*"},t==null?void 0:t.headers])})}}Cy.Files=Ny;class u1 extends we{create(e,t){const n=!!e.encoding_format;let a=n?e.encoding_format:"base64";n&&zt(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const o=this._client.post("/embeddings",{body:{...e,encoding_format:a},...t});return n?o:(zt(this._client).debug("embeddings/decoding base64 embeddings from base64"),o._thenUnwrap(u=>(u&&u.data&&u.data.forEach(d=>{const f=d.embedding;d.embedding=yk(f)}),u)))}}class c1 extends we{retrieve(e,t,n){const{eval_id:a,run_id:o}=t;return this._client.get(ae`/evals/${a}/runs/${o}/output_items/${e}`,n)}list(e,t,n){const{eval_id:a,...o}=t;return this._client.getAPIList(ae`/evals/${a}/runs/${e}/output_items`,pt,{query:o,...n})}}class ky extends we{constructor(){super(...arguments),this.outputItems=new c1(this._client)}create(e,t,n){return this._client.post(ae`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:a}=t;return this._client.get(ae`/evals/${a}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(ae`/evals/${e}/runs`,pt,{query:t,...n})}delete(e,t,n){const{eval_id:a}=t;return this._client.delete(ae`/evals/${a}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:a}=t;return this._client.post(ae`/evals/${a}/runs/${e}`,n)}}ky.OutputItems=c1;class jy extends we{constructor(){super(...arguments),this.runs=new ky(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(ae`/evals/${e}`,t)}update(e,t,n){return this._client.post(ae`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",pt,{query:e,...t})}delete(e,t){return this._client.delete(ae`/evals/${e}`,t)}}jy.Runs=ky;let d1=class extends we{create(e,t){return this._client.post("/files",gs({body:e,...t},this._client))}retrieve(e,t){return this._client.get(ae`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",pt,{query:e,...t})}delete(e,t){return this._client.delete(ae`/files/${e}`,t)}content(e,t){return this._client.get(ae`/files/${e}/content`,{...t,headers:me([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const a=new Set(["processed","error","deleted"]),o=Date.now();let u=await this.retrieve(e);for(;!u.status||!a.has(u.status);)if(await Zl(t),u=await this.retrieve(e),Date.now()-o>n)throw new Vd({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return u}};class f1 extends we{}let h1=class extends we{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class $y extends we{constructor(){super(...arguments),this.graders=new h1(this._client)}}$y.Graders=h1;class m1 extends we{create(e,t,n){return this._client.getAPIList(ae`/fine_tuning/checkpoints/${e}/permissions`,Kd,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(ae`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:a}=t;return this._client.delete(ae`/fine_tuning/checkpoints/${a}/permissions/${e}`,n)}}let Iy=class extends we{constructor(){super(...arguments),this.permissions=new m1(this._client)}};Iy.Permissions=m1;class p1 extends we{list(e,t={},n){return this._client.getAPIList(ae`/fine_tuning/jobs/${e}/checkpoints`,pt,{query:t,...n})}}class Py extends we{constructor(){super(...arguments),this.checkpoints=new p1(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(ae`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",pt,{query:e,...t})}cancel(e,t){return this._client.post(ae`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(ae`/fine_tuning/jobs/${e}/events`,pt,{query:t,...n})}pause(e,t){return this._client.post(ae`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(ae`/fine_tuning/jobs/${e}/resume`,t)}}Py.Checkpoints=p1;class Pi extends we{constructor(){super(...arguments),this.methods=new f1(this._client),this.jobs=new Py(this._client),this.checkpoints=new Iy(this._client),this.alpha=new $y(this._client)}}Pi.Methods=f1;Pi.Jobs=Py;Pi.Checkpoints=Iy;Pi.Alpha=$y;class g1 extends we{}class My extends we{constructor(){super(...arguments),this.graderModels=new g1(this._client)}}My.GraderModels=g1;class y1 extends we{createVariation(e,t){return this._client.post("/images/variations",gs({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",gs({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let _1=class extends we{retrieve(e,t){return this._client.get(ae`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Kd,e)}delete(e,t){return this._client.delete(ae`/models/${e}`,t)}};class b1 extends we{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function _k(r,e){return!e||!vk(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:v1(r,e)}function v1(r,e){const t=r.output.map(a=>{if(a.type==="function_call")return{...a,parsed_arguments:xk(e,a)};if(a.type==="message"){const o=a.content.map(u=>u.type==="output_text"?{...u,parsed:bk(e,u.text)}:u);return{...a,content:o}}return a}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||Zg(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const a of n.output)if(a.type==="message"){for(const o of a.content)if(o.type==="output_text"&&o.parsed!==null)return o.parsed}return null}}),n}function bk(r,e){var t,n,a,o;return((n=(t=r.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((a=r.text)==null?void 0:a.format)?((o=r.text)==null?void 0:o.format).$parseRaw(e):JSON.parse(e)}function vk(r){var e;return!!xy((e=r.text)==null?void 0:e.format)}function wk(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function Sk(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function xk(r,e){const t=Sk(r.tools??[],e.name);return{...e,...e,parsed_arguments:wk(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Zg(r){const e=[];for(const t of r.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}var ui,xc,Oa,Ec,Ww,eS,tS,nS;class Ly extends Sy{constructor(e){super(),ui.add(this),xc.set(this,void 0),Oa.set(this,void 0),Ec.set(this,void 0),be(this,xc,e)}static createResponse(e,t,n){const a=new Ly(t);return a._run(()=>a._createOrRetrieveResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createOrRetrieveResponse(e,t,n){var d;const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),D(this,ui,"m",Ww).call(this);let o,u=null;"response_id"in t?(o=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),u=t.starting_after??null):o=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const f of o)D(this,ui,"m",eS).call(this,f,u);if((d=o.controller.signal)!=null&&d.aborted)throw new Nn;return D(this,ui,"m",tS).call(this)}[(xc=new WeakMap,Oa=new WeakMap,Ec=new WeakMap,ui=new WeakSet,Ww=function(){this.ended||be(this,Oa,void 0)},eS=function(t,n){if(this.ended)return;const a=(u,d)=>{(n==null||d.sequence_number>n)&&this._emit(u,d)},o=D(this,ui,"m",nS).call(this,t);switch(a("event",t),t.type){case"response.output_text.delta":{const u=o.output[t.output_index];if(!u)throw new ve(`missing output at index ${t.output_index}`);if(u.type==="message"){const d=u.content[t.content_index];if(!d)throw new ve(`missing content at index ${t.content_index}`);if(d.type!=="output_text")throw new ve(`expected content to be 'output_text', got ${d.type}`);a("response.output_text.delta",{...t,snapshot:d.text})}break}case"response.function_call_arguments.delta":{const u=o.output[t.output_index];if(!u)throw new ve(`missing output at index ${t.output_index}`);u.type==="function_call"&&a("response.function_call_arguments.delta",{...t,snapshot:u.arguments});break}default:a(t.type,t);break}},tS=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=D(this,Oa,"f");if(!t)throw new ve("request ended without sending any events");be(this,Oa,void 0);const n=Ek(t,D(this,xc,"f"));return be(this,Ec,n),n},nS=function(t){let n=D(this,Oa,"f");if(!n){if(t.type!=="response.created")throw new ve(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=be(this,Oa,t.response),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const a=n.output[t.output_index];if(!a)throw new ve(`missing output at index ${t.output_index}`);a.type==="message"&&a.content.push(t.part);break}case"response.output_text.delta":{const a=n.output[t.output_index];if(!a)throw new ve(`missing output at index ${t.output_index}`);if(a.type==="message"){const o=a.content[t.content_index];if(!o)throw new ve(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new ve(`expected content to be 'output_text', got ${o.type}`);o.text+=t.delta}break}case"response.function_call_arguments.delta":{const a=n.output[t.output_index];if(!a)throw new ve(`missing output at index ${t.output_index}`);a.type==="function_call"&&(a.arguments+=t.delta);break}case"response.completed":{be(this,Oa,t.response);break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",a=>{const o=t.shift();o?o.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,u)=>t.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=D(this,Ec,"f");if(!e)throw new ve("stream ended without producing a ChatCompletion");return e}}function Ek(r,e){return _k(r,e)}class w1 extends we{list(e,t={},n){return this._client.getAPIList(ae`/responses/${e}/input_items`,pt,{query:t,...n})}}class Dy extends we{constructor(){super(...arguments),this.inputItems=new w1(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Zg(n),n))}retrieve(e,t={},n){return this._client.get(ae`/responses/${e}`,{query:t,...n,stream:(t==null?void 0:t.stream)??!1})._thenUnwrap(a=>("object"in a&&a.object==="response"&&Zg(a),a))}delete(e,t){return this._client.delete(ae`/responses/${e}`,{...t,headers:me([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>v1(n,e))}stream(e,t){return Ly.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(ae`/responses/${e}/cancel`,t)}}Dy.InputItems=w1;class S1 extends we{create(e,t,n){return this._client.post(ae`/uploads/${e}/parts`,gs({body:t,...n},this._client))}}class Uy extends we{constructor(){super(...arguments),this.parts=new S1(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(ae`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(ae`/uploads/${e}/complete`,{body:t,...n})}}Uy.Parts=S1;const Ak=async r=>{const e=await Promise.allSettled(r),t=e.filter(a=>a.status==="rejected");if(t.length){for(const a of t)console.error(a.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const a of e)a.status==="fulfilled"&&n.push(a.value);return n};class x1 extends we{create(e,t,n){return this._client.post(ae`/vector_stores/${e}/file_batches`,{body:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{vector_store_id:a}=t;return this._client.get(ae`/vector_stores/${a}/file_batches/${e}`,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,t,n){const{vector_store_id:a}=t;return this._client.post(ae`/vector_stores/${a}/file_batches/${e}/cancel`,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const a=await this.create(e,t);return await this.poll(e,a.id,n)}listFiles(e,t,n){const{vector_store_id:a,...o}=t;return this._client.getAPIList(ae`/vector_stores/${a}/file_batches/${e}/files`,pt,{query:o,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async poll(e,t,n){var o;const a=me([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((o=n==null?void 0:n.pollIntervalMs)==null?void 0:o.toString())??void 0}]);for(;;){const{data:u,response:d}=await this.retrieve(t,{vector_store_id:e},{...n,headers:a}).withResponse();switch(u.status){case"in_progress":let f=5e3;if(n!=null&&n.pollIntervalMs)f=n.pollIntervalMs;else{const h=d.headers.get("openai-poll-after-ms");if(h){const p=parseInt(h);isNaN(p)||(f=p)}}await Zl(f);break;case"failed":case"cancelled":case"completed":return u}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},a){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=(a==null?void 0:a.maxConcurrency)??5,u=Math.min(o,t.length),d=this._client,f=t.values(),h=[...n];async function p(_){for(let b of _){const v=await d.files.create({file:b,purpose:"assistants"},a);h.push(v.id)}}const y=Array(u).fill(f).map(p);return await Ak(y),await this.createAndPoll(e,{file_ids:h})}}let E1=class extends we{create(e,t,n){return this._client.post(ae`/vector_stores/${e}/files`,{body:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{vector_store_id:a}=t;return this._client.get(ae`/vector_stores/${a}/files/${e}`,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{vector_store_id:a,...o}=t;return this._client.post(ae`/vector_stores/${a}/files/${e}`,{body:o,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(ae`/vector_stores/${e}/files`,pt,{query:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t,n){const{vector_store_id:a}=t;return this._client.delete(ae`/vector_stores/${a}/files/${e}`,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const a=await this.create(e,t,n);return await this.poll(e,a.id,n)}async poll(e,t,n){var o;const a=me([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((o=n==null?void 0:n.pollIntervalMs)==null?void 0:o.toString())??void 0}]);for(;;){const u=await this.retrieve(t,{vector_store_id:e},{...n,headers:a}).withResponse(),d=u.data;switch(d.status){case"in_progress":let f=5e3;if(n!=null&&n.pollIntervalMs)f=n.pollIntervalMs;else{const h=u.response.headers.get("openai-poll-after-ms");if(h){const p=parseInt(h);isNaN(p)||(f=p)}}await Zl(f);break;case"failed":case"completed":return d}}}async upload(e,t,n){const a=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:a.id},n)}async uploadAndPoll(e,t,n){const a=await this.upload(e,t,n);return await this.poll(e,a.id,n)}content(e,t,n){const{vector_store_id:a}=t;return this._client.getAPIList(ae`/vector_stores/${a}/files/${e}/content`,Kd,{...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}};class Qd extends we{constructor(){super(...arguments),this.files=new E1(this._client),this.fileBatches=new x1(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(ae`/vector_stores/${e}`,{...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(ae`/vector_stores/${e}`,{body:t,...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",pt,{query:e,...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(ae`/vector_stores/${e}`,{...t,headers:me([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,n){return this._client.getAPIList(ae`/vector_stores/${e}/search`,Kd,{body:t,method:"post",...n,headers:me([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}Qd.Files=E1;Qd.FileBatches=x1;var yi,A1,od;class O1 extends we{constructor(){super(...arguments),yi.add(this)}async unwrap(e,t,n=this._client.webhookSecret,a=300){return await this.verifySignature(e,t,n,a),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,a=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");D(this,yi,"m",A1).call(this,n);const o=me([t]).values,u=D(this,yi,"m",od).call(this,o,"webhook-signature"),d=D(this,yi,"m",od).call(this,o,"webhook-timestamp"),f=D(this,yi,"m",od).call(this,o,"webhook-id"),h=parseInt(d,10);if(isNaN(h))throw new ll("Invalid webhook timestamp format");const p=Math.floor(Date.now()/1e3);if(p-h>a)throw new ll("Webhook timestamp is too old");if(h>p+a)throw new ll("Webhook timestamp is too new");const y=u.split(" ").map(S=>S.startsWith("v1,")?S.substring(3):S),_=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),b=f?`${f}.${d}.${e}`:`${d}.${e}`,v=await crypto.subtle.importKey("raw",_,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const S of y)try{const x=Buffer.from(S,"base64");if(await crypto.subtle.verify("HMAC",v,x,new TextEncoder().encode(b)))return}catch{continue}throw new ll("The given webhook signature does not match the expected signature")}}yi=new WeakSet,A1=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},od=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(n==null)throw new Error(`Missing required header: ${t}`);return n};var Vg,zy,ld,T1;let Le=class{constructor({baseURL:e=li("OPENAI_BASE_URL"),apiKey:t=li("OPENAI_API_KEY"),organization:n=li("OPENAI_ORG_ID")??null,project:a=li("OPENAI_PROJECT_ID")??null,webhookSecret:o=li("OPENAI_WEBHOOK_SECRET")??null,...u}={}){if(Vg.add(this),ld.set(this,void 0),this.completions=new o1(this),this.chat=new Ty(this),this.embeddings=new u1(this),this.files=new d1(this),this.images=new y1(this),this.audio=new Jl(this),this.moderations=new b1(this),this.models=new _1(this),this.fineTuning=new Pi(this),this.graders=new My(this),this.vectorStores=new Qd(this),this.webhooks=new O1(this),this.beta=new Kl(this),this.batches=new t1(this),this.uploads=new Uy(this),this.responses=new Dy(this),this.evals=new jy(this),this.containers=new Cy(this),t===void 0)throw new ve("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const d={apiKey:t,organization:n,project:a,webhookSecret:o,...u,baseURL:e||"https://api.openai.com/v1"};if(!d.dangerouslyAllowBrowser&&AC())throw new ve(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=d.baseURL,this.timeout=d.timeout??zy.DEFAULT_TIMEOUT,this.logger=d.logger??console;const f="warn";this.logLevel=f,this.logLevel=zw(d.logLevel,"ClientOptions.logLevel",this)??zw(li("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??f,this.fetchOptions=d.fetchOptions,this.maxRetries=d.maxRetries??2,this.fetch=d.fetch??CC(),be(this,ld,jC),this._options=d,this.apiKey=t,this.organization=n,this.project=a,this.webhookSecret=o}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return me([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return DC(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${pi}`}defaultIdempotencyKey(){return`stainless-node-retry-${rA()}`}makeStatusError(e,t,n,a){return hn.generate(e,t,n,a)}buildURL(e,t,n){const a=!D(this,Vg,"m",T1).call(this)&&n||this.baseURL,o=bC(e)?new URL(e):new URL(a+(a.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),u=this.defaultQuery();return wC(u)||(t={...u,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(o.search=this.stringifyQuery(t)),o.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(a=>({method:e,path:t,...a})))}request(e,t=null){return new EA(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var E,R;const a=await e,o=a.maxRetries??this.maxRetries;t==null&&(t=o),await this.prepareOptions(a);const{req:u,url:d,timeout:f}=await this.buildRequest(a,{retryCount:o-t});await this.prepareRequest(u,{url:d,options:a});const h="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),p=n===void 0?"":`, retryOf: ${n}`,y=Date.now();if(zt(this).debug(`[${h}] sending request`,ls({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:u.headers})),(E=a.signal)!=null&&E.aborted)throw new Nn;const _=new AbortController,b=await this.fetchWithTimeout(d,u,f,_).catch(Pg),v=Date.now();if(b instanceof Error){const T=`retrying, ${t} attempts remaining`;if((R=a.signal)!=null&&R.aborted)throw new Nn;const j=Ig(b)||/timed? ?out/i.test(String(b)+("cause"in b?String(b.cause):""));if(t)return zt(this).info(`[${h}] connection ${j?"timed out":"failed"} - ${T}`),zt(this).debug(`[${h}] connection ${j?"timed out":"failed"} (${T})`,ls({retryOfRequestLogID:n,url:d,durationMs:v-y,message:b.message})),this.retryRequest(a,t,n??h);throw zt(this).info(`[${h}] connection ${j?"timed out":"failed"} - error; no more retries left`),zt(this).debug(`[${h}] connection ${j?"timed out":"failed"} (error; no more retries left)`,ls({retryOfRequestLogID:n,url:d,durationMs:v-y,message:b.message})),j?new Vd:new Zd({cause:b})}const S=[...b.headers.entries()].filter(([T])=>T==="x-request-id").map(([T,j])=>", "+T+": "+JSON.stringify(j)).join(""),x=`[${h}${p}${S}] ${u.method} ${d} ${b.ok?"succeeded":"failed"} with status ${b.status} in ${v-y}ms`;if(!b.ok){const T=await this.shouldRetry(b);if(t&&T){const oe=`retrying, ${t} attempts remaining`;return await kC(b.body),zt(this).info(`${x} - ${oe}`),zt(this).debug(`[${h}] response error (${oe})`,ls({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,durationMs:v-y})),this.retryRequest(a,t,n??h,b.headers)}const j=T?"error; no more retries left":"error; not retryable";zt(this).info(`${x} - ${j}`);const $=await b.text().catch(oe=>Pg(oe).message),q=EC($),Z=q?void 0:$;throw zt(this).debug(`[${h}] response error (${j})`,ls({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,message:Z,durationMs:Date.now()-y})),this.makeStatusError(b.status,q,Z,b.headers)}return zt(this).info(x),zt(this).debug(`[${h}] response start`,ls({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,durationMs:v-y})),{response:b,options:a,controller:_,requestLogID:h,retryOfRequestLogID:n,startTime:y}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new VC(this,n,e)}async fetchWithTimeout(e,t,n,a){const{signal:o,method:u,...d}=t||{};o&&o.addEventListener("abort",()=>a.abort());const f=setTimeout(()=>a.abort(),n),h=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,p={signal:a.signal,...h?{duplex:"half"}:{},method:"GET",...d};u&&(p.method=u.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(f)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,a){let o;const u=a==null?void 0:a.get("retry-after-ms");if(u){const f=parseFloat(u);Number.isNaN(f)||(o=f)}const d=a==null?void 0:a.get("retry-after");if(d&&!o){const f=parseFloat(d);Number.isNaN(f)?o=Date.parse(d)-Date.now():o=f*1e3}if(!(o&&0<=o&&o<60*1e3)){const f=e.maxRetries??this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,f)}return await Zl(o),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const o=t-e,u=Math.min(.5*Math.pow(2,o),8),d=1-Math.random()*.25;return u*d*1e3}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:a,path:o,query:u,defaultBaseURL:d}=n,f=this.buildURL(o,u,d);"timeout"in n&&xC("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:h,body:p}=this.buildBody({options:n}),y=await this.buildHeaders({options:e,method:a,bodyHeaders:h,retryCount:t});return{req:{method:a,headers:y,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"},...p&&{body:p},...this.fetchOptions??{},...n.fetchOptions??{}},url:f,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:a}){let o={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const u=me([o,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...NC(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(u),u.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=me([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:pA(e)}:D(this,ld,"f").call(this,{body:e,headers:n})}};zy=Le,ld=new WeakMap,Vg=new WeakSet,T1=function(){return this.baseURL!=="https://api.openai.com/v1"};Le.OpenAI=zy;Le.DEFAULT_TIMEOUT=6e5;Le.OpenAIError=ve;Le.APIError=hn;Le.APIConnectionError=Zd;Le.APIConnectionTimeoutError=Vd;Le.APIUserAbortError=Nn;Le.NotFoundError=oA;Le.ConflictError=lA;Le.RateLimitError=cA;Le.BadRequestError=aA;Le.AuthenticationError=sA;Le.InternalServerError=dA;Le.PermissionDeniedError=iA;Le.UnprocessableEntityError=uA;Le.InvalidWebhookSignatureError=ll;Le.toFile=WC;Le.Completions=o1;Le.Chat=Ty;Le.Embeddings=u1;Le.Files=d1;Le.Images=y1;Le.Audio=Jl;Le.Moderations=b1;Le.Models=_1;Le.FineTuning=Pi;Le.Graders=My;Le.VectorStores=Qd;Le.Webhooks=O1;Le.Beta=Kl;Le.Batches=t1;Le.Uploads=Uy;Le.Responses=Dy;Le.Evals=jy;Le.Containers=Cy;function Wd(r,e,t){function n(d,f){var h;Object.defineProperty(d,"_zod",{value:d._zod??{},enumerable:!1}),(h=d._zod).traits??(h.traits=new Set),d._zod.traits.add(r),e(d,f);for(const p in u.prototype)p in d||Object.defineProperty(d,p,{value:u.prototype[p].bind(d)});d._zod.constr=u,d._zod.def=f}const a=(t==null?void 0:t.Parent)??Object;class o extends a{}Object.defineProperty(o,"name",{value:r});function u(d){var f;const h=t!=null&&t.Parent?new o:this;n(h,d),(f=h._zod).deferred??(f.deferred=[]);for(const p of h._zod.deferred)p();return h}return Object.defineProperty(u,"init",{value:n}),Object.defineProperty(u,Symbol.hasInstance,{value:d=>{var f,h;return t!=null&&t.Parent&&d instanceof t.Parent?!0:(h=(f=d==null?void 0:d._zod)==null?void 0:f.traits)==null?void 0:h.has(r)}}),Object.defineProperty(u,"name",{value:r}),u}class Nd extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const Ok={};function ef(r){return Ok}function Tk(r){const e=Object.values(r).filter(n=>typeof n=="number");return Object.entries(r).filter(([n,a])=>e.indexOf(+n)===-1).map(([n,a])=>a)}function Rk(r,e){return typeof e=="bigint"?e.toString():e}const R1=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};function Cd(r,e,t){const n=new r._zod.constr(e??r._zod.def);return(!e||t!=null&&t.parent)&&(n._zod.parent=r),n}function Nk(r){return{}}function Km(r,e=0){var t;for(let n=e;n<r.issues.length;n++)if(((t=r.issues[n])==null?void 0:t.continue)!==!0)return!0;return!1}function Ac(r){return typeof r=="string"?r:r==null?void 0:r.message}function tf(r,e,t){var a,o,u,d,f,h;const n={...r,path:r.path??[]};if(!r.message){const p=Ac((u=(o=(a=r.inst)==null?void 0:a._zod.def)==null?void 0:o.error)==null?void 0:u.call(o,r))??Ac((d=e==null?void 0:e.error)==null?void 0:d.call(e,r))??Ac((f=t.customError)==null?void 0:f.call(t,r))??Ac((h=t.localeError)==null?void 0:h.call(t,r))??"Invalid input";n.message=p}return delete n.inst,delete n.continue,e!=null&&e.reportInput||delete n.input,n}const N1=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(e,Rk,2)},enumerable:!0}),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},Ck=Wd("$ZodError",N1),nf=Wd("$ZodError",N1,{Parent:Error}),kk=r=>(e,t,n,a)=>{const o=n?Object.assign(n,{async:!1}):{async:!1},u=e._zod.run({value:t,issues:[]},o);if(u instanceof Promise)throw new Nd;if(u.issues.length){const d=new((a==null?void 0:a.Err)??r)(u.issues.map(f=>tf(f,o,ef())));throw R1(d,a==null?void 0:a.callee),d}return u.value},C1=kk(nf),jk=r=>async(e,t,n,a)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let u=e._zod.run({value:t,issues:[]},o);if(u instanceof Promise&&(u=await u),u.issues.length){const d=new((a==null?void 0:a.Err)??r)(u.issues.map(f=>tf(f,o,ef())));throw R1(d,a==null?void 0:a.callee),d}return u.value},$k=jk(nf),Ik=r=>(e,t,n)=>{const a=n?{...n,async:!1}:{async:!1},o=e._zod.run({value:t,issues:[]},a);if(o instanceof Promise)throw new Nd;return o.issues.length?{success:!1,error:new(r??Ck)(o.issues.map(u=>tf(u,a,ef())))}:{success:!0,data:o.value}},Pk=Ik(nf),Mk=r=>async(e,t,n)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let o=e._zod.run({value:t,issues:[]},a);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new r(o.issues.map(u=>tf(u,a,ef())))}:{success:!0,data:o.value}},Lk=Mk(nf),Dk={major:4,minor:0,patch:0},Uk=Wd("$ZodType",(r,e)=>{var a;var t;r??(r={}),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=Dk;const n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(const o of n)for(const u of o._zod.onattach)u(r);if(n.length===0)(t=r._zod).deferred??(t.deferred=[]),(a=r._zod.deferred)==null||a.push(()=>{r._zod.run=r._zod.parse});else{const o=(u,d,f)=>{let h=Km(u),p;for(const y of d){if(y._zod.def.when){if(!y._zod.def.when(u))continue}else if(h)continue;const _=u.issues.length,b=y._zod.check(u);if(b instanceof Promise&&(f==null?void 0:f.async)===!1)throw new Nd;if(p||b instanceof Promise)p=(p??Promise.resolve()).then(async()=>{await b,u.issues.length!==_&&(h||(h=Km(u,_)))});else{if(u.issues.length===_)continue;h||(h=Km(u,_))}}return p?p.then(()=>u):u};r._zod.run=(u,d)=>{const f=r._zod.parse(u,d);if(f instanceof Promise){if(d.async===!1)throw new Nd;return f.then(h=>o(h,n,d))}return o(f,n,d)}}r["~standard"]={validate:o=>{var u;try{const d=Pk(r,o);return d.success?{value:d.data}:{issues:(u=d.error)==null?void 0:u.issues}}catch{return Lk(r,o).then(f=>{var h;return f.success?{value:f.data}:{issues:(h=f.error)==null?void 0:h.issues}})}},vendor:"zod",version:1}}),zk=Wd("$ZodNever",(r,e)=>{Uk.init(r,e),r._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:r}),t)});class k1{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){const n=t[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const n={...this.get(t)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function Bk(){return new k1}const Ia=Bk();function qk(r,e){return new r({type:"never",...Nk()})}class rS{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??Ia,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var y,_,b;var n;const a=e._zod.def,o={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},u=this.seen.get(e);if(u)return u.count++,t.schemaPath.includes(e)&&(u.cycle=t.path),u.schema;const d={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,d);const f=(_=(y=e._zod).toJSONSchema)==null?void 0:_.call(y);if(f)d.schema=f;else{const v={...t,schemaPath:[...t.schemaPath,e],path:t.path},S=e._zod.parent;if(S)d.ref=S,this.process(S,v),this.seen.get(S).isParent=!0;else{const x=d.schema;switch(a.type){case"string":{const E=x;E.type="string";const{minimum:R,maximum:T,format:j,patterns:$,contentEncoding:q}=e._zod.bag;if(typeof R=="number"&&(E.minLength=R),typeof T=="number"&&(E.maxLength=T),j&&(E.format=o[j]??j,E.format===""&&delete E.format),q&&(E.contentEncoding=q),$&&$.size>0){const Z=[...$];Z.length===1?E.pattern=Z[0].source:Z.length>1&&(d.schema.allOf=[...Z.map(Y=>({...this.target==="draft-7"?{type:"string"}:{},pattern:Y.source}))])}break}case"number":{const E=x,{minimum:R,maximum:T,format:j,multipleOf:$,exclusiveMaximum:q,exclusiveMinimum:Z}=e._zod.bag;typeof j=="string"&&j.includes("int")?E.type="integer":E.type="number",typeof Z=="number"&&(E.exclusiveMinimum=Z),typeof R=="number"&&(E.minimum=R,typeof Z=="number"&&(Z>=R?delete E.minimum:delete E.exclusiveMinimum)),typeof q=="number"&&(E.exclusiveMaximum=q),typeof T=="number"&&(E.maximum=T,typeof q=="number"&&(q<=T?delete E.maximum:delete E.exclusiveMaximum)),typeof $=="number"&&(E.multipleOf=$);break}case"boolean":{const E=x;E.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{x.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{x.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const E=x,{minimum:R,maximum:T}=e._zod.bag;typeof R=="number"&&(E.minItems=R),typeof T=="number"&&(E.maxItems=T),E.type="array",E.items=this.process(a.element,{...v,path:[...v.path,"items"]});break}case"object":{const E=x;E.type="object",E.properties={};const R=a.shape;for(const $ in R)E.properties[$]=this.process(R[$],{...v,path:[...v.path,"properties",$]});const T=new Set(Object.keys(R)),j=new Set([...T].filter($=>{const q=a.shape[$]._zod;return this.io==="input"?q.optin===void 0:q.optout===void 0}));j.size>0&&(E.required=Array.from(j)),((b=a.catchall)==null?void 0:b._zod.def.type)==="never"?E.additionalProperties=!1:a.catchall?a.catchall&&(E.additionalProperties=this.process(a.catchall,{...v,path:[...v.path,"additionalProperties"]})):this.io==="output"&&(E.additionalProperties=!1);break}case"union":{const E=x;E.anyOf=a.options.map((R,T)=>this.process(R,{...v,path:[...v.path,"anyOf",T]}));break}case"intersection":{const E=x,R=this.process(a.left,{...v,path:[...v.path,"allOf",0]}),T=this.process(a.right,{...v,path:[...v.path,"allOf",1]}),j=q=>"allOf"in q&&Object.keys(q).length===1,$=[...j(R)?R.allOf:[R],...j(T)?T.allOf:[T]];E.allOf=$;break}case"tuple":{const E=x;E.type="array";const R=a.items.map(($,q)=>this.process($,{...v,path:[...v.path,"prefixItems",q]}));if(this.target==="draft-2020-12"?E.prefixItems=R:E.items=R,a.rest){const $=this.process(a.rest,{...v,path:[...v.path,"items"]});this.target==="draft-2020-12"?E.items=$:E.additionalItems=$}a.rest&&(E.items=this.process(a.rest,{...v,path:[...v.path,"items"]}));const{minimum:T,maximum:j}=e._zod.bag;typeof T=="number"&&(E.minItems=T),typeof j=="number"&&(E.maxItems=j);break}case"record":{const E=x;E.type="object",E.propertyNames=this.process(a.keyType,{...v,path:[...v.path,"propertyNames"]}),E.additionalProperties=this.process(a.valueType,{...v,path:[...v.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const E=x,R=Tk(a.entries);R.every(T=>typeof T=="number")&&(E.type="number"),R.every(T=>typeof T=="string")&&(E.type="string"),E.enum=R;break}case"literal":{const E=x,R=[];for(const T of a.values)if(T===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof T=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");R.push(Number(T))}else R.push(T);if(R.length!==0)if(R.length===1){const T=R[0];E.type=T===null?"null":typeof T,E.const=T}else R.every(T=>typeof T=="number")&&(E.type="number"),R.every(T=>typeof T=="string")&&(E.type="string"),R.every(T=>typeof T=="boolean")&&(E.type="string"),R.every(T=>T===null)&&(E.type="null"),E.enum=R;break}case"file":{const E=x,R={type:"string",format:"binary",contentEncoding:"binary"},{minimum:T,maximum:j,mime:$}=e._zod.bag;T!==void 0&&(R.minLength=T),j!==void 0&&(R.maxLength=j),$?$.length===1?(R.contentMediaType=$[0],Object.assign(E,R)):E.anyOf=$.map(q=>({...R,contentMediaType:q})):Object.assign(E,R);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const E=this.process(a.innerType,v);x.anyOf=[E,{type:"null"}];break}case"nonoptional":{this.process(a.innerType,v),d.ref=a.innerType;break}case"success":{const E=x;E.type="boolean";break}case"default":{this.process(a.innerType,v),d.ref=a.innerType,x.default=JSON.parse(JSON.stringify(a.defaultValue));break}case"prefault":{this.process(a.innerType,v),d.ref=a.innerType,this.io==="input"&&(x._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break}case"catch":{this.process(a.innerType,v),d.ref=a.innerType;let E;try{E=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}x.default=E;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const E=x,R=e._zod.pattern;if(!R)throw new Error("Pattern not found in template literal");E.type="string",E.pattern=R.source;break}case"pipe":{const E=this.io==="input"?a.in._zod.def.type==="transform"?a.out:a.in:a.out;this.process(E,v),d.ref=E;break}case"readonly":{this.process(a.innerType,v),d.ref=a.innerType,x.readOnly=!0;break}case"promise":{this.process(a.innerType,v),d.ref=a.innerType;break}case"optional":{this.process(a.innerType,v),d.ref=a.innerType;break}case"lazy":{const E=e._zod.innerType;this.process(E,v),d.ref=E;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const h=this.metadataRegistry.get(e);return h&&Object.assign(d.schema,h),this.io==="input"&&vt(e)&&(delete d.schema.examples,delete d.schema.default),this.io==="input"&&d.schema._prefault&&((n=d.schema).default??(n.default=d.schema._prefault)),delete d.schema._prefault,this.seen.get(e).schema}emit(e,t){var p,y,_,b,v,S;const n={cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0},a=this.seen.get(e);if(!a)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=x=>{var $;const E=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const q=($=n.external.registry.get(x[0]))==null?void 0:$.id,Z=n.external.uri??(oe=>oe);if(q)return{ref:Z(q)};const Y=x[1].defId??x[1].schema.id??`schema${this.counter++}`;return x[1].defId=Y,{defId:Y,ref:`${Z("__shared")}#/${E}/${Y}`}}if(x[1]===a)return{ref:"#"};const T=`#/${E}/`,j=x[1].schema.id??`__schema${this.counter++}`;return{defId:j,ref:T+j}},u=x=>{if(x[1].schema.$ref)return;const E=x[1],{ref:R,defId:T}=o(x);E.def={...E.schema},T&&(E.defId=T);const j=E.schema;for(const $ in j)delete j[$];j.$ref=R};if(n.cycles==="throw")for(const x of this.seen.entries()){const E=x[1];if(E.cycle)throw new Error(`Cycle detected: #/${(p=E.cycle)==null?void 0:p.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const x of this.seen.entries()){const E=x[1];if(e===x[0]){u(x);continue}if(n.external){const T=(y=n.external.registry.get(x[0]))==null?void 0:y.id;if(e!==x[0]&&T){u(x);continue}}if((_=this.metadataRegistry.get(x[0]))==null?void 0:_.id){u(x);continue}if(E.cycle){u(x);continue}if(E.count>1&&n.reused==="ref"){u(x);continue}}const d=(x,E)=>{const R=this.seen.get(x),T=R.def??R.schema,j={...T};if(R.ref===null)return;const $=R.ref;if(R.ref=null,$){d($,E);const q=this.seen.get($).schema;q.$ref&&E.target==="draft-7"?(T.allOf=T.allOf??[],T.allOf.push(q)):(Object.assign(T,q),Object.assign(T,j))}R.isParent||this.override({zodSchema:x,jsonSchema:T,path:R.path??[]})};for(const x of[...this.seen.entries()].reverse())d(x[0],{target:this.target});const f={};if(this.target==="draft-2020-12"?f.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?f.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),(b=n.external)!=null&&b.uri){const x=(v=n.external.registry.get(e))==null?void 0:v.id;if(!x)throw new Error("Schema is missing an `id` property");f.$id=n.external.uri(x)}Object.assign(f,a.def);const h=((S=n.external)==null?void 0:S.defs)??{};for(const x of this.seen.entries()){const E=x[1];E.def&&E.defId&&(h[E.defId]=E.def)}n.external||Object.keys(h).length>0&&(this.target==="draft-2020-12"?f.$defs=h:f.definitions=h);try{return JSON.parse(JSON.stringify(f))}catch{throw new Error("Error converting schema to JSON.")}}}function Jg(r,e){if(r instanceof k1){const n=new rS(e),a={};for(const d of r._idmap.entries()){const[f,h]=d;n.process(h)}const o={},u={registry:r,uri:e==null?void 0:e.uri,defs:a};for(const d of r._idmap.entries()){const[f,h]=d;o[f]=n.emit(h,{...e,external:u})}if(Object.keys(a).length>0){const d=n.target==="draft-2020-12"?"$defs":"definitions";o.__shared={[d]:a}}return{schemas:o}}const t=new rS(e);return t.process(r),t.emit(r,e)}function vt(r,e){const t=e??{seen:new Set};if(t.seen.has(r))return!1;t.seen.add(r);const a=r._zod.def;switch(a.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return vt(a.element,t);case"object":{for(const o in a.shape)if(vt(a.shape[o],t))return!0;return!1}case"union":{for(const o of a.options)if(vt(o,t))return!0;return!1}case"intersection":return vt(a.left,t)||vt(a.right,t);case"tuple":{for(const o of a.items)if(vt(o,t))return!0;return!!(a.rest&&vt(a.rest,t))}case"record":return vt(a.keyType,t)||vt(a.valueType,t);case"map":return vt(a.keyType,t)||vt(a.valueType,t);case"set":return vt(a.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return vt(a.innerType,t);case"lazy":return vt(a.getter(),t);case"default":return vt(a.innerType,t);case"prefault":return vt(a.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return vt(a.in,t)||vt(a.out,t);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${a.type}`)}function aS(r,e=By){r=r.trim();const t=r.indexOf("```");if(t===-1)return e(r);let n=r.substring(t+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));const a=n.indexOf("```");let o=n;return a!==-1&&(o=n.substring(0,a)),e(o.trim())}function By(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,a=!1;for(let o of r){if(n)o==='"'&&!a?n=!1:o===`
`&&!a?o="\\n":o==="\\"?a=!a:a=!1;else if(o==='"')n=!0,a=!1;else if(o==="{")t.push("}");else if(o==="[")t.push("]");else if(o==="}"||o==="]")if(t&&t[t.length-1]===o)t.pop();else return null;e+=o}n&&(e+='"');for(let o=t.length-1;o>=0;o-=1)e+=t[o];try{return JSON.parse(e)}catch{return null}}var Ym,sS;function Hk(){return sS||(sS=1,Ym=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Ym}var Gk=Hk();const Fk=vs(Gk);var Oc={exports:{}},iS;function Zk(){if(iS)return Oc.exports;iS=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,o=new RegExp("^"+a.source),u=new RegExp(a.source+n.source,"gu"),d=new RegExp("\\d+"+n.source,"gu"),f=(_,b,v)=>{let S=!1,x=!1,E=!1;for(let R=0;R<_.length;R++){const T=_[R];S&&r.test(T)?(_=_.slice(0,R)+"-"+_.slice(R),S=!1,E=x,x=!0,R++):x&&E&&e.test(T)?(_=_.slice(0,R-1)+"-"+_.slice(R-1),E=x,x=!1,S=!0):(S=b(T)===T&&v(T)!==T,E=x,x=v(T)===T&&b(T)!==T)}return _},h=(_,b)=>(t.lastIndex=0,_.replace(t,v=>b(v))),p=(_,b)=>(u.lastIndex=0,d.lastIndex=0,_.replace(u,(v,S)=>b(S)).replace(d,v=>b(v))),y=(_,b)=>{if(!(typeof _=="string"||Array.isArray(_)))throw new TypeError("Expected the input to be `string | string[]`");if(b={pascalCase:!1,preserveConsecutiveUppercase:!1,...b},Array.isArray(_)?_=_.map(E=>E.trim()).filter(E=>E.length).join("-"):_=_.trim(),_.length===0)return"";const v=b.locale===!1?E=>E.toLowerCase():E=>E.toLocaleLowerCase(b.locale),S=b.locale===!1?E=>E.toUpperCase():E=>E.toLocaleUpperCase(b.locale);return _.length===1?b.pascalCase?S(_):v(_):(_!==v(_)&&(_=f(_,v,S)),_=_.replace(o,""),b.preserveConsecutiveUppercase?_=h(_,v):_=v(_),b.pascalCase&&(_=S(_.charAt(0))+_.slice(1)),p(_,S))};return Oc.exports=y,Oc.exports.default=y,Oc.exports}Zk();function Vk(r,e){return(e==null?void 0:e[r])||Fk(r)}function Jk(r,e,t){const n={};for(const a in r)Object.hasOwn(r,a)&&(n[e(a,t)]=r[a]);return n}function oS(r){return Array.isArray(r)?[...r]:{...r}}function Kk(r,e){const t=oS(r);for(const[n,a]of Object.entries(e)){const[o,...u]=n.split(".").reverse();let d=t;for(const f of u.reverse()){if(d[f]===void 0)break;d[f]=oS(d[f]),d=d[f]}d[o]!==void 0&&(d[o]={lc:1,type:"secret",id:[a]})}return t}function j1(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}class ys{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,j1(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var a;return(a=this.lc_serializable_keys)==null?void 0:a.includes(n)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof ys||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((a,o)=>(a[o]=o in this?this[o]:this.lc_kwargs[o],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(n,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let o=this,u=n;const[d,...f]=a.split(".").reverse();for(const h of f.reverse()){if(!(h in o)||o[h]===void 0)return;(!(h in u)||u[h]===void 0)&&(typeof o[h]=="object"&&o[h]!=null?u[h]={}:Array.isArray(o[h])&&(u[h]=[])),o=o[h],u=u[h]}d in o&&o[d]!==void 0&&(u[d]=u[d]||o[d])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Jk(Object.keys(t).length?Kk(n,t):n,Vk,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function Da(r){return typeof r=="object"&&r!==null&&"type"in r&&typeof r.type=="string"&&"source_type"in r&&(r.source_type==="url"||r.source_type==="base64"||r.source_type==="text"||r.source_type==="id")}function Yk(r){return Da(r)&&r.source_type==="url"&&"url"in r&&typeof r.url=="string"}function Xk(r){return Da(r)&&r.source_type==="base64"&&"data"in r&&typeof r.data=="string"}function Qk(r){if(Da(r)){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url}};if(r.source_type==="base64"){if(!r.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${r.mime_type};base64,${r.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function lS(r){const e=r.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${r}" - does not match type/subtype format.`);const t=e[0].trim(),n=e[1].trim();if(t===""||n==="")throw new Error(`Invalid mime type: "${r}" - type or subtype is empty.`);const a={};for(const o of r.split(";").slice(1)){const u=o.split("=");if(u.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${r}".`);const d=u[0].trim(),f=u[1].trim();if(d==="")throw new Error(`Invalid parameter syntax in mime type: "${r}".`);a[d]=f}return{type:t,subtype:n,parameters:a}}function kd({dataUrl:r,asTypedArray:e=!1}){const t=r.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let n;if(t){n=t[1].toLowerCase();const a=e?Uint8Array.from(atob(t[2]),o=>o.charCodeAt(0)):t[2];return{mime_type:n,data:a}}}function qy(r,e){if(r.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(r)}if(r.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(r)}if(r.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(r)}if(r.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(r)}throw new Error(`Unable to convert content block type '${r.type}' to provider-specific format: not recognized.`)}function Mi(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:Array.isArray(e)&&e.some(t=>Da(t))?[{type:"text",source_type:"text",text:r},...e]:[{type:"text",text:r},...e]:Array.isArray(e)?rf(r,e)??[...r,...e]:e===""?r:Array.isArray(r)&&r.some(t=>Da(t))?[...r,{type:"file",source_type:"text",text:e}]:[...r,{type:"text",text:e}]}function Wk(r,e){return r==="error"||e==="error"?"error":"success"}function ej(r,e){function t(n,a){if(typeof n!="object"||n===null||n===void 0)return n;if(a>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(u=>t(u,a+1));const o={};for(const u of Object.keys(n))o[u]=t(n[u],a+1);return o}return JSON.stringify(t(r,0),null,2)}class Li extends ys{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=ej(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function en(r,e){const t={...r};for(const[n,a]of Object.entries(e))if(t[n]==null)t[n]=a;else{if(a==null)continue;if(typeof t[n]!=typeof a||Array.isArray(t[n])!==Array.isArray(a))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=a}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=en(t[n],a);else if(Array.isArray(t[n]))t[n]=rf(t[n],a);else{if(t[n]===a)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function rf(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const a=t.findIndex(o=>o.index===n.index);a!==-1?t[a]=en(t[a],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function tj(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return rf(r,e);if(typeof r=="object"&&typeof e=="object")return en(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}class Di extends Li{}function nj(r){return typeof r.role=="string"}function af(r){return typeof(r==null?void 0:r._getType)=="function"}function rj(r){return af(r)&&typeof r.concat=="function"}class aj extends Li{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Hy extends Di{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Hy({content:Mi(this.content,e.content),additional_kwargs:en(this.additional_kwargs,e.additional_kwargs),response_metadata:en(this.response_metadata,e.response_metadata),artifact:tj(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Wk(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function sj(r){const e=[],t=[];for(const n of r)if(n.function){const a=n.function.name;try{const o=JSON.parse(n.function.arguments),u={name:a||"",args:o||{},id:n.id};e.push(u)}catch{t.push({name:a,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}class _s extends Li{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var a;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const o=(a=n.additional_kwargs)==null?void 0:a.tool_calls,u=n.tool_calls;o!=null&&o.length>0&&(u===void 0||u.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(o!=null&&u===void 0){const[d,f]=sj(o);n.tool_calls=d??[],n.invalid_tool_calls=f??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function Ui(r){return r._getType()==="ai"}function uS(r){return r._getType()==="ai"}class xt extends Di{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=[],a=[];for(const o of e.tool_call_chunks){let u={};try{if(u=By(o.args||"{}"),u===null||typeof u!="object"||Array.isArray(u))throw new Error("Malformed tool call chunk args.");n.push({name:o.name??"",args:u,id:o.id,type:"tool_call"})}catch{a.push({name:o.name,args:o.args,id:o.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:a,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var n,a,o,u,d,f,h,p,y,_,b,v,S,x,E,R,T,j,$,q,Z,Y,oe,$e,Se,Ge,At,re,ee,P,H,X,ne,N,B,K,Q,ie,he,pe;const t={content:Mi(this.content,e.content),additional_kwargs:en(this.additional_kwargs,e.additional_kwargs),response_metadata:en(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const ct=rf(this.tool_call_chunks,e.tool_call_chunks);ct!==void 0&&ct.length>0&&(t.tool_call_chunks=ct)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const ct={...(((a=(n=this.usage_metadata)==null?void 0:n.input_token_details)==null?void 0:a.audio)!==void 0||((u=(o=e.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)!==void 0)&&{audio:(((f=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:f.audio)??0)+(((p=(h=e.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:p.audio)??0)},...(((_=(y=this.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:_.cache_read)!==void 0||((v=(b=e.usage_metadata)==null?void 0:b.input_token_details)==null?void 0:v.cache_read)!==void 0)&&{cache_read:(((x=(S=this.usage_metadata)==null?void 0:S.input_token_details)==null?void 0:x.cache_read)??0)+(((R=(E=e.usage_metadata)==null?void 0:E.input_token_details)==null?void 0:R.cache_read)??0)},...(((j=(T=this.usage_metadata)==null?void 0:T.input_token_details)==null?void 0:j.cache_creation)!==void 0||((q=($=e.usage_metadata)==null?void 0:$.input_token_details)==null?void 0:q.cache_creation)!==void 0)&&{cache_creation:(((Y=(Z=this.usage_metadata)==null?void 0:Z.input_token_details)==null?void 0:Y.cache_creation)??0)+((($e=(oe=e.usage_metadata)==null?void 0:oe.input_token_details)==null?void 0:$e.cache_creation)??0)}},et={...(((Ge=(Se=this.usage_metadata)==null?void 0:Se.output_token_details)==null?void 0:Ge.audio)!==void 0||((re=(At=e.usage_metadata)==null?void 0:At.output_token_details)==null?void 0:re.audio)!==void 0)&&{audio:(((P=(ee=this.usage_metadata)==null?void 0:ee.output_token_details)==null?void 0:P.audio)??0)+(((X=(H=e.usage_metadata)==null?void 0:H.output_token_details)==null?void 0:X.audio)??0)},...(((N=(ne=this.usage_metadata)==null?void 0:ne.output_token_details)==null?void 0:N.reasoning)!==void 0||((K=(B=e.usage_metadata)==null?void 0:B.output_token_details)==null?void 0:K.reasoning)!==void 0)&&{reasoning:(((ie=(Q=this.usage_metadata)==null?void 0:Q.output_token_details)==null?void 0:ie.reasoning)??0)+(((pe=(he=e.usage_metadata)==null?void 0:he.output_token_details)==null?void 0:pe.reasoning)??0)}},jn=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},qa=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},ws={input_tokens:jn.input_tokens+qa.input_tokens,output_tokens:jn.output_tokens+qa.output_tokens,total_tokens:jn.total_tokens+qa.total_tokens,...Object.keys(ct).length>0&&{input_token_details:ct},...Object.keys(et).length>0&&{output_token_details:et}};t.usage_metadata=ws}return new xt(t)}}class Yl extends Li{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Yl}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class sf extends Di{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new sf({content:Mi(this.content,e.content),additional_kwargs:en(this.additional_kwargs,e.additional_kwargs),response_metadata:en(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class of extends Di{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new of({content:Mi(this.content,e.content),additional_kwargs:en(this.additional_kwargs,e.additional_kwargs),response_metadata:en(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class ki extends Li{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}}class lf extends Di{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new lf({content:Mi(this.content,e.content),additional_kwargs:en(this.additional_kwargs,e.additional_kwargs),response_metadata:en(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class cS extends Li{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}}class Dl extends Di{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new Dl({content:Mi(this.content,e.content),additional_kwargs:en(this.additional_kwargs,e.additional_kwargs),response_metadata:en(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function $1(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function I1(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}class ij extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function oj(r){return I1(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function lj(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function Xm(r){let e,t;if(lj(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...a}=r;e=n,t=a}if(e==="human"||e==="user")return new ki(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...a}=t;if(!Array.isArray(n))return new _s(t);const o=n.map(oj);return new _s({...a,tool_calls:o})}else{if(e==="system")return new cS(t);if(e==="developer")return new cS({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new aj({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw $1(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function _l(r){if(typeof r=="string")return new ki(r);if(af(r))return r;if(Array.isArray(r)){const[e,t]=r;return Xm({type:e,content:t})}else if(nj(r)){const{role:e,...t}=r;return Xm({...t,type:e})}else return Xm(r)}function P1(r,e="Human",t="AI"){const n=[];for(const a of r){let o;if(a._getType()==="human")o=e;else if(a._getType()==="ai")o=t;else if(a._getType()==="system")o="System";else if(a._getType()==="function")o="Function";else if(a._getType()==="tool")o="Tool";else if(a._getType()==="generic")o=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);const u=a.name?`${a.name}, `:"",d=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);n.push(`${o}: ${u}${d}`)}return n.join(`
`)}function uj(r){var t;const e=r._getType();if(e==="human")return new lf({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new xt({...n})}else{if(e==="system")return new Dl({...r});if(e==="function")return new of({...r});if(Yl.isInstance(r))return new sf({...r});throw new Error("Unknown message type.")}}var Zo={exports:{}},Qm={},Wm,dS;function cj(){if(dS)return Wm;dS=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Wm=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,a=0;a<this._errors.length;a++){var o=this._errors[a],u=o.message,d=(e[u]||0)+1;e[u]=d,d>=n&&(t=o,n=d)}return t},Wm}var fS;function dj(){return fS||(fS=1,function(r){var e=cj();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in t)n[a]=t[a];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],u=0;u<n.retries;u++)o.push(this.createTimeout(u,n));return t&&t.forever&&!o.length&&o.push(this.createTimeout(u,n)),o.sort(function(d,f){return d-f}),o},r.createTimeout=function(t,n){var a=n.randomize?Math.random()+1:1,o=Math.round(a*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return o=Math.min(o,n.maxTimeout),o},r.wrap=function(t,n,a){if(n instanceof Array&&(a=n,n=null),!a){a=[];for(var o in t)typeof t[o]=="function"&&a.push(o)}for(var u=0;u<a.length;u++){var d=a[u],f=t[d];t[d]=(function(p){var y=r.operation(n),_=Array.prototype.slice.call(arguments,1),b=_.pop();_.push(function(v){y.retry(v)||(v&&(arguments[0]=y.mainError()),b.apply(this,arguments))}),y.attempt(function(){p.apply(t,_)})}).bind(t,f),t[d].options=n}}}(Qm)),Qm}var ep,hS;function fj(){return hS||(hS=1,ep=dj()),ep}var mS;function hj(){if(mS)return Zo.exports;mS=1;const r=fj(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(d){super(),d instanceof Error?(this.originalError=d,{message:d}=d):(this.originalError=new Error(d),this.originalError.stack=this.stack),this.name="AbortError",this.message=d}}const n=(u,d,f)=>{const h=f.retries-(d-1);return u.attemptNumber=d,u.retriesLeft=h,u},a=u=>e.includes(u),o=(u,d)=>new Promise((f,h)=>{d={onFailedAttempt:()=>{},retries:10,...d};const p=r.operation(d);p.attempt(async y=>{try{f(await u(y))}catch(_){if(!(_ instanceof Error)){h(new TypeError(`Non-error was thrown: "${_}". You should only throw errors.`));return}if(_ instanceof t)p.stop(),h(_.originalError);else if(_ instanceof TypeError&&!a(_.message))p.stop(),h(_);else{n(_,y,d);try{await d.onFailedAttempt(_)}catch(b){h(b);return}p.retry(_)||h(p.mainError())}}})});return Zo.exports=o,Zo.exports.default=o,Zo.exports.AbortError=t,Zo.exports}var mj=hj();const jd=vs(mj),pj=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ud(r){return typeof r=="string"&&pj.test(r)}var Dt=[];for(var tp=0;tp<256;++tp)Dt.push((tp+256).toString(16).slice(1));function gj(r,e=0){return(Dt[r[e+0]]+Dt[r[e+1]]+Dt[r[e+2]]+Dt[r[e+3]]+"-"+Dt[r[e+4]]+Dt[r[e+5]]+"-"+Dt[r[e+6]]+Dt[r[e+7]]+"-"+Dt[r[e+8]]+Dt[r[e+9]]+"-"+Dt[r[e+10]]+Dt[r[e+11]]+Dt[r[e+12]]+Dt[r[e+13]]+Dt[r[e+14]]+Dt[r[e+15]]).toLowerCase()}var Tc,yj=new Uint8Array(16);function _j(){if(!Tc&&(Tc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Tc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tc(yj)}var bj=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const pS={randomUUID:bj};function Jr(r,e,t){if(pS.randomUUID&&!r)return pS.randomUUID();r=r||{};var n=r.random||(r.rng||_j)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,gj(n)}let vj=class{getStore(){}run(e,t){return t()}};const np=Symbol.for("ls:tracing_async_local_storage"),wj=new vj;let Sj=class{getInstance(){return globalThis[np]??wj}initializeGlobalInstance(e){globalThis[np]===void 0&&(globalThis[np]=e)}};const xj=new Sj;function Ej(r=!1){const e=xj.getInstance().getStore();if(!r&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function Gy(r){return typeof r=="function"&&"langsmith:traceable"in r}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const Aj=Object.prototype.hasOwnProperty;function Kg(r,e){return Aj.call(r,e)}function Yg(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)Kg(r,t)&&e.push(t);return e}function wr(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Xg(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function ci(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function Oj(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Qg(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Qg(r[t]))return!0}else if(typeof r=="object"){const t=Yg(r),n=t.length;for(var e=0;e<n;e++)if(Qg(r[t[e]]))return!0}}return!1}function gS(r,e){const t=[r];for(const n in e){const a=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof a<"u"&&t.push(`${n}: ${a}`)}return t.join(`
`)}class Tj extends Error{constructor(e,t,n,a,o){super(gS(e,{name:t,index:n,operation:a,tree:o})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.setPrototypeOf(this,new.target.prototype),this.message=gS(e,{name:t,index:n,operation:a,tree:o})}}const mt=Tj,Si={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=Wg(t,this.path);n&&(n=wr(n));const a=Al(t,{op:"remove",path:this.from}).removed;return Al(t,{op:"add",path:this.path,value:a}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=Wg(t,this.from);return Al(t,{op:"add",path:this.path,value:wr(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:Id(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var Rj={add:function(r,e,t){return Xg(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Si.move,copy:Si.copy,test:Si.test,_get:Si._get};function Wg(r,e){if(e=="")return r;var t={op:"_get",path:e};return Al(r,t),t.value}function Al(r,e,t=!1,n=!0,a=!0,o=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):ey(e,0)),e.path===""){let u={newDocument:r};if(e.op==="add")return u.newDocument=e.value,u;if(e.op==="replace")return u.newDocument=e.value,u.removed=r,u;if(e.op==="move"||e.op==="copy")return u.newDocument=Wg(r,e.from),e.op==="move"&&(u.removed=r),u;if(e.op==="test"){if(u.test=Id(r,e.value),u.test===!1)throw new mt("Test operation failed","TEST_OPERATION_FAILED",o,e,r);return u.newDocument=r,u}else{if(e.op==="remove")return u.removed=r,u.newDocument=null,u;if(e.op==="_get")return e.value=r,u;if(t)throw new mt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,r);return u}}else{n||(r=wr(r));const d=(e.path||"").split("/");let f=r,h=1,p=d.length,y,_,b;for(typeof t=="function"?b=t:b=ey;;){if(_=d[h],_&&_.indexOf("~")!=-1&&(_=Oj(_)),a&&(_=="__proto__"||_=="prototype"&&h>0&&d[h-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&y===void 0&&(f[_]===void 0?y=d.slice(0,h).join("/"):h==p-1&&(y=e.path),y!==void 0&&b(e,0,r,y)),h++,Array.isArray(f)){if(_==="-")_=f.length;else{if(t&&!Xg(_))throw new mt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,r);Xg(_)&&(_=~~_)}if(h>=p){if(t&&e.op==="add"&&_>f.length)throw new mt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,r);const v=Rj[e.op].call(e,f,_,r);if(v.test===!1)throw new mt("Test operation failed","TEST_OPERATION_FAILED",o,e,r);return v}}else if(h>=p){const v=Si[e.op].call(e,f,_,r);if(v.test===!1)throw new mt("Test operation failed","TEST_OPERATION_FAILED",o,e,r);return v}if(f=f[_],t&&h<p&&(!f||typeof f!="object"))throw new mt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,e,r)}}}function $d(r,e,t,n=!0,a=!0){if(t&&!Array.isArray(e))throw new mt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=wr(r));const o=new Array(e.length);for(let u=0,d=e.length;u<d;u++)o[u]=Al(r,e[u],t,!0,a,u),r=o[u].newDocument;return o.newDocument=r,o}function ey(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new mt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Si[r.op]){if(typeof r.path!="string")throw new mt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new mt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new mt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new mt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Qg(r.value))throw new mt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var a=r.path.split("/").length,o=n.split("/").length;if(a!==o+1&&a!==o)throw new mt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new mt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var u={op:"_get",path:r.from,value:void 0},d=Nj([u],t);if(d&&d.name==="OPERATION_PATH_UNRESOLVABLE")throw new mt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new mt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Nj(r,e,t){try{if(!Array.isArray(r))throw new mt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)$d(wr(e),wr(r),t||!0);else{t=t||ey;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(a){if(a instanceof mt)return a;throw a}}function Id(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),a,o,u;if(t&&n){if(o=r.length,o!=e.length)return!1;for(a=o;a--!==0;)if(!Id(r[a],e[a]))return!1;return!0}if(t!=n)return!1;var d=Object.keys(r);if(o=d.length,o!==Object.keys(e).length)return!1;for(a=o;a--!==0;)if(!e.hasOwnProperty(d[a]))return!1;for(a=o;a--!==0;)if(u=d[a],!Id(r[u],e[u]))return!1;return!0}return r!==r&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function M1(r,e,t,n,a){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var o=Yg(e),u=Yg(r),d=!1,f=u.length-1;f>=0;f--){var h=u[f],p=r[h];if(Kg(e,h)&&!(e[h]===void 0&&p!==void 0&&Array.isArray(e)===!1)){var y=e[h];typeof p=="object"&&p!=null&&typeof y=="object"&&y!=null&&Array.isArray(p)===Array.isArray(y)?M1(p,y,t,n+"/"+ci(h),a):p!==y&&(a&&t.push({op:"test",path:n+"/"+ci(h),value:wr(p)}),t.push({op:"replace",path:n+"/"+ci(h),value:wr(y)}))}else Array.isArray(r)===Array.isArray(e)?(a&&t.push({op:"test",path:n+"/"+ci(h),value:wr(p)}),t.push({op:"remove",path:n+"/"+ci(h)}),d=!0):(a&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!d&&o.length==u.length))for(var f=0;f<o.length;f++){var h=o[f];!Kg(r,h)&&e[h]!==void 0&&t.push({op:"add",path:n+"/"+ci(h),value:wr(e[h])})}}}function Cj(r,e,t=!1){var n=[];return M1(r,e,n,"",t),n}const kj=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function jj(r){return typeof r=="string"&&kj.test(r)}function $j(r){if(!jj(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Ut=[];for(var rp=0;rp<256;++rp)Ut.push((rp+256).toString(16).slice(1));function L1(r,e=0){return(Ut[r[e+0]]+Ut[r[e+1]]+Ut[r[e+2]]+Ut[r[e+3]]+"-"+Ut[r[e+4]]+Ut[r[e+5]]+"-"+Ut[r[e+6]]+Ut[r[e+7]]+"-"+Ut[r[e+8]]+Ut[r[e+9]]+"-"+Ut[r[e+10]]+Ut[r[e+11]]+Ut[r[e+12]]+Ut[r[e+13]]+Ut[r[e+14]]+Ut[r[e+15]]).toLowerCase()}var Rc,Ij=new Uint8Array(16);function Pj(){if(!Rc&&(Rc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Rc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Rc(Ij)}function Mj(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var Lj="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Dj="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Uj(r,e,t){function n(a,o,u,d){var f;if(typeof a=="string"&&(a=Mj(a)),typeof o=="string"&&(o=$j(o)),((f=o)===null||f===void 0?void 0:f.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var h=new Uint8Array(16+a.length);if(h.set(o),h.set(a,o.length),h=t(h),h[6]=h[6]&15|e,h[8]=h[8]&63|128,u){d=d||0;for(var p=0;p<16;++p)u[d+p]=h[p];return u}return L1(h)}try{n.name=r}catch{}return n.DNS=Lj,n.URL=Dj,n}var zj=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const yS={randomUUID:zj};function _i(r,e,t){if(yS.randomUUID&&!r)return yS.randomUUID();r=r||{};var n=r.random||(r.rng||Pj)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,L1(n)}function Bj(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function ap(r,e){return r<<e|r>>>32-e}function qj(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var a=0;a<n.length;++a)r.push(n.charCodeAt(a))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var o=r.length/4+2,u=Math.ceil(o/16),d=new Array(u),f=0;f<u;++f){for(var h=new Uint32Array(16),p=0;p<16;++p)h[p]=r[f*64+p*4]<<24|r[f*64+p*4+1]<<16|r[f*64+p*4+2]<<8|r[f*64+p*4+3];d[f]=h}d[u-1][14]=(r.length-1)*8/Math.pow(2,32),d[u-1][14]=Math.floor(d[u-1][14]),d[u-1][15]=(r.length-1)*8&4294967295;for(var y=0;y<u;++y){for(var _=new Uint32Array(80),b=0;b<16;++b)_[b]=d[y][b];for(var v=16;v<80;++v)_[v]=ap(_[v-3]^_[v-8]^_[v-14]^_[v-16],1);for(var S=t[0],x=t[1],E=t[2],R=t[3],T=t[4],j=0;j<80;++j){var $=Math.floor(j/20),q=ap(S,5)+Bj($,x,E,R)+T+e[$]+_[j]>>>0;T=R,R=E,E=ap(x,30)>>>0,x=S,S=q}t[0]=t[0]+S>>>0,t[1]=t[1]+x>>>0,t[2]=t[2]+E>>>0,t[3]=t[3]+R>>>0,t[4]=t[4]+T>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var _S=Uj("v5",80,qj);const Hj="gen_ai.operation.name",Gj="gen_ai.system",bS="gen_ai.request.model",Fj="gen_ai.response.model",vS="gen_ai.usage.input_tokens",wS="gen_ai.usage.output_tokens",SS="gen_ai.usage.total_tokens",Zj="gen_ai.request.max_tokens",Vj="gen_ai.request.temperature",Jj="gen_ai.request.top_p",Kj="gen_ai.request.frequency_penalty",Yj="gen_ai.request.presence_penalty",Xj="gen_ai.response.finish_reasons",Qj="gen_ai.prompt",Wj="gen_ai.completion",e$="gen_ai.request.extra_query",t$="gen_ai.request.extra_body",n$="gen_ai.serialized.name",r$="gen_ai.serialized.signature",a$="gen_ai.serialized.doc",s$="gen_ai.response.id",i$="gen_ai.response.service_tier",o$="gen_ai.response.system_fingerprint",l$="gen_ai.usage.input_token_details",u$="gen_ai.usage.output_token_details",c$="langsmith.trace.session_id",d$="langsmith.trace.session_name",f$="langsmith.span.kind",h$="langsmith.trace.name",m$="langsmith.metadata",xS="langsmith.span.tags",p$="langsmith.request.streaming",g$="langsmith.request.headers",y$=(...r)=>fetch(...r),D1=Symbol.for("ls:fetch_implementation"),_$=()=>{const r=globalThis[D1];return r?typeof r=="function"&&"Headers"in r&&"Request"in r&&"Response"in r:!1},fe=r=>async(...e)=>{if(r||Fn("DEBUG")==="true"){const[n,a]=e;console.log(`→ ${(a==null?void 0:a.method)||"GET"} ${n}`)}const t=await(globalThis[D1]??y$)(...e);return(r||Fn("DEBUG")==="true")&&console.log(`← ${t.status} ${t.statusText} ${t.url}`),t},U1=()=>Fn("PROJECT")??ar("LANGCHAIN_SESSION")??"default",z1="0.3.44";var Ol={};let Gr;const b$=()=>typeof window<"u"&&typeof window.document<"u",v$=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",w$=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),B1=()=>typeof Deno<"u",S$=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!B1(),x$=()=>Gr||(b$()?Gr="browser":S$()?Gr="node":v$()?Gr="webworker":w$()?Gr="jsdom":B1()?Gr="deno":Gr="other",Gr);let sp;function q1(){if(sp===void 0){const r=x$(),e=O$();sp={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:z1,...e}}return sp}function E$(){const r=A$()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,a]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof a=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[n]=a);return e}function A$(){try{return typeof process<"u"&&Ol?Object.entries(Ol).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function ar(r){try{return typeof process<"u"?Ol==null?void 0:Ol[r]:void 0}catch{return}}function Fn(r){return ar(`LANGSMITH_${r}`)||ar(`LANGCHAIN_${r}`)}let ip;function O$(){if(ip!==void 0)return ip;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=ar(t);n!==void 0&&(e[t]=n)}return ip=e,e}class T${constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&ar("OTEL_ENABLED")==="true"&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(t.length===1&&typeof t[0]=="function"?n=t[0]:t.length===2&&typeof t[1]=="function"?n=t[1]:t.length===3&&typeof t[2]=="function"&&(n=t[2]),typeof n=="function")return n()}}class R${constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new T$})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class N${active(){return{}}with(e,t){return t()}}const op=Symbol.for("ls:otel_trace"),lp=Symbol.for("ls:otel_context"),ES=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),C$=new R$,k$=new N$;class j${getTraceInstance(){return globalThis[op]??C$}getContextInstance(){return globalThis[lp]??k$}initializeGlobalInstances(e){globalThis[op]===void 0&&(globalThis[op]=e.trace),globalThis[lp]===void 0&&(globalThis[lp]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[ES]=e}getDefaultOTLPTracerComponents(){return globalThis[ES]??void 0}}const Fy=new j$;function H1(){return Fy.getTraceInstance()}function $$(){return Fy.getContextInstance()}function I$(){return Fy.getDefaultOTLPTracerComponents()}const P$={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function M$(r){return P$[r]||r}class L${constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(const n of e)try{if(!n.run)continue;if(n.operation==="post"){const a=this.createSpanForRun(n,n.run,t.get(n.id));a&&!n.run.end_time&&this.spans.set(n.id,a)}else this.updateSpanForRun(n,n.run)}catch(a){console.error(`Error processing operation ${n.id}:`,a)}}createSpanForRun(e,t,n){const a=n&&H1().getSpan(n);if(a)try{return this.finishSpanSetup(a,t,e)}catch(o){console.error(`Failed to create span for run ${e.id}:`,o);return}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(t.end_time),e}updateSpanForRun(e,t){try{const n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});const a=t.end_time;a&&(n.end(a),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){var t;if((t=e.extra)!=null&&t.metadata){const n=e.extra.metadata;if(n.ls_model_name)return n.ls_model_name;if(n.invocation_params){const a=n.invocation_params;if(a.model)return a.model;if(a.model_name)return a.model_name}}}setSpanAttributes(e,t,n){var d;if("run_type"in t&&t.run_type){e.setAttribute(f$,t.run_type);const f=M$(t.run_type||"chain");e.setAttribute(Hj,f)}"name"in t&&t.name&&e.setAttribute(h$,t.name),"session_id"in t&&t.session_id&&e.setAttribute(c$,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(d$,t.session_name),this.setGenAiSystem(e,t);const a=this.extractModelName(t);a&&e.setAttribute(bS,a),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(vS,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(wS,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(SS,t.total_tokens),this.setInvocationParameters(e,t);const o=((d=t.extra)==null?void 0:d.metadata)||{};for(const[f,h]of Object.entries(o))h!=null&&e.setAttribute(`${m$}.${f}`,String(h));const u=t.tags;if(u&&Array.isArray(u)?e.setAttribute(xS,u.join(", ")):u&&e.setAttribute(xS,String(u)),"serialized"in t&&typeof t.serialized=="object"){const f=t.serialized;f.name&&e.setAttribute(n$,String(f.name)),f.signature&&e.setAttribute(r$,String(f.signature)),f.doc&&e.setAttribute(a$,String(f.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain";const a=this.extractModelName(t);if(a){const o=a.toLowerCase();o.includes("anthropic")||o.startsWith("claude")?n="anthropic":o.includes("bedrock")?n="aws.bedrock":o.includes("azure")&&o.includes("openai")?n="az.ai.openai":o.includes("azure")&&o.includes("inference")?n="az.ai.inference":o.includes("cohere")?n="cohere":o.includes("deepseek")?n="deepseek":o.includes("gemini")?n="gemini":o.includes("groq")?n="groq":o.includes("watson")||o.includes("ibm")?n="ibm.watsonx.ai":o.includes("mistral")?n="mistral_ai":o.includes("gpt")||o.includes("openai")?n="openai":o.includes("perplexity")||o.includes("sonar")?n="perplexity":o.includes("vertex")?n="vertex_ai":(o.includes("xai")||o.includes("grok"))&&(n="xai")}e.setAttribute(Gj,n)}setInvocationParameters(e,t){var a,o;if(!((o=(a=t.extra)==null?void 0:a.metadata)!=null&&o.invocation_params))return;const n=t.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(Zj,n.max_tokens),n.temperature!==void 0&&e.setAttribute(Vj,n.temperature),n.top_p!==void 0&&e.setAttribute(Jj,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(Kj,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(Yj,n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{const n=t.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(bS,n.model),n.stream!==void 0&&e.setAttribute(p$,n.stream),n.extra_headers&&e.setAttribute(g$,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(e$,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(t$,JSON.stringify(n.extra_body))),e.setAttribute(Qj,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{const n=t.run.outputs,a=this.getUnifiedRunTokens(n);if(a&&(e.setAttribute(vS,a[0]),e.setAttribute(wS,a[1]),e.setAttribute(SS,a[0]+a[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(Fj,String(n.model)),n.id&&e.setAttribute(s$,n.id),n.choices&&Array.isArray(n.choices)){const o=n.choices.map(u=>u.finish_reason).filter(u=>u).map(String);o.length>0&&e.setAttribute(Xj,o.join(", "))}if(n.service_tier&&e.setAttribute(i$,n.service_tier),n.system_fingerprint&&e.setAttribute(o$,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){const o=n.usage_metadata;o.input_token_details&&e.setAttribute(l$,JSON.stringify(o.input_token_details)),o.output_token_details&&e.setAttribute(u$,JSON.stringify(o.output_token_details))}}e.setAttribute(Wj,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;const n=Object.keys(e);for(const u of n){const d=e[u];if(!(!d||typeof d!="object")&&(t=this.extractUnifiedRunTokens(d.usage_metadata),t||d.lc===1&&d.kwargs&&typeof d.kwargs=="object"&&(t=this.extractUnifiedRunTokens(d.kwargs.usage_metadata),t)))return t}const a=e.generations||[];if(!Array.isArray(a))return null;const o=Array.isArray(a[0])?a.flat():a;for(const u of o)if(typeof u=="object"&&u.message&&typeof u.message=="object"&&u.message.kwargs&&typeof u.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(u.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}}var Nc={},up={exports:{}},AS;function D$(){return AS||(AS=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function a(f,h,p){this.fn=f,this.context=h,this.once=p||!1}function o(f,h,p,y,_){if(typeof p!="function")throw new TypeError("The listener must be a function");var b=new a(p,y||f,_),v=t?t+h:h;return f._events[v]?f._events[v].fn?f._events[v]=[f._events[v],b]:f._events[v].push(b):(f._events[v]=b,f._eventsCount++),f}function u(f,h){--f._eventsCount===0?f._events=new n:delete f._events[h]}function d(){this._events=new n,this._eventsCount=0}d.prototype.eventNames=function(){var h=[],p,y;if(this._eventsCount===0)return h;for(y in p=this._events)e.call(p,y)&&h.push(t?y.slice(1):y);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(p)):h},d.prototype.listeners=function(h){var p=t?t+h:h,y=this._events[p];if(!y)return[];if(y.fn)return[y.fn];for(var _=0,b=y.length,v=new Array(b);_<b;_++)v[_]=y[_].fn;return v},d.prototype.listenerCount=function(h){var p=t?t+h:h,y=this._events[p];return y?y.fn?1:y.length:0},d.prototype.emit=function(h,p,y,_,b,v){var S=t?t+h:h;if(!this._events[S])return!1;var x=this._events[S],E=arguments.length,R,T;if(x.fn){switch(x.once&&this.removeListener(h,x.fn,void 0,!0),E){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,p),!0;case 3:return x.fn.call(x.context,p,y),!0;case 4:return x.fn.call(x.context,p,y,_),!0;case 5:return x.fn.call(x.context,p,y,_,b),!0;case 6:return x.fn.call(x.context,p,y,_,b,v),!0}for(T=1,R=new Array(E-1);T<E;T++)R[T-1]=arguments[T];x.fn.apply(x.context,R)}else{var j=x.length,$;for(T=0;T<j;T++)switch(x[T].once&&this.removeListener(h,x[T].fn,void 0,!0),E){case 1:x[T].fn.call(x[T].context);break;case 2:x[T].fn.call(x[T].context,p);break;case 3:x[T].fn.call(x[T].context,p,y);break;case 4:x[T].fn.call(x[T].context,p,y,_);break;default:if(!R)for($=1,R=new Array(E-1);$<E;$++)R[$-1]=arguments[$];x[T].fn.apply(x[T].context,R)}}return!0},d.prototype.on=function(h,p,y){return o(this,h,p,y,!1)},d.prototype.once=function(h,p,y){return o(this,h,p,y,!0)},d.prototype.removeListener=function(h,p,y,_){var b=t?t+h:h;if(!this._events[b])return this;if(!p)return u(this,b),this;var v=this._events[b];if(v.fn)v.fn===p&&(!_||v.once)&&(!y||v.context===y)&&u(this,b);else{for(var S=0,x=[],E=v.length;S<E;S++)(v[S].fn!==p||_&&!v[S].once||y&&v[S].context!==y)&&x.push(v[S]);x.length?this._events[b]=x.length===1?x[0]:x:u(this,b)}return this},d.prototype.removeAllListeners=function(h){var p;return h?(p=t?t+h:h,this._events[p]&&u(this,p)):(this._events=new n,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=t,d.EventEmitter=d,r.exports=d}(up)),up.exports}var Vo={exports:{}},cp,OS;function U$(){return OS||(OS=1,cp=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),cp}var TS;function z$(){if(TS)return Vo.exports;TS=1;const r=U$();class e extends Error{constructor(a){super(a),this.name="TimeoutError"}}const t=(n,a,o)=>new Promise((u,d)=>{if(typeof a!="number"||a<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(a===1/0){u(n);return}const f=setTimeout(()=>{if(typeof o=="function"){try{u(o())}catch(y){d(y)}return}const h=typeof o=="string"?o:`Promise timed out after ${a} milliseconds`,p=o instanceof Error?o:new e(h);typeof n.cancel=="function"&&n.cancel(),d(p)},a);r(n.then(u,d),()=>{clearTimeout(f)})});return Vo.exports=t,Vo.exports.default=t,Vo.exports.TimeoutError=e,Vo.exports}var Cc={},kc={},RS;function B$(){if(RS)return kc;RS=1,Object.defineProperty(kc,"__esModule",{value:!0});function r(e,t,n){let a=0,o=e.length;for(;o>0;){const u=o/2|0;let d=a+u;n(e[d],t)<=0?(a=++d,o-=u+1):o=u}return a}return kc.default=r,kc}var NS;function q$(){if(NS)return Cc;NS=1,Object.defineProperty(Cc,"__esModule",{value:!0});const r=B$();class e{constructor(){this._queue=[]}enqueue(n,a){a=Object.assign({priority:0},a);const o={priority:a.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=a.priority){this._queue.push(o);return}const u=r.default(this._queue,o,(d,f)=>f.priority-d.priority);this._queue.splice(u,0,o)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(a=>a.priority===n.priority).map(a=>a.run)}get size(){return this._queue.length}}return Cc.default=e,Cc}var CS;function H$(){if(CS)return Nc;CS=1,Object.defineProperty(Nc,"__esModule",{value:!0});const r=D$(),e=z$(),t=q$(),n=()=>{},a=new e.TimeoutError;class o extends r{constructor(d){var f,h,p,y;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,d=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},d),!(typeof d.intervalCap=="number"&&d.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(h=(f=d.intervalCap)===null||f===void 0?void 0:f.toString())!==null&&h!==void 0?h:""}\` (${typeof d.intervalCap})`);if(d.interval===void 0||!(Number.isFinite(d.interval)&&d.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(y=(p=d.interval)===null||p===void 0?void 0:p.toString())!==null&&y!==void 0?y:""}\` (${typeof d.interval})`);this._carryoverConcurrencyCount=d.carryoverConcurrencyCount,this._isIntervalIgnored=d.intervalCap===1/0||d.interval===0,this._intervalCap=d.intervalCap,this._interval=d.interval,this._queue=new d.queueClass,this._queueClass=d.queueClass,this.concurrency=d.concurrency,this._timeout=d.timeout,this._throwOnTimeout=d.throwOnTimeout===!0,this._isPaused=d.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const d=Date.now();if(this._intervalId===void 0){const f=this._intervalEnd-d;if(f<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},f)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const d=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const f=this._queue.dequeue();return f?(this.emit("active"),f(),d&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(d){if(!(typeof d=="number"&&d>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${d}\` (${typeof d})`);this._concurrency=d,this._processQueue()}async add(d,f={}){return new Promise((h,p)=>{const y=async()=>{this._pendingCount++,this._intervalCount++;try{const _=this._timeout===void 0&&f.timeout===void 0?d():e.default(Promise.resolve(d()),f.timeout===void 0?this._timeout:f.timeout,()=>{(f.throwOnTimeout===void 0?this._throwOnTimeout:f.throwOnTimeout)&&p(a)});h(await _)}catch(_){p(_)}this._next()};this._queue.enqueue(y,f),this._tryToStartAnother(),this.emit("add")})}async addAll(d,f){return Promise.all(d.map(async h=>this.add(h,f)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(d=>{const f=this._resolveEmpty;this._resolveEmpty=()=>{f(),d()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(d=>{const f=this._resolveIdle;this._resolveIdle=()=>{f(),d()}})}get size(){return this._queue.size}sizeBy(d){return this._queue.filter(d).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(d){this._timeout=d}}return Nc.default=o,Nc}var G$=H$();const Qr=vs(G$),F$=[400,401,403,404,405,406,407,408],Z$=[409];let kS=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,"default"in Qr?this.queue=new Qr.default({concurrency:this.maxConcurrency}):this.queue=new Qr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>jd(()=>e(...t).catch(a=>{throw a instanceof Error?a:new Error(a)}),{async onFailedAttempt(a){if(a.message.startsWith("Cancel")||a.message.startsWith("TimeoutError")||a.message.startsWith("AbortError")||(a==null?void 0:a.code)==="ECONNABORTED")throw a;const o=a==null?void 0:a.response,u=o==null?void 0:o.status;if(u){if(F$.includes(+u))throw a;if(Z$.includes(+u))return;n&&await n(o)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((a,o)=>{var u;(u=e.signal)==null||u.addEventListener("abort",()=>{o(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fe(this.debug)(...e).then(t=>t.ok?t:Promise.reject(t)))}};function jS(r){return typeof(r==null?void 0:r._getType)=="function"}function $S(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}const V$=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Oe(r,e){if(!V$.test(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const IS={};function G1(r){IS[r]||(console.warn(r),IS[r]=!0)}var jc={exports:{}},dp,PS;function uf(){if(PS)return dp;PS=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,a=e-6;return dp={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},dp}var fp,MS;function cf(){if(MS)return fp;MS=1;var r={};return fp=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},fp}var LS;function Xl(){return LS||(LS=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=uf(),o=cf();e=r.exports={};const u=e.re=[],d=e.safeRe=[],f=e.src=[],h=e.safeSrc=[],p=e.t={};let y=0;const _="[a-zA-Z0-9-]",b=[["\\s",1],["\\d",a],[_,n]],v=x=>{for(const[E,R]of b)x=x.split(`${E}*`).join(`${E}{0,${R}}`).split(`${E}+`).join(`${E}{1,${R}}`);return x},S=(x,E,R)=>{const T=v(E),j=y++;o(x,j,E),p[x]=j,f[j]=E,h[j]=T,u[j]=new RegExp(E,R?"g":void 0),d[j]=new RegExp(T,R?"g":void 0)};S("NUMERICIDENTIFIER","0|[1-9]\\d*"),S("NUMERICIDENTIFIERLOOSE","\\d+"),S("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${_}*`),S("MAINVERSION",`(${f[p.NUMERICIDENTIFIER]})\\.(${f[p.NUMERICIDENTIFIER]})\\.(${f[p.NUMERICIDENTIFIER]})`),S("MAINVERSIONLOOSE",`(${f[p.NUMERICIDENTIFIERLOOSE]})\\.(${f[p.NUMERICIDENTIFIERLOOSE]})\\.(${f[p.NUMERICIDENTIFIERLOOSE]})`),S("PRERELEASEIDENTIFIER",`(?:${f[p.NONNUMERICIDENTIFIER]}|${f[p.NUMERICIDENTIFIER]})`),S("PRERELEASEIDENTIFIERLOOSE",`(?:${f[p.NONNUMERICIDENTIFIER]}|${f[p.NUMERICIDENTIFIERLOOSE]})`),S("PRERELEASE",`(?:-(${f[p.PRERELEASEIDENTIFIER]}(?:\\.${f[p.PRERELEASEIDENTIFIER]})*))`),S("PRERELEASELOOSE",`(?:-?(${f[p.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${f[p.PRERELEASEIDENTIFIERLOOSE]})*))`),S("BUILDIDENTIFIER",`${_}+`),S("BUILD",`(?:\\+(${f[p.BUILDIDENTIFIER]}(?:\\.${f[p.BUILDIDENTIFIER]})*))`),S("FULLPLAIN",`v?${f[p.MAINVERSION]}${f[p.PRERELEASE]}?${f[p.BUILD]}?`),S("FULL",`^${f[p.FULLPLAIN]}$`),S("LOOSEPLAIN",`[v=\\s]*${f[p.MAINVERSIONLOOSE]}${f[p.PRERELEASELOOSE]}?${f[p.BUILD]}?`),S("LOOSE",`^${f[p.LOOSEPLAIN]}$`),S("GTLT","((?:<|>)?=?)"),S("XRANGEIDENTIFIERLOOSE",`${f[p.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),S("XRANGEIDENTIFIER",`${f[p.NUMERICIDENTIFIER]}|x|X|\\*`),S("XRANGEPLAIN",`[v=\\s]*(${f[p.XRANGEIDENTIFIER]})(?:\\.(${f[p.XRANGEIDENTIFIER]})(?:\\.(${f[p.XRANGEIDENTIFIER]})(?:${f[p.PRERELEASE]})?${f[p.BUILD]}?)?)?`),S("XRANGEPLAINLOOSE",`[v=\\s]*(${f[p.XRANGEIDENTIFIERLOOSE]})(?:\\.(${f[p.XRANGEIDENTIFIERLOOSE]})(?:\\.(${f[p.XRANGEIDENTIFIERLOOSE]})(?:${f[p.PRERELEASELOOSE]})?${f[p.BUILD]}?)?)?`),S("XRANGE",`^${f[p.GTLT]}\\s*${f[p.XRANGEPLAIN]}$`),S("XRANGELOOSE",`^${f[p.GTLT]}\\s*${f[p.XRANGEPLAINLOOSE]}$`),S("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),S("COERCE",`${f[p.COERCEPLAIN]}(?:$|[^\\d])`),S("COERCEFULL",f[p.COERCEPLAIN]+`(?:${f[p.PRERELEASE]})?(?:${f[p.BUILD]})?(?:$|[^\\d])`),S("COERCERTL",f[p.COERCE],!0),S("COERCERTLFULL",f[p.COERCEFULL],!0),S("LONETILDE","(?:~>?)"),S("TILDETRIM",`(\\s*)${f[p.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",S("TILDE",`^${f[p.LONETILDE]}${f[p.XRANGEPLAIN]}$`),S("TILDELOOSE",`^${f[p.LONETILDE]}${f[p.XRANGEPLAINLOOSE]}$`),S("LONECARET","(?:\\^)"),S("CARETTRIM",`(\\s*)${f[p.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",S("CARET",`^${f[p.LONECARET]}${f[p.XRANGEPLAIN]}$`),S("CARETLOOSE",`^${f[p.LONECARET]}${f[p.XRANGEPLAINLOOSE]}$`),S("COMPARATORLOOSE",`^${f[p.GTLT]}\\s*(${f[p.LOOSEPLAIN]})$|^$`),S("COMPARATOR",`^${f[p.GTLT]}\\s*(${f[p.FULLPLAIN]})$|^$`),S("COMPARATORTRIM",`(\\s*)${f[p.GTLT]}\\s*(${f[p.LOOSEPLAIN]}|${f[p.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",S("HYPHENRANGE",`^\\s*(${f[p.XRANGEPLAIN]})\\s+-\\s+(${f[p.XRANGEPLAIN]})\\s*$`),S("HYPHENRANGELOOSE",`^\\s*(${f[p.XRANGEPLAINLOOSE]})\\s+-\\s+(${f[p.XRANGEPLAINLOOSE]})\\s*$`),S("STAR","(<|>)?=?\\s*\\*"),S("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),S("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(jc,jc.exports)),jc.exports}var hp,DS;function Zy(){if(DS)return hp;DS=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return hp=n=>n?typeof n!="object"?r:n:e,hp}var mp,US;function F1(){if(US)return mp;US=1;const r=/^[0-9]+$/,e=(n,a)=>{const o=r.test(n),u=r.test(a);return o&&u&&(n=+n,a=+a),n===a?0:o&&!u?-1:u&&!o?1:n<a?-1:1};return mp={compareIdentifiers:e,rcompareIdentifiers:(n,a)=>e(a,n)},mp}var pp,zS;function tn(){if(zS)return pp;zS=1;const r=cf(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=uf(),{safeRe:n,t:a}=Xl(),o=Zy(),{compareIdentifiers:u}=F1();class d{constructor(h,p){if(p=o(p),h instanceof d){if(h.loose===!!p.loose&&h.includePrerelease===!!p.includePrerelease)return h;h=h.version}else if(typeof h!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof h}".`);if(h.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",h,p),this.options=p,this.loose=!!p.loose,this.includePrerelease=!!p.includePrerelease;const y=h.trim().match(p.loose?n[a.LOOSE]:n[a.FULL]);if(!y)throw new TypeError(`Invalid Version: ${h}`);if(this.raw=h,this.major=+y[1],this.minor=+y[2],this.patch=+y[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");y[4]?this.prerelease=y[4].split(".").map(_=>{if(/^[0-9]+$/.test(_)){const b=+_;if(b>=0&&b<t)return b}return _}):this.prerelease=[],this.build=y[5]?y[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(h){if(r("SemVer.compare",this.version,this.options,h),!(h instanceof d)){if(typeof h=="string"&&h===this.version)return 0;h=new d(h,this.options)}return h.version===this.version?0:this.compareMain(h)||this.comparePre(h)}compareMain(h){return h instanceof d||(h=new d(h,this.options)),u(this.major,h.major)||u(this.minor,h.minor)||u(this.patch,h.patch)}comparePre(h){if(h instanceof d||(h=new d(h,this.options)),this.prerelease.length&&!h.prerelease.length)return-1;if(!this.prerelease.length&&h.prerelease.length)return 1;if(!this.prerelease.length&&!h.prerelease.length)return 0;let p=0;do{const y=this.prerelease[p],_=h.prerelease[p];if(r("prerelease compare",p,y,_),y===void 0&&_===void 0)return 0;if(_===void 0)return 1;if(y===void 0)return-1;if(y===_)continue;return u(y,_)}while(++p)}compareBuild(h){h instanceof d||(h=new d(h,this.options));let p=0;do{const y=this.build[p],_=h.build[p];if(r("build compare",p,y,_),y===void 0&&_===void 0)return 0;if(_===void 0)return 1;if(y===void 0)return-1;if(y===_)continue;return u(y,_)}while(++p)}inc(h,p,y){if(h.startsWith("pre")){if(!p&&y===!1)throw new Error("invalid increment argument: identifier is empty");if(p){const _=`-${p}`.match(this.options.loose?n[a.PRERELEASELOOSE]:n[a.PRERELEASE]);if(!_||_[1]!==p)throw new Error(`invalid identifier: ${p}`)}}switch(h){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",p,y);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",p,y);break;case"prepatch":this.prerelease.length=0,this.inc("patch",p,y),this.inc("pre",p,y);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",p,y),this.inc("pre",p,y);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const _=Number(y)?1:0;if(this.prerelease.length===0)this.prerelease=[_];else{let b=this.prerelease.length;for(;--b>=0;)typeof this.prerelease[b]=="number"&&(this.prerelease[b]++,b=-2);if(b===-1){if(p===this.prerelease.join(".")&&y===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(_)}}if(p){let b=[p,_];y===!1&&(b=[p]),u(this.prerelease[0],p)===0?isNaN(this.prerelease[1])&&(this.prerelease=b):this.prerelease=b}break}default:throw new Error(`invalid increment argument: ${h}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return pp=d,pp}var gp,BS;function zi(){if(BS)return gp;BS=1;const r=tn();return gp=(t,n,a=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(o){if(!a)return null;throw o}},gp}var yp,qS;function J$(){if(qS)return yp;qS=1;const r=zi();return yp=(t,n)=>{const a=r(t,n);return a?a.version:null},yp}var _p,HS;function K$(){if(HS)return _p;HS=1;const r=zi();return _p=(t,n)=>{const a=r(t.trim().replace(/^[=v]+/,""),n);return a?a.version:null},_p}var bp,GS;function Y$(){if(GS)return bp;GS=1;const r=tn();return bp=(t,n,a,o,u)=>{typeof a=="string"&&(u=o,o=a,a=void 0);try{return new r(t instanceof r?t.version:t,a).inc(n,o,u).version}catch{return null}},bp}var vp,FS;function X$(){if(FS)return vp;FS=1;const r=zi();return vp=(t,n)=>{const a=r(t,null,!0),o=r(n,null,!0),u=a.compare(o);if(u===0)return null;const d=u>0,f=d?a:o,h=d?o:a,p=!!f.prerelease.length;if(!!h.prerelease.length&&!p){if(!h.patch&&!h.minor)return"major";if(h.compareMain(f)===0)return h.minor&&!h.patch?"minor":"patch"}const _=p?"pre":"";return a.major!==o.major?_+"major":a.minor!==o.minor?_+"minor":a.patch!==o.patch?_+"patch":"prerelease"},vp}var wp,ZS;function Q$(){if(ZS)return wp;ZS=1;const r=tn();return wp=(t,n)=>new r(t,n).major,wp}var Sp,VS;function W$(){if(VS)return Sp;VS=1;const r=tn();return Sp=(t,n)=>new r(t,n).minor,Sp}var xp,JS;function eI(){if(JS)return xp;JS=1;const r=tn();return xp=(t,n)=>new r(t,n).patch,xp}var Ep,KS;function tI(){if(KS)return Ep;KS=1;const r=zi();return Ep=(t,n)=>{const a=r(t,n);return a&&a.prerelease.length?a.prerelease:null},Ep}var Ap,YS;function ur(){if(YS)return Ap;YS=1;const r=tn();return Ap=(t,n,a)=>new r(t,a).compare(new r(n,a)),Ap}var Op,XS;function nI(){if(XS)return Op;XS=1;const r=ur();return Op=(t,n,a)=>r(n,t,a),Op}var Tp,QS;function rI(){if(QS)return Tp;QS=1;const r=ur();return Tp=(t,n)=>r(t,n,!0),Tp}var Rp,WS;function Vy(){if(WS)return Rp;WS=1;const r=tn();return Rp=(t,n,a)=>{const o=new r(t,a),u=new r(n,a);return o.compare(u)||o.compareBuild(u)},Rp}var Np,ex;function aI(){if(ex)return Np;ex=1;const r=Vy();return Np=(t,n)=>t.sort((a,o)=>r(a,o,n)),Np}var Cp,tx;function sI(){if(tx)return Cp;tx=1;const r=Vy();return Cp=(t,n)=>t.sort((a,o)=>r(o,a,n)),Cp}var kp,nx;function df(){if(nx)return kp;nx=1;const r=ur();return kp=(t,n,a)=>r(t,n,a)>0,kp}var jp,rx;function Jy(){if(rx)return jp;rx=1;const r=ur();return jp=(t,n,a)=>r(t,n,a)<0,jp}var $p,ax;function Z1(){if(ax)return $p;ax=1;const r=ur();return $p=(t,n,a)=>r(t,n,a)===0,$p}var Ip,sx;function V1(){if(sx)return Ip;sx=1;const r=ur();return Ip=(t,n,a)=>r(t,n,a)!==0,Ip}var Pp,ix;function Ky(){if(ix)return Pp;ix=1;const r=ur();return Pp=(t,n,a)=>r(t,n,a)>=0,Pp}var Mp,ox;function Yy(){if(ox)return Mp;ox=1;const r=ur();return Mp=(t,n,a)=>r(t,n,a)<=0,Mp}var Lp,lx;function J1(){if(lx)return Lp;lx=1;const r=Z1(),e=V1(),t=df(),n=Ky(),a=Jy(),o=Yy();return Lp=(d,f,h,p)=>{switch(f){case"===":return typeof d=="object"&&(d=d.version),typeof h=="object"&&(h=h.version),d===h;case"!==":return typeof d=="object"&&(d=d.version),typeof h=="object"&&(h=h.version),d!==h;case"":case"=":case"==":return r(d,h,p);case"!=":return e(d,h,p);case">":return t(d,h,p);case">=":return n(d,h,p);case"<":return a(d,h,p);case"<=":return o(d,h,p);default:throw new TypeError(`Invalid operator: ${f}`)}},Lp}var Dp,ux;function iI(){if(ux)return Dp;ux=1;const r=tn(),e=zi(),{safeRe:t,t:n}=Xl();return Dp=(o,u)=>{if(o instanceof r)return o;if(typeof o=="number"&&(o=String(o)),typeof o!="string")return null;u=u||{};let d=null;if(!u.rtl)d=o.match(u.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const b=u.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let v;for(;(v=b.exec(o))&&(!d||d.index+d[0].length!==o.length);)(!d||v.index+v[0].length!==d.index+d[0].length)&&(d=v),b.lastIndex=v.index+v[1].length+v[2].length;b.lastIndex=-1}if(d===null)return null;const f=d[2],h=d[3]||"0",p=d[4]||"0",y=u.includePrerelease&&d[5]?`-${d[5]}`:"",_=u.includePrerelease&&d[6]?`+${d[6]}`:"";return e(`${f}.${h}.${p}${y}${_}`,u)},Dp}var Up,cx;function oI(){if(cx)return Up;cx=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const o=this.map.keys().next().value;this.delete(o)}this.map.set(t,n)}return this}}return Up=r,Up}var zp,dx;function cr(){if(dx)return zp;dx=1;const r=/\s+/g;class e{constructor(ee,P){if(P=a(P),ee instanceof e)return ee.loose===!!P.loose&&ee.includePrerelease===!!P.includePrerelease?ee:new e(ee.raw,P);if(ee instanceof o)return this.raw=ee.value,this.set=[[ee]],this.formatted=void 0,this;if(this.options=P,this.loose=!!P.loose,this.includePrerelease=!!P.includePrerelease,this.raw=ee.trim().replace(r," "),this.set=this.raw.split("||").map(H=>this.parseRange(H.trim())).filter(H=>H.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const H=this.set[0];if(this.set=this.set.filter(X=>!S(X[0])),this.set.length===0)this.set=[H];else if(this.set.length>1){for(const X of this.set)if(X.length===1&&x(X[0])){this.set=[X];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let ee=0;ee<this.set.length;ee++){ee>0&&(this.formatted+="||");const P=this.set[ee];for(let H=0;H<P.length;H++)H>0&&(this.formatted+=" "),this.formatted+=P[H].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(ee){const H=((this.options.includePrerelease&&b)|(this.options.loose&&v))+":"+ee,X=n.get(H);if(X)return X;const ne=this.options.loose,N=ne?f[h.HYPHENRANGELOOSE]:f[h.HYPHENRANGE];ee=ee.replace(N,Ge(this.options.includePrerelease)),u("hyphen replace",ee),ee=ee.replace(f[h.COMPARATORTRIM],p),u("comparator trim",ee),ee=ee.replace(f[h.TILDETRIM],y),u("tilde trim",ee),ee=ee.replace(f[h.CARETTRIM],_),u("caret trim",ee);let B=ee.split(" ").map(he=>R(he,this.options)).join(" ").split(/\s+/).map(he=>Se(he,this.options));ne&&(B=B.filter(he=>(u("loose invalid filter",he,this.options),!!he.match(f[h.COMPARATORLOOSE])))),u("range list",B);const K=new Map,Q=B.map(he=>new o(he,this.options));for(const he of Q){if(S(he))return[he];K.set(he.value,he)}K.size>1&&K.has("")&&K.delete("");const ie=[...K.values()];return n.set(H,ie),ie}intersects(ee,P){if(!(ee instanceof e))throw new TypeError("a Range is required");return this.set.some(H=>E(H,P)&&ee.set.some(X=>E(X,P)&&H.every(ne=>X.every(N=>ne.intersects(N,P)))))}test(ee){if(!ee)return!1;if(typeof ee=="string")try{ee=new d(ee,this.options)}catch{return!1}for(let P=0;P<this.set.length;P++)if(At(this.set[P],ee,this.options))return!0;return!1}}zp=e;const t=oI(),n=new t,a=Zy(),o=ff(),u=cf(),d=tn(),{safeRe:f,t:h,comparatorTrimReplace:p,tildeTrimReplace:y,caretTrimReplace:_}=Xl(),{FLAG_INCLUDE_PRERELEASE:b,FLAG_LOOSE:v}=uf(),S=re=>re.value==="<0.0.0-0",x=re=>re.value==="",E=(re,ee)=>{let P=!0;const H=re.slice();let X=H.pop();for(;P&&H.length;)P=H.every(ne=>X.intersects(ne,ee)),X=H.pop();return P},R=(re,ee)=>(u("comp",re,ee),re=q(re,ee),u("caret",re),re=j(re,ee),u("tildes",re),re=Y(re,ee),u("xrange",re),re=$e(re,ee),u("stars",re),re),T=re=>!re||re.toLowerCase()==="x"||re==="*",j=(re,ee)=>re.trim().split(/\s+/).map(P=>$(P,ee)).join(" "),$=(re,ee)=>{const P=ee.loose?f[h.TILDELOOSE]:f[h.TILDE];return re.replace(P,(H,X,ne,N,B)=>{u("tilde",re,H,X,ne,N,B);let K;return T(X)?K="":T(ne)?K=`>=${X}.0.0 <${+X+1}.0.0-0`:T(N)?K=`>=${X}.${ne}.0 <${X}.${+ne+1}.0-0`:B?(u("replaceTilde pr",B),K=`>=${X}.${ne}.${N}-${B} <${X}.${+ne+1}.0-0`):K=`>=${X}.${ne}.${N} <${X}.${+ne+1}.0-0`,u("tilde return",K),K})},q=(re,ee)=>re.trim().split(/\s+/).map(P=>Z(P,ee)).join(" "),Z=(re,ee)=>{u("caret",re,ee);const P=ee.loose?f[h.CARETLOOSE]:f[h.CARET],H=ee.includePrerelease?"-0":"";return re.replace(P,(X,ne,N,B,K)=>{u("caret",re,X,ne,N,B,K);let Q;return T(ne)?Q="":T(N)?Q=`>=${ne}.0.0${H} <${+ne+1}.0.0-0`:T(B)?ne==="0"?Q=`>=${ne}.${N}.0${H} <${ne}.${+N+1}.0-0`:Q=`>=${ne}.${N}.0${H} <${+ne+1}.0.0-0`:K?(u("replaceCaret pr",K),ne==="0"?N==="0"?Q=`>=${ne}.${N}.${B}-${K} <${ne}.${N}.${+B+1}-0`:Q=`>=${ne}.${N}.${B}-${K} <${ne}.${+N+1}.0-0`:Q=`>=${ne}.${N}.${B}-${K} <${+ne+1}.0.0-0`):(u("no pr"),ne==="0"?N==="0"?Q=`>=${ne}.${N}.${B}${H} <${ne}.${N}.${+B+1}-0`:Q=`>=${ne}.${N}.${B}${H} <${ne}.${+N+1}.0-0`:Q=`>=${ne}.${N}.${B} <${+ne+1}.0.0-0`),u("caret return",Q),Q})},Y=(re,ee)=>(u("replaceXRanges",re,ee),re.split(/\s+/).map(P=>oe(P,ee)).join(" ")),oe=(re,ee)=>{re=re.trim();const P=ee.loose?f[h.XRANGELOOSE]:f[h.XRANGE];return re.replace(P,(H,X,ne,N,B,K)=>{u("xRange",re,H,X,ne,N,B,K);const Q=T(ne),ie=Q||T(N),he=ie||T(B),pe=he;return X==="="&&pe&&(X=""),K=ee.includePrerelease?"-0":"",Q?X===">"||X==="<"?H="<0.0.0-0":H="*":X&&pe?(ie&&(N=0),B=0,X===">"?(X=">=",ie?(ne=+ne+1,N=0,B=0):(N=+N+1,B=0)):X==="<="&&(X="<",ie?ne=+ne+1:N=+N+1),X==="<"&&(K="-0"),H=`${X+ne}.${N}.${B}${K}`):ie?H=`>=${ne}.0.0${K} <${+ne+1}.0.0-0`:he&&(H=`>=${ne}.${N}.0${K} <${ne}.${+N+1}.0-0`),u("xRange return",H),H})},$e=(re,ee)=>(u("replaceStars",re,ee),re.trim().replace(f[h.STAR],"")),Se=(re,ee)=>(u("replaceGTE0",re,ee),re.trim().replace(f[ee.includePrerelease?h.GTE0PRE:h.GTE0],"")),Ge=re=>(ee,P,H,X,ne,N,B,K,Q,ie,he,pe)=>(T(H)?P="":T(X)?P=`>=${H}.0.0${re?"-0":""}`:T(ne)?P=`>=${H}.${X}.0${re?"-0":""}`:N?P=`>=${P}`:P=`>=${P}${re?"-0":""}`,T(Q)?K="":T(ie)?K=`<${+Q+1}.0.0-0`:T(he)?K=`<${Q}.${+ie+1}.0-0`:pe?K=`<=${Q}.${ie}.${he}-${pe}`:re?K=`<${Q}.${ie}.${+he+1}-0`:K=`<=${K}`,`${P} ${K}`.trim()),At=(re,ee,P)=>{for(let H=0;H<re.length;H++)if(!re[H].test(ee))return!1;if(ee.prerelease.length&&!P.includePrerelease){for(let H=0;H<re.length;H++)if(u(re[H].semver),re[H].semver!==o.ANY&&re[H].semver.prerelease.length>0){const X=re[H].semver;if(X.major===ee.major&&X.minor===ee.minor&&X.patch===ee.patch)return!0}return!1}return!0};return zp}var Bp,fx;function ff(){if(fx)return Bp;fx=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(p,y){if(y=t(y),p instanceof e){if(p.loose===!!y.loose)return p;p=p.value}p=p.trim().split(/\s+/).join(" "),u("comparator",p,y),this.options=y,this.loose=!!y.loose,this.parse(p),this.semver===r?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(p){const y=this.options.loose?n[a.COMPARATORLOOSE]:n[a.COMPARATOR],_=p.match(y);if(!_)throw new TypeError(`Invalid comparator: ${p}`);this.operator=_[1]!==void 0?_[1]:"",this.operator==="="&&(this.operator=""),_[2]?this.semver=new d(_[2],this.options.loose):this.semver=r}toString(){return this.value}test(p){if(u("Comparator.test",p,this.options.loose),this.semver===r||p===r)return!0;if(typeof p=="string")try{p=new d(p,this.options)}catch{return!1}return o(p,this.operator,this.semver,this.options)}intersects(p,y){if(!(p instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new f(p.value,y).test(this.value):p.operator===""?p.value===""?!0:new f(this.value,y).test(p.semver):(y=t(y),y.includePrerelease&&(this.value==="<0.0.0-0"||p.value==="<0.0.0-0")||!y.includePrerelease&&(this.value.startsWith("<0.0.0")||p.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&p.operator.startsWith(">")||this.operator.startsWith("<")&&p.operator.startsWith("<")||this.semver.version===p.semver.version&&this.operator.includes("=")&&p.operator.includes("=")||o(this.semver,"<",p.semver,y)&&this.operator.startsWith(">")&&p.operator.startsWith("<")||o(this.semver,">",p.semver,y)&&this.operator.startsWith("<")&&p.operator.startsWith(">")))}}Bp=e;const t=Zy(),{safeRe:n,t:a}=Xl(),o=J1(),u=cf(),d=tn(),f=cr();return Bp}var qp,hx;function hf(){if(hx)return qp;hx=1;const r=cr();return qp=(t,n,a)=>{try{n=new r(n,a)}catch{return!1}return n.test(t)},qp}var Hp,mx;function lI(){if(mx)return Hp;mx=1;const r=cr();return Hp=(t,n)=>new r(t,n).set.map(a=>a.map(o=>o.value).join(" ").trim().split(" ")),Hp}var Gp,px;function uI(){if(px)return Gp;px=1;const r=tn(),e=cr();return Gp=(n,a,o)=>{let u=null,d=null,f=null;try{f=new e(a,o)}catch{return null}return n.forEach(h=>{f.test(h)&&(!u||d.compare(h)===-1)&&(u=h,d=new r(u,o))}),u},Gp}var Fp,gx;function cI(){if(gx)return Fp;gx=1;const r=tn(),e=cr();return Fp=(n,a,o)=>{let u=null,d=null,f=null;try{f=new e(a,o)}catch{return null}return n.forEach(h=>{f.test(h)&&(!u||d.compare(h)===1)&&(u=h,d=new r(u,o))}),u},Fp}var Zp,yx;function dI(){if(yx)return Zp;yx=1;const r=tn(),e=cr(),t=df();return Zp=(a,o)=>{a=new e(a,o);let u=new r("0.0.0");if(a.test(u)||(u=new r("0.0.0-0"),a.test(u)))return u;u=null;for(let d=0;d<a.set.length;++d){const f=a.set[d];let h=null;f.forEach(p=>{const y=new r(p.semver.version);switch(p.operator){case">":y.prerelease.length===0?y.patch++:y.prerelease.push(0),y.raw=y.format();case"":case">=":(!h||t(y,h))&&(h=y);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${p.operator}`)}}),h&&(!u||t(u,h))&&(u=h)}return u&&a.test(u)?u:null},Zp}var Vp,_x;function fI(){if(_x)return Vp;_x=1;const r=cr();return Vp=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},Vp}var Jp,bx;function Xy(){if(bx)return Jp;bx=1;const r=tn(),e=ff(),{ANY:t}=e,n=cr(),a=hf(),o=df(),u=Jy(),d=Yy(),f=Ky();return Jp=(p,y,_,b)=>{p=new r(p,b),y=new n(y,b);let v,S,x,E,R;switch(_){case">":v=o,S=d,x=u,E=">",R=">=";break;case"<":v=u,S=f,x=o,E="<",R="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(p,y,b))return!1;for(let T=0;T<y.set.length;++T){const j=y.set[T];let $=null,q=null;if(j.forEach(Z=>{Z.semver===t&&(Z=new e(">=0.0.0")),$=$||Z,q=q||Z,v(Z.semver,$.semver,b)?$=Z:x(Z.semver,q.semver,b)&&(q=Z)}),$.operator===E||$.operator===R||(!q.operator||q.operator===E)&&S(p,q.semver))return!1;if(q.operator===R&&x(p,q.semver))return!1}return!0},Jp}var Kp,vx;function hI(){if(vx)return Kp;vx=1;const r=Xy();return Kp=(t,n,a)=>r(t,n,">",a),Kp}var Yp,wx;function mI(){if(wx)return Yp;wx=1;const r=Xy();return Yp=(t,n,a)=>r(t,n,"<",a),Yp}var Xp,Sx;function pI(){if(Sx)return Xp;Sx=1;const r=cr();return Xp=(t,n,a)=>(t=new r(t,a),n=new r(n,a),t.intersects(n,a)),Xp}var Qp,xx;function gI(){if(xx)return Qp;xx=1;const r=hf(),e=ur();return Qp=(t,n,a)=>{const o=[];let u=null,d=null;const f=t.sort((_,b)=>e(_,b,a));for(const _ of f)r(_,n,a)?(d=_,u||(u=_)):(d&&o.push([u,d]),d=null,u=null);u&&o.push([u,null]);const h=[];for(const[_,b]of o)_===b?h.push(_):!b&&_===f[0]?h.push("*"):b?_===f[0]?h.push(`<=${b}`):h.push(`${_} - ${b}`):h.push(`>=${_}`);const p=h.join(" || "),y=typeof n.raw=="string"?n.raw:String(n);return p.length<y.length?p:n},Qp}var Wp,Ex;function yI(){if(Ex)return Wp;Ex=1;const r=cr(),e=ff(),{ANY:t}=e,n=hf(),a=ur(),o=(y,_,b={})=>{if(y===_)return!0;y=new r(y,b),_=new r(_,b);let v=!1;e:for(const S of y.set){for(const x of _.set){const E=f(S,x,b);if(v=v||E!==null,E)continue e}if(v)return!1}return!0},u=[new e(">=0.0.0-0")],d=[new e(">=0.0.0")],f=(y,_,b)=>{if(y===_)return!0;if(y.length===1&&y[0].semver===t){if(_.length===1&&_[0].semver===t)return!0;b.includePrerelease?y=u:y=d}if(_.length===1&&_[0].semver===t){if(b.includePrerelease)return!0;_=d}const v=new Set;let S,x;for(const Y of y)Y.operator===">"||Y.operator===">="?S=h(S,Y,b):Y.operator==="<"||Y.operator==="<="?x=p(x,Y,b):v.add(Y.semver);if(v.size>1)return null;let E;if(S&&x){if(E=a(S.semver,x.semver,b),E>0)return null;if(E===0&&(S.operator!==">="||x.operator!=="<="))return null}for(const Y of v){if(S&&!n(Y,String(S),b)||x&&!n(Y,String(x),b))return null;for(const oe of _)if(!n(Y,String(oe),b))return!1;return!0}let R,T,j,$,q=x&&!b.includePrerelease&&x.semver.prerelease.length?x.semver:!1,Z=S&&!b.includePrerelease&&S.semver.prerelease.length?S.semver:!1;q&&q.prerelease.length===1&&x.operator==="<"&&q.prerelease[0]===0&&(q=!1);for(const Y of _){if($=$||Y.operator===">"||Y.operator===">=",j=j||Y.operator==="<"||Y.operator==="<=",S){if(Z&&Y.semver.prerelease&&Y.semver.prerelease.length&&Y.semver.major===Z.major&&Y.semver.minor===Z.minor&&Y.semver.patch===Z.patch&&(Z=!1),Y.operator===">"||Y.operator===">="){if(R=h(S,Y,b),R===Y&&R!==S)return!1}else if(S.operator===">="&&!n(S.semver,String(Y),b))return!1}if(x){if(q&&Y.semver.prerelease&&Y.semver.prerelease.length&&Y.semver.major===q.major&&Y.semver.minor===q.minor&&Y.semver.patch===q.patch&&(q=!1),Y.operator==="<"||Y.operator==="<="){if(T=p(x,Y,b),T===Y&&T!==x)return!1}else if(x.operator==="<="&&!n(x.semver,String(Y),b))return!1}if(!Y.operator&&(x||S)&&E!==0)return!1}return!(S&&j&&!x&&E!==0||x&&$&&!S&&E!==0||Z||q)},h=(y,_,b)=>{if(!y)return _;const v=a(y.semver,_.semver,b);return v>0?y:v<0||_.operator===">"&&y.operator===">="?_:y},p=(y,_,b)=>{if(!y)return _;const v=a(y.semver,_.semver,b);return v<0?y:v>0||_.operator==="<"&&y.operator==="<="?_:y};return Wp=o,Wp}var eg,Ax;function _I(){if(Ax)return eg;Ax=1;const r=Xl(),e=uf(),t=tn(),n=F1(),a=zi(),o=J$(),u=K$(),d=Y$(),f=X$(),h=Q$(),p=W$(),y=eI(),_=tI(),b=ur(),v=nI(),S=rI(),x=Vy(),E=aI(),R=sI(),T=df(),j=Jy(),$=Z1(),q=V1(),Z=Ky(),Y=Yy(),oe=J1(),$e=iI(),Se=ff(),Ge=cr(),At=hf(),re=lI(),ee=uI(),P=cI(),H=dI(),X=fI(),ne=Xy(),N=hI(),B=mI(),K=pI(),Q=gI(),ie=yI();return eg={parse:a,valid:o,clean:u,inc:d,diff:f,major:h,minor:p,patch:y,prerelease:_,compare:b,rcompare:v,compareLoose:S,compareBuild:x,sort:E,rsort:R,gt:T,lt:j,eq:$,neq:q,gte:Z,lte:Y,cmp:oe,coerce:$e,Comparator:Se,Range:Ge,satisfies:At,toComparators:re,maxSatisfying:ee,minSatisfying:P,minVersion:H,validRange:X,outside:ne,gtr:N,ltr:B,intersects:K,simplifyRange:Q,subset:ie,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},eg}_I();function Ta(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[a,o]=e.split("/",2);if(!a||!o)throw new Error(`Invalid identifier format: ${r}`);return[a,o,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class bI extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function Re(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}n=await r.text();const a=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;if(r.status===409)throw new bI(a);const o=new Error(a);throw o.status=r.status,o}const K1="ERR_CONFLICTING_ENDPOINTS";class vI extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:K1}),this.name="ConflictingEndpointsError"}}function wI(r){return typeof r=="object"&&r!==null&&r.code===K1}var Ox="[...]",SI={result:"[Circular]"},Pd=[],xi=[];const xI=new TextEncoder;function EI(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function $c(r){return xI.encode(r)}function Y1(r){if(r&&typeof r=="object"&&r!==null){if(r instanceof Map)return Object.fromEntries(r);if(r instanceof Set)return Array.from(r);if(r instanceof Date)return r.toISOString();if(r instanceof RegExp)return r.toString();if(r instanceof Error)return{name:r.name,message:r.message}}else if(typeof r=="bigint")return r.toString();return r}function AI(r){return function(e,t){return Y1(t)}}function An(r,e,t,n,a){var o;try{const u=JSON.stringify(r,AI(t),n);return $c(u)}catch(u){if(!((o=u.message)!=null&&o.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),$c("[Unserializable]");Fn("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof a>"u"&&(a=EI()),ty(r,"",0,[],void 0,0,a);let d;try{xi.length===0?d=JSON.stringify(r,t,n):d=JSON.stringify(r,OI(t),n)}catch{return $c("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Pd.length!==0;){const f=Pd.pop();f.length===4?Object.defineProperty(f[0],f[1],f[3]):f[0][f[1]]=f[2]}}return $c(d)}}function tg(r,e,t,n){var a=Object.getOwnPropertyDescriptor(n,t);a.get!==void 0?a.configurable?(Object.defineProperty(n,t,{value:r}),Pd.push([n,t,e,a])):xi.push([e,t,r]):(n[t]=r,Pd.push([n,t,e]))}function ty(r,e,t,n,a,o,u){o+=1;var d;if(typeof r=="object"&&r!==null){for(d=0;d<n.length;d++)if(n[d]===r){tg(SI,r,e,a);return}if(typeof u.depthLimit<"u"&&o>u.depthLimit){tg(Ox,r,e,a);return}if(typeof u.edgesLimit<"u"&&t+1>u.edgesLimit){tg(Ox,r,e,a);return}if(n.push(r),Array.isArray(r))for(d=0;d<r.length;d++)ty(r[d],d,d,n,r,o,u);else{r=Y1(r);var f=Object.keys(r);for(d=0;d<f.length;d++){var h=f[d];ty(r[h],h,d,n,r,o,u)}}n.pop()}}function OI(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(xi.length>0)for(var n=0;n<xi.length;n++){var a=xi[n];if(a[1]===e&&a[0]===t){t=a[2],xi.splice(n,1);break}}return r.call(this,e,t)}}function Tx(r){const e=q1(),t=E$(),n=r.extra??{},a=n.metadata;return r.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...a}},r}const TI=r=>{const e=(r==null?void 0:r.toString())??Fn("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},RI=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function NI(r){const e=[];for await(const t of r)e.push(t);return e}function ng(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const CI=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function Rx(r){return typeof r=="number"?Number(r.toFixed(4)):r}class kI{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(o=>{t=o}),a=An(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:a}),this.sizeBytes+=a,n}pop(e){var a;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(((a=this.peek())==null?void 0:a.size)??0)<e&&this.items.length>0;){const o=this.items.shift();o&&(t.push(o),n+=o.size,this.sizeBytes-=o.size)}if(t.length===0&&this.items.length>0){const o=this.items.shift();t.push(o),n+=o.size,this.sizeBytes-=o.size}return[t.map(o=>({action:o.action,item:o.payload,otelContext:o.otelContext,apiKey:o.apiKey,apiUrl:o.apiUrl})),()=>t.forEach(o=>o.itemPromiseResolve())]}}const jI=20971520,$I=2500,Nx="https://api.smith.langchain.com";class Ul{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new kI}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:ar("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:ar("LANGSMITH_DEBUG")==="true"});const t=Ul.getDefaultClientConfig();if(this.tracingSampleRate=TI(e.tracingSamplingRate),this.apiUrl=ng(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=ng(e.apiKey??t.apiKey),this.webUrl=ng(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new kS({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new kS({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:CI,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,ar("OTEL_ENABLED")==="true"&&(this.langSmithToOTELTranslator=new L$)}static getDefaultClientConfig(){const e=Fn("API_KEY"),t=Fn("ENDPOINT")??Nx,n=Fn("HIDE_INPUTS")==="true",a=Fn("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:RI(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${z1}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",a=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(fe(this.debug),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(o,`Failed to fetch ${e}`),o}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let a=Number(t.get("offset"))||0;const o=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(o));const u=`${this.apiUrl}${e}?${t}`,d=await this.caller.call(fe(this.debug),u,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(d,`Failed to fetch ${e}`);const f=n?n(await d.json()):await d.json();if(f.length===0||(yield f,f.length<o))break;a+=f.length}}async*_getCursorPaginatedList(e,t=null,n="POST",a="runs"){const o=t?{...t}:{};for(;;){const d=await(await this.caller.call(fe(this.debug),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(o)})).json();if(!d||!d[a])break;yield d[a];const f=d.cursors;if(!f||!f.next)break;o.cursor=f.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const a of e)this.filteredPostUuids.has(a.id)?this.filteredPostUuids.delete(a.id):n.push(a);return n}else{const n=[];for(const a of e){const o=a.trace_id??a.id;this.filteredPostUuids.has(o)||(a.id===o?this._shouldSample()?n.push(a):this.filteredPostUuids.add(o):n.push(a))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??jI}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,a]=this.autoBatchQueue.pop(e);if(!n.length){a();break}const o=n.reduce((f,h)=>{const p=h.apiUrl??this.apiUrl,y=h.apiKey??this.apiKey,b=h.apiKey===this.apiKey&&h.apiUrl===this.apiUrl?"default":`${p}|${y}`;return f[b]||(f[b]=[]),f[b].push(h),f},{}),u=[];for(const[f,h]of Object.entries(o)){const p=this._processBatch(h,{apiUrl:f==="default"?void 0:f.split("|")[0],apiKey:f==="default"?void 0:f.split("|")[1]});u.push(p)}const d=Promise.all(u).finally(a);t.push(d)}return Promise.all(t)}async _processBatch(e,t){var n;if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{const a={runCreates:e.filter(u=>u.action==="create").map(u=>u.item),runUpdates:e.filter(u=>u.action==="update").map(u=>u.item)},o=await this._ensureServerInfo();(n=o==null?void 0:o.batch_ingest_config)!=null&&n.use_multipart_endpoint?await this.multipartIngestRuns(a,t):await this.batchIngestRuns(a,t)}}catch(a){console.error("Error exporting batch:",a)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){const t=new Map,n=[];for(const a of e)a.item.id&&a.otelContext&&(t.set(a.item.id,a.otelContext),a.action==="create"?n.push({operation:"post",id:a.item.id,trace_id:a.item.trace_id??a.item.id,run:a.item}):n.push({operation:"patch",id:a.item.id,trace_id:a.item.trace_id??a.item.id,run:a.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Tx(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await this.caller.call(fe(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout($I),...this.fetchOptions});await Re(e,"get server info");const t=await e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}_cloneCurrentOTELContext(){const e=H1(),t=$$();if(this.langSmithToOTELTranslator!==void 0){const n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},a=e.project_name;delete e.project_name;const o=await this.prepareRunCreateOrUpdateInputs({session_name:a,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&o.trace_id!==void 0&&o.dotted_order!==void 0){const f=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:o,otelContext:f,apiKey:t==null?void 0:t.apiKey,apiUrl:t==null?void 0:t.apiUrl}).catch(console.error);return}const u=Tx(o);(t==null?void 0:t.apiKey)!==void 0&&(n["x-api-key"]=t.apiKey);const d=await this.caller.call(fe(this.debug),`${(t==null?void 0:t.apiUrl)??this.apiUrl}/runs`,{method:"POST",headers:n,body:An(u,`Creating run with id: ${u.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(d,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let a=await Promise.all((e==null?void 0:e.map(f=>this.prepareRunCreateOrUpdateInputs(f)))??[]),o=await Promise.all((t==null?void 0:t.map(f=>this.prepareRunCreateOrUpdateInputs(f)))??[]);if(a.length>0&&o.length>0){const f=a.reduce((p,y)=>(y.id&&(p[y.id]=y),p),{}),h=[];for(const p of o)p.id!==void 0&&f[p.id]?f[p.id]={...f[p.id],...p}:h.push(p);a=Object.values(f),o=h}const u={post:a,patch:o};if(!u.post.length&&!u.patch.length)return;const d={post:[],patch:[]};for(const f of["post","patch"]){const h=f,p=u[h].reverse();let y=p.pop();for(;y!==void 0;)d[h].push(y),y=p.pop()}if(d.post.length>0||d.patch.length>0){const f=d.post.map(h=>h.id).concat(d.patch.map(h=>h.id)).join(",");await this._postBatchIngestRuns(An(d,`Ingesting runs with ids: ${f}`),n)}}async _postBatchIngestRuns(e,t){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};(t==null?void 0:t.apiKey)!==void 0&&(n["x-api-key"]=t.apiKey);const a=await this.batchIngestCaller.call(fe(this.debug),`${(t==null?void 0:t.apiUrl)??this.apiUrl}/runs/batch`,{method:"POST",headers:n,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(a,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;const a={};let o=[];for(const y of e??[]){const _=await this.prepareRunCreateOrUpdateInputs(y);_.id!==void 0&&_.attachments!==void 0&&(a[_.id]=_.attachments),delete _.attachments,o.push(_)}let u=[];for(const y of t??[])u.push(await this.prepareRunCreateOrUpdateInputs(y));if(o.find(y=>y.trace_id===void 0||y.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(u.find(y=>y.trace_id===void 0||y.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(o.length>0&&u.length>0){const y=o.reduce((b,v)=>(v.id&&(b[v.id]=v),b),{}),_=[];for(const b of u)b.id!==void 0&&y[b.id]?y[b.id]={...y[b.id],...b}:_.push(b);o=Object.values(y),u=_}if(o.length===0&&u.length===0)return;const h=[],p=[];for(const[y,_]of[["post",o],["patch",u]])for(const b of _){const{inputs:v,outputs:S,events:x,attachments:E,...R}=b,T={inputs:v,outputs:S,events:x},j=An(R,`Serializing for multipart ingestion of run with id: ${R.id}`);p.push({name:`${y}.${R.id}`,payload:new Blob([j],{type:`application/json; length=${j.length}`})});for(const[$,q]of Object.entries(T)){if(q===void 0)continue;const Z=An(q,`Serializing ${$} for multipart ingestion of run with id: ${R.id}`);p.push({name:`${y}.${R.id}.${$}`,payload:new Blob([Z],{type:`application/json; length=${Z.length}`})})}if(R.id!==void 0){const $=a[R.id];if($){delete a[R.id];for(const[q,Z]of Object.entries($)){let Y,oe;if(Array.isArray(Z)?[Y,oe]=Z:(Y=Z.mimeType,oe=Z.data),q.includes(".")){console.warn(`Skipping attachment '${q}' for run ${R.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}p.push({name:`attachment.${R.id}.${q}`,payload:new Blob([oe],{type:`${Y}; length=${oe.byteLength}`})})}}}h.push(`trace=${R.trace_id},id=${R.id}`)}await this._sendMultipartRequest(p,h.join("; "),n)}async _createNodeFetchBody(e,t){const n=[];for(const u of e)n.push(new Blob([`--${t}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${u.name}"\r
`,`Content-Type: ${u.payload.type}\r
\r
`])),n.push(u.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${t}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,t){const n=new TextEncoder;return new ReadableStream({async start(o){const u=async d=>{typeof d=="string"?o.enqueue(n.encode(d)):o.enqueue(d)};for(const d of e){await u(`--${t}\r
`),await u(`Content-Disposition: form-data; name="${d.name}"\r
`),await u(`Content-Type: ${d.payload.type}\r
\r
`);const h=d.payload.stream().getReader();try{let p;for(;!(p=await h.read()).done;)o.enqueue(p.value)}finally{h.releaseLock()}await u(`\r
`)}await u(`--${t}--\r
`),o.close()}})}async _sendMultipartRequest(e,t,n){const a="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),o=_$(),u=()=>this._createNodeFetchBody(e,a),d=()=>this._createMultipartStream(e,a),f=async h=>{const p={...this.headers,"Content-Type":`multipart/form-data; boundary=${a}`};return(n==null?void 0:n.apiKey)!==void 0&&(p["x-api-key"]=n.apiKey),this.batchIngestCaller.call(fe(this.debug),`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/multipart`,{method:"POST",headers:p,body:h,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})};try{let h,p=!1;!o&&!this.multipartStreamingDisabled?(p=!0,h=await f(await d())):h=await f(await u()),(!this.multipartStreamingDisabled||p)&&h.status===422&&((n==null?void 0:n.apiUrl)??this.apiUrl)!==Nx&&(console.warn(`Streaming multipart upload to ${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,h=await f(await u())),await Re(h,"ingest multipart runs",!0)}catch(h){console.warn(`${h.message.trim()}

Context: ${t}`)}}async updateRun(e,t,n){Oe(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const a={...t,id:e};if(!this._filterForSampling([a],!0).length)return;if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){const d=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&a.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:a,otelContext:d,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:a,otelContext:d,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}const o={...this.headers,"Content-Type":"application/json"};(n==null?void 0:n.apiKey)!==void 0&&(o["x-api-key"]=n.apiKey);const u=await this.caller.call(fe(this.debug),`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:o,body:An(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(u,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Oe(e);let n=await this._get(`/runs/${e}`);return t&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let a;t.session_id?a=t.session_id:n!=null&&n.projectName?a=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?a=n==null?void 0:n.projectId:a=(await this.readProject({projectName:Fn("PROJECT")||"default"})).id;const o=await this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var o;const t=await NI(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},a={};t.sort((u,d)=>((u==null?void 0:u.dotted_order)??"").localeCompare((d==null?void 0:d.dotted_order)??""));for(const u of t){if(u.parent_run_id===null||u.parent_run_id===void 0)throw new Error(`Child run ${u.id} has no parent`);(o=u.dotted_order)!=null&&o.startsWith(e.dotted_order??"")&&u.id!==e.id&&(u.parent_run_id in n||(n[u.parent_run_id]=[]),n[u.parent_run_id].push(u),a[u.id]=u)}e.child_runs=n[e.id]||[];for(const u in n)u!==e.id&&(a[u].child_runs=n[u]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:a,traceId:o,referenceExampleId:u,startTime:d,executionOrder:f,isRoot:h,runType:p,error:y,id:_,query:b,filter:v,traceFilter:S,treeFilter:x,limit:E,select:R,order:T}=e;let j=[];if(t&&(j=Array.isArray(t)?t:[t]),n){const Y=Array.isArray(n)?n:[n],oe=await Promise.all(Y.map($e=>this.readProject({projectName:$e}).then(Se=>Se.id)));j.push(...oe)}const $=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],q={session:j.length?j:null,run_type:p,reference_example:u,query:b,filter:v,trace_filter:S,tree_filter:x,execution_order:f,parent_run:a,start_time:d?d.toISOString():null,error:y,id:_,limit:E,trace:o,select:R||$,is_root:h,order:T};let Z=0;for await(const Y of this._getCursorPaginatedList("/runs/query",q))if(E){if(Z>=E)break;if(Y.length+Z>E){yield*Y.slice(0,E-Z);break}Z+=Y.length,yield*Y}else yield*Y}async*listGroupRuns(e){const{projectId:t,projectName:n,groupBy:a,filter:o,startTime:u,endTime:d,limit:f,offset:h}=e,y={session_id:t||(await this.readProject({projectName:n})).id,group_by:a,filter:o,start_time:u?u.toISOString():null,end_time:d?d.toISOString():null,limit:Number(f)||100};let _=Number(h)||0;const b="/runs/group",v=`${this.apiUrl}${b}`;for(;;){const S={...y,offset:_},x=Object.fromEntries(Object.entries(S).filter(([$,q])=>q!==void 0)),E=await this.caller.call(fe(),v,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(x),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(E,`Failed to fetch ${b}`);const R=await E.json(),{groups:T,total:j}=R;if(T.length===0)break;for(const $ of T)yield $;if(_+=T.length,_>=j)break}}async getRunStats({id:e,trace:t,parentRun:n,runType:a,projectNames:o,projectIds:u,referenceExampleIds:d,startTime:f,endTime:h,error:p,query:y,filter:_,traceFilter:b,treeFilter:v,isRoot:S,dataSourceType:x}){let E=u||[];o&&(E=[...u||[],...await Promise.all(o.map(q=>this.readProject({projectName:q}).then(Z=>Z.id)))]);const T=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:a,session:E,reference_example:d,start_time:f,end_time:h,error:p,query:y,filter:_,trace_filter:b,tree_filter:v,is_root:S,data_source_type:x}).filter(([q,Z])=>Z!==void 0));return await(await this.caller.call(fe(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(T),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||_i()};Oe(e);const o=await(await this.caller.call(fe(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(o===null||!("share_token"in o))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${o.share_token}/r`}async unshareRun(e){Oe(e);const t=await this.caller.call(fe(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(t,"unshare run",!0)}async readRunSharedLink(e){Oe(e);const n=await(await this.caller.call(fe(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const u of t)n.append("id",u);return Oe(e),await(await this.caller.call(fe(this.debug),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),Oe(e);const a=await(await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};Oe(e);const o=await(await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return o.url=`${this.getHostUrl()}/public/${o.share_token}/d`,o}async unshareDataset(e){Oe(e);const t=await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(t,"unshare dataset",!0)}async readSharedDataset(e){return Oe(e),await(await this.caller.call(fe(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const a=new URLSearchParams;Object.entries(n).forEach(([d,f])=>{Array.isArray(f)?f.forEach(h=>a.append(d,h)):a.append(d,f)});const o=await this.caller.call(fe(this.debug),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),u=await o.json();if(!o.ok)throw"detail"in u?new Error(`Failed to list shared examples.
Status: ${o.status}
Message: ${Array.isArray(u.detail)?u.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${o.status} ${o.statusText}`);return u.map(d=>({...d,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:a=!1,projectExtra:o=null,referenceDatasetId:u=null}){const d=a?"?upsert=true":"",f=`${this.apiUrl}/sessions${d}`,h=o||{};n&&(h.metadata=n);const p={name:e,extra:h,description:t};u!==null&&(p.reference_dataset_id=u);const y=await this.caller.call(fe(this.debug),f,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(p),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(y,"create project"),await y.json()}async updateProject(e,{name:t=null,description:n=null,metadata:a=null,projectExtra:o=null,endTime:u=null}){const d=`${this.apiUrl}/sessions/${e}`;let f=o;a&&(f={...f||{},metadata:a});const h={name:t,extra:f,description:n,end_time:u?new Date(u).toISOString():null},p=await this.caller.call(fe(this.debug),d,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(p,"update project"),await p.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Oe(e),n+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");const o=await this.caller.call(fe(this.debug),`${this.apiUrl}${n}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const u=await o.json();return o.ok?Array.isArray(u)?u.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let a="/sessions";const o=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Oe(e),a+=`/${e}`;else if(t!==void 0)o.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&o.append("include_stats",n.toString());const u=await this._get(a,o);let d;if(Array.isArray(u)){if(u.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);d=u[0]}else d=u;return d}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:a,referenceDatasetName:o,referenceFree:u,metadata:d}={}){const f=new URLSearchParams;if(e!==void 0)for(const h of e)f.append("id",h);if(t!==void 0&&f.append("name",t),n!==void 0&&f.append("name_contains",n),a!==void 0)f.append("reference_dataset",a);else if(o!==void 0){const h=await this.readDataset({datasetName:o});f.append("reference_dataset",h.id)}u!==void 0&&f.append("reference_free",u.toString()),d!==void 0&&f.append("metadata",JSON.stringify(d));for await(const h of this._getPaginated("/sessions",f))yield*h}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,Oe(n);const a=await this.caller.call(fe(this.debug),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(a,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:a,description:o,dataType:u,name:d}){const f=`${this.apiUrl}/datasets/upload`,h=new FormData;h.append("file",e,t),n.forEach(_=>{h.append("input_keys",_)}),a.forEach(_=>{h.append("output_keys",_)}),o&&h.append("description",o),u&&h.append("data_type",u),d&&h.append("name",d);const p=await this.caller.call(fe(this.debug),f,{method:"POST",headers:this.headers,body:h,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(p,"upload CSV"),await p.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:a,outputsSchema:o,metadata:u}={}){const d={name:e,description:t,extra:u?{metadata:u}:void 0};n&&(d.data_type=n),a&&(d.inputs_schema_definition=a),o&&(d.outputs_schema_definition=o);const f=await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(f,"create dataset"),await f.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Oe(e),n+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");const o=await this._get(n,a);let u;if(Array.isArray(o)){if(o.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);u=o[0]}else u=o;return u}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:a}){let o=e;if(o===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:t})).id);const u=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${o}/versions/diff`,u)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(d=>JSON.parse(d))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:a,datasetNameContains:o,metadata:u}={}){const d="/datasets",f=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const h of n)f.append("id",h);a!==void 0&&f.append("name",a),o!==void 0&&f.append("name_contains",o),u!==void 0&&f.append("metadata",JSON.stringify(u));for await(const h of this._getPaginated(d,f))yield*h}async updateDataset(e){const{datasetId:t,datasetName:n,...a}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const o=t??(await this.readDataset({datasetName:n})).id;Oe(o);const u=await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${o}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(u,"update dataset"),await u.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:a,tag:o}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const u=t??(await this.readDataset({datasetName:n})).id;Oe(u);const d=await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${u}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof a=="string"?a:a.toISOString(),tag:o}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(d,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(await this.readDataset({datasetName:t})).id),a!==void 0)Oe(a),n+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const o=await this.caller.call(fe(this.debug),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(o,`delete ${n}`),await o.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let a=e;if(!a&&!t)throw new Error("Must provide either datasetName or datasetId");if(a&&t)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:t})).id),Oe(a);const o={tag:n},u=await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(u,"index dataset"),await u.json()}async similarExamples(e,t,n,{filter:a}={}){const o={limit:n,inputs:e};a!==void 0&&(o.filter=a),Oe(t);const u=await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(u,"fetch similar examples"),(await u.json()).examples}async createExample(e,t,n){var p;if(Cx(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let a=t?n==null?void 0:n.datasetId:e.dataset_id;const o=t?n==null?void 0:n.datasetName:e.dataset_name;if(a===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:o})).id);const u=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let d;Cx(e)?d=e:d={inputs:e,outputs:t,created_at:u==null?void 0:u.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const f=await this._uploadExamplesMultipart(a,[d]);return await this.readExample(((p=f.example_ids)==null?void 0:p[0])??_i())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const R=e;let T=R[0].dataset_id;const j=R[0].dataset_name;if(T===void 0&&j===void 0)throw new Error("Must provide either datasetName or datasetId");if(T!==void 0&&j!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");T===void 0&&(T=(await this.readDataset({datasetName:j})).id);const $=await this._uploadExamplesMultipart(T,R);return await Promise.all($.example_ids.map(Z=>this.readExample(Z)))}const{inputs:t,outputs:n,metadata:a,splits:o,sourceRunIds:u,useSourceRunIOs:d,useSourceRunAttachments:f,attachments:h,exampleIds:p,datasetId:y,datasetName:_}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let b=y;const v=_;if(b===void 0&&v===void 0)throw new Error("Must provide either datasetName or datasetId");if(b!==void 0&&v!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");b===void 0&&(b=(await this.readDataset({datasetName:v})).id);const S=t.map((R,T)=>({dataset_id:b,inputs:R,outputs:n==null?void 0:n[T],metadata:a==null?void 0:a[T],split:o==null?void 0:o[T],id:p==null?void 0:p[T],attachments:h==null?void 0:h[T],source_run_id:u==null?void 0:u[T],use_source_run_io:d==null?void 0:d[T],use_source_run_attachments:f==null?void 0:f[T]})),x=await this._uploadExamplesMultipart(b,S);return await Promise.all(x.example_ids.map(R=>this.readExample(R)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const a=e.map(u=>jS(u)?$S(u):u),o=jS(t)?$S(t):t;return this.createExample({input:a},{output:o},n)}async readExample(e){Oe(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:a,...o}=n,u=o;return a&&(u.attachments=Object.entries(a).reduce((d,[f,h])=>(d[f.slice(11)]={presigned_url:h.presigned_url,mime_type:h.mime_type},d),{})),u}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:a,splits:o,inlineS3Urls:u,metadata:d,limit:f,offset:h,filter:p,includeAttachments:y}={}){let _;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)_=e;else if(t!==void 0)_=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const b=new URLSearchParams({dataset:_}),v=a?typeof a=="string"?a:a==null?void 0:a.toISOString():void 0;v&&b.append("as_of",v);const S=u??!0;if(b.append("inline_s3_urls",S.toString()),n!==void 0)for(const E of n)b.append("id",E);if(o!==void 0)for(const E of o)b.append("splits",E);if(d!==void 0){const E=JSON.stringify(d);b.append("metadata",E)}f!==void 0&&b.append("limit",f.toString()),h!==void 0&&b.append("offset",h.toString()),p!==void 0&&b.append("filter",p),y===!0&&["attachment_urls","outputs","metadata"].forEach(E=>b.append("select",E));let x=0;for await(const E of this._getPaginated("/examples",b)){for(const R of E){const{attachment_urls:T,...j}=R,$=j;T&&($.attachments=Object.entries(T).reduce((q,[Z,Y])=>(q[Z.slice(11)]={presigned_url:Y.presigned_url,mime_type:Y.mime_type||void 0},q),{})),yield $,x++}if(f!==void 0&&x>=f)break}}async deleteExample(e){Oe(e);const t=`/examples/${e}`,n=await this.caller.call(fe(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n;t?n=e:n=e.id,Oe(n);let a;t?a={id:n,...t}:a=e;let o;return a.dataset_id!==void 0?o=a.dataset_id:o=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(o,[a])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:a}){let o;if(e?o=e:o=(await this.readDataset({datasetName:t})).id,Oe(o),n&&a||!n&&!a)throw new Error("Exactly one of asOf and tag must be specified.");const u=new URLSearchParams;n!==void 0&&u.append("as_of",typeof n=="string"?n:n.toISOString()),a!==void 0&&u.append("tag",a);const d=await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${o}/version?${u.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(d,"read dataset version"),await d.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,Oe(a);const o=new URLSearchParams,u=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return u&&o.append("as_of",u),await this._get(`/datasets/${a}/splits`,o)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:a,remove:o=!1}){let u;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?u=(await this.readDataset({datasetName:t})).id:u=e,Oe(u);const d={split_name:n,examples:a.map(h=>(Oe(h),h)),remove:o},f=await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/${u}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(f,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:a,referenceExample:o}={loadChildRuns:!1}){G1("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let u;if(typeof e=="string")u=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)u=e;else throw new Error(`Invalid run type: ${typeof e}`);u.reference_example_id!==null&&u.reference_example_id!==void 0&&(o=await this.readExample(u.reference_example_id));const d=await t.evaluateRun(u,o),[f,h]=await this._logEvaluationFeedback(d,u,n);return h[0]}async createFeedback(e,t,{score:n,value:a,correction:o,comment:u,sourceInfo:d,feedbackSourceType:f="api",sourceRunId:h,feedbackId:p,feedbackConfig:y,projectId:_,comparativeExperimentId:b}){var R;if(!e&&!_)throw new Error("One of runId or projectId must be provided");if(e&&_)throw new Error("Only one of runId or projectId can be provided");const v={type:f??"api",metadata:d??{}};h!==void 0&&(v==null?void 0:v.metadata)!==void 0&&!v.metadata.__run&&(v.metadata.__run={run_id:h}),(v==null?void 0:v.metadata)!==void 0&&((R=v.metadata.__run)==null?void 0:R.run_id)!==void 0&&Oe(v.metadata.__run.run_id);const S={id:p??_i(),run_id:e,key:t,score:Rx(n),value:a,correction:o,comment:u,feedback_source:v,comparative_experiment_id:b,feedbackConfig:y,session_id:_},x=`${this.apiUrl}/feedback`,E=await this.caller.call(fe(this.debug),x,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(S),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(E,"create feedback",!0),S}async updateFeedback(e,{score:t,value:n,correction:a,comment:o}){const u={};t!=null&&(u.score=Rx(t)),n!=null&&(u.value=n),a!=null&&(u.correction=a),o!=null&&(u.comment=o),Oe(e);const d=await this.caller.call(fe(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(d,"update feedback",!0)}async readFeedback(e){Oe(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Oe(e);const t=`/feedback/${e}`,n=await this.caller.call(fe(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(const o of t)a.append("key",o);if(n)for(const o of n)a.append("source",o);for await(const o of this._getPaginated("/feedback",a))yield*o}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:a}={}){const o={run_id:e,feedback_key:t,feedback_config:a};return n?typeof n=="string"?o.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(o.expires_in=n):o.expires_in={hours:3},await(await this.caller.call(fe(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:a,description:o,metadata:u,id:d}){var p;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const f={id:d,name:e,experiment_ids:t,reference_dataset_id:n,description:o,created_at:(p=a??new Date)==null?void 0:p.toISOString(),extra:{}};return u&&(f.extra.metadata=u),await(await this.caller.call(fe(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Oe(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const a=this._selectEvalResults(e),o=[];for(const u of a){let d=n||{};u.evaluatorInfo&&(d={...u.evaluatorInfo,...d});let f=null;u.targetRunId?f=u.targetRunId:t&&(f=t.id),o.push(await this.createFeedback(f,u.key,{score:u.score,value:u.value,comment:u.comment,correction:u.correction,sourceInfo:d,sourceRunId:u.sourceRunId,feedbackConfig:u.feedbackConfig,feedbackSourceType:"model"}))}return[a,o]}async logEvaluationFeedback(e,t,n){const[a]=await this._logEvaluationFeedback(e,t,n);return a}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:a,limit:o}=e,u=new URLSearchParams;t&&t.forEach((f,h)=>{Oe(f,`queueIds[${h}]`),u.append("ids",f)}),n&&u.append("name",n),a&&u.append("name_contains",a),u.append("limit",(o!==void 0?Math.min(o,100):100).toString());let d=0;for await(const f of this._getPaginated("/annotation-queues",u))if(yield*f,d++,o!==void 0&&d>=o)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:a,rubricInstructions:o}=e,u={name:t,description:n,id:a||_i(),rubric_instructions:o},d=await this.caller.call(fe(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(u).filter(([h,p])=>p!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(d,"create annotation queue"),await d.json()}async readAnnotationQueue(e){const t=await this.caller.call(fe(this.debug),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(t,"read annotation queue"),await t.json()}async updateAnnotationQueue(e,t){const{name:n,description:a,rubricInstructions:o}=t,u=await this.caller.call(fe(this.debug),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:a,rubric_instructions:o}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(u,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(fe(this.debug),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(fe(this.debug),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((a,o)=>Oe(a,`runIds[${o}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${Oe(e,"queueId")}/run`,a=await this.caller.call(fe(this.debug),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(a,"get run from annotation queue"),await a.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(fe(this.debug),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}/runs/${Oe(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(fe(this.debug),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(fe(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const a=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),o=new Error(`Error ${t.status}: ${t.statusText}
${a}`);throw o.statusCode=t.status,o}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,a,o]=Ta(e),u=await this.caller.call(fe(this.debug),`${this.apiUrl}/likes/${n}/${a}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(u,`${t?"like":"unlike"} prompt`),await u.json()}async _getPromptUrl(e){const[t,n,a]=Ta(e);if(await this._currentTenantIsOwner(t)){const o=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${n}/${a.substring(0,8)}?organizationId=${o.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${o.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,a=>a.repos))yield*n}async getPrompt(e){const[t,n,a]=Ta(e),o=await this.caller.call(fe(this.debug),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(o.status===404)return null;await Re(o,"get prompt");const u=await o.json();return u.repo?u.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[a,o,u]=Ta(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);const d={repo_handle:o,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},f=await this.caller.call(fe(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(f,"create prompt");const{repo:h}=await f.json();return h}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[a,o,u]=Ta(e),d=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${a}/${o}`):n==null?void 0:n.parentCommitHash,f={manifest:JSON.parse(JSON.stringify(t)),parent_commit:d},h=await this.caller.call(fe(this.debug),`${this.apiUrl}/commits/${a}/${o}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(h,"create commit");const p=await h.json();return this._getPromptUrl(`${a}/${o}${p.commit_hash?`:${p.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var d;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const f of t){const h=f.id,p={...f.metadata&&{metadata:f.metadata},...f.split&&{split:f.split}},y=An(p,`Serializing body for example with id: ${h}`),_=new Blob([y],{type:"application/json"});if(n.append(h,_),f.inputs){const b=An(f.inputs,`Serializing inputs for example with id: ${h}`),v=new Blob([b],{type:"application/json"});n.append(`${h}.inputs`,v)}if(f.outputs){const b=An(f.outputs,`Serializing outputs whle updating example with id: ${h}`),v=new Blob([b],{type:"application/json"});n.append(`${h}.outputs`,v)}if(f.attachments)for(const[b,v]of Object.entries(f.attachments)){let S,x;Array.isArray(v)?[S,x]=v:(S=v.mimeType,x=v.data);const E=new Blob([x],{type:`${S}; length=${x.byteLength}`});n.append(`${h}.attachment.${b}`,E)}if(f.attachments_operations){const b=An(f.attachments_operations,`Serializing attachments while updating example with id: ${h}`),v=new Blob([b],{type:"application/json"});n.append(`${h}.attachments_operations`,v)}}const a=e??((d=t[0])==null?void 0:d.dataset_id);return await(await this.caller.call(fe(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${a}/examples`)}`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const u of t){const d=(u.id??_i()).toString(),f={created_at:u.created_at,...u.metadata&&{metadata:u.metadata},...u.split&&{split:u.split},...u.source_run_id&&{source_run_id:u.source_run_id},...u.use_source_run_io&&{use_source_run_io:u.use_source_run_io},...u.use_source_run_attachments&&{use_source_run_attachments:u.use_source_run_attachments}},h=An(f,`Serializing body for uploaded example with id: ${d}`),p=new Blob([h],{type:"application/json"});if(n.append(d,p),u.inputs){const y=An(u.inputs,`Serializing inputs for uploaded example with id: ${d}`),_=new Blob([y],{type:"application/json"});n.append(`${d}.inputs`,_)}if(u.outputs){const y=An(u.outputs,`Serializing outputs for uploaded example with id: ${d}`),_=new Blob([y],{type:"application/json"});n.append(`${d}.outputs`,_)}if(u.attachments)for(const[y,_]of Object.entries(u.attachments)){let b,v;Array.isArray(_)?[b,v]=_:(b=_.mimeType,v=_.data);const S=new Blob([v],{type:`${b}; length=${v.byteLength}`});n.append(`${d}.attachment.${y}`,S)}}const a=await this.caller.call(fe(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,body:n});return await Re(a,"upload examples"),await a.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,a]=Ta(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const o={};if((t==null?void 0:t.description)!==void 0&&(o.description=t.description),(t==null?void 0:t.readme)!==void 0&&(o.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(o.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(o.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(o.is_archived=t.isArchived),Object.keys(o).length===0)throw new Error("No valid update options provided");const u=await this.caller.call(fe(this.debug),`${this.apiUrl}/repos/${n}/${a}`,{method:"PATCH",body:JSON.stringify(o),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Re(u,"update prompt"),u.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,a]=Ta(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(fe(this.debug),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[n,a,o]=Ta(e),u=await this.caller.call(fe(this.debug),`${this.apiUrl}/commits/${n}/${a}/${o}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Re(u,"pull prompt commit");const d=await u.json();return{owner:n,repo:a,commit_hash:d.commit_hash,manifest:d.manifest,examples:d.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(a=>a!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:a}=t,[o,u]=this.parseTokenOrUrl(e,n),d=new Ul({apiUrl:o,apiKey:"placeholder"}),f=await d.readSharedDataset(u),h=a||f.name;try{if(await this.hasDataset({datasetId:h})){console.log(`Dataset ${h} already exists in your tenant. Skipping.`);return}}catch{}const p=await d.listSharedExamples(u),y=await this.createDataset(h,{description:f.description,dataType:f.data_type||"kv",inputsSchema:f.inputs_schema_definition??void 0,outputsSchema:f.outputs_schema_definition??void 0});try{await this.createExamples({inputs:p.map(_=>_.inputs),outputs:p.flatMap(_=>_.outputs?[_.outputs]:[]),datasetId:y.id})}catch(_){throw console.error(`An error occurred while creating dataset ${h}. You should delete it manually.`),_}}parseTokenOrUrl(e,t,n=2,a="dataset"){try{return Oe(e),[t,e]}catch{}try{const u=new URL(e).pathname.split("/").filter(d=>d!=="");if(u.length>=n){const d=u[u.length-n];return[t,d]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}async awaitPendingTraceBatches(){var e,t;if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:n})=>n),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await((t=(e=I$())==null?void 0:e.DEFAULT_LANGSMITH_SPAN_PROCESSOR)==null?void 0:t.forceFlush())}}function Cx(r){return"dataset_id"in r||"dataset_name"in r}const II=r=>!!["TRACING_V2","TRACING"].find(t=>Fn(t)==="true"),rg=Symbol.for("lc:context_variables");function PI(r){return r.replace(/[-:.]/g,"")}function MI(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return PI(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}class Md{constructor(e,t,n,a){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=a}static fromHeader(e){const t=e.split(",");let n={},a=[],o,u;for(const d of t){const[f,h]=d.split("="),p=decodeURIComponent(h);f==="langsmith-metadata"?n=JSON.parse(p):f==="langsmith-tags"?a=p.split(","):f==="langsmith-project"?o=p:f==="langsmith-replicas"&&(u=JSON.parse(p))}return new Md(n,a,o,u)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class un{constructor(e){var d;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),LI(e)){Object.assign(this,{...e});return}const t=un.getDefaultConfig(),{metadata:n,...a}=e,o=a.client??un.getSharedClient(),u={...n,...(d=a==null?void 0:a.extra)==null?void 0:d.metadata};if(a.extra={...a.extra,metadata:u},Object.assign(this,{...t,...a,client:o}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=qI(this.replicas),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const f=MI(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+f:this.dotted_order=f}}set metadata(e){var t;this.extra={...this.extra,metadata:{...(t=this.extra)==null?void 0:t.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){return{id:_i(),run_type:"chain",project_name:U1(),child_runs:[],api_url:ar("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:ar("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return un.sharedClient||(un.sharedClient=new Ul),un.sharedClient}createChild(e){var f,h,p,y,_,b;const t=this.child_execution_order+1,n=new un({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});rg in this&&(n[rg]=this[rg]);const a=Symbol.for("lc:child_config"),o=((f=e.extra)==null?void 0:f[a])??this.extra[a];if(UI(o)){const v={...o},S=DI(v.callbacks)?(p=(h=v.callbacks).copy)==null?void 0:p.call(h):void 0;S&&(Object.assign(S,{_parentRunId:n.id}),(b=(_=(y=S.handlers)==null?void 0:y.find(X1))==null?void 0:_.updateFromRunTree)==null||b.call(_,n),v.callbacks=S),n.extra[a]=v}const u=new Set;let d=this;for(;d!=null&&!u.has(d.id);)u.add(d.id),d.child_execution_order=Math.max(d.child_execution_order,t),d=d.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,t,n=!0){var d,f;const a=e.extra??{};if(((d=a==null?void 0:a.runtime)==null?void 0:d.library)===void 0&&(a.runtime||(a.runtime={}),t))for(const[h,p]of Object.entries(t))a.runtime[h]||(a.runtime[h]=p);let o,u;return n?(u=(f=e.parent_run)==null?void 0:f.id,o=[]):(o=e.child_runs.map(h=>this._convertToCreate(h,t,n)),u=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:o,parent_run_id:u,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,n=!0){const a=this._convertToCreate(this,t,n);if(e===this.project_name)return a;const o=y=>_S(`${y}:${e}`,_S.DNS),u=o(a.id),d=a.trace_id?o(a.trace_id):void 0,f=a.parent_run_id?o(a.parent_run_id):void 0;let h;if(a.dotted_order){const y=zI(a.dotted_order),_=[];for(let v=0;v<y.length-1;v++){const[S,x]=y[v],E=o(x);_.push(S.toISOString().replace(/[-:]/g,"").replace(".","")+E)}const[b]=y[y.length-1];_.push(b.toISOString().replace(/[-:]/g,"").replace(".","")+u),h=_.join(".")}else h=void 0;return{...a,id:u,trace_id:d,parent_run_id:f,dotted_order:h,session_name:e}}async postRun(e=!0){try{const t=q1();if(this.replicas&&this.replicas.length>0)for(const{projectName:n,apiKey:a,apiUrl:o}of this.replicas){const u=this._remapForProject(n??this.project_name,t,!0);await this.client.createRun(u,{apiKey:a,apiUrl:o})}else{const n=this._convertToCreate(this,t,e);await this.client.createRun(n)}if(!e){G1("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const n of this.child_runs)await n.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;if(this.replicas&&this.replicas.length>0)for(const{projectName:t,apiKey:n,apiUrl:a,updates:o}of this.replicas){const u=this._remapForProject(t??this.project_name);await this.client.updateRun(u.id,{inputs:u.inputs,outputs:u.outputs,error:u.error,parent_run_id:u.parent_run_id,session_name:u.session_name,reference_example_id:u.reference_example_id,end_time:u.end_time,dotted_order:u.dotted_order,trace_id:u.trace_id,events:u.events,tags:u.tags,extra:u.extra,attachments:this.attachments,...o},{apiKey:n,apiUrl:a})}else try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var h,p,y,_;const n=e==null?void 0:e.callbacks;let a,o,u,d=II();if(n){const b=((h=n==null?void 0:n.getParentRunId)==null?void 0:h.call(n))??"",v=(p=n==null?void 0:n.handlers)==null?void 0:p.find(S=>(S==null?void 0:S.name)=="langchain_tracer");a=(y=v==null?void 0:v.getRun)==null?void 0:y.call(v,b),o=v==null?void 0:v.projectName,u=v==null?void 0:v.client,d=d||!!v}return a?new un({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:u,tracingEnabled:d,project_name:o,tags:[...new Set(((a==null?void 0:a.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(_=a==null?void 0:a.extra)==null?void 0:_.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new un({...t,client:u,tracingEnabled:d,project_name:o})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var h;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=n["langsmith-trace"];if(!a||typeof a!="string")return;const o=a.trim(),u=o.split(".").map(p=>{const[y,_]=p.split("Z");return{strTime:y,time:Date.parse(y+"Z"),uuid:_}}),d=u[0].uuid,f={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(h=u.at(-1))==null?void 0:h.uuid,trace_id:d,dotted_order:o};if(n.baggage&&typeof n.baggage=="string"){const p=Md.fromHeader(n.baggage);f.metadata=p.metadata,f.tags=p.tags,f.project_name=p.project_name,f.replicas=p.replicas}return new un(f)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new Md((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[a,o]of Object.entries(t))e.set(a,o);return t}}Object.defineProperty(un,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function LI(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function X1(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function kx(r){return Array.isArray(r)&&r.some(e=>X1(e))}function DI(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function UI(r){var e;return r!==void 0&&typeof r.callbacks=="object"&&(kx((e=r.callbacks)==null?void 0:e.handlers)||kx(r.callbacks))}function zI(r){return r.split(".").map(t=>{const n=t.slice(0,-36),a=t.slice(-36),o=parseInt(n.slice(0,4)),u=parseInt(n.slice(4,6))-1,d=parseInt(n.slice(6,8)),f=parseInt(n.slice(9,11)),h=parseInt(n.slice(11,13)),p=parseInt(n.slice(13,15)),y=parseInt(n.slice(15,21));return[new Date(o,u,d,f,h,p,y/1e3),a]})}function BI(){const r=ar("LANGSMITH_RUNS_ENDPOINTS");if(!r)return[];try{const e=JSON.parse(r);return HI(e),Object.entries(e).map(([t,n])=>({apiUrl:t.replace(/\/$/,""),apiKey:n}))}catch(e){if(wI(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS – must be valid JSON mapping of url->apiKey"),[]}}function qI(r){return r?r.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):BI()}function HI(r){if(Object.keys(r).length>0&&Fn("ENDPOINT"))throw new vI}var ag={};const GI=()=>typeof window<"u"&&typeof window.document<"u",FI=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",ZI=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Qy=()=>typeof Deno<"u",VI=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Qy(),JI=()=>{let r;return GI()?r="browser":VI()?r="node":FI()?r="webworker":ZI()?r="jsdom":Qy()?r="deno":r="other",r};let sg;function KI(){return sg===void 0&&(sg={library:"langchain-js",runtime:JI()}),sg}function Wr(r){try{return typeof process<"u"?ag==null?void 0:ag[r]:Qy()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}class YI{}function XI(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}class Ql extends YI{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,j1(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Wr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return ys.prototype.toJSON.call(this)}toJSONNotImplemented(){return ys.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Ql{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Jr()}),Object.assign(this,e)}}return new t}}const QI=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},WI=r=>{if(r)return r.events=r.events??[],r.child_runs=r.child_runs??[],r};function ny(r,e){if(r)return new un({...r,parent_run:ny(e),child_runs:r.child_runs.map(t=>ny(t)).filter(t=>t!==void 0),extra:{...r.extra,runtime:KI()},tracingEnabled:!1})}function ig(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function eP(r){return r.replace(/[-:.]/g,"")}function tP(r,e,t){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return eP(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}function Jo(r){return typeof r._addRunToRunMap=="function"}class Wl extends Ql{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?WI(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=tP(e.start_time,e.id,e.execution_order),n={...e},a=this.getRunById(n.parent_run_id);if(n.parent_run_id!==void 0?a&&(this._addChildRun(a,n),a.child_execution_order=Math.max(a.child_execution_order,n.child_execution_order),n.trace_id=a.trace_id,a.dotted_order!==void 0&&(n.dotted_order=[a.dotted_order,t].join("."))):(n.trace_id=n.id,n.dotted_order=t),this.usesRunTreeMap){const o=ny(n,a);o!==void 0&&this.runTreeMap.set(n.id,o)}else this.runMap.set(n.id,n);return n}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await((n=this.onRunUpdate)==null?void 0:n.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,a,o,u,d,f){const h=this._getExecutionOrder(a),p=Date.now(),y=d?{...o,metadata:d}:o,_={id:n,name:f??e.id[e.id.length-1],parent_run_id:a,start_time:p,serialized:e,events:[{name:"start",time:new Date(p).toISOString()}],inputs:{prompts:t},execution_order:h,child_runs:[],child_execution_order:h,run_type:"llm",extra:y??{},tags:u||[]};return this._addRunToRunMap(_)}async handleLLMStart(e,t,n,a,o,u,d,f){var p,y;const h=this.getRunById(n)??this._createRunForLLMStart(e,t,n,a,o,u,d,f);return await((p=this.onRunCreate)==null?void 0:p.call(this,h)),await((y=this.onLLMStart)==null?void 0:y.call(this,h)),h}_createRunForChatModelStart(e,t,n,a,o,u,d,f){const h=this._getExecutionOrder(a),p=Date.now(),y=d?{...o,metadata:d}:o,_={id:n,name:f??e.id[e.id.length-1],parent_run_id:a,start_time:p,serialized:e,events:[{name:"start",time:new Date(p).toISOString()}],inputs:{messages:t},execution_order:h,child_runs:[],child_execution_order:h,run_type:"llm",extra:y??{},tags:u||[]};return this._addRunToRunMap(_)}async handleChatModelStart(e,t,n,a,o,u,d,f){var p,y;const h=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,a,o,u,d,f);return await((p=this.onRunCreate)==null?void 0:p.call(this,h)),await((y=this.onLLMStart)==null?void 0:y.call(this,h)),h}async handleLLMEnd(e,t,n,a,o){var d;const u=this.getRunById(t);if(!u||(u==null?void 0:u.run_type)!=="llm")throw new Error("No LLM run to end.");return u.end_time=Date.now(),u.outputs=e,u.events.push({name:"end",time:new Date(u.end_time).toISOString()}),u.extra={...u.extra,...o},await((d=this.onLLMEnd)==null?void 0:d.call(this,u)),await this._endTrace(u),u}async handleLLMError(e,t,n,a,o){var d;const u=this.getRunById(t);if(!u||(u==null?void 0:u.run_type)!=="llm")throw new Error("No LLM run to end.");return u.end_time=Date.now(),u.error=this.stringifyError(e),u.events.push({name:"error",time:new Date(u.end_time).toISOString()}),u.extra={...u.extra,...o},await((d=this.onLLMError)==null?void 0:d.call(this,u)),await this._endTrace(u),u}_createRunForChainStart(e,t,n,a,o,u,d,f){const h=this._getExecutionOrder(a),p=Date.now(),y={id:n,name:f??e.id[e.id.length-1],parent_run_id:a,start_time:p,serialized:e,events:[{name:"start",time:new Date(p).toISOString()}],inputs:t,execution_order:h,child_execution_order:h,run_type:d??"chain",child_runs:[],extra:u?{metadata:u}:{},tags:o||[]};return this._addRunToRunMap(y)}async handleChainStart(e,t,n,a,o,u,d,f){var p,y;const h=this.getRunById(n)??this._createRunForChainStart(e,t,n,a,o,u,d,f);return await((p=this.onRunCreate)==null?void 0:p.call(this,h)),await((y=this.onChainStart)==null?void 0:y.call(this,h)),h}async handleChainEnd(e,t,n,a,o){var d;const u=this.getRunById(t);if(!u)throw new Error("No chain run to end.");return u.end_time=Date.now(),u.outputs=ig(e,"output"),u.events.push({name:"end",time:new Date(u.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(u.inputs=ig(o.inputs,"input")),await((d=this.onChainEnd)==null?void 0:d.call(this,u)),await this._endTrace(u),u}async handleChainError(e,t,n,a,o){var d;const u=this.getRunById(t);if(!u)throw new Error("No chain run to end.");return u.end_time=Date.now(),u.error=this.stringifyError(e),u.events.push({name:"error",time:new Date(u.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(u.inputs=ig(o.inputs,"input")),await((d=this.onChainError)==null?void 0:d.call(this,u)),await this._endTrace(u),u}_createRunForToolStart(e,t,n,a,o,u,d){const f=this._getExecutionOrder(a),h=Date.now(),p={id:n,name:d??e.id[e.id.length-1],parent_run_id:a,start_time:h,serialized:e,events:[{name:"start",time:new Date(h).toISOString()}],inputs:{input:t},execution_order:f,child_execution_order:f,run_type:"tool",child_runs:[],extra:u?{metadata:u}:{},tags:o||[]};return this._addRunToRunMap(p)}async handleToolStart(e,t,n,a,o,u,d){var h,p;const f=this.getRunById(n)??this._createRunForToolStart(e,t,n,a,o,u,d);return await((h=this.onRunCreate)==null?void 0:h.call(this,f)),await((p=this.onToolStart)==null?void 0:p.call(this,f)),f}async handleToolEnd(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var o;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const a=n;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((o=this.onAgentAction)==null?void 0:o.call(this,n))}async handleAgentEnd(e,t){var a;const n=this.getRunById(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,n)))}_createRunForRetrieverStart(e,t,n,a,o,u,d){const f=this._getExecutionOrder(a),h=Date.now(),p={id:n,name:d??e.id[e.id.length-1],parent_run_id:a,start_time:h,serialized:e,events:[{name:"start",time:new Date(h).toISOString()}],inputs:{query:t},execution_order:f,child_execution_order:f,run_type:"retriever",child_runs:[],extra:u?{metadata:u}:{},tags:o||[]};return this._addRunToRunMap(p)}async handleRetrieverStart(e,t,n,a,o,u,d){var h,p;const f=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,a,o,u,d);return await((h=this.onRunCreate)==null?void 0:h.call(this,f)),await((p=this.onRetrieverStart)==null?void 0:p.call(this,f)),f}async handleRetrieverEnd(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var a;const n=this.getRunById(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,n)))}async handleLLMNewToken(e,t,n,a,o,u){var f;const d=this.getRunById(n);if(!d||(d==null?void 0:d.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return d.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:u==null?void 0:u.chunk}}),await((f=this.onLLMNewToken)==null?void 0:f.call(this,d,e,{chunk:u==null?void 0:u.chunk})),d}}var cd={exports:{}};cd.exports;var jx;function nP(){return jx||(jx=1,function(r){const t=(o=0)=>u=>`\x1B[${38+o};5;${u}m`,n=(o=0)=>(u,d,f)=>`\x1B[${38+o};2;${u};${d};${f}m`;function a(){const o=new Map,u={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};u.color.gray=u.color.blackBright,u.bgColor.bgGray=u.bgColor.bgBlackBright,u.color.grey=u.color.blackBright,u.bgColor.bgGrey=u.bgColor.bgBlackBright;for(const[d,f]of Object.entries(u)){for(const[h,p]of Object.entries(f))u[h]={open:`\x1B[${p[0]}m`,close:`\x1B[${p[1]}m`},f[h]=u[h],o.set(p[0],p[1]);Object.defineProperty(u,d,{value:f,enumerable:!1})}return Object.defineProperty(u,"codes",{value:o,enumerable:!1}),u.color.close="\x1B[39m",u.bgColor.close="\x1B[49m",u.color.ansi256=t(),u.color.ansi16m=n(),u.bgColor.ansi256=t(10),u.bgColor.ansi16m=n(10),Object.defineProperties(u,{rgbToAnsi256:{value:(d,f,h)=>d===f&&f===h?d<8?16:d>248?231:Math.round((d-8)/247*24)+232:16+36*Math.round(d/255*5)+6*Math.round(f/255*5)+Math.round(h/255*5),enumerable:!1},hexToRgb:{value:d=>{const f=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(d.toString(16));if(!f)return[0,0,0];let{colorString:h}=f.groups;h.length===3&&(h=h.split("").map(y=>y+y).join(""));const p=Number.parseInt(h,16);return[p>>16&255,p>>8&255,p&255]},enumerable:!1},hexToAnsi256:{value:d=>u.rgbToAnsi256(...u.hexToRgb(d)),enumerable:!1}}),u}Object.defineProperty(r,"exports",{enumerable:!0,get:a})}(cd)),cd.exports}var rP=nP();const Q1=vs(rP);function Kt(r,e){return`${r.open}${e}${r.close}`}function Gn(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function $x(r){return typeof r=="string"?r.trim():r==null?r:Gn(r,r.toString())}function Ra(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:ln}=Q1;class Ix extends Wl{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const a=this.runMap.get(n.parent_run_id);if(a)t.push(a),n=a;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((a,o,u)=>{const d=`${a.execution_order}:${a.run_type}:${a.name}`;return o===u.length-1?Kt(Q1.bold,d):d}).join(" > ");return Kt(ln.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Gn(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.cyan,"[chain/end]")} [${t}] [${Ra(e)}] Exiting Chain run with output: ${Gn(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.red,"[chain/error]")} [${t}] [${Ra(e)}] Chain run errored with error: ${Gn(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${Kt(ln.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Gn(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.cyan,"[llm/end]")} [${t}] [${Ra(e)}] Exiting LLM run with output: ${Gn(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.red,"[llm/error]")} [${t}] [${Ra(e)}] LLM run errored with error: ${Gn(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.green,"[tool/start]")} [${t}] Entering Tool run with input: "${$x(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.cyan,"[tool/end]")} [${t}] [${Ra(e)}] Exiting Tool run with output: "${$x((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.red,"[tool/error]")} [${t}] [${Ra(e)}] Tool run errored with error: ${Gn(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Gn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.cyan,"[retriever/end]")} [${t}] [${Ra(e)}] Exiting Retriever run with output: ${Gn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Kt(ln.red,"[retriever/error]")} [${t}] [${Ra(e)}] Retriever run errored with error: ${Gn(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${Kt(ln.blue,"[agent/action]")} [${n}] Agent selected action: ${Gn(t.actions[t.actions.length-1],"[action]")}`)}}let og;const aP=()=>{if(og===void 0){const r=Wr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};og=new Ul(r)}return og};class Tl extends Wl{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:t,projectName:n,client:a,replicas:o}=e;this.projectName=n??U1(),this.replicas=o,this.exampleId=t,this.client=a??aP();const u=Tl.getTraceableRunTree();u&&this.updateFromRunTree(u)}async persistRun(e){}async onRunCreate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.postRun())}async onRunUpdate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.patchRun())}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();const a=[t];for(;a.length>0;){const o=a.shift();!o||n.has(o.id)||(n.add(o.id),this.runTreeMap.set(o.id,o),o.child_runs&&a.push(...o.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const t=this.runTreeMap.get(e);if(t)return new un({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return Ej(!0)}catch{return}}}const W1=Symbol.for("ls:tracing_async_local_storage"),dd=Symbol.for("lc:context_variables"),sP=r=>{globalThis[W1]=r},zl=()=>globalThis[W1];let Rl;function iP(){const r="default"in Qr?Qr.default:Qr;return new r({autoStart:!0,concurrency:1})}function oP(){return typeof Rl>"u"&&(Rl=iP()),Rl}async function Et(r,e){if(e===!0){const t=zl();t!==void 0?await t.run(void 0,async()=>r()):await r()}else Rl=oP(),Rl.add(async()=>{const t=zl();t!==void 0?await t.run(void 0,async()=>r()):await r()})}const lP=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Wr(t)==="true");function eO(r){var n;const e=zl();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[dd])==null?void 0:n[r]}const uP=Symbol("lc:configure_hooks"),cP=()=>eO(uP)||[];class dP{setHandler(e){return this.setHandlers([e])}}class mf{constructor(e,t,n,a,o,u,d,f){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:u}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:d}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:f})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,a,o){await Promise.all(this.handlers.map(u=>Et(async()=>{var d;try{await((d=u.handleCustomEvent)==null?void 0:d.call(u,e,t,this.runId,this.tags,this.metadata))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleCustomEvent: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}}class fP extends mf{getChild(e){const t=new fn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw a}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${a}`),t.raiseError)throw e}},t.awaitHandlers)))}}class Px extends mf{async handleLLMNewToken(e,t,n,a,o,u){await Promise.all(this.handlers.map(d=>Et(async()=>{var f;if(!d.ignoreLLM)try{await((f=d.handleLLMNewToken)==null?void 0:f.call(d,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,u))}catch(h){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMNewToken: ${h}`),d.raiseError)throw h}},d.awaitHandlers)))}async handleLLMError(e,t,n,a,o){await Promise.all(this.handlers.map(u=>Et(async()=>{var d;if(!u.ignoreLLM)try{await((d=u.handleLLMError)==null?void 0:d.call(u,e,this.runId,this._parentRunId,this.tags,o))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleLLMError: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}async handleLLMEnd(e,t,n,a,o){await Promise.all(this.handlers.map(u=>Et(async()=>{var d;if(!u.ignoreLLM)try{await((d=u.handleLLMEnd)==null?void 0:d.call(u,e,this.runId,this._parentRunId,this.tags,o))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleLLMEnd: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}}class hP extends mf{getChild(e){const t=new fn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,a,o){await Promise.all(this.handlers.map(u=>Et(async()=>{var d;if(!u.ignoreChain)try{await((d=u.handleChainError)==null?void 0:d.call(u,e,this.runId,this._parentRunId,this.tags,o))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainError: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}async handleChainEnd(e,t,n,a,o){await Promise.all(this.handlers.map(u=>Et(async()=>{var d;if(!u.ignoreChain)try{await((d=u.handleChainEnd)==null?void 0:d.call(u,e,this.runId,this._parentRunId,this.tags,o))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainEnd: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}}class mP extends mf{getChild(e){const t=new fn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}}class fn extends dP{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,a=void 0,o=void 0,u=void 0,d=void 0,f=void 0){return Promise.all(t.map(async(h,p)=>{const y=p===0&&n?n:Jr();return await Promise.all(this.handlers.map(_=>{if(!_.ignoreLLM)return Jo(_)&&_._createRunForLLMStart(e,[h],y,this._parentRunId,o,this.tags,this.metadata,f),Et(async()=>{var b;try{await((b=_.handleLLMStart)==null?void 0:b.call(_,e,[h],y,this._parentRunId,o,this.tags,this.metadata,f))}catch(v){if((_.raiseError?console.error:console.warn)(`Error in handler ${_.constructor.name}, handleLLMStart: ${v}`),_.raiseError)throw v}},_.awaitHandlers)})),new Px(y,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,a=void 0,o=void 0,u=void 0,d=void 0,f=void 0){return Promise.all(t.map(async(h,p)=>{const y=p===0&&n?n:Jr();return await Promise.all(this.handlers.map(_=>{if(!_.ignoreLLM)return Jo(_)&&_._createRunForChatModelStart(e,[h],y,this._parentRunId,o,this.tags,this.metadata,f),Et(async()=>{var b,v;try{if(_.handleChatModelStart)await((b=_.handleChatModelStart)==null?void 0:b.call(_,e,[h],y,this._parentRunId,o,this.tags,this.metadata,f));else if(_.handleLLMStart){const S=P1(h);await((v=_.handleLLMStart)==null?void 0:v.call(_,e,[S],y,this._parentRunId,o,this.tags,this.metadata,f))}}catch(S){if((_.raiseError?console.error:console.warn)(`Error in handler ${_.constructor.name}, handleLLMStart: ${S}`),_.raiseError)throw S}},_.awaitHandlers)})),new Px(y,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=Jr(),a=void 0,o=void 0,u=void 0,d=void 0){return await Promise.all(this.handlers.map(f=>{if(!f.ignoreChain)return Jo(f)&&f._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,a,d),Et(async()=>{var h;try{await((h=f.handleChainStart)==null?void 0:h.call(f,e,t,n,this._parentRunId,this.tags,this.metadata,a,d))}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleChainStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new hP(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=Jr(),a=void 0,o=void 0,u=void 0,d=void 0){return await Promise.all(this.handlers.map(f=>{if(!f.ignoreAgent)return Jo(f)&&f._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,d),Et(async()=>{var h;try{await((h=f.handleToolStart)==null?void 0:h.call(f,e,t,n,this._parentRunId,this.tags,this.metadata,d))}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleToolStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new mP(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=Jr(),a=void 0,o=void 0,u=void 0,d=void 0){return await Promise.all(this.handlers.map(f=>{if(!f.ignoreRetriever)return Jo(f)&&f._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,d),Et(async()=>{var h;try{await((h=f.handleRetrieverStart)==null?void 0:h.call(f,e,t,n,this._parentRunId,this.tags,this.metadata,d))}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleRetrieverStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new fP(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,a,o){await Promise.all(this.handlers.map(u=>Et(async()=>{var d;if(!u.ignoreCustomEvent)try{await((d=u.handleCustomEvent)==null?void 0:d.call(u,e,t,n,this.tags,this.metadata))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleCustomEvent: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new fn(this._parentRunId);for(const a of this.handlers){const o=this.inheritableHandlers.includes(a);n.addHandler(a,o)}for(const a of this.tags){const o=this.inheritableTags.includes(a);n.addTags([a],o)}for(const a of Object.keys(this.metadata)){const o=Object.keys(this.inheritableMetadata).includes(a);n.addMetadata({[a]:this.metadata[a]},o)}for(const a of e)n.handlers.filter(o=>o.name==="console_callback_handler").some(o=>o.name===a.name)||n.addHandler(a,t);return n}static fromHandlers(e){class t extends Ql{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Jr()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static configure(e,t,n,a,o,u,d){return this._configureSync(e,t,n,a,o,u,d)}static _configureSync(e,t,n,a,o,u,d){var _,b;let f;(e||t)&&(Array.isArray(e)||!e?(f=new fn,f.setHandlers((e==null?void 0:e.map(Ld))??[],!0)):f=e,f=f.copy(Array.isArray(t)?t.map(Ld):t==null?void 0:t.handlers,!1));const h=Wr("LANGCHAIN_VERBOSE")==="true"||(d==null?void 0:d.verbose),p=((_=Tl.getTraceableRunTree())==null?void 0:_.tracingEnabled)||lP(),y=p||(Wr("LANGCHAIN_TRACING")??!1);if(h||y){if(f||(f=new fn),h&&!f.handlers.some(v=>v.name===Ix.prototype.name)){const v=new Ix;f.addHandler(v,!0)}if(y&&!f.handlers.some(v=>v.name==="langchain_tracer")&&p){const v=new Tl;f.addHandler(v,!0),f._parentRunId=((b=Tl.getTraceableRunTree())==null?void 0:b.id)??f._parentRunId}}for(const{contextVar:v,inheritable:S=!0,handlerClass:x,envVar:E}of cP()){const R=E&&Wr(E)==="true"&&x;let T;const j=v!==void 0?eO(v):void 0;j&&QI(j)?T=j:R&&(T=new x({})),T!==void 0&&(f||(f=new fn),f.handlers.some($=>$.name===T.name)||f.addHandler(T,S))}return(n||a)&&f&&(f.addTags(n??[]),f.addTags(a??[],!1)),(o||u)&&f&&(f.addMetadata(o??{}),f.addMetadata(u??{},!1)),f}}function Ld(r){return"name"in r?r:Ql.fromMethods(r)}class pP{getStore(){}run(e,t){return t()}enterWith(e){}}const gP=new pP,Mx=Symbol.for("lc:child_config");class yP{getInstance(){return zl()??gP}getRunnableConfig(){var t,n;return(n=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:n[Mx]}runWithConfig(e,t,n){var p;const a=fn._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),o=this.getInstance(),u=o.getStore(),d=a==null?void 0:a.getParentRunId(),f=(p=a==null?void 0:a.handlers)==null?void 0:p.find(y=>(y==null?void 0:y.name)==="langchain_tracer");let h;return f&&d?h=f.getRunTreeWithTracingConfig(d):n||(h=new un({name:"<runnable_lambda>",tracingEnabled:!1})),h&&(h.extra={...h.extra,[Mx]:e}),u!==void 0&&u[dd]!==void 0&&(h===void 0&&(h={}),h[dd]=u[dd]),o.run(h,t)}initializeGlobalInstance(e){zl()===void 0&&sP(e)}}const Ua=new yP,lg=25;async function sr(r){return fn._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function Lx(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const a=e[n]??[];e[n]=[...new Set(a.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const a=e.callbacks,o=t.callbacks;if(Array.isArray(o))if(!a)e.callbacks=o;else if(Array.isArray(a))e.callbacks=a.concat(o);else{const u=a.copy();for(const d of o)u.addHandler(Ld(d),!0);e.callbacks=u}else if(o)if(!a)e.callbacks=o;else if(Array.isArray(a)){const u=o.copy();for(const d of a)u.addHandler(Ld(d),!0);e.callbacks=u}else e.callbacks=new fn(o._parentRunId,{handlers:a.handlers.concat(o.handlers),inheritableHandlers:a.inheritableHandlers.concat(o.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(o.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(o.inheritableTags))),metadata:{...a.metadata,...o.metadata}})}else{const a=n;e[a]=t[a]??e[a]}return e}const _P=new Set(["string","number","boolean"]);function Fe(r){var n;const e=Ua.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:a,runName:o,...u}=e;t=Object.entries(u).reduce((d,[f,h])=>(h!==void 0&&(d[f]=h),d),t)}if(r&&(t=Object.entries(r).reduce((a,[o,u])=>(u!==void 0&&(a[o]=u),a),t)),t!=null&&t.configurable)for(const a of Object.keys(t.configurable))_P.has(typeof t.configurable[a])&&!((n=t.metadata)!=null&&n[a])&&(t.metadata||(t.metadata={}),t.metadata[a]=t.configurable[a]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const a=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,a])):t.signal=a,delete t.timeout}return t}function Ft(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:a,configurable:o,runId:u}={}){const d=Fe(r);return e!==void 0&&(delete d.runName,d.callbacks=e),n!==void 0&&(d.recursionLimit=n),t!==void 0&&(d.maxConcurrency=t),a!==void 0&&(d.runName=a),o!==void 0&&(d.configurable={...d.configurable,...o}),u!==void 0&&delete d.runId,d}function ji(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function za(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,a)=>{t=()=>{a(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class Cn extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new Cn({start(n){return a();function a(){return t.read().then(({done:o,value:u})=>{if(o){n.close();return}return n.enqueue(u),a()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new Cn({async pull(t){const{value:n,done:a}=await e.next();a&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function tO(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(a){for(;;)if(a.length===0){const o=await r.next();for(const u of t)u.push(o)}else{if(a[0].done)return;yield a.shift().value}})}function ir(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,a]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=ir(t[n],a):t[n]=a;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}class Bi{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((n,a)=>{Ua.runWithConfig(ji(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,a):this.firstResult.then(o=>n(void 0),a)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Ua.runWithConfig(ji(this.config),this.signal?async()=>za(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function bP(r,e,t,n,...a){const o=new Bi({generator:e,startSetup:t,signal:n}),u=await o.setup;return{output:r(o,u,...a),setup:u}}class ja{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=$d({},t);return new Bl({ops:t,state:n[n.length-1].newDocument})}}class Bl extends ja{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=$d(this.state,e.ops);return new Bl({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=$d({},e.ops);return new Bl({ops:e.ops,state:t[t.length-1].newDocument})}}const vP=r=>r.name==="log_stream_tracer";async function Dx(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Ux(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function wP(r){return r!==void 0&&r.message!==void 0}class zx extends Wl{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Cn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const a=this.keyMapByRunId[e];a&&await this.writer.write(new ja({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new ja({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Dx(e,this._schemaFormat)),await this.writer.write(new ja({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Dx(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await Ux(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const a=new ja({ops:n});await this.writer.write(a)}finally{if(e.id===this.rootId){const t=new ja({ops:[{op:"replace",path:"/final_output",value:await Ux(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const a=this.keyMapByRunId[e.id];if(a===void 0)return;const o=e.inputs.messages!==void 0;let u;o?wP(n==null?void 0:n.chunk)?u=n==null?void 0:n.chunk:u=new xt({id:`run-${e.id}`,content:t}):u=t;const d=new ja({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:u}]});await this.writer.write(d)}}const Bx="__run";class $i{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new $i({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Ba extends $i{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Ba({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function Ic({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const SP=r=>r.name==="event_stream_tracer";class xP extends Wl{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Cn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const a=this.runInfoMap.get(e);if(a===void 0){yield n.value;return}function o(d,f){return d==="llm"&&typeof f=="string"?new $i({text:f}):f}let u=this.tappedPromises.get(e);if(u===void 0){let d;u=new Promise(f=>{d=f}),this.tappedPromises.set(e,u);try{const f={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...f,data:{chunk:o(a.runType,n.value)}},a),yield n.value;for await(const h of t)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...f,data:{chunk:o(a.runType,h)}},a),yield h}finally{d()}}else{yield n.value;for await(const d of t)yield d}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var u,d;const t=Ic(e),n=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:((u=e.extra)==null?void 0:u.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,a);const o=`on_${n}_start`;await this.send({event:o,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((d=e.extra)==null?void 0:d.metadata)??{}},a)}async onLLMNewToken(e,t,n){const a=this.runInfoMap.get(e.id);let o,u;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")u="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?o=new xt({content:t,id:`run-${e.id}`}):o=n.chunk.message;else if(a.runType==="llm")u="on_llm_stream",(n==null?void 0:n.chunk)===void 0?o=new $i({text:t}):o=n.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:u,data:{chunk:o},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){var u,d,f;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const a=(u=e.outputs)==null?void 0:u.generations;let o;if(t.runType==="chat_model"){for(const h of a??[]){if(o!==void 0)break;o=(d=h[0])==null?void 0:d.message}n="on_chat_model_end"}else if(t.runType==="llm")o={generations:a==null?void 0:a.map(h=>h.map(p=>({text:p.text,generationInfo:p.generationInfo}))),llmOutput:((f=e.outputs)==null?void 0:f.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:o,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var u,d;const t=Ic(e),n=e.run_type??"chain",a={tags:e.tags??[],metadata:((u=e.extra)==null?void 0:u.metadata)??{},name:t,runType:e.run_type};let o={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(o={},a.inputs={}):e.inputs.input!==void 0?(o.input=e.inputs.input,a.inputs=e.inputs.input):(o.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${n}_start`,data:o,name:t,tags:e.tags??[],run_id:e.id,metadata:((d=e.extra)==null?void 0:d.metadata)??{}},a)}async onChainEnd(e){var d;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},u={output:((d=e.outputs)==null?void 0:d.output)??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(u.input=a.input,t.inputs=a.input),await this.sendEndEvent({event:n,data:u,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var a,o;const t=Ic(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((o=e.extra)==null?void 0:o.metadata)??{}},n)}async onToolEnd(e){var a;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((a=e.outputs)==null?void 0:a.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var o,u;const t=Ic(e),a={tags:e.tags??[],metadata:((o=e.extra)==null?void 0:o.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,a),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((u=e.extra)==null?void 0:u.metadata)??{}},a)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const a=this.runInfoMap.get(n);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:a.tags,metadata:a.metadata,data:t},a)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const EP=[400,401,402,403,404,405,406,407,409],AP=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&EP.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const a=new Error(r==null?void 0:r.message);throw a.name="InsufficientQuotaError",a}};class Wy{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??AP;const t="default"in Qr?Qr.default:Qr;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>jd(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((a,o)=>{var u;(u=e.signal)==null||u.addEventListener("abort",()=>{o(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class nO extends Wl{constructor({config:e,onStart:t,onEnd:n,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function e_(r){return r?r.lc_runnable:!1}class OP{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const a=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||a.some(o=>{var u;return(u=this.includeTags)==null?void 0:u.includes(o)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&a.every(o=>{var u;return!((u=this.excludeTags)!=null&&u.includes(o))})),n}}function ug(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const TP=["*","_","`"];function RP(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function NP(r,e,t){const{firstNode:n,lastNode:a,nodeColors:o,withStyles:u=!0,curveStyle:d="linear",wrapLabelNWords:f=9}=t??{};let h=u?`%%{init: {'flowchart': {'curve': '${d}'}}}%%
graph TD;
`:`graph TD;
`;if(u){const b="default",v={[b]:"{0}({1})"};n!==void 0&&(v[n]="{0}([{1}]):::first"),a!==void 0&&(v[a]="{0}([{1}]):::last");for(const[S,x]of Object.entries(r)){const E=x.name.split(":").pop()??"";let T=TP.some($=>E.startsWith($)&&E.endsWith($))?`<p>${E}</p>`:E;Object.keys(x.metadata??{}).length&&(T+=`<hr/><small><em>${Object.entries(x.metadata??{}).map(([$,q])=>`${$} = ${q}`).join(`
`)}</em></small>`);const j=(v[S]??v[b]).replace("{0}",ug(S)).replace("{1}",T);h+=`	${j}
`}}const p={};for(const b of e){const v=b.source.split(":"),S=b.target.split(":"),x=v.filter((E,R)=>E===S[R]).join(":");p[x]||(p[x]=[]),p[x].push(b)}const y=new Set;function _(b,v){const S=b.length===1&&b[0].source===b[0].target;if(v&&!S){const x=v.split(":").pop();if(y.has(x))throw new Error(`Found duplicate subgraph '${x}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);y.add(x),h+=`	subgraph ${x}
`}for(const x of b){const{source:E,target:R,data:T,conditional:j}=x;let $="";if(T!==void 0){let q=T;const Z=q.split(" ");Z.length>f&&(q=Array.from({length:Math.ceil(Z.length/f)},(Y,oe)=>Z.slice(oe*f,(oe+1)*f).join(" ")).join("&nbsp;<br>&nbsp;")),$=j?` -. &nbsp;${q}&nbsp; .-> `:` -- &nbsp;${q}&nbsp; --> `}else $=j?" -.-> ":" --> ";h+=`	${ug(E)}${$}${ug(R)};
`}for(const x in p)x.startsWith(`${v}:`)&&x!==v&&_(p[x],x);v&&!S&&(h+=`	end
`)}_(p[""]??[],"");for(const b in p)!b.includes(":")&&b!==""&&_(p[b],b);return u&&(h+=RP(o??{})),h}async function CP(r,e){let{backgroundColor:t="white"}=e??{};const n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const a=`https://mermaid.ink/img/${n}?bgColor=${t}`,o=await fetch(a);if(!o.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${o.status}`,`Status text: ${o.statusText}`].join(`
`));return await o.blob()}const kP=Symbol("Let zodToJsonSchema decide on which parser to use"),jP={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},$P=r=>({...jP,...r}),IP=r=>{const e=$P(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function rO(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Ke(r,e,t,n,a){r[e]=t,rO(r,e,n,a)}const aO=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function kn(r){if(r.target!=="openAi")return{};const e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?aO(e,r.currentPath):e.join("/")}}function PP(r,e){var n,a,o;const t={type:"array"};return(n=r.type)!=null&&n._def&&((o=(a=r.type)==null?void 0:a._def)==null?void 0:o.typeName)!==G.ZodAny&&(t.items=Ze(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ke(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ke(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ke(t,"minItems",r.exactLength.value,r.exactLength.message,e),Ke(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function MP(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ke(t,"minimum",n.value,n.message,e):Ke(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ke(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ke(t,"maximum",n.value,n.message,e):Ke(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ke(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ke(t,"multipleOf",n.value,n.message,e);break}return t}function LP(){return{type:"boolean"}}function sO(r,e){return Ze(r.type._def,e)}const DP=(r,e)=>Ze(r.innerType._def,e);function iO(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>iO(r,e,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return UP(r,e)}}const UP=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Ke(t,"minimum",n.value,n.message,e);break;case"max":Ke(t,"maximum",n.value,n.message,e);break}return t};function zP(r,e){return{...Ze(r.innerType._def,e),default:r.defaultValue()}}function BP(r,e){return e.effectStrategy==="input"?Ze(r.schema._def,e):kn(e)}function qP(r){return{type:"string",enum:Array.from(r.values)}}const HP=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function GP(r,e){const t=[Ze(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Ze(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return t.forEach(o=>{if(HP(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let u=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:d,...f}=o;u=f}else n=void 0;a.push(u)}}),a.length?{allOf:a,...n}:void 0}function FP(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let cg;const Xn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(cg===void 0&&(cg=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),cg),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function oO(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":Ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":Ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Qn(t,"email",n.message,e);break;case"format:idn-email":Qn(t,"idn-email",n.message,e);break;case"pattern:zod":Yt(t,Xn.email,n.message,e);break}break;case"url":Qn(t,"uri",n.message,e);break;case"uuid":Qn(t,"uuid",n.message,e);break;case"regex":Yt(t,n.regex,n.message,e);break;case"cuid":Yt(t,Xn.cuid,n.message,e);break;case"cuid2":Yt(t,Xn.cuid2,n.message,e);break;case"startsWith":Yt(t,RegExp(`^${dg(n.value,e)}`),n.message,e);break;case"endsWith":Yt(t,RegExp(`${dg(n.value,e)}$`),n.message,e);break;case"datetime":Qn(t,"date-time",n.message,e);break;case"date":Qn(t,"date",n.message,e);break;case"time":Qn(t,"time",n.message,e);break;case"duration":Qn(t,"duration",n.message,e);break;case"length":Ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),Ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Yt(t,RegExp(dg(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&Qn(t,"ipv4",n.message,e),n.version!=="v4"&&Qn(t,"ipv6",n.message,e);break}case"base64url":Yt(t,Xn.base64url,n.message,e);break;case"jwt":Yt(t,Xn.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Yt(t,Xn.ipv4Cidr,n.message,e),n.version!=="v4"&&Yt(t,Xn.ipv6Cidr,n.message,e);break}case"emoji":Yt(t,Xn.emoji(),n.message,e);break;case"ulid":{Yt(t,Xn.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Qn(t,"binary",n.message,e);break}case"contentEncoding:base64":{Ke(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Yt(t,Xn.base64,n.message,e);break}}break}case"nanoid":Yt(t,Xn.nanoid,n.message,e)}return t}function dg(r,e){return e.patternStrategy==="escape"?VP(r):r}const ZP=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function VP(r){let e="";for(let t=0;t<r.length;t++)ZP.has(r[t])||(e+="\\"),e+=r[t];return e}function Qn(r,e,t,n){var a;r.format||(a=r.anyOf)!=null&&a.some(o=>o.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Ke(r,"format",e,t,n)}function Yt(r,e,t,n){var a;r.pattern||(a=r.allOf)!=null&&a.some(o=>o.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:qx(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Ke(r,"pattern",qx(e,n),t,n)}function qx(r,e){var f;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let a="",o=!1,u=!1,d=!1;for(let h=0;h<n.length;h++){if(o){a+=n[h],o=!1;continue}if(t.i){if(u){if(n[h].match(/[a-z]/)){d?(a+=n[h],a+=`${n[h-2]}-${n[h]}`.toUpperCase(),d=!1):n[h+1]==="-"&&((f=n[h+2])!=null&&f.match(/[a-z]/))?(a+=n[h],d=!0):a+=`${n[h]}${n[h].toUpperCase()}`;continue}}else if(n[h].match(/[a-z]/)){a+=`[${n[h]}${n[h].toUpperCase()}]`;continue}}if(t.m){if(n[h]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(n[h]==="$"){a+=`($|(?=[\r
]))`;continue}}if(t.s&&n[h]==="."){a+=u?`${n[h]}\r
`:`[${n[h]}\r
]`;continue}a+=n[h],n[h]==="\\"?o=!0:u&&n[h]==="]"?u=!1:!u&&n[h]==="["&&(u=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return a}function lO(r,e){var n,a,o,u,d,f;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===G.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((h,p)=>({...h,[p]:Ze(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",p]})??kn(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Ze(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((a=r.keyType)==null?void 0:a._def.typeName)===G.ZodString&&((o=r.keyType._def.checks)!=null&&o.length)){const{type:h,...p}=oO(r.keyType._def,e);return{...t,propertyNames:p}}else{if(((u=r.keyType)==null?void 0:u._def.typeName)===G.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((d=r.keyType)==null?void 0:d._def.typeName)===G.ZodBranded&&r.keyType._def.type._def.typeName===G.ZodString&&((f=r.keyType._def.type._def.checks)!=null&&f.length)){const{type:h,...p}=sO(r.keyType._def,e);return{...t,propertyNames:p}}}return t}function JP(r,e){if(e.mapStrategy==="record")return lO(r,e);const t=Ze(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||kn(e),n=Ze(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||kn(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function KP(r){const e=r.values,n=Object.keys(r.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function YP(r){return r.target==="openAi"?void 0:{not:kn({...r,currentPath:[...r.currentPath,"not"]})}}function XP(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Dd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function QP(r,e){if(e.target==="openApi3")return Hx(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Dd&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((a,o)=>{const u=Dd[o._def.typeName];return u&&!a.includes(u)?[...a,u]:a},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((a,o)=>{const u=typeof o._def.value;switch(u){case"string":case"number":case"boolean":return[...a,u];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===t.length){const a=n.filter((o,u,d)=>d.indexOf(o)===u);return{type:a.length>1?a:a[0],enum:t.reduce((o,u)=>o.includes(u._def.value)?o:[...o,u._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return Hx(r,e)}const Hx=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,a)=>Ze(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function WP(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Dd[r.innerType._def.typeName],nullable:!0}:{type:[Dd[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Ze(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Ze(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function eM(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",rO(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ke(t,"minimum",n.value,n.message,e):Ke(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ke(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ke(t,"maximum",n.value,n.message,e):Ke(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ke(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ke(t,"multipleOf",n.value,n.message,e);break}return t}function tM(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},a=[],o=r.shape();for(const d in o){let f=o[d];if(f===void 0||f._def===void 0)continue;let h=rM(f);h&&t&&(f._def.typeName==="ZodOptional"&&(f=f._def.innerType),f.isNullable()||(f=f.nullable()),h=!1);const p=Ze(f._def,{...e,currentPath:[...e.currentPath,"properties",d],propertyPath:[...e.currentPath,"properties",d]});p!==void 0&&(n.properties[d]=p,h||a.push(d))}a.length&&(n.required=a);const u=nM(r,e);return u!==void 0&&(n.additionalProperties=u),n}function nM(r,e){if(r.catchall._def.typeName!=="ZodNever")return Ze(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function rM(r){try{return r.isOptional()}catch{return!0}}const aM=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Ze(r.innerType._def,e);const t=Ze(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:kn(e)},t]}:kn(e)},sM=(r,e)=>{if(e.pipeStrategy==="input")return Ze(r.in._def,e);if(e.pipeStrategy==="output")return Ze(r.out._def,e);const t=Ze(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Ze(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(a=>a!==void 0)}};function iM(r,e){return Ze(r.type._def,e)}function oM(r,e){const n={type:"array",uniqueItems:!0,items:Ze(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ke(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ke(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function lM(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Ze(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Ze(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Ze(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function uM(r){return{not:kn(r)}}function cM(r){return kn(r)}const dM=(r,e)=>Ze(r.innerType._def,e),fM=(r,e,t)=>{switch(e){case G.ZodString:return oO(r,t);case G.ZodNumber:return eM(r,t);case G.ZodObject:return tM(r,t);case G.ZodBigInt:return MP(r,t);case G.ZodBoolean:return LP();case G.ZodDate:return iO(r,t);case G.ZodUndefined:return uM(t);case G.ZodNull:return XP(t);case G.ZodArray:return PP(r,t);case G.ZodUnion:case G.ZodDiscriminatedUnion:return QP(r,t);case G.ZodIntersection:return GP(r,t);case G.ZodTuple:return lM(r,t);case G.ZodRecord:return lO(r,t);case G.ZodLiteral:return FP(r,t);case G.ZodEnum:return qP(r);case G.ZodNativeEnum:return KP(r);case G.ZodNullable:return WP(r,t);case G.ZodOptional:return aM(r,t);case G.ZodMap:return JP(r,t);case G.ZodSet:return oM(r,t);case G.ZodLazy:return()=>r.getter()._def;case G.ZodPromise:return iM(r,t);case G.ZodNaN:case G.ZodNever:return YP(t);case G.ZodEffects:return BP(r,t);case G.ZodAny:return kn(t);case G.ZodUnknown:return cM(t);case G.ZodDefault:return zP(r,t);case G.ZodBranded:return sO(r,t);case G.ZodReadonly:return dM(r,t);case G.ZodCatch:return DP(r,t);case G.ZodPipeline:return sM(r,t);case G.ZodFunction:case G.ZodVoid:case G.ZodSymbol:return;default:return(n=>{})()}};function Ze(r,e,t=!1){var d;const n=e.seen.get(r);if(e.override){const f=(d=e.override)==null?void 0:d.call(e,r,e,n,t);if(f!==kP)return f}if(n&&!t){const f=hM(n,e);if(f!==void 0)return f}const a={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,a);const o=fM(r,r.typeName,e),u=typeof o=="function"?Ze(o(),e):o;if(u&&mM(r,e,u),e.postProcess){const f=e.postProcess(u,r,e);return a.jsonSchema=u,f}return a.jsonSchema=u,u}const hM=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:aO(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),kn(e)):e.$refStrategy==="seen"?kn(e):void 0}},mM=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),pM=(r,e)=>{const t=IP(e);let n;const a=e==null?void 0:e.name,o=Ze(r._def,t,!1)??kn(t);t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));const u=a===void 0?n?{...o,[t.definitionPath]:n}:o:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,a].join("/"),[t.definitionPath]:{...n,[a]:o}};return t.target==="jsonSchema7"?u.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u};function ry(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let a=0;a<n;a++)if(!ry(r[a],e[a]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),a=Object.keys(e);if(n.length!==a.length)return!1;for(const u of n)if(!ry(r[u],e[u]))return!1;return!0}return r===e}function dr(r){if(typeof r!="object"||r===null)return!1;const e=r;if(!("_zod"in e))return!1;const t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function Tr(r){if(typeof r!="object"||r===null)return!1;const e=r;if(!("_def"in e)||"_zod"in e)return!1;const t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function Xr(r){return!r||typeof r!="object"||Array.isArray(r)?!1:!!(dr(r)||Tr(r))}async function uO(r,e){if(dr(r))try{return{success:!0,data:await $k(r,e)}}catch(t){return{success:!1,error:t}}if(Tr(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function cO(r,e){if(dr(r))return C1(r,e);if(Tr(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function t_(r){var e;if(dr(r))return(e=Ia.get(r))==null?void 0:e.description;if(Tr(r)||"description"in r&&typeof r.description=="string")return r.description}function gM(r){return Xr(r)?Tr(r)?r._def.typeName==="ZodString":dr(r)?r._zod.def.type==="string":!1:!1}function Nl(r){return dr(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="object":!1}function dO(r){return dr(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="array":!1}function ay(r,e=!1){if(Tr(r))return r.strict();if(Nl(r)){const t=r._zod.def.shape;if(e)for(const[o,u]of Object.entries(r._zod.def.shape)){if(Nl(u)){const f=ay(u,e);t[o]=f}else if(dO(u)){let f=u._zod.def.element;Nl(f)&&(f=ay(f,e)),t[o]=Cd(u,{...u._zod.def,element:f})}else t[o]=u;const d=Ia.get(u);d&&Ia.add(t[o],d)}const n=Cd(r,{...r._zod.def,shape:t,catchall:qk(zk)}),a=Ia.get(r);return a&&Ia.add(n,a),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function yM(r){return Tr(r)&&"typeName"in r._def&&r._def.typeName==="ZodEffects"}function _M(r){return dr(r)&&r._zod.def.type==="pipe"}function bl(r,e=!1){if(Tr(r))return yM(r)?bl(r._def.schema,e):r;if(dr(r)){let t=r;if(_M(r)&&(t=bl(r._zod.def.in,e)),e){if(Nl(t)){const a=t._zod.def.shape;for(const[o,u]of Object.entries(t._zod.def.shape))a[o]=bl(u,e);t=Cd(t,{...t._zod.def,shape:a})}else if(dO(t)){const a=bl(t._zod.def.element,e);t=Cd(t,{...t._zod.def,element:a})}}const n=Ia.get(r);return n&&Ia.add(t,n),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Zn(r){if(dr(r)){const e=bl(r,!0);if(Nl(e)){const t=ay(e,!0);return Jg(t)}else return Jg(r)}return Tr(r)?pM(r):r}function bM(r,e){if(r!==void 0&&!ud(r))return r;if(e_(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function vM(r){return e_(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...Zn(r.data.schema),title:r.data.name}}}class pf{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=ud(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...vM(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const a=t??Jr(),o={id:a,data:e,name:bM(t,e),metadata:n};return this.nodes[a]=o,o}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const o={source:e.id,target:t.id,data:n,conditional:a};return this.edges.push(o),o}firstNode(){return Gx(this)}lastNode(){return Fx(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(h=>h.id).every(ud)&&(n="");const o=h=>n?`${n}:${h}`:h;Object.entries(e.nodes).forEach(([h,p])=>{this.nodes[o(h)]={...p,id:o(h)}});const u=e.edges.map(h=>({...h,source:o(h.source),target:o(h.target)}));this.edges=[...this.edges,...u];const d=e.firstNode(),f=e.lastNode();return[d?{id:o(d.id),data:d.data}:void 0,f?{id:o(f.id),data:f.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Gx(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Fx(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(a=>[a.id,a.name])),t=new Map;Object.values(e).forEach(a=>{t.set(a,(t.get(a)||0)+1)});const n=a=>{const o=e[a];return ud(a)&&t.get(o)===1?o:a};return new pf({nodes:Object.fromEntries(Object.entries(this.nodes).map(([a,o])=>[n(a),{...o,id:n(a)}])),edges:this.edges.map(a=>({...a,source:n(a.source),target:n(a.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:o}=e??{},u=this.reid(),d=u.firstNode(),f=u.lastNode();return NP(u.nodes,u.edges,{firstNode:d==null?void 0:d.id,lastNode:f==null?void 0:f.id,withStyles:t,curveStyle:n,nodeColors:a,wrapLabelNWords:o})}async drawMermaidPng(e){const t=this.drawMermaid(e);return CP(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function Gx(r,e=[]){const t=new Set(r.edges.filter(a=>!e.includes(a.source)).map(a=>a.target)),n=[];for(const a of Object.values(r.nodes))!e.includes(a.id)&&!t.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function Fx(r,e=[]){const t=new Set(r.edges.filter(a=>!e.includes(a.target)).map(a=>a.source)),n=[];for(const a of Object.values(r.nodes))!e.includes(a.id)&&!t.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function wM(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const a of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Cn.fromReadableStream(t)}function Zx(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const SM=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function sy(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*Vx(r,e){for(;;){const{value:t,done:n}=Ua.runWithConfig(ji(r),e.next.bind(e),!0);if(n)break;yield t}}async function*iy(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:a}=await Ua.runWithConfig(ji(r),t.next.bind(e),!0);if(a)break;yield n}}function $t(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}class It extends ys{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new ms({bound:this,kwargs:e,config:{}})}map(){return new Ud({bound:this})}withRetry(e){return new fO({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new ms({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new EM({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Fe);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([a])=>a!=="runId"));return Array.from({length:t},(a,o)=>Fe(o===0?e:n))}return Array.from({length:t},()=>Fe(e))}async batch(e,t,n){var f;const a=this._getOptionsList(t??{},e.length),o=((f=a[0])==null?void 0:f.maxConcurrency)??(n==null?void 0:n.maxConcurrency),u=new Wy({maxConcurrency:o,onFailedAttempt:h=>{throw h}}),d=e.map((h,p)=>u.call(async()=>{try{return await this.invoke(h,a[p])}catch(y){if(n!=null&&n.returnExceptions)return y;throw y}}));return Promise.all(d)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Fe(t),a=new Bi({generator:this._streamIterator(e,n),config:n});return await a.setup,Cn.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Fe(e):t=Fe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const a=Fe(n),o=await sr(a),u=await(o==null?void 0:o.handleChainStart(this.toJSON(),$t(t,"input"),a.runId,a==null?void 0:a.runType,void 0,void 0,(a==null?void 0:a.runName)??this.getName()));delete a.runId;let d;try{const f=e.call(this,t,a,u);d=await za(f,n==null?void 0:n.signal)}catch(f){throw await(u==null?void 0:u.handleChainError(f)),f}return await(u==null?void 0:u.handleChainEnd($t(d,"output"))),d}async _batchWithConfig(e,t,n,a){var h;const o=this._getOptionsList(n??{},t.length),u=await Promise.all(o.map(sr)),d=await Promise.all(u.map(async(p,y)=>{const _=await(p==null?void 0:p.handleChainStart(this.toJSON(),$t(t[y],"input"),o[y].runId,o[y].runType,void 0,void 0,o[y].runName??this.getName()));return delete o[y].runId,_}));let f;try{const p=e.call(this,t,o,d,a);f=await za(p,(h=o==null?void 0:o[0])==null?void 0:h.signal)}catch(p){throw await Promise.all(d.map(y=>y==null?void 0:y.handleChainError(p))),p}return await Promise.all(d.map(p=>p==null?void 0:p.handleChainEnd($t(f,"output")))),f}async*_transformStreamWithConfig(e,t,n){let a,o=!0,u,d=!0;const f=Fe(n),h=await sr(f);async function*p(){for await(const _ of e){if(o)if(a===void 0)a=_;else try{a=ir(a,_)}catch{a=void 0,o=!1}yield _}}let y;try{const _=await bP(t.bind(this),p(),async()=>h==null?void 0:h.handleChainStart(this.toJSON(),{input:""},f.runId,f.runType,void 0,void 0,f.runName??this.getName()),n==null?void 0:n.signal,f);delete f.runId,y=_.setup;const b=y==null?void 0:y.handlers.find(SP);let v=_.output;b!==void 0&&y!==void 0&&(v=b.tapOutputIterable(y.runId,v));const S=y==null?void 0:y.handlers.find(vP);S!==void 0&&y!==void 0&&(v=S.tapOutputIterable(y.runId,v));for await(const x of v)if(yield x,d)if(u===void 0)u=x;else try{u=ir(u,x)}catch{u=void 0,d=!1}}catch(_){throw await(y==null?void 0:y.handleChainError(_,void 0,void 0,void 0,{inputs:$t(a,"input")})),_}await(y==null?void 0:y.handleChainEnd(u??{},void 0,void 0,void 0,{inputs:$t(a,"input")}))}getGraph(e){const t=new pf,n=t.addNode({name:`${this.getName()}Input`,schema:Il()}),a=t.addNode(this),o=t.addNode({name:`${this.getName()}Output`,schema:Il()});return t.addEdge(n,a),t.addEdge(a,o),t}pipe(e){return new Sr({first:this,last:hs(e)})}pick(e){return this.pipe(new AM(e))}assign(e){return this.pipe(new hO(new qi({steps:e})))}async*transform(e,t){let n;for await(const a of e)n===void 0?n=a:n=ir(n,a);yield*this._streamIterator(n,Fe(t))}async*streamLog(e,t,n){const a=new zx({...n,autoClose:!1,_schemaFormat:"original"}),o=Fe(t);yield*this._streamLog(e,a,o)}async*_streamLog(e,t,n){const{callbacks:a}=n;if(a===void 0)n.callbacks=[t];else if(Array.isArray(a))n.callbacks=a.concat([t]);else{const f=a.copy();f.addHandler(t,!0),n.callbacks=f}const o=this.stream(e,n);async function u(){try{const f=await o;for await(const h of f){const p=new ja({ops:[{op:"add",path:"/streamed_output/-",value:h}]});await t.writer.write(p)}}finally{await t.writer.close()}}const d=u();try{for await(const f of t)yield f}finally{await d}}streamEvents(e,t,n){let a;if(t.version==="v1")a=this._streamEventsV1(e,t,n);else if(t.version==="v2")a=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?wM(a):Cn.fromAsyncGenerator(a)}async*_streamEventsV2(e,t,n){var v;const a=new xP({...n,autoClose:!1}),o=Fe(t),u=o.runId??Jr();o.runId=u;const d=o.callbacks;if(d===void 0)o.callbacks=[a];else if(Array.isArray(d))o.callbacks=d.concat(a);else{const S=d.copy();S.addHandler(a,!0),o.callbacks=S}const f=new AbortController,h=this;async function p(){let S,x=null;try{t!=null&&t.signal?"any"in AbortSignal?S=AbortSignal.any([f.signal,t.signal]):(S=t.signal,x=()=>{f.abort()},t.signal.addEventListener("abort",x,{once:!0})):S=f.signal;const E=await h.stream(e,{...o,signal:S}),R=a.tapOutputIterable(u,E);for await(const T of R)if(f.signal.aborted)break}finally{await a.finish(),S&&x&&S.removeEventListener("abort",x)}}const y=p();let _=!1,b;try{for await(const S of a){if(!_){S.data.input=e,_=!0,b=S.run_id,yield S;continue}S.run_id===b&&S.event.endsWith("_end")&&(v=S.data)!=null&&v.input&&delete S.data.input,yield S}}finally{f.abort(),await y}}async*_streamEventsV1(e,t,n){let a,o=!1;const u=Fe(t),d=u.tags??[],f=u.metadata??{},h=u.runName??this.getName(),p=new zx({...n,autoClose:!1,_schemaFormat:"streaming_events"}),y=new OP({...n}),_=this._streamLog(e,p,u);for await(const v of _){if(a?a=a.concat(v):a=Bl.fromRunLogPatch(v),a.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!o){o=!0;const R={...a.state},T={run_id:R.id,event:`on_${R.type}_start`,name:h,tags:d,metadata:f,data:{input:e}};y.includeEvent(T,R.type)&&(yield T)}const S=v.ops.filter(R=>R.path.startsWith("/logs/")).map(R=>R.path.split("/")[2]),x=[...new Set(S)];for(const R of x){let T,j={};const $=a.state.logs[R];if($.end_time===void 0?$.streamed_output.length>0?T="stream":T="start":T="end",T==="start")$.inputs!==void 0&&(j.input=$.inputs);else if(T==="end")$.inputs!==void 0&&(j.input=$.inputs),j.output=$.final_output;else if(T==="stream"){const q=$.streamed_output.length;if(q!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${q} instead. Encountered in: "${$.name}"`);j={chunk:$.streamed_output[0]},$.streamed_output=[]}yield{event:`on_${$.type}_${T}`,name:$.name,run_id:$.id,tags:$.tags,metadata:$.metadata,data:j}}const{state:E}=a;if(E.streamed_output.length>0){const R=E.streamed_output.length;if(R!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${R} instead. Encountered in: "${E.name}"`);const T={chunk:E.streamed_output[0]};E.streamed_output=[];const j={event:`on_${E.type}_stream`,run_id:E.id,tags:d,metadata:f,name:h,data:T};y.includeEvent(j,E.type)&&(yield j)}}const b=a==null?void 0:a.state;if(b!==void 0){const v={event:`on_${b.type}_end`,name:h,run_id:b.id,tags:d,metadata:f,data:{output:b.final_output}};y.includeEvent(v,b.type)&&(yield v)}}static isRunnable(e){return e_(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new ms({bound:this,config:{},configFactories:[a=>({callbacks:[new nO({config:a,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return OM(this,e)}}class ms extends It{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Lx(this.config,...e);return Lx(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new fO({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Fe(t),this.kwargs))}async batch(e,t,n){const a=Array.isArray(t)?await Promise.all(t.map(async o=>this._mergeConfig(Fe(o),this.kwargs))):await this._mergeConfig(Fe(t),this.kwargs);return this.bound.batch(e,a,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Fe(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Fe(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Fe(t),this.kwargs))}streamEvents(e,t,n){const a=this,o=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig(Fe(t),a.kwargs),version:t.version},n)};return Cn.fromAsyncGenerator(o())}static isRunnableBinding(e){return e.bound&&It.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new ms({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new nO({config:a,onStart:e,onEnd:t,onError:n})]})]})}}class Ud extends It{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Ud({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,Ft(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new Ud({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class fO extends ms{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const a=e>1?`retry:attempt:${e}`:void 0;return Ft(t,{callbacks:n==null?void 0:n.getChild(a)})}async _invoke(e,t,n){return jd(a=>super.invoke(e,this._patchConfigForRetry(a,t,n)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,a){const o={};try{await jd(async u=>{const d=e.map((_,b)=>b).filter(_=>o[_.toString()]===void 0||o[_.toString()]instanceof Error),f=d.map(_=>e[_]),h=d.map(_=>this._patchConfigForRetry(u,t==null?void 0:t[_],n==null?void 0:n[_])),p=await super.batch(f,h,{...a,returnExceptions:!0});let y;for(let _=0;_<p.length;_+=1){const b=p[_],v=d[_];b instanceof Error&&y===void 0&&(y=b,y.input=f[_]),o[v.toString()]=b}if(y)throw y;return p},{onFailedAttempt:u=>this.onFailedAttempt(u,u.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(u){if((a==null?void 0:a.returnExceptions)!==!0)throw u}return Object.keys(o).sort((u,d)=>parseInt(u,10)-parseInt(d,10)).map(u=>o[parseInt(u,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class Sr extends It{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var f;const n=Fe(t),a=await sr(n),o=await(a==null?void 0:a.handleChainStart(this.toJSON(),$t(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let u=e,d;try{const h=[this.first,...this.middle];for(let p=0;p<h.length;p+=1){const _=h[p].invoke(u,Ft(n,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));u=await za(_,t==null?void 0:t.signal)}if((f=t==null?void 0:t.signal)!=null&&f.aborted)throw new Error("Aborted");d=await this.last.invoke(u,Ft(n,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}return await(o==null?void 0:o.handleChainEnd($t(d,"output"))),d}async batch(e,t,n){var f;const a=this._getOptionsList(t??{},e.length),o=await Promise.all(a.map(sr)),u=await Promise.all(o.map(async(h,p)=>{const y=await(h==null?void 0:h.handleChainStart(this.toJSON(),$t(e[p],"input"),a[p].runId,void 0,void 0,void 0,a[p].runName));return delete a[p].runId,y}));let d=e;try{for(let h=0;h<this.steps.length;h+=1){const y=this.steps[h].batch(d,u.map((_,b)=>{const v=_==null?void 0:_.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`);return Ft(a[b],{callbacks:v})}),n);d=await za(y,(f=a[0])==null?void 0:f.signal)}}catch(h){throw await Promise.all(u.map(p=>p==null?void 0:p.handleChainError(h))),h}return await Promise.all(u.map(h=>h==null?void 0:h.handleChainEnd($t(d,"output")))),d}async*_streamIterator(e,t){var y;const n=await sr(t),{runId:a,...o}=t??{},u=await(n==null?void 0:n.handleChainStart(this.toJSON(),$t(e,"input"),a,void 0,void 0,void 0,o==null?void 0:o.runName)),d=[this.first,...this.middle,this.last];let f=!0,h;async function*p(){yield e}try{let _=d[0].transform(p(),Ft(o,{callbacks:u==null?void 0:u.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let b=1;b<d.length;b+=1)_=await d[b].transform(_,Ft(o,{callbacks:u==null?void 0:u.getChild(this.omitSequenceTags?void 0:`seq:step:${b+1}`)}));for await(const b of _)if((y=t==null?void 0:t.signal)==null||y.throwIfAborted(),yield b,f)if(h===void 0)h=b;else try{h=ir(h,b)}catch{h=void 0,f=!1}}catch(_){throw await(u==null?void 0:u.handleChainError(_)),_}await(u==null?void 0:u.handleChainEnd($t(h,"output")))}getGraph(e){const t=new pf;let n=null;return this.steps.forEach((a,o)=>{const u=a.getGraph(e);o!==0&&u.trimFirstNode(),o!==this.steps.length-1&&u.trimLastNode(),t.extend(u);const d=u.firstNode();if(!d)throw new Error(`Runnable ${a} has no first node`);n&&t.addEdge(n,d),n=u.lastNode()}),t}pipe(e){return Sr.isRunnableSequence(e)?new Sr({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Sr({first:this.first,middle:[...this.middle,this.last],last:hs(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&It.isRunnable(e)}static from([e,...t],n){let a={};return typeof n=="string"?a.name=n:n!==void 0&&(a=n),new Sr({...a,first:hs(e),middle:t.slice(0,-1).map(hs),last:hs(t[t.length-1])})}}class qi extends It{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=hs(n)}static from(e){return new qi({steps:e})}async invoke(e,t){const n=Fe(t),a=await sr(n),o=await(a==null?void 0:a.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const u={};try{const d=Object.entries(this.steps).map(async([f,h])=>{u[f]=await h.invoke(e,Ft(n,{callbacks:o==null?void 0:o.getChild(`map:key:${f}`)}))});await za(Promise.all(d),t==null?void 0:t.signal)}catch(d){throw await(o==null?void 0:o.handleChainError(d)),d}return await(o==null?void 0:o.handleChainEnd(u)),u}async*_transform(e,t,n){const a={...this.steps},o=tO(e,Object.keys(a).length),u=new Map(Object.entries(a).map(([d,f],h)=>{const p=f.transform(o[h],Ft(n,{callbacks:t==null?void 0:t.getChild(`map:key:${d}`)}));return[d,p.next().then(y=>({key:d,gen:p,result:y}))]}));for(;u.size;){const d=Promise.race(u.values()),{key:f,result:h,gen:p}=await za(d,n==null?void 0:n.signal);u.delete(f),h.done||(yield{[f]:h.value},u.set(f,p.next().then(y=>({key:f,gen:p,result:y}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Fe(t),o=new Bi({generator:this.transform(n(),a),config:a});return await o.setup,Cn.fromAsyncGenerator(o)}}class n_ extends It{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Gy(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),a=await sr(n),o=this.func(Ft(n,{callbacks:a}),e);return za(o,n==null?void 0:n.signal)}async*_streamIterator(e,t){var o,u;const[n]=this._getOptionsList(t??{},1),a=await this.invoke(e,t);if(sy(a)){for await(const d of a)(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield d;return}if(SM(a)){for(;;){(u=n==null?void 0:n.signal)==null||u.throwIfAborted();const d=a.next();if(d.done)break;yield d.value}return}yield a}static from(e){return new n_({func:e})}}function xM(r){if(Gy(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class Hi extends It{static lc_name(){return"RunnableLambda"}constructor(e){if(Gy(e.func))return n_.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),xM(e.func),this.func=e.func}static from(e){return new Hi({func:e})}async _invoke(e,t,n){return new Promise((a,o)=>{const u=Ft(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??lg)-1});Ua.runWithConfig(ji(u),async()=>{var d,f;try{let h=await this.func(e,{...u});if(h&&It.isRunnable(h)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");h=await h.invoke(e,{...u,recursionLimit:(u.recursionLimit??lg)-1})}else if(sy(h)){let p;for await(const y of iy(u,h))if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),p===void 0)p=y;else try{p=ir(p,y)}catch{p=y}h=p}else if(Zx(h)){let p;for(const y of Vx(u,h))if((f=t==null?void 0:t.signal)==null||f.throwIfAborted(),p===void 0)p=y;else try{p=ir(p,y)}catch{p=y}h=p}a(h)}catch(h){o(h)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){var d,f;let a;for await(const h of e)if(a===void 0)a=h;else try{a=ir(a,h)}catch{a=h}const o=Ft(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??lg)-1}),u=await new Promise((h,p)=>{Ua.runWithConfig(ji(o),async()=>{try{const y=await this.func(a,{...o,config:o});h(y)}catch(y){p(y)}})});if(u&&It.isRunnable(u)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const h=await u.stream(a,o);for await(const p of h)yield p}else if(sy(u))for await(const h of iy(o,u))(d=n==null?void 0:n.signal)==null||d.throwIfAborted(),yield h;else if(Zx(u))for(const h of Vx(o,u))(f=n==null?void 0:n.signal)==null||f.throwIfAborted(),yield h;else yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Fe(t),o=new Bi({generator:this.transform(n(),a),config:a});return await o.setup,Cn.fromAsyncGenerator(o)}}class EM extends It{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Fe(t),a=await sr(n),{runId:o,...u}=n,d=await(a==null?void 0:a.handleChainStart(this.toJSON(),$t(e,"input"),o,void 0,void 0,void 0,u==null?void 0:u.runName)),f=Ft(u,{callbacks:d==null?void 0:d.getChild()});return await Ua.runWithConfig(f,async()=>{var y;let p;for(const _ of this.runnables()){(y=n==null?void 0:n.signal)==null||y.throwIfAborted();try{const b=await _.invoke(e,f);return await(d==null?void 0:d.handleChainEnd($t(b,"output"))),b}catch(b){p===void 0&&(p=b)}}throw p===void 0?new Error("No error stored at end of fallback."):(await(d==null?void 0:d.handleChainError(p)),p)})}async*_streamIterator(e,t){var y;const n=Fe(t),a=await sr(n),{runId:o,...u}=n,d=await(a==null?void 0:a.handleChainStart(this.toJSON(),$t(e,"input"),o,void 0,void 0,void 0,u==null?void 0:u.runName));let f,h;for(const _ of this.runnables()){(y=n==null?void 0:n.signal)==null||y.throwIfAborted();const b=Ft(u,{callbacks:d==null?void 0:d.getChild()});try{const v=await _.stream(e,b);h=iy(b,v);break}catch(v){f===void 0&&(f=v)}}if(h===void 0){const _=f??new Error("No error stored at end of fallback.");throw await(d==null?void 0:d.handleChainError(_)),_}let p;try{for await(const _ of h){yield _;try{p=p===void 0?p:ir(p,_)}catch{p=void 0}}}catch(_){throw await(d==null?void 0:d.handleChainError(_)),_}await(d==null?void 0:d.handleChainEnd($t(p,"output")))}async batch(e,t,n){var f;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),o=await Promise.all(a.map(h=>sr(h))),u=await Promise.all(o.map(async(h,p)=>{const y=await(h==null?void 0:h.handleChainStart(this.toJSON(),$t(e[p],"input"),a[p].runId,void 0,void 0,void 0,a[p].runName));return delete a[p].runId,y}));let d;for(const h of this.runnables()){(f=a[0].signal)==null||f.throwIfAborted();try{const p=await h.batch(e,u.map((y,_)=>Ft(a[_],{callbacks:y==null?void 0:y.getChild()})),n);return await Promise.all(u.map((y,_)=>y==null?void 0:y.handleChainEnd($t(p[_],"output")))),p}catch(p){d===void 0&&(d=p)}}throw d?(await Promise.all(u.map(h=>h==null?void 0:h.handleChainError(d))),d):new Error("No error stored at end of fallbacks.")}}function hs(r){if(typeof r=="function")return new Hi({func:r});if(It.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=hs(n);return new qi({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class hO extends It{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof qi&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const a=this.mapper.getStepsKeys(),[o,u]=tO(e),d=this.mapper.transform(u,Ft(n,{callbacks:t==null?void 0:t.getChild()})),f=d.next();for await(const h of o){if(typeof h!="object"||Array.isArray(h))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof h}`);const p=Object.fromEntries(Object.entries(h).filter(([y])=>!a.includes(y)));Object.keys(p).length>0&&(yield p)}yield(await f).value;for await(const h of d)yield h}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Fe(t),o=new Bi({generator:this.transform(n(),a),config:a});return await o.setup,Cn.fromAsyncGenerator(o)}}class AM extends It{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Fe(t),o=new Bi({generator:this.transform(n(),a),config:a});return await o.setup,Cn.fromAsyncGenerator(o)}}class Jx extends ms{constructor(e){const t=Sr.from([Hi.from(async n=>{let a;if(I1(n))try{a=await cO(this.schema,n.args)}catch{throw new ij("Received tool input did not match expected schema",JSON.stringify(n.args))}else a=n;return a}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function OM(r,e){const t=e.name??r.getName(),n=e.description??t_(e.schema);return gM(e.schema)?new Jx({name:t,description:n,schema:jt({input:xe()}).transform(a=>a.input),bound:r}):new Jx({name:t,description:n,schema:e.schema,bound:r})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var TM=typeof window=="object"?window:{},Ne="0123456789abcdef".split(""),RM=[-2147483648,8388608,32768,128],Wn=[24,16,8,0],Ct=[];function lr(r){r?(Ct[0]=Ct[16]=Ct[1]=Ct[2]=Ct[3]=Ct[4]=Ct[5]=Ct[6]=Ct[7]=Ct[8]=Ct[9]=Ct[10]=Ct[11]=Ct[12]=Ct[13]=Ct[14]=Ct[15]=0,this.blocks=Ct):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}lr.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===TM.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,a,o=r.length||0,u=this.blocks;n<o;){if(this.hashed&&(this.hashed=!1,u[0]=this.block,u[16]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0),e)for(a=this.start;n<o&&a<64;++n)u[a>>2]|=r[n]<<Wn[a++&3];else for(a=this.start;n<o&&a<64;++n)t=r.charCodeAt(n),t<128?u[a>>2]|=t<<Wn[a++&3]:t<2048?(u[a>>2]|=(192|t>>6)<<Wn[a++&3],u[a>>2]|=(128|t&63)<<Wn[a++&3]):t<55296||t>=57344?(u[a>>2]|=(224|t>>12)<<Wn[a++&3],u[a>>2]|=(128|t>>6&63)<<Wn[a++&3],u[a>>2]|=(128|t&63)<<Wn[a++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),u[a>>2]|=(240|t>>18)<<Wn[a++&3],u[a>>2]|=(128|t>>12&63)<<Wn[a++&3],u[a>>2]|=(128|t>>6&63)<<Wn[a++&3],u[a>>2]|=(128|t&63)<<Wn[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=u[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};lr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=RM[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};lr.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4,o,u,d,f=this.blocks;for(u=16;u<80;++u)d=f[u-3]^f[u-8]^f[u-14]^f[u-16],f[u]=d<<1|d>>>31;for(u=0;u<20;u+=5)o=e&t|~e&n,d=r<<5|r>>>27,a=d+o+a+1518500249+f[u]<<0,e=e<<30|e>>>2,o=r&e|~r&t,d=a<<5|a>>>27,n=d+o+n+1518500249+f[u+1]<<0,r=r<<30|r>>>2,o=a&r|~a&e,d=n<<5|n>>>27,t=d+o+t+1518500249+f[u+2]<<0,a=a<<30|a>>>2,o=n&a|~n&r,d=t<<5|t>>>27,e=d+o+e+1518500249+f[u+3]<<0,n=n<<30|n>>>2,o=t&n|~t&a,d=e<<5|e>>>27,r=d+o+r+1518500249+f[u+4]<<0,t=t<<30|t>>>2;for(;u<40;u+=5)o=e^t^n,d=r<<5|r>>>27,a=d+o+a+1859775393+f[u]<<0,e=e<<30|e>>>2,o=r^e^t,d=a<<5|a>>>27,n=d+o+n+1859775393+f[u+1]<<0,r=r<<30|r>>>2,o=a^r^e,d=n<<5|n>>>27,t=d+o+t+1859775393+f[u+2]<<0,a=a<<30|a>>>2,o=n^a^r,d=t<<5|t>>>27,e=d+o+e+1859775393+f[u+3]<<0,n=n<<30|n>>>2,o=t^n^a,d=e<<5|e>>>27,r=d+o+r+1859775393+f[u+4]<<0,t=t<<30|t>>>2;for(;u<60;u+=5)o=e&t|e&n|t&n,d=r<<5|r>>>27,a=d+o+a-1894007588+f[u]<<0,e=e<<30|e>>>2,o=r&e|r&t|e&t,d=a<<5|a>>>27,n=d+o+n-1894007588+f[u+1]<<0,r=r<<30|r>>>2,o=a&r|a&e|r&e,d=n<<5|n>>>27,t=d+o+t-1894007588+f[u+2]<<0,a=a<<30|a>>>2,o=n&a|n&r|a&r,d=t<<5|t>>>27,e=d+o+e-1894007588+f[u+3]<<0,n=n<<30|n>>>2,o=t&n|t&a|n&a,d=e<<5|e>>>27,r=d+o+r-1894007588+f[u+4]<<0,t=t<<30|t>>>2;for(;u<80;u+=5)o=e^t^n,d=r<<5|r>>>27,a=d+o+a-899497514+f[u]<<0,e=e<<30|e>>>2,o=r^e^t,d=a<<5|a>>>27,n=d+o+n-899497514+f[u+1]<<0,r=r<<30|r>>>2,o=a^r^e,d=n<<5|n>>>27,t=d+o+t-899497514+f[u+2]<<0,a=a<<30|a>>>2,o=n^a^r,d=t<<5|t>>>27,e=d+o+e-899497514+f[u+3]<<0,n=n<<30|n>>>2,o=t^n^a,d=e<<5|e>>>27,r=d+o+r-899497514+f[u+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+a<<0};lr.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4;return Ne[r>>28&15]+Ne[r>>24&15]+Ne[r>>20&15]+Ne[r>>16&15]+Ne[r>>12&15]+Ne[r>>8&15]+Ne[r>>4&15]+Ne[r&15]+Ne[e>>28&15]+Ne[e>>24&15]+Ne[e>>20&15]+Ne[e>>16&15]+Ne[e>>12&15]+Ne[e>>8&15]+Ne[e>>4&15]+Ne[e&15]+Ne[t>>28&15]+Ne[t>>24&15]+Ne[t>>20&15]+Ne[t>>16&15]+Ne[t>>12&15]+Ne[t>>8&15]+Ne[t>>4&15]+Ne[t&15]+Ne[n>>28&15]+Ne[n>>24&15]+Ne[n>>20&15]+Ne[n>>16&15]+Ne[n>>12&15]+Ne[n>>8&15]+Ne[n>>4&15]+Ne[n&15]+Ne[a>>28&15]+Ne[a>>24&15]+Ne[a>>20&15]+Ne[a>>16&15]+Ne[a>>12&15]+Ne[a>>8&15]+Ne[a>>4&15]+Ne[a&15]};lr.prototype.toString=lr.prototype.hex;lr.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,a>>24&255,a>>16&255,a>>8&255,a&255]};lr.prototype.array=lr.prototype.digest;lr.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};let Kx=!1;const NM=r=>(Kx||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","└> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),Kx=!0),new lr(!0).update(r).hex()),CM=(...r)=>NM(r.join("_"));class kM{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:CM})}makeDefaultKeyEncoder(e){this.keyEncoder=e}}const jM=new Map;class r_ extends kM{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,n){this.cache.set(this.keyEncoder(e,t),n)}static global(){return new r_(jM)}}class mO extends ys{}class $M extends mO{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new ki(this.value)]}}class IM extends mO{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return P1(this.messages)}toChatMessages(){return this.messages}}var Ko={},Yx;function PM(){if(Yx)return Ko;Yx=1,Ko.byteLength=d,Ko.toByteArray=h,Ko.fromByteArray=_;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)r[a]=n[a],e[n.charCodeAt(a)]=a;e[45]=62,e[95]=63;function u(b){var v=b.length;if(v%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var S=b.indexOf("=");S===-1&&(S=v);var x=S===v?0:4-S%4;return[S,x]}function d(b){var v=u(b),S=v[0],x=v[1];return(S+x)*3/4-x}function f(b,v,S){return(v+S)*3/4-S}function h(b){var v,S=u(b),x=S[0],E=S[1],R=new t(f(b,x,E)),T=0,j=E>0?x-4:x,$;for($=0;$<j;$+=4)v=e[b.charCodeAt($)]<<18|e[b.charCodeAt($+1)]<<12|e[b.charCodeAt($+2)]<<6|e[b.charCodeAt($+3)],R[T++]=v>>16&255,R[T++]=v>>8&255,R[T++]=v&255;return E===2&&(v=e[b.charCodeAt($)]<<2|e[b.charCodeAt($+1)]>>4,R[T++]=v&255),E===1&&(v=e[b.charCodeAt($)]<<10|e[b.charCodeAt($+1)]<<4|e[b.charCodeAt($+2)]>>2,R[T++]=v>>8&255,R[T++]=v&255),R}function p(b){return r[b>>18&63]+r[b>>12&63]+r[b>>6&63]+r[b&63]}function y(b,v,S){for(var x,E=[],R=v;R<S;R+=3)x=(b[R]<<16&16711680)+(b[R+1]<<8&65280)+(b[R+2]&255),E.push(p(x));return E.join("")}function _(b){for(var v,S=b.length,x=S%3,E=[],R=16383,T=0,j=S-x;T<j;T+=R)E.push(y(b,T,T+R>j?j:T+R));return x===1?(v=b[S-1],E.push(r[v>>2]+r[v<<4&63]+"==")):x===2&&(v=(b[S-2]<<8)+b[S-1],E.push(r[v>>10]+r[v>>4&63]+r[v<<2&63]+"=")),E.join("")}return Ko}var MM=PM();const LM=vs(MM);var DM=Object.defineProperty,UM=(r,e,t)=>e in r?DM(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zM=(r,e,t)=>(UM(r,e+"",t),t);function BM(r,e){let t=Array.from({length:r.length},(n,a)=>({start:a,end:a+1}));for(;t.length>1;){let n=null;for(let a=0;a<t.length-1;a++){const o=r.slice(t[a].start,t[a+1].end),u=e.get(o.join(","));u!=null&&(n==null||u<n[0])&&(n=[u,a])}if(n!=null){const a=n[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function qM(r,e){return r.length===1?[e.get(r.join(","))]:BM(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function HM(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var oy=class{constructor(r,e){Jt(this,"specialTokens");Jt(this,"inverseSpecialTokens");Jt(this,"patStr");Jt(this,"textEncoder",new TextEncoder);Jt(this,"textDecoder",new TextDecoder("utf-8"));Jt(this,"rankMap",new Map);Jt(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,a)=>{const[o,u,...d]=a.split(" "),f=Number.parseInt(u,10);return d.forEach((h,p)=>n[h]=f+p),n},{});for(const[n,a]of Object.entries(t)){const o=LM.toByteArray(n);this.rankMap.set(o.join(","),a),this.textMap.set(a,o)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[a,o])=>(n[o]=this.textEncoder.encode(a),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),a=oy.specialTokenRegex(Object.keys(this.specialTokens)),o=[],u=new Set(e==="all"?Object.keys(this.specialTokens):e),d=new Set(t==="all"?Object.keys(this.specialTokens).filter(h=>!u.has(h)):t);if(d.size>0){const h=oy.specialTokenRegex([...d]),p=r.match(h);if(p!=null)throw new Error(`The text contains a special token that is not allowed: ${p[0]}`)}let f=0;for(;;){let h=null,p=f;for(;a.lastIndex=p,h=a.exec(r),!(h==null||u.has(h[0]));)p=h.index+1;const y=(h==null?void 0:h.index)??r.length;for(const b of r.substring(f,y).matchAll(n)){const v=this.textEncoder.encode(b[0]),S=this.rankMap.get(v.join(","));if(S!=null){o.push(S);continue}o.push(...qM(v,this.rankMap))}if(h==null)break;let _=this.specialTokens[h[0]];o.push(_),f=h.index+h[0].length}return o}decode(r){const e=[];let t=0;for(let o=0;o<r.length;++o){const u=r[o],d=this.textMap.get(u)??this.inverseSpecialTokens[u];d!=null&&(e.push(d),t+=d.length)}const n=new Uint8Array(t);let a=0;for(const o of e)n.set(o,a),a+=o.length;return this.textDecoder.decode(n)}},pO=oy;zM(pO,"specialTokenRegex",r=>new RegExp(r.map(e=>HM(e)).join("|"),"g"));function GM(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":return"o200k_base";default:throw new Error("Unknown model")}}const Pc={},FM=new Wy({});async function ZM(r){return r in Pc||(Pc[r]=FM.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new pO(e)).catch(e=>{throw delete Pc[r],e})),await Pc[r]}async function VM(r){return ZM(GM(r))}const JM=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function a_(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const KM=()=>!1;class YM extends It{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??KM(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class XM extends YM{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:a,...o}=n;super({callbacks:e??t,...o}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof a=="object"?this.cache=a:a?this.cache=r_.global():this.cache=void 0,this.caller=new Wy(n??{})}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(a=>typeof a=="string"?a:a.type==="text"&&"text"in a?a.text:"").join("");let n=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await VM("modelName"in this?JM(this.modelName):"gpt2")}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}if(this._encoding)try{n=this._encoding.encode(t).length}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new $M(e):Array.isArray(e)?new IM(e.map(_l)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([u,d])=>d!==void 0).map(([u,d])=>`${u}:${JSON.stringify(d)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class Ii extends It{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=Fe(t);return this.func&&await this.func(e,n),this._callWithConfig(a=>Promise.resolve(a),e,n)}async*transform(e,t){const n=Fe(t);let a,o=!0;for await(const u of this._transformStreamWithConfig(e,d=>d,n))if(yield u,o)if(a===void 0)a=u;else try{a=ir(a,u)}catch{a=void 0,o=!1}this.func&&a!==void 0&&await this.func(a,n)}static assign(e){return new hO(new qi({steps:e}))}}function fg(r){const e=[];for(const t of r){let n=t;if(Array.isArray(t.content))for(let a=0;a<t.content.length;a++){const o=t.content[a];(Yk(o)||Xk(o))&&n===t&&(n=new t.constructor({...n,content:[...t.content.slice(0,a),Qk(o),...t.content.slice(a+1)]}))}e.push(n)}return e}class Kr extends XM{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=Kr._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){var n;if(this._streamResponseChunks===Kr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const o=Kr._convertInputToPromptValue(e).toChatMessages(),[u,d]=this._separateRunnableConfigFromCallOptionsCompat(t),f={...u.metadata,...this.getLsParams(d)},h=await fn.configure(u.callbacks,this.callbacks,u.tags,this.tags,f,this.metadata,{verbose:this.verbose}),p={options:d,invocation_params:this==null?void 0:this.invocationParams(d),batch_size:1},y=await(h==null?void 0:h.handleChatModelStart(this.toJSON(),[fg(o)],u.runId,void 0,p,void 0,void 0,u.runName));let _,b;try{for await(const v of this._streamResponseChunks(o,d,y==null?void 0:y[0])){if(v.message.id==null){const S=(n=y==null?void 0:y.at(0))==null?void 0:n.runId;S!=null&&v.message._updateId(`run-${S}`)}v.message.response_metadata={...v.generationInfo,...v.message.response_metadata},yield v.message,_?_=_.concat(v):_=v,uS(v.message)&&v.message.usage_metadata!==void 0&&(b={tokenUsage:{promptTokens:v.message.usage_metadata.input_tokens,completionTokens:v.message.usage_metadata.output_tokens,totalTokens:v.message.usage_metadata.total_tokens}})}}catch(v){throw await Promise.all((y??[]).map(S=>S==null?void 0:S.handleLLMError(v))),v}await Promise.all((y??[]).map(v=>v==null?void 0:v.handleLLMEnd({generations:[[_]],llmOutput:b})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,a){var y,_;const o=e.map(b=>b.map(_l));let u;if(a!==void 0&&a.length===o.length)u=a;else{const b={...n.metadata,...this.getLsParams(t)},v=await fn.configure(n.callbacks,this.callbacks,n.tags,this.tags,b,this.metadata,{verbose:this.verbose}),S={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};u=await(v==null?void 0:v.handleChatModelStart(this.toJSON(),o.map(fg),n.runId,void 0,S,void 0,void 0,n.runName))}const d=[],f=[];if(!!(u!=null&&u[0].handlers.find(XI))&&!this.disableStreaming&&o.length===1&&this._streamResponseChunks!==Kr.prototype._streamResponseChunks)try{const b=await this._streamResponseChunks(o[0],t,u==null?void 0:u[0]);let v,S;for await(const x of b){if(x.message.id==null){const E=(y=u==null?void 0:u.at(0))==null?void 0:y.runId;E!=null&&x.message._updateId(`run-${E}`)}v===void 0?v=x:v=ir(v,x),uS(x.message)&&x.message.usage_metadata!==void 0&&(S={tokenUsage:{promptTokens:x.message.usage_metadata.input_tokens,completionTokens:x.message.usage_metadata.output_tokens,totalTokens:x.message.usage_metadata.total_tokens}})}if(v===void 0)throw new Error("Received empty response from chat model call.");d.push([v]),await(u==null?void 0:u[0].handleLLMEnd({generations:d,llmOutput:S}))}catch(b){throw await(u==null?void 0:u[0].handleLLMError(b)),b}else{const b=await Promise.allSettled(o.map((v,S)=>this._generate(v,{...t,promptIndex:S},u==null?void 0:u[S])));await Promise.all(b.map(async(v,S)=>{var x,E,R;if(v.status==="fulfilled"){const T=v.value;for(const j of T.generations){if(j.message.id==null){const $=(x=u==null?void 0:u.at(0))==null?void 0:x.runId;$!=null&&j.message._updateId(`run-${$}`)}j.message.response_metadata={...j.generationInfo,...j.message.response_metadata}}return T.generations.length===1&&(T.generations[0].message.response_metadata={...T.llmOutput,...T.generations[0].message.response_metadata}),d[S]=T.generations,f[S]=T.llmOutput,(E=u==null?void 0:u[S])==null?void 0:E.handleLLMEnd({generations:[T.generations],llmOutput:T.llmOutput})}else return await((R=u==null?void 0:u[S])==null?void 0:R.handleLLMError(v.reason)),Promise.reject(v.reason)}))}const p={generations:d,llmOutput:f.length?(_=this._combineLLMOutput)==null?void 0:_.call(this,...f):void 0};return Object.defineProperty(p,Bx,{value:u?{runIds:u==null?void 0:u.map(b=>b.runId)}:void 0,configurable:!0}),p}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:a,handledOptions:o}){const u=e.map(x=>x.map(_l)),d={...o.metadata,...this.getLsParams(a)},f=await fn.configure(o.callbacks,this.callbacks,o.tags,this.tags,d,this.metadata,{verbose:this.verbose}),h={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},p=await(f==null?void 0:f.handleChatModelStart(this.toJSON(),u.map(fg),o.runId,void 0,h,void 0,void 0,o.runName)),y=[],b=(await Promise.allSettled(u.map(async(x,E)=>{const R=Kr._convertInputToPromptValue(x).toString(),T=await t.lookup(R,n);return T==null&&y.push(E),T}))).map((x,E)=>({result:x,runManager:p==null?void 0:p[E]})).filter(({result:x})=>x.status==="fulfilled"&&x.value!=null||x.status==="rejected"),v=[];await Promise.all(b.map(async({result:x,runManager:E},R)=>{if(x.status==="fulfilled"){const T=x.value;return v[R]=T.map(j=>("message"in j&&af(j.message)&&Ui(j.message)&&(j.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),j.generationInfo={...j.generationInfo,tokenUsage:{}},j)),T.length&&await(E==null?void 0:E.handleLLMNewToken(T[0].text)),E==null?void 0:E.handleLLMEnd({generations:[T]},void 0,void 0,void 0,{cached:!0})}else return await(E==null?void 0:E.handleLLMError(x.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(x.reason)}));const S={generations:v,missingPromptIndices:y,startedRunManagers:p};return Object.defineProperty(S,Bx,{value:p?{runIds:p==null?void 0:p.map(x=>x.runId)}:void 0,configurable:!0}),S}async generate(e,t,n){let a;Array.isArray(t)?a={stop:t}:a=t;const o=e.map(v=>v.map(_l)),[u,d]=this._separateRunnableConfigFromCallOptionsCompat(a);if(u.callbacks=u.callbacks??n,!this.cache)return this._generateUncached(o,d,u);const{cache:f}=this,h=this._getSerializedCacheKeyParametersForCall(d),{generations:p,missingPromptIndices:y,startedRunManagers:_}=await this._generateCached({messages:o,cache:f,llmStringKey:h,parsedOptions:d,handledOptions:u});let b={};if(y.length>0){const v=await this._generateUncached(y.map(S=>o[S]),d,u,_!==void 0?y.map(S=>_==null?void 0:_[S]):void 0);await Promise.all(v.generations.map(async(S,x)=>{const E=y[x];p[E]=S;const R=Kr._convertInputToPromptValue(o[E]).toString();return f.update(R,h,S)})),b=v.llmOutput??{}}return{generations:p,llmOutput:b}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const a=e.map(o=>o.toChatMessages());return this.generate(a,t,n)}async call(e,t,n){return(await this.generate([e.map(_l)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const a=e.toChatMessages();return this.call(a,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const a=new ki(e),o=await this.call([a],t,n);if(typeof o.content!="string")throw new Error("Cannot use predict when output is not a string.");return o.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,a=t==null?void 0:t.name,o=t_(n)??"A function available to call.",u=t==null?void 0:t.method,d=t==null?void 0:t.includeRaw;if(u==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let f=a??"extract",h;Xr(n)?h=[{type:"function",function:{name:f,description:o,parameters:Zn(n)}}]:("name"in n&&(f=n.name),h=[{type:"function",function:{name:f,description:o,parameters:n}}]);const p=this.bindTools(h),y=Hi.from(S=>{if(!S.tool_calls||S.tool_calls.length===0)throw new Error("No tool calls found in the response.");const x=S.tool_calls.find(E=>E.name===f);if(!x)throw new Error(`No tool call found with name ${f}.`);return x.args});if(!d)return p.pipe(y).withConfig({runName:"StructuredOutput"});const _=Ii.assign({parsed:(S,x)=>y.invoke(S.raw,x)}),b=Ii.assign({parsed:()=>null}),v=_.withFallbacks({fallbacks:[b]});return Sr.from([{raw:p},v]).withConfig({runName:"StructuredOutputRunnable"})}}class gO extends It{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,a)=>this.parseResult([{text:n}],a==null?void 0:a.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,a)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],a==null?void 0:a.callbacks),e,{...t,runType:"parser"})}}class yO extends gO{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class ql extends Error{constructor(e,t,n,a=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=a,a&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");$1(this,"OUTPUT_PARSING_FAILURE")}}class QM extends yO{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class _O extends QM{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const a of e){if(typeof a!="string"&&typeof a.content!="string")throw new Error("Cannot handle non-string output.");let o;if(rj(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");o=new Ba({message:a,text:a.content})}else if(af(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");o=new Ba({message:uj(a),text:a.content})}else o=new $i({text:a});n===void 0?n=o:n=n.concat(o);const u=await this.parsePartialResult([n]);u!=null&&!ry(u,t)&&(this.diff?yield this._diff(t,u):yield u,t=u)}}getFormatInstructions(){return""}}class Xx extends yO{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=jt(Object.fromEntries(Object.entries(e).map(([n,a])=>[n,xe().describe(a)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Zn(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(a,o)=>`"${o.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await cO(this.schema,JSON.parse(n))}catch(t){throw new ql(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class Qx extends _O{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?Cj(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return aS(e[0].text)}async parse(e){return aS(e,JSON.parse)}getFormatInstructions(){return""}}function s_(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=By(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(a){throw new ql([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${a.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function WM(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function bO(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}class eL extends _O{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var u;const n=e[0].message;let a;if(Ui(n)&&((u=n.tool_calls)!=null&&u.length)?a=n.tool_calls.map(d=>{const{id:f,...h}=d;return this.returnId?{id:f,...h}:h}):n.additional_kwargs.tool_calls!==void 0&&(a=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(f=>s_(f,{returnId:this.returnId,partial:t}))),!a)return[];const o=[];for(const d of a)if(d!==void 0){const f={type:d.name,args:d.args,id:d.id};o.push(f)}return o}}class Wx extends eL{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){var n;if(this.zodSchema===void 0)return e;const t=await uO(this.zodSchema,e);if(t.success)return t.data;throw new ql(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify((n=t.error)==null?void 0:n.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(o=>o.type===this.keyName);let a=n;if(n.length)return this.returnId||(a=n.map(o=>o.args)),this.returnSingle?a[0]:a}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(u=>u.type===this.keyName);let a=n;return n.length?(this.returnId||(a=n.map(u=>u.args)),this.returnSingle?this._validateResult(a[0]):await Promise.all(a.map(u=>this._validateResult(u)))):void 0}}const tL=Symbol("Let zodToJsonSchema decide on which parser to use"),eE={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},nL=r=>typeof r=="string"?{...eE,basePath:["#"],definitions:{},name:r}:{...eE,basePath:["#"],definitions:{},...r},ly=r=>"_def"in r?r._def:r;function rL(r){if(!r)return!0;for(const e in r)return!1;return!0}const aL=r=>{const e=nL(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,a])=>[ly(a),{def:ly(a),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function vO(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Ye(r,e,t,n,a){r[e]=t,vO(r,e,n,a)}function sL(){return{}}function iL(r,e){var n,a;const t={type:"array"};return((a=(n=r.type)==null?void 0:n._def)==null?void 0:a.typeName)!==G.ZodAny&&(t.items=qe(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ye(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ye(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ye(t,"minItems",r.exactLength.value,r.exactLength.message,e),Ye(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function oL(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ye(t,"minimum",n.value,n.message,e):Ye(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ye(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ye(t,"maximum",n.value,n.message,e):Ye(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ye(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ye(t,"multipleOf",n.value,n.message,e);break}return t}function lL(){return{type:"boolean"}}function uL(r,e){return qe(r.type._def,e)}const cL=(r,e)=>qe(r.innerType._def,e);function wO(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>wO(r,e,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return dL(r,e)}}const dL=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Ye(t,"minimum",n.value,n.message,e);break;case"max":Ye(t,"maximum",n.value,n.message,e);break}return t};function fL(r,e){return{...qe(r.innerType._def,e),default:r.defaultValue()}}function hL(r,e,t){return e.effectStrategy==="input"?qe(r.schema._def,e,t):{}}function mL(r){return{type:"string",enum:[...r.values]}}const pL=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function gL(r,e){const t=[qe(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),qe(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return t.forEach(o=>{if(pL(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let u=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:d,...f}=o;u=f}else n=void 0;a.push(u)}}),a.length?{allOf:a,...n}:void 0}function yL(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let hg;const os={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(hg===void 0&&(hg=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),hg),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function SO(r,e){const t={type:"string"};function n(a){return e.patternStrategy==="escape"?_L(a):a}if(r.checks)for(const a of r.checks)switch(a.kind){case"min":Ye(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,a.value):a.value,a.message,e);break;case"max":Ye(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":er(t,"email",a.message,e);break;case"format:idn-email":er(t,"idn-email",a.message,e);break;case"pattern:zod":tr(t,os.email,a.message,e);break}break;case"url":er(t,"uri",a.message,e);break;case"uuid":er(t,"uuid",a.message,e);break;case"regex":tr(t,a.regex,a.message,e);break;case"cuid":tr(t,os.cuid,a.message,e);break;case"cuid2":tr(t,os.cuid2,a.message,e);break;case"startsWith":tr(t,RegExp(`^${n(a.value)}`),a.message,e);break;case"endsWith":tr(t,RegExp(`${n(a.value)}$`),a.message,e);break;case"datetime":er(t,"date-time",a.message,e);break;case"date":er(t,"date",a.message,e);break;case"time":er(t,"time",a.message,e);break;case"duration":er(t,"duration",a.message,e);break;case"length":Ye(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,a.value):a.value,a.message,e),Ye(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,a.value):a.value,a.message,e);break;case"includes":{tr(t,RegExp(n(a.value)),a.message,e);break}case"ip":{a.version!=="v6"&&er(t,"ipv4",a.message,e),a.version!=="v4"&&er(t,"ipv6",a.message,e);break}case"emoji":tr(t,os.emoji,a.message,e);break;case"ulid":{tr(t,os.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{er(t,"binary",a.message,e);break}case"contentEncoding:base64":{Ye(t,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{tr(t,os.base64,a.message,e);break}}break}case"nanoid":tr(t,os.nanoid,a.message,e)}return t}const _L=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),er=(r,e,t,n)=>{var a;r.format||(a=r.anyOf)!=null&&a.some(o=>o.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Ye(r,"format",e,t,n)},tr=(r,e,t,n)=>{var a;r.pattern||(a=r.allOf)!=null&&a.some(o=>o.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:tE(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Ye(r,"pattern",tE(e,n),t,n)},tE=(r,e)=>{var h;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},a=n.i?t.source.toLowerCase():t.source;let o="",u=!1,d=!1,f=!1;for(let p=0;p<a.length;p++){if(u){o+=a[p],u=!1;continue}if(n.i){if(d){if(a[p].match(/[a-z]/)){f?(o+=a[p],o+=`${a[p-2]}-${a[p]}`.toUpperCase(),f=!1):a[p+1]==="-"&&((h=a[p+2])!=null&&h.match(/[a-z]/))?(o+=a[p],f=!0):o+=`${a[p]}${a[p].toUpperCase()}`;continue}}else if(a[p].match(/[a-z]/)){o+=`[${a[p]}${a[p].toUpperCase()}]`;continue}}if(n.m){if(a[p]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[p]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[p]==="."){o+=d?`${a[p]}\r
`:`[${a[p]}\r
]`;continue}o+=a[p],a[p]==="\\"?u=!0:d&&a[p]==="]"?d=!1:!d&&a[p]==="["&&(d=!0)}try{const p=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return o};function xO(r,e){var n,a,o,u;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===G.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((d,f)=>({...d,[f]:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",f]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((a=r.keyType)==null?void 0:a._def.typeName)===G.ZodString&&((o=r.keyType._def.checks)!=null&&o.length)){const d=Object.entries(SO(r.keyType._def,e)).reduce((f,[h,p])=>h==="type"?f:{...f,[h]:p},{});return{...t,propertyNames:d}}else if(((u=r.keyType)==null?void 0:u._def.typeName)===G.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function bL(r,e){if(e.mapStrategy==="record")return xO(r,e);const t=qe(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function vL(r){const e=r.values,n=Object.keys(r.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function wL(){return{not:{}}}function SL(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const zd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function xL(r,e){if(e.target==="openApi3")return nE(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in zd&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((a,o)=>{const u=zd[o._def.typeName];return u&&!a.includes(u)?[...a,u]:a},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((a,o)=>{const u=typeof o._def.value;switch(u){case"string":case"number":case"boolean":return[...a,u];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===t.length){const a=n.filter((o,u,d)=>d.indexOf(o)===u);return{type:a.length>1?a:a[0],enum:t.reduce((o,u)=>o.includes(u._def.value)?o:[...o,u._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return nE(r,e)}const nE=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,a)=>qe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function EL(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:zd[r.innerType._def.typeName],nullable:!0}:{type:[zd[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=qe(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=qe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function AL(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",vO(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ye(t,"minimum",n.value,n.message,e):Ye(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ye(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ye(t,"maximum",n.value,n.message,e):Ye(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ye(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ye(t,"multipleOf",n.value,n.message,e);break}return t}function OL(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":qe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":qe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function TL(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[a,o])=>{var f;if(o===void 0||o._def===void 0)return n;const u=[...e.currentPath,"properties",a],d=qe(o._def,{...e,currentPath:u,propertyPath:u});if(d===void 0)return n;if(e.openaiStrictMode&&o.isOptional()&&!o.isNullable()&&typeof((f=o._def)==null?void 0:f.defaultValue)>"u")throw new Error(`Zod field at \`${u.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...n.properties,[a]:d},required:o.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,a]}},{properties:{},required:[]}),additionalProperties:OL(r,e)};return t.required.length||delete t.required,t}const RL=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return qe(r.innerType._def,e);const t=qe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},NL=(r,e)=>{if(e.pipeStrategy==="input")return qe(r.in._def,e);if(e.pipeStrategy==="output")return qe(r.out._def,e);const t=qe(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=qe(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(a=>a!==void 0)}};function CL(r,e){return qe(r.type._def,e)}function kL(r,e){const n={type:"array",uniqueItems:!0,items:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ye(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ye(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function jL(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>qe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:qe(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>qe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function $L(){return{not:{}}}function IL(){return{}}const PL=(r,e)=>qe(r.innerType._def,e);function qe(r,e,t=!1){var u;const n=e.seen.get(r);if(e.override){const d=(u=e.override)==null?void 0:u.call(e,r,e,n,t);if(d!==tL)return d}if(n&&!t){const d=ML(n,e);if(d!==void 0)return"$ref"in d&&e.seenRefs.add(d.$ref),d}const a={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,a);const o=DL(r,r.typeName,e,t);return o&&UL(r,e,o),a.jsonSchema=o,o}const ML=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:LL(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,a)=>e.currentPath[a]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},LL=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},DL=(r,e,t,n)=>{switch(e){case G.ZodString:return SO(r,t);case G.ZodNumber:return AL(r,t);case G.ZodObject:return TL(r,t);case G.ZodBigInt:return oL(r,t);case G.ZodBoolean:return lL();case G.ZodDate:return wO(r,t);case G.ZodUndefined:return $L();case G.ZodNull:return SL(t);case G.ZodArray:return iL(r,t);case G.ZodUnion:case G.ZodDiscriminatedUnion:return xL(r,t);case G.ZodIntersection:return gL(r,t);case G.ZodTuple:return jL(r,t);case G.ZodRecord:return xO(r,t);case G.ZodLiteral:return yL(r,t);case G.ZodEnum:return mL(r);case G.ZodNativeEnum:return vL(r);case G.ZodNullable:return EL(r,t);case G.ZodOptional:return RL(r,t);case G.ZodMap:return bL(r,t);case G.ZodSet:return kL(r,t);case G.ZodLazy:return qe(r.getter()._def,t);case G.ZodPromise:return CL(r,t);case G.ZodNaN:case G.ZodNever:return wL();case G.ZodEffects:return hL(r,t,n);case G.ZodAny:return sL();case G.ZodUnknown:return IL();case G.ZodDefault:return fL(r,t);case G.ZodBranded:return uL(r,t);case G.ZodReadonly:return PL(r,t);case G.ZodCatch:return cL(r,t);case G.ZodPipeline:return NL(r,t);case G.ZodFunction:case G.ZodVoid:case G.ZodSymbol:return;default:return(a=>{})()}},UL=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),zL=(r,e)=>{const t=aL(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,a=qe(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(a.title=o);const u=(()=>{if(rL(t.definitions))return;const f={},h=new Set;for(let p=0;p<500;p++){const y=Object.entries(t.definitions).filter(([_])=>!h.has(_));if(y.length===0)break;for(const[_,b]of y)f[_]=qe(ly(b),{...t,currentPath:[...t.basePath,t.definitionPath,_]},!0)??{},h.add(_)}return f})(),d=n===void 0?u?{...a,[t.definitionPath]:u}:a:t.nameStrategy==="duplicate-ref"?{...a,...u||t.seenRefs.size?{[t.definitionPath]:{...u,...t.seenRefs.size?{[n]:a}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...u,[n]:a}};return t.target==="jsonSchema7"?d.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(d.$schema="https://json-schema.org/draft/2019-09/schema#"),d};function BL(r,e){return zL(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function qL(r,e,t){return rk({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:BL(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function HL(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:a,baseURL:o,azureADTokenProvider:u,azureOpenAIEndpoint:d}=r;if((n||u)&&a&&e)return`${a}/${e}`;if((n||u)&&d&&e)return`${d}/openai/deployments/${e}`;if(n||u){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return o}function GL(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function FL(r){return r!==void 0&&It.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function ZL(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&(Xr(r.schema)||r.schema!=null&&typeof r.schema=="object"&&"type"in r.schema&&typeof r.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(r.schema.type))}function i_(r){return ZL(r)||FL(r)||GL(r)}function VL(r,e){return{name:r.name,description:r.description,parameters:Zn(r.schema)}}function JL(r,e){let t;return i_(r)?t={type:"function",function:VL(r)}:t=r,t}function Mc(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function mg(r){let e;return r.constructor.name===Vd.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===Nn.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=Mc(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Mc(r,"MODEL_AUTHENTICATION"):r.status===429?e=Mc(r,"MODEL_RATE_LIMIT"):r.status===404?e=Mc(r,"MODEL_NOT_FOUND"):e=r,e}function rE(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function KL(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function YL(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(EO(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function EO(r,e){var n;const t=[];for(const[a,o]of Object.entries(r.properties??{}))o.description&&e<2&&t.push(`// ${o.description}`),(n=r.required)!=null&&n.includes(a)?t.push(`${a}: ${Bd(o,e)},`):t.push(`${a}?: ${Bd(o,e)},`);return t.map(a=>" ".repeat(e)+a).join(`
`)}function Bd(r,e){if(KL(r))return r.anyOf.map(t=>Bd(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",EO(r,e+2),"}"].join(`
`);case"array":return r.items?`${Bd(r.items,e)}[]`:"any[]";default:return""}}function XL(r,e){let t;return i_(r)?t=JL(r):t=r,(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function QL(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function o_(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Yl.isInstance(r))throw new Error("Invalid generic chat message");return QL(r)}default:throw new Error(`Unknown message type: ${e}`)}}const AO={providerName:"ChatOpenAI",fromStandardTextBlock(r){return{type:"text",text:r.text}},fromStandardImageBlock(r){var e,t;if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url,...(e=r.metadata)!=null&&e.detail?{detail:r.metadata.detail}:{}}};if(r.source_type==="base64")return{type:"image_url",image_url:{url:`data:${r.mime_type??""};base64,${r.data}`,...(t=r.metadata)!=null&&t.detail?{detail:r.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${r.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(r){if(r.source_type==="url"){const e=kd({dataUrl:r.url});if(!e)throw new Error(`URL audio blocks with source_type ${r.source_type} must be formatted as a data URL for ChatOpenAI`);const t=e.mime_type||r.mime_type||"";let n;try{n=lS(t)}catch{throw new Error(`Audio blocks with source_type ${r.source_type} must have mime type of audio/wav or audio/mp3`)}if(n.type!=="audio"||n.subtype!=="wav"&&n.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${r.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:n.subtype,data:e.data}}}if(r.source_type==="base64"){let e;try{e=lS(r.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${r.source_type} must have mime type of audio/wav or audio/mp3`)}if(e.type!=="audio"||e.subtype!=="wav"&&e.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${r.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:e.subtype,data:r.data}}}throw new Error(`Audio content blocks with source_type ${r.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(r){var e,t,n,a,o,u,d,f,h,p;if(r.source_type==="url"){if(!kd({dataUrl:r.url}))throw new Error(`URL file blocks with source_type ${r.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:r.url,...(e=r.metadata)!=null&&e.filename||(t=r.metadata)!=null&&t.name?{filename:((n=r.metadata)==null?void 0:n.filename)||((a=r.metadata)==null?void 0:a.name)}:{}}}}if(r.source_type==="base64")return{type:"file",file:{file_data:`data:${r.mime_type??""};base64,${r.data}`,...(o=r.metadata)!=null&&o.filename||(u=r.metadata)!=null&&u.name||(d=r.metadata)!=null&&d.title?{filename:((f=r.metadata)==null?void 0:f.filename)||((h=r.metadata)==null?void 0:h.name)||((p=r.metadata)==null?void 0:p.title)}:{}}};if(r.source_type==="id")return{type:"file",file:{file_id:r.id}};throw new Error(`File content blocks with source_type ${r.source_type} are not supported for ChatOpenAI`)}};function aE(r,e){return r.flatMap(t=>{var u;let n=o_(t);n==="system"&&qd(e)&&(n="developer");const a=typeof t.content=="string"?t.content:t.content.map(d=>Da(d)?qy(d,AO):d),o={role:n,content:a};if(t.name!=null&&(o.name=t.name),t.additional_kwargs.function_call!=null&&(o.function_call=t.additional_kwargs.function_call,o.content=""),Ui(t)&&((u=t.tool_calls)!=null&&u.length)?(o.tool_calls=t.tool_calls.map(WM),o.content=""):(t.additional_kwargs.tool_calls!=null&&(o.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(o.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const d={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[o,d]}return o})}const Ei="__openai_function_call_ids__";function WL(r){const e=(r.summary.length>1?r.summary.reduce((t,n)=>{const a=t.at(-1);return a.index===n.index?a.text+=n.text:t.push(n),t},[{...r.summary[0]}]):r.summary).map(t=>Object.fromEntries(Object.entries(t).filter(([n])=>n!=="index")));return{...r,summary:e}}function sE(r,e,t){return r.flatMap(n=>{var u,d,f;const a=n.additional_kwargs;let o=o_(n);if(o==="system"&&qd(e)&&(o="developer"),o==="function")throw new Error("Function messages are not supported in Responses API");if(o==="tool"){const h=n;return(a==null?void 0:a.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof h.content=="string")return{type:"computer_screenshot",image_url:h.content};if(Array.isArray(h.content)){const y=h.content.find(b=>b.type==="computer_screenshot");if(y)return y;const _=h.content.find(b=>b.type==="image_url");if(_)return{type:"computer_screenshot",image_url:typeof _.image_url=="string"?_.image_url:_.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:h.tool_call_id}:{type:"function_call_output",call_id:h.tool_call_id,id:(u=h.id)!=null&&u.startsWith("fc_")?h.id:void 0,output:typeof h.content!="string"?JSON.stringify(h.content):h.content}}if(o==="assistant"){if(!t&&n.response_metadata.output!=null&&Array.isArray(n.response_metadata.output)&&n.response_metadata.output.length>0&&n.response_metadata.output.every(v=>"type"in v))return n.response_metadata.output;const h=[];if(a!=null&&a.reasoning&&!t){const v=WL(a.reasoning);h.push(v)}let{content:p}=n;a!=null&&a.refusal&&(typeof p=="string"&&(p=[{type:"output_text",text:p,annotations:[]}]),p=[...p,{type:"refusal",refusal:a.refusal}]),h.push({type:"message",role:"assistant",...n.id&&!t&&n.id.startsWith("msg_")?{id:n.id}:{},content:typeof p=="string"?p:p.flatMap(v=>v.type==="text"?{type:"output_text",text:v.text,annotations:v.annotations??[]}:v.type==="output_text"||v.type==="refusal"?v:[])});const y=a==null?void 0:a[Ei];Ui(n)&&((d=n.tool_calls)!=null&&d.length)?h.push(...n.tool_calls.map(v=>({type:"function_call",name:v.name,arguments:JSON.stringify(v.args),call_id:v.id,...t?{id:y==null?void 0:y[v.id]}:{}}))):a!=null&&a.tool_calls&&h.push(...a.tool_calls.map(v=>({type:"function_call",name:v.function.name,call_id:v.id,arguments:v.function.arguments,...t?{id:y==null?void 0:y[v.id]}:{}})));const _=(f=n.response_metadata.output)!=null&&f.length?n.response_metadata.output:a.tool_outputs,b=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(_!=null){const v=_,S=v==null?void 0:v.filter(x=>b.includes(x.type));S.length>0&&h.push(...S)}return h}if(o==="user"||o==="system"||o==="developer"){if(typeof n.content=="string")return{type:"message",role:o,content:n.content};const h=[],p=n.content.flatMap(y=>(y.type==="mcp_approval_response"&&h.push({type:"mcp_approval_response",approval_request_id:y.approval_request_id,approve:y.approve}),Da(y)?qy(y,AO):y.type==="text"?{type:"input_text",text:y.text}:y.type==="image_url"?{type:"input_image",image_url:typeof y.image_url=="string"?y.image_url:y.image_url.url,detail:typeof y.image_url=="string"?"auto":y.image_url.detail}:y.type==="input_text"||y.type==="input_image"||y.type==="input_file"?y:[]));return p.length>0&&h.push({type:"message",role:o,content:p}),h}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${o}`),[]})}function OO(r){if(r.error){const d=new Error(r.error.message);throw d.name=r.error.code,d}let e;const t=[],n=[],a=[],o={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,service_tier:r.service_tier,model_name:r.model},u={};for(const d of r.output)if(d.type==="message")e=d.id,t.push(...d.content.flatMap(f=>f.type==="output_text"?("parsed"in f&&f.parsed!=null&&(u.parsed=f.parsed),{type:"text",text:f.text,annotations:f.annotations}):f.type==="refusal"?(u.refusal=f.refusal,[]):f));else if(d.type==="function_call"){const f={function:{name:d.name,arguments:d.arguments},id:d.call_id};try{n.push(s_(f,{returnId:!0}))}catch(h){let p;typeof h=="object"&&h!=null&&"message"in h&&typeof h.message=="string"&&(p=h.message),a.push(bO(f,p))}u[Ei]??(u[Ei]={}),d.id&&(u[Ei][d.call_id]=d.id)}else d.type==="reasoning"?u.reasoning=d:(u.tool_outputs??(u.tool_outputs=[]),u.tool_outputs.push(d));return new _s({id:e,content:t,tool_calls:n,invalid_tool_calls:a,usage_metadata:r.usage,additional_kwargs:u,response_metadata:o})}function e4(r){var f,h;const e=[];let t={},n;const a=[],o={},u={};let d;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text_annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")d=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")a.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.call_id,index:r.output_index}),u[Ei]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call"].includes(r.item.type))u.tool_outputs=[r.item];else if(r.type==="response.created")o.id=r.response.id,o.model_name=r.response.model,o.model=r.response.model;else if(r.type==="response.completed"){const p=OO(r.response);n=r.response.usage,((h=(f=r.response.text)==null?void 0:f.format)==null?void 0:h.type)==="json_schema"&&(u.parsed??(u.parsed=JSON.parse(p.text)));for(const[y,_]of Object.entries(r.response))y!=="id"&&(o[y]=_)}else if(r.type==="response.function_call_arguments.delta")a.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")u.refusal=r.refusal;else if(r.type==="response.output_item.added"&&"item"in r&&r.item.type==="reasoning"){const p=r.item.summary?r.item.summary.map((y,_)=>({...y,index:_})):void 0;u.reasoning={id:r.item.id,type:r.item.type,...p?{summary:p}:{}}}else if(r.type==="response.reasoning_summary_part.added")u.reasoning={type:"reasoning",summary:[{...r.part,index:r.summary_index}]};else if(r.type==="response.reasoning_summary_text.delta")u.reasoning={type:"reasoning",summary:[{text:r.delta,type:"summary_text",index:r.summary_index}]};else return r.type==="response.image_generation_call.partial_image",null;return new Ba({text:e.map(p=>p.text).join(""),message:new xt({id:d,content:e,tool_call_chunks:a,usage_metadata:n,additional_kwargs:u,response_metadata:o}),generationInfo:t})}function uy(r){return"type"in r&&r.type!=="function"}function t4(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function n4(r,e){const t=[];for(const n of r)uy(n)?(n.type==="image_generation"&&(e!=null&&e.stream)&&(n.partial_images=1),t.push(n)):a_(n)&&t.push({type:"function",name:n.function.name,parameters:n.function.parameters,description:n.function.description,strict:(e==null?void 0:e.strict)??null});return t}function iE(r,e){return a_(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:XL(r,e)}function qd(r){return r&&/^o\d/.test(r)}class r4 extends Kr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort","service_tier"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","useResponsesApi","zdrEnabled","reasoning"]}constructor(e){var t,n,a;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"service_tier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??Wr("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??Wr("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=(e==null?void 0:e.reasoningEffort)??((a=e==null?void 0:e.reasoning)==null?void 0:a.effort),this.reasoning=(e==null?void 0:e.reasoning)??(e!=null&&e.reasoningEffort?{effort:e.reasoningEffort}:void 0),this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.disableStreaming=(e==null?void 0:e.disableStreaming)??this.disableStreaming,this.streaming=(e==null?void 0:e.streaming)??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),(e==null?void 0:e.service_tier)!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=(e==null?void 0:e.zdrEnabled)??!1}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.withConfig({tools:e.map(a=>uy(a)?a:iE(a,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Xr(e.json_schema.schema)?i4(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}getReasoningParams(e){if(!qd(this.model))return;let t;return this.reasoningEffort!==void 0&&(t={effort:this.reasoningEffort}),this.reasoning!==void 0&&(t={...t,...this.reasoning}),(e==null?void 0:e.reasoning_effort)!==void 0&&(t={...t,effort:e.reasoning_effort}),(e==null?void 0:e.reasoning)!==void 0&&(t={...t,...e.reasoning}),t}invocationParams(e,t){var d,f;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const h={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(d=e==null?void 0:e.tools)!=null&&d.length?n4(e.tools,{stream:this.streaming,strict:n}):void 0,tool_choice:t4(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const y=rE(e==null?void 0:e.tool_choice);if(typeof y=="object"&&"type"in y)return{type:"function",name:y.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const y=this.createResponseFormat(e==null?void 0:e.response_format);return(y==null?void 0:y.type)==="json_schema"?y.json_schema.schema!=null?{format:{type:"json_schema",schema:y.json_schema.schema,description:y.json_schema.description,name:y.json_schema.name,strict:y.json_schema.strict}}:void 0:{format:y}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},p=this.getReasoningParams(e);return p!==void 0&&(h.reasoning=p),h}let a={};(e==null?void 0:e.stream_options)!==void 0?a={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(a={stream_options:{include_usage:!0}});const o={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(f=e==null?void 0:e.tools)!=null&&f.length?e.tools.map(h=>iE(h,{strict:n})):void 0,tool_choice:rE(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...a,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(o.prediction=e.prediction),this.service_tier!==void 0&&(o.service_tier=this.service_tier),(e==null?void 0:e.service_tier)!==void 0&&(o.service_tier=e.service_tier);const u=this.getReasoningParams(e);return u!==void 0&&u.effort!==void 0&&(o.reasoning_effort=u.effort),qd(o.model)?o.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:o.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,o}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const a=[],o=[];for(const f of n??[])try{a.push(s_(f,{returnId:!0}))}catch(h){o.push(bO(f,h.message))}const u={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(u.__raw_response=t);const d={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(u.audio=e.audio),new _s({content:e.content||"",tool_calls:a,invalid_tool_calls:o,additional_kwargs:u,response_metadata:d,id:t.id})}default:return new Yl(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var f,h;const a=e.role??n,o=e.content??"";let u;e.function_call?u={function_call:e.function_call}:e.tool_calls?u={tool_calls:e.tool_calls}:u={},this.__includeRawResponse&&(u.__raw_response=t),e.audio&&(u.audio={...e.audio,index:t.choices[0].index});const d={usage:{...t.usage}};if(a==="user")return new lf({content:o,response_metadata:d});if(a==="assistant"){const p=[];if(Array.isArray(e.tool_calls))for(const y of e.tool_calls)p.push({name:(f=y.function)==null?void 0:f.name,args:(h=y.function)==null?void 0:h.arguments,id:y.id,index:y.index,type:"tool_call_chunk"});return new xt({content:o,tool_call_chunks:p,additional_kwargs:u,id:t.id,response_metadata:d})}else return a==="system"?new Dl({content:o,response_metadata:d}):a==="developer"?new Dl({content:o,response_metadata:d,additional_kwargs:{__openai_role__:"developer"}}):a==="function"?new of({content:o,additional_kwargs:u,name:e.name,response_metadata:d}):a==="tool"?new Hy({content:o,additional_kwargs:u,tool_call_id:e.tool_call_id,response_metadata:d}):new sf({content:o,role:a,response_metadata:d})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var h,p,y,_,b,v,S,x,E,R;if(this._useResponseApi(t)){const T=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:sE(e,this.model,this.zdrEnabled),stream:!0},t);for await(const j of T){const $=e4(j);$!=null&&(yield $)}return}const a=aE(e,this.model),o={...this.invocationParams(t,{streaming:!0}),messages:a,stream:!0};let u;const d=await this.completionWithRetry(o,t);let f;for await(const T of d){const j=(h=T==null?void 0:T.choices)==null?void 0:h[0];if(T.usage&&(f=T.usage),!j)continue;const{delta:$}=j;if(!$)continue;const q=this._convertOpenAIDeltaToBaseMessageChunk($,T,u);u=$.role??u;const Z={prompt:t.promptIndex??0,completion:j.index??0};if(typeof q.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const Y={...Z};j.finish_reason!=null&&(Y.finish_reason=j.finish_reason,Y.system_fingerprint=T.system_fingerprint,Y.model_name=T.model,Y.service_tier=T.service_tier),this.logprobs&&(Y.logprobs=j.logprobs);const oe=new Ba({message:q,text:q.content,generationInfo:Y});yield oe,await(n==null?void 0:n.handleLLMNewToken(oe.text??"",Z,void 0,void 0,void 0,{chunk:oe}))}if(f){const T={...((p=f.prompt_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(y=f.prompt_tokens_details)==null?void 0:y.audio_tokens},...((_=f.prompt_tokens_details)==null?void 0:_.cached_tokens)!==null&&{cache_read:(b=f.prompt_tokens_details)==null?void 0:b.cached_tokens}},j={...((v=f.completion_tokens_details)==null?void 0:v.audio_tokens)!==null&&{audio:(S=f.completion_tokens_details)==null?void 0:S.audio_tokens},...((x=f.completion_tokens_details)==null?void 0:x.reasoning_tokens)!==null&&{reasoning:(E=f.completion_tokens_details)==null?void 0:E.reasoning_tokens}};yield new Ba({message:new xt({content:"",response_metadata:{usage:{...f}},usage_metadata:{input_tokens:f.prompt_tokens,output_tokens:f.completion_tokens,total_tokens:f.total_tokens,...Object.keys(T).length>0&&{input_token_details:T},...Object.keys(j).length>0&&{output_token_details:j}}}),text:""})}if((R=t.signal)!=null&&R.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var d;const a=this.invocationParams(t);if(a.stream){const f=this._streamResponseChunks(e,t,n);let h;for await(const p of f)p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},h=(h==null?void 0:h.concat(p))??p;return{generations:h?[h]:[],llmOutput:{estimatedTokenUsage:(d=h==null?void 0:h.message)==null?void 0:d.usage_metadata}}}const o=sE(e,this.model,this.zdrEnabled),u=await this.responseApiWithRetry({input:o,...a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:u.output_text,message:OO(u)}],llmOutput:{id:u.id,estimatedTokenUsage:u.usage?{promptTokens:u.usage.input_tokens,completionTokens:u.usage.output_tokens,totalTokens:u.usage.total_tokens}:void 0}}}_useResponseApi(e){var a,o,u;const t=(a=e==null?void 0:e.tools)==null?void 0:a.some(uy),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null||((o=e==null?void 0:e.reasoning)==null?void 0:o.summary)!=null||((u=this.reasoning)==null?void 0:u.summary)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var d,f;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const a={},o=this.invocationParams(t),u=aE(e,this.model);if(o.stream){const h=this._streamResponseChunks(e,t,n),p={};for await(const x of h){x.message.response_metadata={...x.generationInfo,...x.message.response_metadata};const E=((d=x.generationInfo)==null?void 0:d.completion)??0;p[E]===void 0?p[E]=x:p[E]=p[E].concat(x)}const y=Object.entries(p).sort(([x],[E])=>parseInt(x,10)-parseInt(E,10)).map(([x,E])=>E),{functions:_,function_call:b}=this.invocationParams(t),v=await this.getEstimatedTokenCountFromPrompt(e,_,b),S=await this.getNumTokensFromGenerations(y);return a.input_tokens=v,a.output_tokens=S,a.total_tokens=v+S,{generations:y,llmOutput:{estimatedTokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}else{let h;t.response_format&&t.response_format.type==="json_schema"?h=await this.betaParsedCompletionWithRetry({...o,stream:!1,messages:u},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):h=await this.completionWithRetry({...o,stream:!1,messages:u},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:p,prompt_tokens:y,total_tokens:_,prompt_tokens_details:b,completion_tokens_details:v}=(h==null?void 0:h.usage)??{};p&&(a.output_tokens=(a.output_tokens??0)+p),y&&(a.input_tokens=(a.input_tokens??0)+y),_&&(a.total_tokens=(a.total_tokens??0)+_),((b==null?void 0:b.audio_tokens)!==null||(b==null?void 0:b.cached_tokens)!==null)&&(a.input_token_details={...(b==null?void 0:b.audio_tokens)!==null&&{audio:b==null?void 0:b.audio_tokens},...(b==null?void 0:b.cached_tokens)!==null&&{cache_read:b==null?void 0:b.cached_tokens}}),((v==null?void 0:v.audio_tokens)!==null||(v==null?void 0:v.reasoning_tokens)!==null)&&(a.output_token_details={...(v==null?void 0:v.audio_tokens)!==null&&{audio:v==null?void 0:v.audio_tokens},...(v==null?void 0:v.reasoning_tokens)!==null&&{reasoning:v==null?void 0:v.reasoning_tokens}});const S=[];for(const x of(h==null?void 0:h.choices)??[]){const R={text:((f=x.message)==null?void 0:f.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(x.message??{role:"assistant"},h)};R.generationInfo={...x.finish_reason?{finish_reason:x.finish_reason}:{},...x.logprobs?{logprobs:x.logprobs}:{}},Ui(R.message)&&(R.message.usage_metadata=a),R.message=new _s(Object.fromEntries(Object.entries(R.message).filter(([T])=>!T.startsWith("lc_")))),S.push(R)}return{generations:S,llmOutput:{tokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let a=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const o=YL(t);a+=await this.getNumTokens(o),a+=9}return t&&e.find(o=>o._getType()==="system")&&(a-=4),n==="none"?a+=1:typeof n=="object"&&(a+=await this.getNumTokens(n.name)+4),a}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var a;return(a=n.message.additional_kwargs)!=null&&a.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,a)=>n+a,0)}async getNumTokensFromMessages(e){let t=0,n=0,a=0;this.model==="gpt-3.5-turbo-0301"?(n=4,a=-1):(n=3,a=1);const o=await Promise.all(e.map(async u=>{var _,b,v,S,x,E;const d=await this.getNumTokens(u.content),f=await this.getNumTokens(o_(u)),h=u.name!==void 0?a+await this.getNumTokens(u.name):0;let p=d+n+f+h;const y=u;if(y._getType()==="function"&&(p-=2),(_=y.additional_kwargs)!=null&&_.function_call&&(p+=3),(b=y==null?void 0:y.additional_kwargs.function_call)!=null&&b.name&&(p+=await this.getNumTokens((v=y.additional_kwargs.function_call)==null?void 0:v.name)),(S=y.additional_kwargs.function_call)!=null&&S.arguments)try{p+=await this.getNumTokens(JSON.stringify(JSON.parse((x=y.additional_kwargs.function_call)==null?void 0:x.arguments)))}catch(R){console.error("Error parsing function arguments",R,JSON.stringify(y.additional_kwargs.function_call)),p+=await this.getNumTokens((E=y.additional_kwargs.function_call)==null?void 0:E.arguments)}return t+=p,p}));return t+=3,{totalCount:t,countPerMessage:o}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(a){throw mg(a)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var a,o;const n=this._getClientOptions(t);try{return((o=(a=e.text)==null?void 0:a.format)==null?void 0:o.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(u){throw mg(u)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.parse(e,n)}catch(a){throw mg(a)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},a=HL(n),o={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};o.baseURL||delete o.baseURL,this.client=new Le(o)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,a,o,u;a4(e)?(n=e.schema,a=e.name,o=e.method,u=e.includeRaw):(n=e,a=t==null?void 0:t.name,o=t==null?void 0:t.method,u=t==null?void 0:t.includeRaw);let d,f;if((t==null?void 0:t.strict)!==void 0&&o==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?o===void 0&&(o="jsonSchema"):o==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),o==="jsonMode"){let _;Xr(n)?(f=Xx.fromZodSchema(n),_=Zn(n)):f=new Qx,d=this.withConfig({response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"jsonMode"},schema:_}})}else if(o==="jsonSchema")if(d=this.withConfig({response_format:{type:"json_schema",json_schema:{name:a??"extract",description:t_(n),schema:n,strict:t==null?void 0:t.strict}},ls_structured_output_format:{kwargs:{method:"jsonSchema"},schema:Zn(n)}}),Xr(n)){const _=Xx.fromZodSchema(n);f=Hi.from(b=>"parsed"in b.additional_kwargs?b.additional_kwargs.parsed:_)}else f=new Qx;else{let _=a??"extract";if(Xr(n)){const b=Zn(n);d=this.withConfig({tools:[{type:"function",function:{name:_,description:b.description,parameters:b}}],tool_choice:{type:"function",function:{name:_}},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:b},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),f=new Wx({returnSingle:!0,keyName:_,zodSchema:n})}else{let b;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(b=n,_=n.name):(_=n.title??_,b={name:_,description:n.description??"",parameters:n}),d=this.withConfig({tools:[{type:"function",function:b}],tool_choice:{type:"function",function:{name:_}},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:Zn(n)},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),f=new Wx({returnSingle:!0,keyName:_})}}if(!u)return d.pipe(f);const h=Ii.assign({parsed:(_,b)=>f.invoke(_.raw,b)}),p=Ii.assign({parsed:()=>null}),y=h.withFallbacks({fallbacks:[p]});return Sr.from([{raw:d},y])}}function a4(r){return r!==void 0&&typeof r.schema=="object"}function s4(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function i4(r,e,t){if(Tr(r))return qL(r,e,t);if(dr(r))return s4({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Jg(r,{cycles:"ref",reused:"ref",override(n){n.jsonSchema.title=e}})}},n=>C1(r,JSON.parse(n)));throw new Error("Unsupported schema response format")}function Ae(r,e,t,n,a){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}function W(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}let TO=function(){const{crypto:r}=globalThis;if(r!=null&&r.randomUUID)return TO=r.randomUUID.bind(r),r.randomUUID();const e=new Uint8Array(1),t=r?()=>r.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function Hl(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}const cy=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){const e=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(e.stack=r.stack),r.cause&&!e.cause&&(e.cause=r.cause),r.name&&(e.name=r.name),e}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)};class je extends Error{}class Zt extends je{constructor(e,t,n,a){super(`${Zt.makeMessage(e,t,n)}`),this.status=e,this.headers=a,this.requestID=a==null?void 0:a.get("request-id"),this.error=t}static makeMessage(e,t,n){const a=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,n,a){if(!e||!a)return new gf({message:n,cause:cy(t)});const o=t;return e===400?new NO(e,o,n,a):e===401?new CO(e,o,n,a):e===403?new kO(e,o,n,a):e===404?new jO(e,o,n,a):e===409?new $O(e,o,n,a):e===422?new IO(e,o,n,a):e===429?new PO(e,o,n,a):e>=500?new MO(e,o,n,a):new Zt(e,o,n,a)}}class rr extends Zt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class gf extends Zt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class RO extends gf{constructor({message:e}={}){super({message:e??"Request timed out."})}}class NO extends Zt{}class CO extends Zt{}class kO extends Zt{}class jO extends Zt{}class $O extends Zt{}class IO extends Zt{}class PO extends Zt{}class MO extends Zt{}const o4=/^[a-z][a-z0-9+.-]*:/i,l4=r=>o4.test(r);let dy=r=>(dy=Array.isArray,dy(r)),oE=dy;function lE(r){return typeof r!="object"?{}:r??{}}function u4(r){if(!r)return!0;for(const e in r)return!1;return!0}function c4(r,e){return Object.prototype.hasOwnProperty.call(r,e)}const d4=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new je(`${r} must be an integer`);if(e<0)throw new je(`${r} must be a positive integer`);return e},LO=r=>{try{return JSON.parse(r)}catch{return}},f4=r=>new Promise(e=>setTimeout(e,r)),bi="0.56.0",h4=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function m4(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const p4=()=>{var t;const r=m4();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":cE(Deno.build.os),"X-Stainless-Arch":uE(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":cE(globalThis.process.platform??"unknown"),"X-Stainless-Arch":uE(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=g4();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function g4(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const a=n[1]||0,o=n[2]||0,u=n[3]||0;return{browser:e,version:`${a}.${o}.${u}`}}}return null}const uE=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",cE=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let dE;const y4=()=>dE??(dE=p4());function _4(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function DO(...r){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...r)}function UO(r){let e=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return DO({start(){},async pull(t){const{done:n,value:a}=await e.next();n?t.close():t.enqueue(a)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function l_(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function b4(r){var n,a;if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await((a=(n=r[Symbol.asyncIterator]()).return)==null?void 0:a.call(n));return}const e=r.getReader(),t=e.cancel();e.releaseLock(),await t}const v4=({headers:r,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function w4(r){let e=0;for(const a of r)e+=a.length;const t=new Uint8Array(e);let n=0;for(const a of r)t.set(a,n),n+=a.length;return t}let fE;function u_(r){let e;return(fE??(e=new globalThis.TextEncoder,fE=e.encode.bind(e)))(r)}let hE;function mE(r){let e;return(hE??(e=new globalThis.TextDecoder,hE=e.decode.bind(e)))(r)}var On,Tn;class eu{constructor(){On.set(this,void 0),Tn.set(this,void 0),Ae(this,On,new Uint8Array),Ae(this,Tn,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?u_(e):e;Ae(this,On,w4([W(this,On,"f"),t]));const n=[];let a;for(;(a=S4(W(this,On,"f"),W(this,Tn,"f")))!=null;){if(a.carriage&&W(this,Tn,"f")==null){Ae(this,Tn,a.index);continue}if(W(this,Tn,"f")!=null&&(a.index!==W(this,Tn,"f")+1||a.carriage)){n.push(mE(W(this,On,"f").subarray(0,W(this,Tn,"f")-1))),Ae(this,On,W(this,On,"f").subarray(W(this,Tn,"f"))),Ae(this,Tn,null);continue}const o=W(this,Tn,"f")!==null?a.preceding-1:a.preceding,u=mE(W(this,On,"f").subarray(0,o));n.push(u),Ae(this,On,W(this,On,"f").subarray(a.index)),Ae(this,Tn,null)}return n}flush(){return W(this,On,"f").length?this.decode(`
`):[]}}On=new WeakMap,Tn=new WeakMap;eu.NEWLINE_CHARS=new Set([`
`,"\r"]);eu.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function S4(r,e){for(let a=e??0;a<r.length;a++){if(r[a]===10)return{preceding:a,index:a+1,carriage:!1};if(r[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function x4(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}const Hd={off:0,error:200,warn:300,info:400,debug:500},pE=(r,e,t)=>{if(r){if(c4(Hd,r))return r;Qt(t).warn(`${e} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(Hd))}`)}};function vl(){}function Lc(r,e,t){return!e||Hd[r]>Hd[t]?vl:e[r].bind(e)}const E4={error:vl,warn:vl,info:vl,debug:vl};let gE=new WeakMap;function Qt(r){const e=r.logger,t=r.logLevel??"off";if(!e)return E4;const n=gE.get(e);if(n&&n[0]===t)return n[1];const a={error:Lc("error",e,t),warn:Lc("warn",e,t),info:Lc("info",e,t),debug:Lc("debug",e,t)};return gE.set(e,[t,a]),a}const us=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r);var Yo;class xr{constructor(e,t,n){this.iterator=e,Yo.set(this,void 0),this.controller=t,Ae(this,Yo,n)}static fromSSEResponse(e,t,n){let a=!1;const o=n?Qt(n):console;async function*u(){if(a)throw new je("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let d=!1;try{for await(const f of A4(e,t)){if(f.event==="completion")try{yield JSON.parse(f.data)}catch(h){throw o.error("Could not parse message into JSON:",f.data),o.error("From chunk:",f.raw),h}if(f.event==="message_start"||f.event==="message_delta"||f.event==="message_stop"||f.event==="content_block_start"||f.event==="content_block_delta"||f.event==="content_block_stop")try{yield JSON.parse(f.data)}catch(h){throw o.error("Could not parse message into JSON:",f.data),o.error("From chunk:",f.raw),h}if(f.event!=="ping"&&f.event==="error")throw new Zt(void 0,LO(f.data)??f.data,void 0,e.headers)}d=!0}catch(f){if(Hl(f))return;throw f}finally{d||t.abort()}}return new xr(u,t,n)}static fromReadableStream(e,t,n){let a=!1;async function*o(){const d=new eu,f=l_(e);for await(const h of f)for(const p of d.decode(h))yield p;for(const h of d.flush())yield h}async function*u(){if(a)throw new je("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let d=!1;try{for await(const f of o())d||f&&(yield JSON.parse(f));d=!0}catch(f){if(Hl(f))return;throw f}finally{d||t.abort()}}return new xr(u,t,n)}[(Yo=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),a=o=>({next:()=>{if(o.length===0){const u=n.next();e.push(u),t.push(u)}return o.shift()}});return[new xr(()=>a(e),this.controller,W(this,Yo,"f")),new xr(()=>a(t),this.controller,W(this,Yo,"f"))]}toReadableStream(){const e=this;let t;return DO({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:a,done:o}=await t.next();if(o)return n.close();const u=u_(JSON.stringify(a)+`
`);n.enqueue(u)}catch(a){n.error(a)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}}async function*A4(r,e){if(!r.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new je("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new je("Attempted to iterate over a response with no body");const t=new T4,n=new eu,a=l_(r.body);for await(const o of O4(a))for(const u of n.decode(o)){const d=t.decode(u);d&&(yield d)}for(const o of n.flush()){const u=t.decode(o);u&&(yield u)}}async function*O4(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?u_(t):t;let a=new Uint8Array(e.length+n.length);a.set(e),a.set(n,e.length),e=a;let o;for(;(o=x4(e))!==-1;)yield e.slice(0,o),e=e.slice(o)}e.length>0&&(yield e)}class T4{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,a]=R4(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}}function R4(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}async function zO(r,e){const{response:t,requestLogID:n,retryOfRequestLogID:a,startTime:o}=e,u=await(async()=>{var y;if(e.options.stream)return Qt(r).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,r):xr.fromSSEResponse(t,e.controller,r);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const d=t.headers.get("content-type"),f=(y=d==null?void 0:d.split(";")[0])==null?void 0:y.trim();if((f==null?void 0:f.includes("application/json"))||(f==null?void 0:f.endsWith("+json"))){const _=await t.json();return BO(_,t)}return await t.text()})();return Qt(r).debug(`[${n}] response parsed`,us({retryOfRequestLogID:a,url:t.url,status:t.status,body:u,durationMs:Date.now()-o})),u}function BO(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var wl;class yf extends Promise{constructor(e,t,n=zO){super(a=>{a(null)}),this.responsePromise=t,this.parseResponse=n,wl.set(this,void 0),Ae(this,wl,e)}_thenUnwrap(e){return new yf(W(this,wl,"f"),this.responsePromise,async(t,n)=>BO(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(W(this,wl,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}wl=new WeakMap;var Dc;class N4{constructor(e,t,n,a){Dc.set(this,void 0),Ae(this,Dc,e),this.options=a,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new je("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await W(this,Dc,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Dc=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class C4 extends yf{constructor(e,t,n){super(e,t,async(a,o)=>new n(a,o.response,await zO(a,o),o.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class tu extends N4{constructor(e,t,n,a){super(e,t,n,a),this.data=n.data||[],this.has_more=n.has_more||!1,this.first_id=n.first_id||null,this.last_id=n.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var t;if((t=this.options.query)!=null&&t.before_id){const n=this.first_id;return n?{...this.options,query:{...lE(this.options.query),before_id:n}}:null}const e=this.last_id;return e?{...this.options,query:{...lE(this.options.query),after_id:e}}:null}}const qO=()=>{var r;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((r=e==null?void 0:e.versions)==null?void 0:r.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ai(r,e,t){return qO(),new File(r,e??"unknown_file",t)}function fd(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}const HO=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",k4=async(r,e)=>({...r,body:await $4(r.body,e)}),yE=new WeakMap;function j4(r){const e=typeof r=="function"?r:r.fetch,t=yE.get(e);if(t)return t;const n=(async()=>{try{const a="Response"in e?e.Response:(await e("data:,")).constructor,o=new FormData;return o.toString()!==await new a(o).text()}catch{return!0}})();return yE.set(e,n),n}const $4=async(r,e)=>{if(!await j4(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(r||{}).map(([n,a])=>fy(t,n,a))),t},I4=r=>r instanceof Blob&&"name"in r,fy=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(t instanceof Response){let n={};const a=t.headers.get("Content-Type");a&&(n={type:a}),r.append(e,Ai([await t.blob()],fd(t),n))}else if(HO(t))r.append(e,Ai([await new Response(UO(t)).blob()],fd(t)));else if(I4(t))r.append(e,Ai([t],fd(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(n=>fy(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,a])=>fy(r,`${e}[${n}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},GO=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",P4=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&GO(r),M4=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function";async function L4(r,e,t){if(qO(),r=await r,e||(e=fd(r)),P4(r))return r instanceof File&&e==null&&t==null?r:Ai([await r.arrayBuffer()],e??r.name,{type:r.type,lastModified:r.lastModified,...t});if(M4(r)){const a=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()),Ai(await hy(a),e,t)}const n=await hy(r);if(!(t!=null&&t.type)){const a=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof a=="string"&&(t={...t,type:a})}return Ai(n,e,t)}async function hy(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(GO(r))e.push(r instanceof Blob?r:await r.arrayBuffer());else if(HO(r))for await(const n of r)e.push(...await hy(n));else{const n=(t=r==null?void 0:r.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof r}${n?`; constructor: ${n}`:""}${D4(r)}`)}return e}function D4(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}class ea{constructor(e){this._client=e}}const FO=Symbol.for("brand.privateNullableHeaders");function*U4(r){if(!r)return;if(FO in r){const{values:n,nulls:a}=r;yield*n.entries();for(const o of a)yield[o,null];return}let e=!1,t;r instanceof Headers?t=r.entries():oE(r)?t=r:(e=!0,t=Object.entries(r??{}));for(let n of t){const a=n[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");const o=oE(n[1])?n[1]:[n[1]];let u=!1;for(const d of o)d!==void 0&&(e&&!u&&(u=!0,yield[a,null]),yield[a,d])}}const at=r=>{const e=new Headers,t=new Set;for(const n of r){const a=new Set;for(const[o,u]of U4(n)){const d=o.toLowerCase();a.has(d)||(e.delete(o),a.add(d)),u===null?(e.delete(o),t.add(d)):(e.append(o,u),t.delete(d))}}return{[FO]:!0,values:e,nulls:t}};function ZO(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const _E=Object.freeze(Object.create(null)),z4=(r=ZO)=>function(t,...n){if(t.length===1)return t[0];let a=!1;const o=[],u=t.reduce((p,y,_)=>{var S;/[?#]/.test(y)&&(a=!0);const b=n[_];let v=(a?encodeURIComponent:r)(""+b);return _!==n.length&&(b==null||typeof b=="object"&&b.toString===((S=Object.getPrototypeOf(Object.getPrototypeOf(b.hasOwnProperty??_E)??_E))==null?void 0:S.toString))&&(v=b+"",o.push({start:p.length+y.length,length:v.length,error:`Value of type ${Object.prototype.toString.call(b).slice(8,-1)} is not a valid path parameter`})),p+y+(_===n.length?"":v)},""),d=u.split(/[?#]/,1)[0],f=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let h;for(;(h=f.exec(d))!==null;)o.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(o.sort((p,y)=>p.start-y.start),o.length>0){let p=0;const y=o.reduce((_,b)=>{const v=" ".repeat(b.start-p),S="^".repeat(b.length);return p=b.start+b.length,_+v+S},"");throw new je(`Path parameters result in path with invalid segments:
${o.map(_=>_.error).join(`
`)}
${u}
${y}`)}return u},or=z4(ZO);class VO extends ea{list(e={},t){const{betas:n,...a}=e??{};return this._client.getAPIList("/v1/files",tu,{query:a,...t,headers:at([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])})}delete(e,t={},n){const{betas:a}=t??{};return this._client.delete(or`/v1/files/${e}`,{...n,headers:at([{"anthropic-beta":[...a??[],"files-api-2025-04-14"].toString()},n==null?void 0:n.headers])})}download(e,t={},n){const{betas:a}=t??{};return this._client.get(or`/v1/files/${e}/content`,{...n,headers:at([{"anthropic-beta":[...a??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},n){const{betas:a}=t??{};return this._client.get(or`/v1/files/${e}`,{...n,headers:at([{"anthropic-beta":[...a??[],"files-api-2025-04-14"].toString()},n==null?void 0:n.headers])})}upload(e,t){const{betas:n,...a}=e;return this._client.post("/v1/files",k4({body:a,...t,headers:at([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])},this._client))}}let JO=class extends ea{retrieve(e,t={},n){const{betas:a}=t??{};return this._client.get(or`/v1/models/${e}?beta=true`,{...n,headers:at([{...(a==null?void 0:a.toString())!=null?{"anthropic-beta":a==null?void 0:a.toString()}:void 0},n==null?void 0:n.headers])})}list(e={},t){const{betas:n,...a}=e??{};return this._client.getAPIList("/v1/models?beta=true",tu,{query:a,...t,headers:at([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},t==null?void 0:t.headers])})}};class _f{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new eu;for await(const t of this.iterator)for(const n of e.decode(t))yield JSON.parse(n);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new je("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new je("Attempted to iterate over a response with no body");return new _f(l_(e.body),t)}}let KO=class extends ea{create(e,t){const{betas:n,...a}=e;return this._client.post("/v1/messages/batches?beta=true",{body:a,...t,headers:at([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}retrieve(e,t={},n){const{betas:a}=t??{};return this._client.get(or`/v1/messages/batches/${e}?beta=true`,{...n,headers:at([{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString()},n==null?void 0:n.headers])})}list(e={},t){const{betas:n,...a}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",tu,{query:a,...t,headers:at([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}delete(e,t={},n){const{betas:a}=t??{};return this._client.delete(or`/v1/messages/batches/${e}?beta=true`,{...n,headers:at([{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString()},n==null?void 0:n.headers])})}cancel(e,t={},n){const{betas:a}=t??{};return this._client.post(or`/v1/messages/batches/${e}/cancel?beta=true`,{...n,headers:at([{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString()},n==null?void 0:n.headers])})}async results(e,t={},n){const a=await this.retrieve(e);if(!a.results_url)throw new je(`No batch \`results_url\`; Has it finished processing? ${a.processing_status} - ${a.id}`);const{betas:o}=t??{};return this._client.get(a.results_url,{...n,headers:at([{"anthropic-beta":[...o??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},n==null?void 0:n.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((u,d)=>_f.fromResponse(d.response,d.controller))}};const B4=r=>{let e=0,t=[];for(;e<r.length;){let n=r[e];if(n==="\\"){e++;continue}if(n==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(n==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(n==="["){t.push({type:"paren",value:"["}),e++;continue}if(n==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(n===":"){t.push({type:"separator",value:":"}),e++;continue}if(n===","){t.push({type:"delimiter",value:","}),e++;continue}if(n==='"'){let d="",f=!1;for(n=r[++e];n!=='"';){if(e===r.length){f=!0;break}if(n==="\\"){if(e++,e===r.length){f=!0;break}d+=n+r[e],n=r[++e]}else d+=n,n=r[++e]}n=r[++e],f||t.push({type:"string",value:d});continue}if(n&&/\s/.test(n)){e++;continue}let o=/[0-9]/;if(n&&o.test(n)||n==="-"||n==="."){let d="";for(n==="-"&&(d+=n,n=r[++e]);n&&o.test(n)||n===".";)d+=n,n=r[++e];t.push({type:"number",value:d});continue}let u=/[a-z]/i;if(n&&u.test(n)){let d="";for(;n&&u.test(n)&&e!==r.length;)d+=n,n=r[++e];if(d=="true"||d=="false"||d==="null")t.push({type:"name",value:d});else{e++;continue}continue}e++}return t},vi=r=>{if(r.length===0)return r;let e=r[r.length-1];switch(e.type){case"separator":return r=r.slice(0,r.length-1),vi(r);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return r=r.slice(0,r.length-1),vi(r);case"string":let n=r[r.length-2];if((n==null?void 0:n.type)==="delimiter")return r=r.slice(0,r.length-1),vi(r);if((n==null?void 0:n.type)==="brace"&&n.value==="{")return r=r.slice(0,r.length-1),vi(r);break;case"delimiter":return r=r.slice(0,r.length-1),vi(r)}return r},q4=r=>{let e=[];return r.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?r.push({type:"brace",value:"}"}):t==="]"&&r.push({type:"paren",value:"]"})}),r},H4=r=>{let e="";return r.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},YO=r=>JSON.parse(H4(q4(vi(B4(r)))));var qn,Na,Xo,Uc,Qo,Wo,zc,el,Fr,tl,Bc,qc,di,Hc,Gc,pg,bE,Fc,gg,yg,_g,vE;const wE="__json_buf";function SE(r){return r.type==="tool_use"||r.type==="server_tool_use"||r.type==="mcp_tool_use"}class Gd{constructor(){qn.add(this),this.messages=[],this.receivedMessages=[],Na.set(this,void 0),this.controller=new AbortController,Xo.set(this,void 0),Uc.set(this,()=>{}),Qo.set(this,()=>{}),Wo.set(this,void 0),zc.set(this,()=>{}),el.set(this,()=>{}),Fr.set(this,{}),tl.set(this,!1),Bc.set(this,!1),qc.set(this,!1),di.set(this,!1),Hc.set(this,void 0),Gc.set(this,void 0),Fc.set(this,e=>{if(Ae(this,Bc,!0),Hl(e)&&(e=new rr),e instanceof rr)return Ae(this,qc,!0),this._emit("abort",e);if(e instanceof je)return this._emit("error",e);if(e instanceof Error){const t=new je(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new je(String(e)))}),Ae(this,Xo,new Promise((e,t)=>{Ae(this,Uc,e,"f"),Ae(this,Qo,t,"f")})),Ae(this,Wo,new Promise((e,t)=>{Ae(this,zc,e,"f"),Ae(this,el,t,"f")})),W(this,Xo,"f").catch(()=>{}),W(this,Wo,"f").catch(()=>{})}get response(){return W(this,Hc,"f")}get request_id(){return W(this,Gc,"f")}async withResponse(){const e=await W(this,Xo,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Gd;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const a=new Gd;for(const o of t.messages)a._addMessageParam(o);return a._run(()=>a._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},W(this,Fc,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var u;const a=n==null?void 0:n.signal;let o;a&&(a.aborted&&this.controller.abort(),o=this.controller.abort.bind(this.controller),a.addEventListener("abort",o));try{W(this,qn,"m",gg).call(this);const{response:d,data:f}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(d);for await(const h of f)W(this,qn,"m",yg).call(this,h);if((u=f.controller.signal)!=null&&u.aborted)throw new rr;W(this,qn,"m",_g).call(this)}finally{a&&o&&a.removeEventListener("abort",o)}}_connected(e){this.ended||(Ae(this,Hc,e),Ae(this,Gc,e==null?void 0:e.headers.get("request-id")),W(this,Uc,"f").call(this,e),this._emit("connect"))}get ended(){return W(this,tl,"f")}get errored(){return W(this,Bc,"f")}get aborted(){return W(this,qc,"f")}abort(){this.controller.abort()}on(e,t){return(W(this,Fr,"f")[e]||(W(this,Fr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=W(this,Fr,"f")[e];if(!n)return this;const a=n.findIndex(o=>o.listener===t);return a>=0&&n.splice(a,1),this}once(e,t){return(W(this,Fr,"f")[e]||(W(this,Fr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Ae(this,di,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Ae(this,di,!0),await W(this,Wo,"f")}get currentMessage(){return W(this,Na,"f")}async finalMessage(){return await this.done(),W(this,qn,"m",pg).call(this)}async finalText(){return await this.done(),W(this,qn,"m",bE).call(this)}_emit(e,...t){if(W(this,tl,"f"))return;e==="end"&&(Ae(this,tl,!0),W(this,zc,"f").call(this));const n=W(this,Fr,"f")[e];if(n&&(W(this,Fr,"f")[e]=n.filter(a=>!a.once),n.forEach(({listener:a})=>a(...t))),e==="abort"){const a=t[0];!W(this,di,"f")&&!(n!=null&&n.length)&&Promise.reject(a),W(this,Qo,"f").call(this,a),W(this,el,"f").call(this,a),this._emit("end");return}if(e==="error"){const a=t[0];!W(this,di,"f")&&!(n!=null&&n.length)&&Promise.reject(a),W(this,Qo,"f").call(this,a),W(this,el,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",W(this,qn,"m",pg).call(this))}async _fromReadableStream(e,t){var o;const n=t==null?void 0:t.signal;let a;n&&(n.aborted&&this.controller.abort(),a=this.controller.abort.bind(this.controller),n.addEventListener("abort",a));try{W(this,qn,"m",gg).call(this),this._connected(null);const u=xr.fromReadableStream(e,this.controller);for await(const d of u)W(this,qn,"m",yg).call(this,d);if((o=u.controller.signal)!=null&&o.aborted)throw new rr;W(this,qn,"m",_g).call(this)}finally{n&&a&&n.removeEventListener("abort",a)}}[(Na=new WeakMap,Xo=new WeakMap,Uc=new WeakMap,Qo=new WeakMap,Wo=new WeakMap,zc=new WeakMap,el=new WeakMap,Fr=new WeakMap,tl=new WeakMap,Bc=new WeakMap,qc=new WeakMap,di=new WeakMap,Hc=new WeakMap,Gc=new WeakMap,Fc=new WeakMap,qn=new WeakSet,pg=function(){if(this.receivedMessages.length===0)throw new je("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},bE=function(){if(this.receivedMessages.length===0)throw new je("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new je("stream ended without producing a content block with type=text");return t.join(" ")},gg=function(){this.ended||Ae(this,Na,void 0)},yg=function(t){if(this.ended)return;const n=W(this,qn,"m",vE).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const a=n.content.at(-1);switch(t.delta.type){case"text_delta":{a.type==="text"&&this._emit("text",t.delta.text,a.text||"");break}case"citations_delta":{a.type==="text"&&this._emit("citation",t.delta.citation,a.citations??[]);break}case"input_json_delta":{SE(a)&&a.input&&this._emit("inputJson",t.delta.partial_json,a.input);break}case"thinking_delta":{a.type==="thinking"&&this._emit("thinking",t.delta.thinking,a.thinking);break}case"signature_delta":{a.type==="thinking"&&this._emit("signature",a.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{Ae(this,Na,n);break}}},_g=function(){if(this.ended)throw new je("stream has ended, this shouldn't happen");const t=W(this,Na,"f");if(!t)throw new je("request ended without sending any chunks");return Ae(this,Na,void 0),t},vE=function(t){let n=W(this,Na,"f");if(t.type==="message_start"){if(n)throw new je(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new je(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.container=t.delta.container,n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(n.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(n.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(n.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(n.usage.server_tool_use=t.usage.server_tool_use),n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const a=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(a==null?void 0:a.type)==="text"&&(n.content[t.index]={...a,text:(a.text||"")+t.delta.text});break}case"citations_delta":{(a==null?void 0:a.type)==="text"&&(n.content[t.index]={...a,citations:[...a.citations??[],t.delta.citation]});break}case"input_json_delta":{if(a&&SE(a)){let o=a[wE]||"";o+=t.delta.partial_json;const u={...a};if(Object.defineProperty(u,wE,{value:o,enumerable:!1,writable:!0}),o)try{u.input=YO(o)}catch(d){const f=new je(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${d}. JSON: ${o}`);W(this,Fc,"f").call(this,f)}n.content[t.index]=u}break}case"thinking_delta":{(a==null?void 0:a.type)==="thinking"&&(n.content[t.index]={...a,thinking:a.thinking+t.delta.thinking});break}case"signature_delta":{(a==null?void 0:a.type)==="thinking"&&(n.content[t.index]={...a,signature:t.delta.signature});break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",a=>{const o=t.shift();o?o.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,u)=>t.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new xr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const XO={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192},xE={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let c_=class extends ea{constructor(){super(...arguments),this.batches=new KO(this._client)}create(e,t){const{betas:n,...a}=e;a.model in xE&&console.warn(`The model '${a.model}' is deprecated and will reach end-of-life on ${xE[a.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let o=this._client._options.timeout;if(!a.stream&&o==null){const u=XO[a.model]??void 0;o=this._client.calculateNonstreamingTimeout(a.max_tokens,u)}return this._client.post("/v1/messages?beta=true",{body:a,timeout:o??6e5,...t,headers:at([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}stream(e,t){return Gd.createMessage(this,e,t)}countTokens(e,t){const{betas:n,...a}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:a,...t,headers:at([{"anthropic-beta":[...n??[],"token-counting-2024-11-01"].toString()},t==null?void 0:t.headers])})}};c_.Batches=KO;class nu extends ea{constructor(){super(...arguments),this.models=new JO(this._client),this.messages=new c_(this._client),this.files=new VO(this._client)}}nu.Models=JO;nu.Messages=c_;nu.Files=VO;class QO extends ea{create(e,t){const{betas:n,...a}=e;return this._client.post("/v1/complete",{body:a,timeout:this._client._options.timeout??6e5,...t,headers:at([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}}var Hn,Ca,nl,Zc,rl,al,Vc,sl,Zr,il,Jc,Kc,fi,Yc,Xc,bg,EE,vg,wg,Sg,xg,AE;const OE="__json_buf";function TE(r){return r.type==="tool_use"||r.type==="server_tool_use"}class Fd{constructor(){Hn.add(this),this.messages=[],this.receivedMessages=[],Ca.set(this,void 0),this.controller=new AbortController,nl.set(this,void 0),Zc.set(this,()=>{}),rl.set(this,()=>{}),al.set(this,void 0),Vc.set(this,()=>{}),sl.set(this,()=>{}),Zr.set(this,{}),il.set(this,!1),Jc.set(this,!1),Kc.set(this,!1),fi.set(this,!1),Yc.set(this,void 0),Xc.set(this,void 0),vg.set(this,e=>{if(Ae(this,Jc,!0),Hl(e)&&(e=new rr),e instanceof rr)return Ae(this,Kc,!0),this._emit("abort",e);if(e instanceof je)return this._emit("error",e);if(e instanceof Error){const t=new je(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new je(String(e)))}),Ae(this,nl,new Promise((e,t)=>{Ae(this,Zc,e,"f"),Ae(this,rl,t,"f")})),Ae(this,al,new Promise((e,t)=>{Ae(this,Vc,e,"f"),Ae(this,sl,t,"f")})),W(this,nl,"f").catch(()=>{}),W(this,al,"f").catch(()=>{})}get response(){return W(this,Yc,"f")}get request_id(){return W(this,Xc,"f")}async withResponse(){const e=await W(this,nl,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Fd;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const a=new Fd;for(const o of t.messages)a._addMessageParam(o);return a._run(()=>a._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},W(this,vg,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var u;const a=n==null?void 0:n.signal;let o;a&&(a.aborted&&this.controller.abort(),o=this.controller.abort.bind(this.controller),a.addEventListener("abort",o));try{W(this,Hn,"m",wg).call(this);const{response:d,data:f}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(d);for await(const h of f)W(this,Hn,"m",Sg).call(this,h);if((u=f.controller.signal)!=null&&u.aborted)throw new rr;W(this,Hn,"m",xg).call(this)}finally{a&&o&&a.removeEventListener("abort",o)}}_connected(e){this.ended||(Ae(this,Yc,e),Ae(this,Xc,e==null?void 0:e.headers.get("request-id")),W(this,Zc,"f").call(this,e),this._emit("connect"))}get ended(){return W(this,il,"f")}get errored(){return W(this,Jc,"f")}get aborted(){return W(this,Kc,"f")}abort(){this.controller.abort()}on(e,t){return(W(this,Zr,"f")[e]||(W(this,Zr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=W(this,Zr,"f")[e];if(!n)return this;const a=n.findIndex(o=>o.listener===t);return a>=0&&n.splice(a,1),this}once(e,t){return(W(this,Zr,"f")[e]||(W(this,Zr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Ae(this,fi,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Ae(this,fi,!0),await W(this,al,"f")}get currentMessage(){return W(this,Ca,"f")}async finalMessage(){return await this.done(),W(this,Hn,"m",bg).call(this)}async finalText(){return await this.done(),W(this,Hn,"m",EE).call(this)}_emit(e,...t){if(W(this,il,"f"))return;e==="end"&&(Ae(this,il,!0),W(this,Vc,"f").call(this));const n=W(this,Zr,"f")[e];if(n&&(W(this,Zr,"f")[e]=n.filter(a=>!a.once),n.forEach(({listener:a})=>a(...t))),e==="abort"){const a=t[0];!W(this,fi,"f")&&!(n!=null&&n.length)&&Promise.reject(a),W(this,rl,"f").call(this,a),W(this,sl,"f").call(this,a),this._emit("end");return}if(e==="error"){const a=t[0];!W(this,fi,"f")&&!(n!=null&&n.length)&&Promise.reject(a),W(this,rl,"f").call(this,a),W(this,sl,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",W(this,Hn,"m",bg).call(this))}async _fromReadableStream(e,t){var o;const n=t==null?void 0:t.signal;let a;n&&(n.aborted&&this.controller.abort(),a=this.controller.abort.bind(this.controller),n.addEventListener("abort",a));try{W(this,Hn,"m",wg).call(this),this._connected(null);const u=xr.fromReadableStream(e,this.controller);for await(const d of u)W(this,Hn,"m",Sg).call(this,d);if((o=u.controller.signal)!=null&&o.aborted)throw new rr;W(this,Hn,"m",xg).call(this)}finally{n&&a&&n.removeEventListener("abort",a)}}[(Ca=new WeakMap,nl=new WeakMap,Zc=new WeakMap,rl=new WeakMap,al=new WeakMap,Vc=new WeakMap,sl=new WeakMap,Zr=new WeakMap,il=new WeakMap,Jc=new WeakMap,Kc=new WeakMap,fi=new WeakMap,Yc=new WeakMap,Xc=new WeakMap,vg=new WeakMap,Hn=new WeakSet,bg=function(){if(this.receivedMessages.length===0)throw new je("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},EE=function(){if(this.receivedMessages.length===0)throw new je("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new je("stream ended without producing a content block with type=text");return t.join(" ")},wg=function(){this.ended||Ae(this,Ca,void 0)},Sg=function(t){if(this.ended)return;const n=W(this,Hn,"m",AE).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const a=n.content.at(-1);switch(t.delta.type){case"text_delta":{a.type==="text"&&this._emit("text",t.delta.text,a.text||"");break}case"citations_delta":{a.type==="text"&&this._emit("citation",t.delta.citation,a.citations??[]);break}case"input_json_delta":{TE(a)&&a.input&&this._emit("inputJson",t.delta.partial_json,a.input);break}case"thinking_delta":{a.type==="thinking"&&this._emit("thinking",t.delta.thinking,a.thinking);break}case"signature_delta":{a.type==="thinking"&&this._emit("signature",a.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{Ae(this,Ca,n);break}}},xg=function(){if(this.ended)throw new je("stream has ended, this shouldn't happen");const t=W(this,Ca,"f");if(!t)throw new je("request ended without sending any chunks");return Ae(this,Ca,void 0),t},AE=function(t){let n=W(this,Ca,"f");if(t.type==="message_start"){if(n)throw new je(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new je(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(n.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(n.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(n.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(n.usage.server_tool_use=t.usage.server_tool_use),n;case"content_block_start":return n.content.push({...t.content_block}),n;case"content_block_delta":{const a=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(a==null?void 0:a.type)==="text"&&(n.content[t.index]={...a,text:(a.text||"")+t.delta.text});break}case"citations_delta":{(a==null?void 0:a.type)==="text"&&(n.content[t.index]={...a,citations:[...a.citations??[],t.delta.citation]});break}case"input_json_delta":{if(a&&TE(a)){let o=a[OE]||"";o+=t.delta.partial_json;const u={...a};Object.defineProperty(u,OE,{value:o,enumerable:!1,writable:!0}),o&&(u.input=YO(o)),n.content[t.index]=u}break}case"thinking_delta":{(a==null?void 0:a.type)==="thinking"&&(n.content[t.index]={...a,thinking:a.thinking+t.delta.thinking});break}case"signature_delta":{(a==null?void 0:a.type)==="thinking"&&(n.content[t.index]={...a,signature:t.delta.signature});break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",a=>{const o=t.shift();o?o.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,u)=>t.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new xr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class WO extends ea{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(or`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",tu,{query:e,...t})}delete(e,t){return this._client.delete(or`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(or`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const n=await this.retrieve(e);if(!n.results_url)throw new je(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);return this._client.get(n.results_url,{...t,headers:at([{Accept:"application/binary"},t==null?void 0:t.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((a,o)=>_f.fromResponse(o.response,o.controller))}}class d_ extends ea{constructor(){super(...arguments),this.batches=new WO(this._client)}create(e,t){e.model in RE&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${RE[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!e.stream&&n==null){const a=XO[e.model]??void 0;n=this._client.calculateNonstreamingTimeout(e.max_tokens,a)}return this._client.post("/v1/messages",{body:e,timeout:n??6e5,...t,stream:e.stream??!1})}stream(e,t){return Fd.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const RE={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};d_.Batches=WO;class eT extends ea{retrieve(e,t={},n){const{betas:a}=t??{};return this._client.get(or`/v1/models/${e}`,{...n,headers:at([{...(a==null?void 0:a.toString())!=null?{"anthropic-beta":a==null?void 0:a.toString()}:void 0},n==null?void 0:n.headers])})}list(e={},t){const{betas:n,...a}=e??{};return this._client.getAPIList("/v1/models",tu,{query:a,...t,headers:at([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},t==null?void 0:t.headers])})}}var Eg={};const Qc=r=>{var e,t,n,a;if(typeof globalThis.process<"u")return((e=Eg==null?void 0:Eg[r])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(a=(n=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:a.trim()};var my,f_,hd,tT;class gt{constructor({baseURL:e=Qc("ANTHROPIC_BASE_URL"),apiKey:t=Qc("ANTHROPIC_API_KEY")??null,authToken:n=Qc("ANTHROPIC_AUTH_TOKEN")??null,...a}={}){my.add(this),hd.set(this,void 0);const o={apiKey:t,authToken:n,...a,baseURL:e||"https://api.anthropic.com"};if(!o.dangerouslyAllowBrowser&&h4())throw new je(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=o.baseURL,this.timeout=o.timeout??f_.DEFAULT_TIMEOUT,this.logger=o.logger??console;const u="warn";this.logLevel=u,this.logLevel=pE(o.logLevel,"ClientOptions.logLevel",this)??pE(Qc("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??u,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??_4(),Ae(this,hd,v4),this._options=o,this.apiKey=t,this.authToken=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){return at([this.apiKeyAuth(e),this.bearerAuth(e)])}apiKeyAuth(e){if(this.apiKey!=null)return at([{"X-Api-Key":this.apiKey}])}bearerAuth(e){if(this.authToken!=null)return at([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new je(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${bi}`}defaultIdempotencyKey(){return`stainless-node-retry-${TO()}`}makeStatusError(e,t,n,a){return Zt.generate(e,t,n,a)}buildURL(e,t,n){const a=!W(this,my,"m",tT).call(this)&&n||this.baseURL,o=l4(e)?new URL(e):new URL(a+(a.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),u=this.defaultQuery();return u4(u)||(t={...u,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(o.search=this.stringifyQuery(t)),o.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new je("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(a=>({method:e,path:t,...a})))}request(e,t=null){return new yf(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var E,R;const a=await e,o=a.maxRetries??this.maxRetries;t==null&&(t=o),await this.prepareOptions(a);const{req:u,url:d,timeout:f}=this.buildRequest(a,{retryCount:o-t});await this.prepareRequest(u,{url:d,options:a});const h="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),p=n===void 0?"":`, retryOf: ${n}`,y=Date.now();if(Qt(this).debug(`[${h}] sending request`,us({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:u.headers})),(E=a.signal)!=null&&E.aborted)throw new rr;const _=new AbortController,b=await this.fetchWithTimeout(d,u,f,_).catch(cy),v=Date.now();if(b instanceof Error){const T=`retrying, ${t} attempts remaining`;if((R=a.signal)!=null&&R.aborted)throw new rr;const j=Hl(b)||/timed? ?out/i.test(String(b)+("cause"in b?String(b.cause):""));if(t)return Qt(this).info(`[${h}] connection ${j?"timed out":"failed"} - ${T}`),Qt(this).debug(`[${h}] connection ${j?"timed out":"failed"} (${T})`,us({retryOfRequestLogID:n,url:d,durationMs:v-y,message:b.message})),this.retryRequest(a,t,n??h);throw Qt(this).info(`[${h}] connection ${j?"timed out":"failed"} - error; no more retries left`),Qt(this).debug(`[${h}] connection ${j?"timed out":"failed"} (error; no more retries left)`,us({retryOfRequestLogID:n,url:d,durationMs:v-y,message:b.message})),j?new RO:new gf({cause:b})}const S=[...b.headers.entries()].filter(([T])=>T==="request-id").map(([T,j])=>", "+T+": "+JSON.stringify(j)).join(""),x=`[${h}${p}${S}] ${u.method} ${d} ${b.ok?"succeeded":"failed"} with status ${b.status} in ${v-y}ms`;if(!b.ok){const T=this.shouldRetry(b);if(t&&T){const oe=`retrying, ${t} attempts remaining`;return await b4(b.body),Qt(this).info(`${x} - ${oe}`),Qt(this).debug(`[${h}] response error (${oe})`,us({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,durationMs:v-y})),this.retryRequest(a,t,n??h,b.headers)}const j=T?"error; no more retries left":"error; not retryable";Qt(this).info(`${x} - ${j}`);const $=await b.text().catch(oe=>cy(oe).message),q=LO($),Z=q?void 0:$;throw Qt(this).debug(`[${h}] response error (${j})`,us({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,message:Z,durationMs:Date.now()-y})),this.makeStatusError(b.status,q,Z,b.headers)}return Qt(this).info(x),Qt(this).debug(`[${h}] response start`,us({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,durationMs:v-y})),{response:b,options:a,controller:_,requestLogID:h,retryOfRequestLogID:n,startTime:y}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new C4(this,n,e)}async fetchWithTimeout(e,t,n,a){const{signal:o,method:u,...d}=t||{};o&&o.addEventListener("abort",()=>a.abort());const f=setTimeout(()=>a.abort(),n),h=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,p={signal:a.signal,...h?{duplex:"half"}:{},method:"GET",...d};u&&(p.method=u.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(f)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,a){let o;const u=a==null?void 0:a.get("retry-after-ms");if(u){const f=parseFloat(u);Number.isNaN(f)||(o=f)}const d=a==null?void 0:a.get("retry-after");if(d&&!o){const f=parseFloat(d);Number.isNaN(f)?o=Date.parse(d)-Date.now():o=f*1e3}if(!(o&&0<=o&&o<60*1e3)){const f=e.maxRetries??this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,f)}return await f4(o),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const o=t-e,u=Math.min(.5*Math.pow(2,o),8),d=1-Math.random()*.25;return u*d*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new je("Streaming is strongly recommended for operations that may token longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:a,path:o,query:u,defaultBaseURL:d}=n,f=this.buildURL(o,u,d);"timeout"in n&&d4("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:h,body:p}=this.buildBody({options:n}),y=this.buildHeaders({options:e,method:a,bodyHeaders:h,retryCount:t});return{req:{method:a,headers:y,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"},...p&&{body:p},...this.fetchOptions??{},...n.fetchOptions??{}},url:f,timeout:n.timeout}}buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:a}){let o={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const u=at([o,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...y4(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(u),u.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=at([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:UO(e)}:W(this,hd,"f").call(this,{body:e,headers:n})}}f_=gt,hd=new WeakMap,my=new WeakSet,tT=function(){return this.baseURL!=="https://api.anthropic.com"};gt.Anthropic=f_;gt.HUMAN_PROMPT=`

Human:`;gt.AI_PROMPT=`

Assistant:`;gt.DEFAULT_TIMEOUT=6e5;gt.AnthropicError=je;gt.APIError=Zt;gt.APIConnectionError=gf;gt.APIConnectionTimeoutError=RO;gt.APIUserAbortError=rr;gt.NotFoundError=jO;gt.ConflictError=$O;gt.RateLimitError=PO;gt.BadRequestError=NO;gt.AuthenticationError=CO;gt.InternalServerError=MO;gt.PermissionDeniedError=kO;gt.UnprocessableEntityError=IO;gt.toFile=L4;class Gi extends gt{constructor(){super(...arguments),this.completions=new QO(this),this.messages=new d_(this),this.models=new eT(this),this.beta=new nu(this)}}Gi.Completions=QO;Gi.Messages=d_;Gi.Models=eT;Gi.Beta=nu;const{HUMAN_PROMPT:DU,AI_PROMPT:UU}=Gi;class NE extends gO{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(a){throw new ql(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(a.message)}`,e)}else t=e;if(this.zodSchema===void 0)return t;const n=await uO(this.zodSchema,t);if(n.success)return n.data;throw new ql(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(n.error.issues)}`,JSON.stringify(t,null,2))}async parseResult(e){const t=e.flatMap(o=>{const{message:u}=o;return Array.isArray(u.content)?nT(u.content)[0]:[]});if(t[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[n]=t;return await this._validateResult(n.args)}}function nT(r){const e=[];for(const t of r)t.type==="tool_use"?e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"}):t.type==="server_tool_use"&&t.name==="web_search"&&e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"});return e}function G4(r){if(r)return r==="any"?{type:"any"}:r==="auto"?{type:"auto"}:typeof r=="string"?{type:"tool",name:r}:r}function F4(r){return r==null||typeof r!="object"||!("type"in r)||r.type!=="image"||!("source"in r)||typeof r.source!="object"||r.source==null||!("type"in r.source)?!1:r.source.type==="base64"?!(!("media_type"in r.source)||typeof r.source.media_type!="string"||!("data"in r.source)||typeof r.source.data!="string"):r.source.type==="url"?!(!("url"in r.source)||typeof r.source.url!="string"):!1}function CE(r){const e=kd({dataUrl:r});if(e)return{type:"base64",media_type:e.mime_type,data:e.data};let t;try{t=new URL(r)}catch{throw new Error([`Malformed image URL: ${JSON.stringify(r)}. Content blocks of type 'image_url' must be a valid http, https, or base64-encoded data URL.`,"Example: data:image/png;base64,/9j/4AAQSk...","Example: https://example.com/image.jpg"].join(`

`))}if(t.protocol==="http:"||t.protocol==="https:")return{type:"url",url:r};throw new Error([`Invalid image URL protocol: ${JSON.stringify(t.protocol)}. Anthropic only supports images as http, https, or base64-encoded data URLs on 'image_url' content blocks.`,"Example: data:image/png;base64,/9j/4AAQSk...","Example: https://example.com/image.jpg"].join(`

`))}function Z4(r){const e=[];for(const t of r)if(t._getType()==="tool")if(typeof t.content=="string"){const n=e[e.length-1];(n==null?void 0:n._getType())==="human"&&Array.isArray(n.content)&&"type"in n.content[0]&&n.content[0].type==="tool_result"?n.content.push({type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}):e.push(new ki({content:[{type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}]}))}else e.push(new ki({content:[{type:"tool_result",...t.content!=null?{content:py(t.content)}:{},tool_use_id:t.tool_call_id}]}));else e.push(t);return e}function kE(r){if(r.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:r.id,name:r.name,input:r.args}}const V4={providerName:"anthropic",fromStandardTextBlock(r){return{type:"text",text:r.text,..."citations"in(r.metadata??{})?{citations:r.metadata.citations}:{},..."cache_control"in(r.metadata??{})?{cache_control:r.metadata.cache_control}:{}}},fromStandardImageBlock(r){if(r.source_type==="url"){const e=kd({dataUrl:r.url,asTypedArray:!1});return e?{type:"image",source:{type:"base64",data:e.data,media_type:e.mime_type},..."cache_control"in(r.metadata??{})?{cache_control:r.metadata.cache_control}:{}}:{type:"image",source:{type:"url",url:r.url,media_type:r.mime_type??""},..."cache_control"in(r.metadata??{})?{cache_control:r.metadata.cache_control}:{}}}else{if(r.source_type==="base64")return{type:"image",source:{type:"base64",data:r.data,media_type:r.mime_type??""},..."cache_control"in(r.metadata??{})?{cache_control:r.metadata.cache_control}:{}};throw new Error(`Unsupported image source type: ${r.source_type}`)}},fromStandardFileBlock(r){const e=(r.mime_type??"").split(";")[0];if(r.source_type==="url"){if(e==="application/pdf"||e==="")return{type:"document",source:{type:"url",url:r.url,media_type:r.mime_type??""},..."cache_control"in(r.metadata??{})?{cache_control:r.metadata.cache_control}:{},..."citations"in(r.metadata??{})?{citations:r.metadata.citations}:{},..."context"in(r.metadata??{})?{context:r.metadata.context}:{},..."title"in(r.metadata??{})?{title:r.metadata.title}:{}};throw new Error(`Unsupported file mime type for file url source: ${r.mime_type}`)}else if(r.source_type==="text"){if(e==="text/plain"||e==="")return{type:"document",source:{type:"text",data:r.text,media_type:r.mime_type??""},..."cache_control"in(r.metadata??{})?{cache_control:r.metadata.cache_control}:{},..."citations"in(r.metadata??{})?{citations:r.metadata.citations}:{},..."context"in(r.metadata??{})?{context:r.metadata.context}:{},..."title"in(r.metadata??{})?{title:r.metadata.title}:{}};throw new Error(`Unsupported file mime type for file text source: ${r.mime_type}`)}else if(r.source_type==="base64"){if(e==="application/pdf"||e==="")return{type:"document",source:{type:"base64",data:r.data,media_type:"application/pdf"},..."cache_control"in(r.metadata??{})?{cache_control:r.metadata.cache_control}:{},..."citations"in(r.metadata??{})?{citations:r.metadata.citations}:{},..."context"in(r.metadata??{})?{context:r.metadata.context}:{},..."title"in(r.metadata??{})?{title:r.metadata.title}:{}};if(["image/jpeg","image/png","image/gif","image/webp"].includes(e))return{type:"document",source:{type:"content",content:[{type:"image",source:{type:"base64",data:r.data,media_type:e}}]},..."cache_control"in(r.metadata??{})?{cache_control:r.metadata.cache_control}:{},..."citations"in(r.metadata??{})?{citations:r.metadata.citations}:{},..."context"in(r.metadata??{})?{context:r.metadata.context}:{},..."title"in(r.metadata??{})?{title:r.metadata.title}:{}};throw new Error(`Unsupported file mime type for file base64 source: ${r.mime_type}`)}else throw new Error(`Unsupported file source type: ${r.source_type}`)}};function py(r){const e=["tool_use","tool_result","input_json_delta","server_tool_use","web_search_tool_result","web_search_result"],t=["text","text_delta"];return typeof r=="string"?r:r.map(a=>{if(Da(a))return qy(a,V4);const o="cache_control"in a?a.cache_control:void 0;if(a.type==="image_url"){let u;return typeof a.image_url=="string"?u=CE(a.image_url):u=CE(a.image_url.url),{type:"image",source:u,...o?{cache_control:o}:{}}}else{if(F4(a))return a;if(a.type==="document")return{...a,...o?{cache_control:o}:{}};if(a.type==="thinking")return{type:"thinking",thinking:a.thinking,signature:a.signature,...o?{cache_control:o}:{}};if(a.type==="redacted_thinking")return{type:"redacted_thinking",data:a.data,...o?{cache_control:o}:{}};if(a.type==="search_result")return{type:"search_result",title:a.title,source:a.source,..."cache_control"in a&&a.cache_control?{cache_control:a.cache_control}:{},..."citations"in a&&a.citations?{citations:a.citations}:{},content:a.content};if(t.find(u=>u===a.type)&&"text"in a)return{type:"text",text:a.text,...o?{cache_control:o}:{},..."citations"in a&&a.citations?{citations:a.citations}:{}};if(e.find(u=>u===a.type)){const u={...a};if("index"in u&&delete u.index,u.type==="input_json_delta"&&(u.type="tool_use"),"input"in u&&typeof u.input=="string")try{u.input=JSON.parse(u.input)}catch{u.input={}}return{...u,...o?{cache_control:o}:{}}}else throw new Error("Unsupported message content format")}})}function jE(r){const e=Z4(r);let t;e.length>0&&e[0]._getType()==="system"&&(t=r[0].content);const a=(t!==void 0?e.slice(1):e).map(o=>{var d;let u;if(o._getType()==="human")u="user";else if(o._getType()==="ai")u="assistant";else if(o._getType()==="tool")u="user";else throw o._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${o._getType()}" is not supported.`);if(Ui(o)&&((d=o.tool_calls)!=null&&d.length)){if(typeof o.content=="string")return o.content===""?{role:u,content:o.tool_calls.map(kE)}:{role:u,content:[{type:"text",text:o.content},...o.tool_calls.map(kE)]};{const{content:f}=o;return!o.tool_calls.every(p=>f.find(y=>(y.type==="tool_use"||y.type==="input_json_delta"||y.type==="server_tool_use")&&y.id===p.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:u,content:py(o.content)}}}else return{role:u,content:py(o.content)}});return{messages:J4(a),system:t}}function J4(r){if(!r||r.length<=1)return r;const e=[];let t=r[0];const n=o=>typeof o=="string"?[{type:"text",text:o}]:o,a=o=>o.role!=="user"||typeof o.content=="string"?!1:Array.isArray(o.content)&&o.content.every(u=>u.type==="tool_result");for(let o=1;o<r.length;o+=1){const u=r[o];a(t)&&a(u)?t={...t,content:[...n(t.content),...n(u.content)]}:(e.push(t),t=u)}return e.push(t),e}function K4(r,e){var t;if(r.type==="message_start"){const{content:n,usage:a,...o}=r.message,u={};for(const[y,_]of Object.entries(o))_!=null&&(u[y]=_);const{input_tokens:d,output_tokens:f,...h}=a??{},p={input_tokens:d,output_tokens:f,total_tokens:d+f,input_token_details:{cache_creation:h.cache_creation_input_tokens,cache_read:h.cache_read_input_tokens}};return{chunk:new xt({content:e.coerceContentToString?"":[],additional_kwargs:u,usage_metadata:e.streamUsage?p:void 0,response_metadata:{usage:{...h}},id:r.message.id})}}else if(r.type==="message_delta"){const n={input_tokens:0,output_tokens:r.usage.output_tokens,total_tokens:r.usage.output_tokens,input_token_details:{cache_creation:r.usage.cache_creation_input_tokens,cache_read:r.usage.cache_read_input_tokens}};return{chunk:new xt({content:e.coerceContentToString?"":[],additional_kwargs:{...r.delta},usage_metadata:e.streamUsage?n:void 0})}}else if(r.type==="content_block_start"&&["tool_use","document","server_tool_use","web_search_tool_result"].includes(r.content_block.type)){const n=r.content_block;let a;return n.type==="tool_use"?a=[{id:n.id,index:r.index,name:n.name,args:""}]:n.type==="server_tool_use"?a=[{id:n.id,index:r.index,name:n.name,args:""}]:a=[],{chunk:new xt({content:e.coerceContentToString?"":[{index:r.index,...r.content_block,input:n.type==="server_tool_use"||n.type==="tool_use"?"":void 0}],additional_kwargs:{},tool_call_chunks:a})}}else if(r.type==="content_block_delta"&&["text_delta","citations_delta","thinking_delta","signature_delta"].includes(r.delta.type)){if(e.coerceContentToString&&"text"in r.delta)return{chunk:new xt({content:r.delta.text})};{const n=r.delta;return"citation"in n&&(n.citations=[n.citation],delete n.citation),n.type==="thinking_delta"||n.type==="signature_delta"?{chunk:new xt({content:[{index:r.index,...n,type:"thinking"}]})}:{chunk:new xt({content:[{index:r.index,...n,type:"text"}]})}}}else{if(r.type==="content_block_delta"&&r.delta.type==="input_json_delta")return{chunk:new xt({content:e.coerceContentToString?"":[{index:r.index,input:r.delta.partial_json,type:r.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:r.index,args:r.delta.partial_json}]})};if(r.type==="content_block_start"&&r.content_block.type==="text"){const n=(t=r.content_block)==null?void 0:t.text;if(n!==void 0)return{chunk:new xt({content:e.coerceContentToString?n:[{index:r.index,...r.content_block}],additional_kwargs:{}})}}else{if(r.type==="content_block_start"&&r.content_block.type==="redacted_thinking")return{chunk:new xt({content:e.coerceContentToString?"":[{index:r.index,...r.content_block}]})};if(r.type==="content_block_start"&&r.content_block.type==="thinking"){const n=r.content_block.thinking;return{chunk:new xt({content:e.coerceContentToString?n:[{index:r.index,...r.content_block}]})}}}}return null}function Y4(r,e){const t=e.usage,n=t!=null?{input_tokens:t.input_tokens??0,output_tokens:t.output_tokens??0,total_tokens:(t.input_tokens??0)+(t.output_tokens??0),input_token_details:{cache_creation:t.cache_creation_input_tokens,cache_read:t.cache_read_input_tokens}}:void 0;if(r.length===1&&r[0].type==="text")return[{text:r[0].text,message:new _s({content:r[0].text,additional_kwargs:e,usage_metadata:n,response_metadata:e,id:e.id})}];{const a=nT(r);return[{text:"",message:new _s({content:r,additional_kwargs:e,tool_calls:a,usage_metadata:n,response_metadata:e,id:e.id})}]}}function Wc(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function $E(r){let e;return r.status===400&&r.message.includes("tool")?e=Wc(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Wc(r,"MODEL_AUTHENTICATION"):r.status===404?e=Wc(r,"MODEL_NOT_FOUND"):r.status===429?e=Wc(r,"MODEL_RATE_LIMIT"):e=r,e}function X4(r){return!!(r.tools&&r.tools.length>0)}function Q4(r){for(const e of r.messages??[])if(typeof e.content!="string"){for(const t of e.content??[])if(typeof t=="object"&&t!=null&&t.type==="document"&&typeof t.citations=="object"&&t.citations.enabled)return!0}return!1}function W4(r){return!!(r.thinking&&r.thinking.type==="enabled")}function eD(r){return"input_schema"in r}function tD(r){const e=["web_search"];return typeof r=="object"&&r!==null&&"type"in r&&"name"in r&&typeof r.type=="string"&&typeof r.name=="string"&&e.includes(r.name)}function nD(r){if(typeof r.content=="string")return r.content;if(Array.isArray(r.content)&&r.content.length>=1&&"input"in r.content[0])return typeof r.content[0].input=="string"?r.content[0].input:JSON.stringify(r.content[0].input);if(Array.isArray(r.content)&&r.content.length>=1&&"text"in r.content[0])return r.content[0].text}class rD extends Kr{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thinking",{enumerable:!0,configurable:!0,writable:!0,value:{type:"disabled"}}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??Wr("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.thinking=(e==null?void 0:e.thinking)??this.thinking,this.createClient=(e==null?void 0:e.createClient)??(t=>new Gi(t))}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(t=>{if(tD(t)||eD(t))return t;if(a_(t))return{name:t.function.name,description:t.function.description,input_schema:t.function.parameters};if(i_(t))return{name:t.name,description:t.description,input_schema:Xr(t.schema)?Zn(t.schema):t.schema};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(t,null,2)}`)})}bindTools(e,t){return this.withConfig({tools:this.formatStructuredToolToAnthropic(e),...t})}invocationParams(e){const t=G4(e==null?void 0:e.tool_choice);if(this.thinking.type==="enabled"){if(this.topK!==-1)throw new Error("topK is not supported when thinking is enabled");if(this.topP!==-1)throw new Error("topP is not supported when thinking is enabled");if(this.temperature!==1)throw new Error("temperature is not supported when thinking is enabled");return{model:this.model,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,t,n){var h;const a=this.invocationParams(t),o=jE(e),u={...a,...o,stream:!0},d=!X4(u)&&!Q4(u)&&!W4(u),f=await this.createStreamWithRetry(u,{headers:t.headers});for await(const p of f){if((h=t.signal)!=null&&h.aborted)throw f.controller.abort(),new Error("AbortError: User aborted the request.");const y=this.streamUsage??t.streamUsage,_=K4(p,{streamUsage:y,coerceContentToString:d});if(!_)continue;const{chunk:b}=_,v=nD(b),S=new Ba({message:new xt({content:b.content,additional_kwargs:b.additional_kwargs,tool_call_chunks:b.tool_call_chunks,usage_metadata:y?b.usage_metadata:void 0,response_metadata:b.response_metadata,id:b.id}),text:v??""});yield S,await(n==null?void 0:n.handleLLMNewToken(v??"",void 0,void 0,void 0,void 0,{chunk:S}))}}async _generateNonStreaming(e,t,n){const a=await this.completionWithRetry({...t,stream:!1,...jE(e)},n),{content:o,...u}=a,d=Y4(o,u),{role:f,type:h,...p}=u;return{generations:d,llmOutput:p}}async _generate(e,t,n){if(this.stopSequences&&t.stop)throw new Error('"stopSequence" parameter found in input and default params');const a=this.invocationParams(t);if(a.stream){let o;const u=this._streamResponseChunks(e,t,n);for await(const d of u)o===void 0?o=d:o=o.concat(d);if(o===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:o.text,message:o.message}]}}else return this._generateNonStreaming(e,a,{signal:t.signal,headers:t.headers})}async createStreamWithRetry(e,t){if(!this.streamingClient){const a=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...a,apiKey:this.apiKey,maxRetries:0})}const n=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},t)}catch(a){throw $E(a)}};return this.caller.call(n)}async completionWithRetry(e,t){if(!this.batchClient){const a=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...a,apiKey:this.apiKey,maxRetries:0})}const n=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},t)}catch(a){throw $E(a)}};return this.caller.callWithOptions({signal:t.signal??void 0},n)}_llmType(){return"anthropic"}withStructuredOutput(e,t){var v;const n=e,a=t==null?void 0:t.name,o=t==null?void 0:t.method,u=t==null?void 0:t.includeRaw;if(o==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let d=a??"extract",f,h;if(Xr(n)){const S=Zn(n);h=[{name:d,description:S.description??"A function available to call.",input_schema:S}],f=new NE({returnSingle:!0,keyName:d,zodSchema:n})}else{let S;typeof n.name=="string"&&typeof n.description=="string"&&typeof n.input_schema=="object"&&n.input_schema!=null?(S=n,d=n.name):S={name:d,description:n.description??"",input_schema:n},h=[S],f=new NE({returnSingle:!0,keyName:d})}let p;if(((v=this.thinking)==null?void 0:v.type)==="enabled"){const S="Anthropic structured output relies on forced tool calling, which is not supported when `thinking` is enabled. This method will raise OutputParserException if tool calls are not generated. Consider disabling `thinking` or adjust your prompt to ensure the tool is called.";console.warn(S),p=this.withConfig({tools:h,ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:Zn(n)}});const x=E=>{if(!E.tool_calls||E.tool_calls.length===0)throw new Error(S);return E};p=p.pipe(x)}else p=this.withConfig({tools:h,tool_choice:{type:"tool",name:d},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:Zn(n)}});if(!u)return p.pipe(f).withConfig({runName:"ChatAnthropicStructuredOutput"});const y=Ii.assign({parsed:(S,x)=>f.invoke(S.raw,x)}),_=Ii.assign({parsed:()=>null}),b=y.withFallbacks({fallbacks:[_]});return Sr.from([{raw:p},b]).withConfig({runName:"StructuredOutputRunnable"})}}class aD extends rD{}var IE;(function(r){r.STRING="string",r.NUMBER="number",r.INTEGER="integer",r.BOOLEAN="boolean",r.ARRAY="array",r.OBJECT="object"})(IE||(IE={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var PE;(function(r){r.LANGUAGE_UNSPECIFIED="language_unspecified",r.PYTHON="python"})(PE||(PE={}));var ME;(function(r){r.OUTCOME_UNSPECIFIED="outcome_unspecified",r.OUTCOME_OK="outcome_ok",r.OUTCOME_FAILED="outcome_failed",r.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(ME||(ME={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LE=["user","model","function","system"];var DE;(function(r){r.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(DE||(DE={}));var UE;(function(r){r.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(UE||(UE={}));var zE;(function(r){r.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(zE||(zE={}));var BE;(function(r){r.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER"})(BE||(BE={}));var Cl;(function(r){r.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.LANGUAGE="LANGUAGE",r.OTHER="OTHER"})(Cl||(Cl={}));var qE;(function(r){r.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",r.RETRIEVAL_QUERY="RETRIEVAL_QUERY",r.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",r.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",r.CLASSIFICATION="CLASSIFICATION",r.CLUSTERING="CLUSTERING"})(qE||(qE={}));var HE;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.AUTO="AUTO",r.ANY="ANY",r.NONE="NONE"})(HE||(HE={}));var GE;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.MODE_DYNAMIC="MODE_DYNAMIC"})(GE||(GE={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class hi extends dn{constructor(e,t){super(e),this.response=t}}class rT extends dn{constructor(e,t,n,a){super(e),this.status=t,this.statusText=n,this.errorDetails=a}}class Ma extends dn{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD="https://generativelanguage.googleapis.com",iD="v1beta",oD="0.21.0",lD="genai-js";var bs;(function(r){r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens",r.EMBED_CONTENT="embedContent",r.BATCH_EMBED_CONTENTS="batchEmbedContents"})(bs||(bs={}));class uD{constructor(e,t,n,a,o){this.model=e,this.task=t,this.apiKey=n,this.stream=a,this.requestOptions=o}toString(){var e,t;const n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||iD;let o=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||sD}/${n}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function cD(r){const e=[];return r!=null&&r.apiClient&&e.push(r.apiClient),e.push(`${lD}/${oD}`),e.join(" ")}async function dD(r){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",cD(r.requestOptions)),t.append("x-goog-api-key",r.apiKey);let n=(e=r.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(a){throw new Ma(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${a.message}`)}for(const[a,o]of n.entries()){if(a==="x-goog-api-key")throw new Ma(`Cannot set reserved header name ${a}`);if(a==="x-goog-api-client")throw new Ma(`Header name ${a} can only be set using the apiClient field`);t.append(a,o)}}return t}async function fD(r,e,t,n,a,o){const u=new uD(r,e,t,n,o);return{url:u.toString(),fetchOptions:Object.assign(Object.assign({},gD(o)),{method:"POST",headers:await dD(u),body:a})}}async function ru(r,e,t,n,a,o={},u=fetch){const{url:d,fetchOptions:f}=await fD(r,e,t,n,a,o);return hD(d,f,u)}async function hD(r,e,t=fetch){let n;try{n=await t(r,e)}catch(a){mD(a,r)}return n.ok||await pD(n,r),n}function mD(r,e){let t=r;throw r instanceof rT||r instanceof Ma||(t=new dn(`Error fetching from ${e.toString()}: ${r.message}`),t.stack=r.stack),t}async function pD(r,e){let t="",n;try{const a=await r.json();t=a.error.message,a.error.details&&(t+=` ${JSON.stringify(a.error.details)}`,n=a.error.details)}catch{}throw new rT(`Error fetching from ${e.toString()}: [${r.status} ${r.statusText}] ${t}`,r.status,r.statusText,n)}function gD(r){const e={};if((r==null?void 0:r.signal)!==void 0||(r==null?void 0:r.timeout)>=0){const t=new AbortController;(r==null?void 0:r.timeout)>=0&&setTimeout(()=>t.abort(),r.timeout),r!=null&&r.signal&&r.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h_(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),md(r.candidates[0]))throw new hi(`${$a(r)}`,r);return yD(r)}else if(r.promptFeedback)throw new hi(`Text not available. ${$a(r)}`,r);return""},r.functionCall=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),md(r.candidates[0]))throw new hi(`${$a(r)}`,r);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),FE(r)[0]}else if(r.promptFeedback)throw new hi(`Function call not available. ${$a(r)}`,r)},r.functionCalls=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),md(r.candidates[0]))throw new hi(`${$a(r)}`,r);return FE(r)}else if(r.promptFeedback)throw new hi(`Function call not available. ${$a(r)}`,r)},r}function yD(r){var e,t,n,a;const o=[];if(!((t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const u of(a=(n=r.candidates)===null||n===void 0?void 0:n[0].content)===null||a===void 0?void 0:a.parts)u.text&&o.push(u.text),u.executableCode&&o.push("\n```"+u.executableCode.language+`
`+u.executableCode.code+"\n```\n"),u.codeExecutionResult&&o.push("\n```\n"+u.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function FE(r){var e,t,n,a;const o=[];if(!((t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const u of(a=(n=r.candidates)===null||n===void 0?void 0:n[0].content)===null||a===void 0?void 0:a.parts)u.functionCall&&o.push(u.functionCall);if(o.length>0)return o}const _D=[Cl.RECITATION,Cl.SAFETY,Cl.LANGUAGE];function md(r){return!!r.finishReason&&_D.includes(r.finishReason)}function $a(r){var e,t,n;let a="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)a+="Response was blocked",!((e=r.promptFeedback)===null||e===void 0)&&e.blockReason&&(a+=` due to ${r.promptFeedback.blockReason}`),!((t=r.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(a+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((n=r.candidates)===null||n===void 0)&&n[0]){const o=r.candidates[0];md(o)&&(a+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(a+=`: ${o.finishMessage}`))}return a}function Gl(r){return this instanceof Gl?(this.v=r,this):new Gl(r)}function bD(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),a,o=[];return a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a;function u(_){n[_]&&(a[_]=function(b){return new Promise(function(v,S){o.push([_,b,v,S])>1||d(_,b)})})}function d(_,b){try{f(n[_](b))}catch(v){y(o[0][3],v)}}function f(_){_.value instanceof Gl?Promise.resolve(_.value.v).then(h,p):y(o[0][2],_)}function h(_){d("next",_)}function p(_){d("throw",_)}function y(_,b){_(b),o.shift(),o.length&&d(o[0][0],o[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZE=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function vD(r){const e=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=xD(e),[n,a]=t.tee();return{stream:SD(n),response:wD(a)}}async function wD(r){const e=[],t=r.getReader();for(;;){const{done:n,value:a}=await t.read();if(n)return h_(ED(e));e.push(a)}}function SD(r){return bD(this,arguments,function*(){const t=r.getReader();for(;;){const{value:n,done:a}=yield Gl(t.read());if(a)break;yield yield Gl(h_(n))}})}function xD(r){const e=r.getReader();return new ReadableStream({start(n){let a="";return o();function o(){return e.read().then(({value:u,done:d})=>{if(d){if(a.trim()){n.error(new dn("Failed to parse stream"));return}n.close();return}a+=u;let f=a.match(ZE),h;for(;f;){try{h=JSON.parse(f[1])}catch{n.error(new dn(`Error parsing JSON response: "${f[1]}"`));return}n.enqueue(h),a=a.substring(f[0].length),f=a.match(ZE)}return o()})}}})}function ED(r){const e=r[r.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const n of r){if(n.candidates)for(const a of n.candidates){const o=a.index;if(t.candidates||(t.candidates=[]),t.candidates[o]||(t.candidates[o]={index:a.index}),t.candidates[o].citationMetadata=a.citationMetadata,t.candidates[o].groundingMetadata=a.groundingMetadata,t.candidates[o].finishReason=a.finishReason,t.candidates[o].finishMessage=a.finishMessage,t.candidates[o].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[o].content||(t.candidates[o].content={role:a.content.role||"user",parts:[]});const u={};for(const d of a.content.parts)d.text&&(u.text=d.text),d.functionCall&&(u.functionCall=d.functionCall),d.executableCode&&(u.executableCode=d.executableCode),d.codeExecutionResult&&(u.codeExecutionResult=d.codeExecutionResult),Object.keys(u).length===0&&(u.text=""),t.candidates[o].content.parts.push(u)}}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aT(r,e,t,n){const a=await ru(e,bs.STREAM_GENERATE_CONTENT,r,!0,JSON.stringify(t),n);return vD(a)}async function sT(r,e,t,n){const o=await(await ru(e,bs.GENERATE_CONTENT,r,!1,JSON.stringify(t),n)).json();return{response:h_(o)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iT(r){if(r!=null){if(typeof r=="string")return{role:"system",parts:[{text:r}]};if(r.text)return{role:"system",parts:[r]};if(r.parts)return r.role?r:{role:"system",parts:r.parts}}}function Fl(r){let e=[];if(typeof r=="string")e=[{text:r}];else for(const t of r)typeof t=="string"?e.push({text:t}):e.push(t);return AD(e)}function AD(r){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,a=!1;for(const o of r)"functionResponse"in o?(t.parts.push(o),a=!0):(e.parts.push(o),n=!0);if(n&&a)throw new dn("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!a)throw new dn("No content is provided for sending chat message.");return n?e:t}function OD(r,e){var t;let n={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const a=r.generateContentRequest!=null;if(r.contents){if(a)throw new Ma("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=r.contents}else if(a)n=Object.assign(Object.assign({},n),r.generateContentRequest);else{const o=Fl(r);n.contents=[o]}return{generateContentRequest:n}}function VE(r){let e;return r.contents?e=r:e={contents:[Fl(r)]},r.systemInstruction&&(e.systemInstruction=iT(r.systemInstruction)),e}function TD(r){return typeof r=="string"||Array.isArray(r)?{content:Fl(r)}:r}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JE=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],RD={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function ND(r){let e=!1;for(const t of r){const{role:n,parts:a}=t;if(!e&&n!=="user")throw new dn(`First content should be with role 'user', got ${n}`);if(!LE.includes(n))throw new dn(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(LE)}`);if(!Array.isArray(a))throw new dn("Content should have 'parts' property with an array of Parts");if(a.length===0)throw new dn("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const d of a)for(const f of JE)f in d&&(o[f]+=1);const u=RD[n];for(const d of JE)if(!u.includes(d)&&o[d]>0)throw new dn(`Content with role '${n}' can't contain '${d}' part`);e=!0}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KE="SILENT_ERROR";class CD{constructor(e,t,n,a={}){this.model=t,this.params=n,this._requestOptions=a,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(ND(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,a,o,u,d,f;await this._sendPromise;const h=Fl(e),p={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(u=this.params)===null||u===void 0?void 0:u.toolConfig,systemInstruction:(d=this.params)===null||d===void 0?void 0:d.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,h]},y=Object.assign(Object.assign({},this._requestOptions),t);let _;return this._sendPromise=this._sendPromise.then(()=>sT(this._apiKey,this.model,p,y)).then(b=>{var v;if(b.response.candidates&&b.response.candidates.length>0){this._history.push(h);const S=Object.assign({parts:[],role:"model"},(v=b.response.candidates)===null||v===void 0?void 0:v[0].content);this._history.push(S)}else{const S=$a(b.response);S&&console.warn(`sendMessage() was unsuccessful. ${S}. Inspect response object for details.`)}_=b}),await this._sendPromise,_}async sendMessageStream(e,t={}){var n,a,o,u,d,f;await this._sendPromise;const h=Fl(e),p={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(u=this.params)===null||u===void 0?void 0:u.toolConfig,systemInstruction:(d=this.params)===null||d===void 0?void 0:d.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,h]},y=Object.assign(Object.assign({},this._requestOptions),t),_=aT(this._apiKey,this.model,p,y);return this._sendPromise=this._sendPromise.then(()=>_).catch(b=>{throw new Error(KE)}).then(b=>b.response).then(b=>{if(b.candidates&&b.candidates.length>0){this._history.push(h);const v=Object.assign({},b.candidates[0].content);v.role||(v.role="model"),this._history.push(v)}else{const v=$a(b);v&&console.warn(`sendMessageStream() was unsuccessful. ${v}. Inspect response object for details.`)}}).catch(b=>{b.message!==KE&&console.error(b)}),_}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kD(r,e,t,n){return(await ru(e,bs.COUNT_TOKENS,r,!1,JSON.stringify(t),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jD(r,e,t,n){return(await ru(e,bs.EMBED_CONTENT,r,!1,JSON.stringify(t),n)).json()}async function $D(r,e,t,n){const a=t.requests.map(u=>Object.assign(Object.assign({},u),{model:e}));return(await ru(e,bs.BATCH_EMBED_CONTENTS,r,!1,JSON.stringify({requests:a}),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YE{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=iT(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const a=VE(e),o=Object.assign(Object.assign({},this._requestOptions),t);return sT(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},a),o)}async generateContentStream(e,t={}){var n;const a=VE(e),o=Object.assign(Object.assign({},this._requestOptions),t);return aT(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},a),o)}startChat(e){var t;return new CD(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=OD(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),a=Object.assign(Object.assign({},this._requestOptions),t);return kD(this.apiKey,this.model,n,a)}async embedContent(e,t={}){const n=TD(e),a=Object.assign(Object.assign({},this._requestOptions),t);return jD(this.apiKey,this.model,n,a)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return $D(this.apiKey,this.model,e,n)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new dn("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new YE(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new Ma("Cached content must contain a `name` field.");if(!e.model)throw new Ma("Cached content must contain a `model` field.");const a=["model","systemInstruction"];for(const u of a)if(t!=null&&t[u]&&e[u]&&(t==null?void 0:t[u])!==e[u]){if(u==="model"){const d=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,f=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(d===f)continue}throw new Ma(`Different value for "${u}" specified in modelParams (${t[u]}) and cachedContent (${e[u]})`)}const o=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new YE(this.apiKey,o,n)}}const PD=Pl(["openai","anthropic","google"]),MD=Pl(["gpt-4-turbo-2024-04-09","gpt-4o","claude-3-5-sonnet-20241022","claude-3-5-haiku-20241022","gemini-2.0-flash","gemini-1.5-pro"]),LD=jt({provider:PD,model:MD,apiKey:xe().min(1),temperature:$l().min(0).max(2).default(.7),maxTokens:$l().min(1).max(8192).default(4e3)}),XE=jt({company:jt({name:xe(),industry:xe(),size:Pl(["startup","small","medium","enterprise"]),description:xe(),website:xe().url().optional()}),brandDNA:jt({valuePropositions:vr(xe()),coreOfferings:vr(xe()),targetAudience:jt({demographics:xe(),psychographics:xe(),painPoints:vr(xe())}),brandVoice:jt({personality:vr(xe()),tone:Pl(["professional","friendly","authoritative","casual","technical"]),communicationStyle:xe()}),brandColors:jt({primary:xe(),secondary:xe(),accent:xe()})}),marketingInsights:jt({competitiveAdvantage:xe(),marketPosition:xe(),contentThemes:vr(xe()),recommendedChannels:vr(xe())}),metadata:jt({extractedAt:xe(),websiteAnalyzed:$g(),confidenceScore:$l().min(0).max(1),version:xe()})});class DD{constructor(){Jt(this,"configs",new Map);Jt(this,"models",new Map)}configureProvider(e){const t=LD.parse(e),n=`${e.provider}-${e.model}`;this.configs.set(n,t);let a;switch(e.provider){case"openai":a=new r4({modelName:e.model,openAIApiKey:e.apiKey,temperature:e.temperature,maxTokens:e.maxTokens});break;case"anthropic":a=new aD({modelName:e.model,anthropicApiKey:e.apiKey,temperature:e.temperature,maxTokens:e.maxTokens});break;case"google":a=new ID(e.apiKey);break;default:throw new Error(`Unsupported AI provider: ${e.provider}`)}this.models.set(n,a),console.log(`✅ Modern AI provider configured: ${n}`)}async extractCompanyDNA(e){try{let t="",n=!1;e.website&&(t=await this.scrapeWebsite(e.website),n=!0);const a=await this.analyzeBrandFromContent({companyName:e.companyName,websiteContent:t,industry:e.industry,description:e.description});return XE.parse({company:{name:e.companyName,industry:a.industry||e.industry||"Unknown",size:a.estimatedSize||"startup",description:a.description||e.description||"",website:e.website},brandDNA:a.brandDNA,marketingInsights:a.marketingInsights,metadata:{extractedAt:new Date().toISOString(),websiteAnalyzed:n,confidenceScore:a.confidenceScore,version:"2.0.0"}})}catch(t){throw console.error("❌ Company DNA extraction failed:",t),new Error(`Failed to extract company DNA: ${t instanceof Error?t.message:"Unknown error"}`)}}async scrapeWebsite(e){try{console.log(`🔍 Scraping website: ${e}`);const{enhancedWebsiteAnalyzer:t}=await nA(async()=>{const{enhancedWebsiteAnalyzer:o}=await import("./enhanced-website-analyzer-SxfL-iDv.js");return{enhancedWebsiteAnalyzer:o}},[]);await t.initialize();const n=await t.analyzeWebsite(e),a=t.extractContentForAI(n);return await t.cleanup(),console.log(`✅ Successfully analyzed website: ${e}`),a}catch(t){return console.error("❌ Website scraping failed:",t),`Failed to analyze website: ${t instanceof Error?t.message:"Unknown error"}`}}async analyzeBrandFromContent(e){const t=this.getDefaultModel(),n=`
You are an expert brand strategist analyzing a company to extract comprehensive brand DNA.

COMPANY INFORMATION:
- Name: ${e.companyName}
- Industry: ${e.industry||"Unknown"}
- Description: ${e.description||"Not provided"}

WEBSITE CONTENT:
${e.websiteContent||"No website content available"}

TASK: Analyze all available information and extract comprehensive brand DNA.

OUTPUT FORMAT: Return a JSON object with this exact structure:
{
  "industry": "string - identified industry",
  "estimatedSize": "startup | small | medium | enterprise",
  "description": "string - comprehensive company description",
  "brandDNA": {
    "valuePropositions": ["string array - key value propositions"],
    "coreOfferings": ["string array - main products/services"],
    "targetAudience": {
      "demographics": "string - target customer demographics",
      "psychographics": "string - target customer psychographics", 
      "painPoints": ["string array - customer pain points addressed"]
    },
    "brandVoice": {
      "personality": ["string array - brand personality traits"],
      "tone": "professional | friendly | authoritative | casual | technical",
      "communicationStyle": "string - how the brand communicates"
    },
    "brandColors": {
      "primary": "#hex - primary brand color",
      "secondary": "#hex - secondary brand color", 
      "accent": "#hex - accent color"
    }
  },
  "marketingInsights": {
    "competitiveAdvantage": "string - unique competitive advantage",
    "marketPosition": "string - position in the market",
    "contentThemes": ["string array - recommended content themes"],
    "recommendedChannels": ["string array - optimal marketing channels"]
  },
  "confidenceScore": 0.85
}

ANALYSIS GUIDELINES:
- Extract specific, actionable insights
- Identify unique value propositions
- Understand target audience deeply
- Recommend appropriate brand voice
- Suggest realistic brand colors (use web standards)
- Provide marketing strategy insights
- Assign confidence score based on available data quality

Return only valid JSON, no additional text.`;try{const a=await t.invoke(n),o=a.content||a;return JSON.parse(o)}catch(a){return console.error("❌ Brand analysis failed:",a),{industry:e.industry||"Technology",estimatedSize:"startup",description:e.description||`${e.companyName} is a company in the ${e.industry||"technology"} industry.`,brandDNA:{valuePropositions:["Innovation","Quality","Customer Focus"],coreOfferings:["Primary Service"],targetAudience:{demographics:"Business professionals",psychographics:"Growth-oriented individuals",painPoints:["Efficiency challenges","Cost concerns"]},brandVoice:{personality:["Professional","Reliable","Innovative"],tone:"professional",communicationStyle:"Clear and professional communication"},brandColors:{primary:"#2563eb",secondary:"#3b82f6",accent:"#10b981"}},marketingInsights:{competitiveAdvantage:"Customer-focused approach",marketPosition:"Innovative market challenger",contentThemes:["Industry insights","Product updates","Customer success"],recommendedChannels:["LinkedIn","Blog","Email marketing"]},confidenceScore:.3}}}getDefaultModel(){if(this.models.size===0)throw new Error("No AI providers configured. Please configure at least one provider.");const e=["anthropic-claude-3-5-sonnet-20241022","openai-gpt-4o","google-gemini-2.0-flash"];for(const t of e)if(this.models.has(t))return this.models.get(t);return Array.from(this.models.values())[0]}exportCompanyDNA(e){return JSON.stringify(e,null,2)}importCompanyDNA(e){try{const t=JSON.parse(e);return XE.parse(t)}catch(t){throw new Error(`Invalid company DNA JSON: ${t instanceof Error?t.message:"Unknown error"}`)}}getConfiguredProviders(){return Array.from(this.configs.keys())}isConfigured(){return this.models.size>0}}const pd=new DD,UD=jt({uri:xe(),name:xe(),description:xe(),mimeType:xe().optional(),metadata:vy(Il()).optional()}),zD=jt({name:xe(),description:xe(),inputSchema:jt({type:tA("object"),properties:vy(Il()),required:vr(xe()).optional()})});class BD{constructor(){Jt(this,"context",null);Jt(this,"resources",new Map);Jt(this,"tools",new Map);Jt(this,"listeners",new Set);this.initializeDefaultTools()}initializeDefaultTools(){this.registerTool({name:"extract_company_dna",description:"Extract comprehensive company DNA from website and basic information",inputSchema:{type:"object",properties:{companyName:{type:"string",description:"Company name"},website:{type:"string",description:"Company website URL"},industry:{type:"string",description:"Company industry"},description:{type:"string",description:"Company description"}},required:["companyName"]}}),this.registerTool({name:"analyze_brand_voice",description:"Analyze brand voice and personality from company content",inputSchema:{type:"object",properties:{content:{type:"string",description:"Content to analyze for brand voice"},context:{type:"object",description:"Additional context for analysis"}},required:["content"]}}),this.registerTool({name:"generate_marketing_content",description:"Generate marketing content based on company DNA",inputSchema:{type:"object",properties:{contentType:{type:"string",enum:["blog","social","email","video-script"],description:"Type of content to generate"},topic:{type:"string",description:"Content topic or theme"},length:{type:"number",description:"Desired content length"},tone:{type:"string",enum:["professional","casual","friendly","authoritative"],description:"Content tone"}},required:["contentType","topic"]}}),console.log("🔧 MCP tools initialized")}async loadContext(){try{if(typeof window<"u"){const e=localStorage.getItem("slotted_company_dna_v2");if(e)return this.context=JSON.parse(e),this.notifyListeners(),this.context}return null}catch(e){return console.error("❌ Failed to load MCP context:",e),null}}async saveContext(e){try{e.metadata={...e.metadata,extractedAt:new Date().toISOString(),version:"2.0.0"},this.context=e,typeof window<"u"&&localStorage.setItem("slotted_company_dna_v2",JSON.stringify(e)),this.updateMCPResources(e),this.notifyListeners(),console.log("✅ Company DNA saved successfully")}catch(t){throw console.error("❌ Failed to save MCP context:",t),t}}updateMCPResources(e){this.registerResource({uri:"company://profile",name:"Company Profile",description:`Profile for ${e.company.name}`,mimeType:"application/json",metadata:{company:e.company,lastUpdated:e.metadata.extractedAt}}),this.registerResource({uri:"company://brand-dna",name:"Brand DNA",description:`Brand DNA and voice guidelines for ${e.company.name}`,mimeType:"application/json",metadata:{brandDNA:e.brandDNA,confidenceScore:e.metadata.confidenceScore}}),this.registerResource({uri:"company://marketing-insights",name:"Marketing Insights",description:`Marketing strategy and insights for ${e.company.name}`,mimeType:"application/json",metadata:{insights:e.marketingInsights,recommendedChannels:e.marketingInsights.recommendedChannels}}),console.log("📚 MCP resources updated")}registerResource(e){const t=UD.parse(e);this.resources.set(t.uri,t)}registerTool(e){const t=zD.parse(e);this.tools.set(t.name,t)}getMCPPromptContext(){if(!this.context)return"No company context available. Please extract company DNA first.";const{company:e,brandDNA:t,marketingInsights:n}=this.context;return`
COMPANY CONTEXT (MCP v2.0):
================================

COMPANY PROFILE:
- Name: ${e.name}
- Industry: ${e.industry}
- Size: ${e.size}
- Description: ${e.description}
${e.website?`- Website: ${e.website}`:""}

BRAND DNA:
- Value Propositions: ${t.valuePropositions.join(", ")}
- Core Offerings: ${t.coreOfferings.join(", ")}
- Target Demographics: ${t.targetAudience.demographics}
- Target Psychographics: ${t.targetAudience.psychographics}
- Pain Points Addressed: ${t.targetAudience.painPoints.join(", ")}

BRAND VOICE & PERSONALITY:
- Personality Traits: ${t.brandVoice.personality.join(", ")}
- Communication Tone: ${t.brandVoice.tone}
- Communication Style: ${t.brandVoice.communicationStyle}

BRAND COLORS:
- Primary: ${t.brandColors.primary}
- Secondary: ${t.brandColors.secondary}
- Accent: ${t.brandColors.accent}

MARKETING STRATEGY:
- Competitive Advantage: ${n.competitiveAdvantage}
- Market Position: ${n.marketPosition}
- Content Themes: ${n.contentThemes.join(", ")}
- Recommended Channels: ${n.recommendedChannels.join(", ")}

CONTEXT METADATA:
- Extracted: ${this.context.metadata.extractedAt}
- Website Analyzed: ${this.context.metadata.websiteAnalyzed}
- Confidence Score: ${this.context.metadata.confidenceScore}
- Version: ${this.context.metadata.version}

USE THIS CONTEXT FOR:
- Brand-consistent content generation
- Voice and tone matching
- Target audience alignment
- Channel-appropriate messaging
- Strategic content planning
`.trim()}exportContext(){if(!this.context)throw new Error("No context available to export");return JSON.stringify(this.context,null,2)}async importContext(e){try{const t=JSON.parse(e);await this.saveContext(t)}catch(t){throw new Error(`Invalid context JSON: ${t instanceof Error?t.message:"Unknown error"}`)}}getResources(){return Array.from(this.resources.values())}getTools(){return Array.from(this.tools.values())}async executeTool(e,t){if(!this.tools.get(e))throw new Error(`Tool not found: ${e}`);return console.log(`🔧 Executing MCP tool: ${e}`,t),{success:!0,result:`Tool ${e} executed with parameters`,parameters:t}}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.context&&this.listeners.forEach(e=>e(this.context))}getContext(){return this.context}hasContext(){return this.context!==null}async clearContext(){this.context=null,this.resources.clear(),typeof window<"u"&&localStorage.removeItem("slotted_company_dna_v2"),this.initializeDefaultTools(),console.log("🗑️ MCP context cleared")}}const gy=new BD,qD=jt({companyName:xe().min(1,"Company name is required"),website:xe().url("Please enter a valid URL").optional().or(tA("")),industry:xe().optional(),description:xe().optional()}),HD=()=>{const[r,e]=St.useState({companyName:"",website:"",industry:"",description:""}),[t,n]=St.useState({status:"idle",progress:0,currentStep:""}),[a,o]=St.useState({provider:"anthropic",model:"claude-3-5-sonnet-20241022",apiKey:"",temperature:.7,maxTokens:4e3}),[u,d]=St.useState(!1),[f,h]=St.useState({}),p=St.useCallback(S=>{try{return qD.parse(S),h({}),!0}catch(x){if(x instanceof Ar){const E={};x.errors.forEach(R=>{R.path.length>0&&(E[R.path[0]]=R.message)}),h(E)}return!1}},[]),y=St.useCallback((S,x)=>{n(E=>({...E,progress:S,currentStep:x}))},[]),_=St.useCallback(async()=>{if(p(r)){if(!a.apiKey){h({apiKey:"API key is required"});return}try{n({status:"analyzing",progress:0,currentStep:"Initializing analysis..."}),y(10,"Configuring AI provider..."),pd.configureProvider(a),r.website?(y(15,"Initializing advanced website analyzer..."),y(25,"Loading website content..."),y(35,"Extracting brand elements..."),y(45,"Analyzing visual design...")):y(30,"Processing company information..."),y(60,"Generating comprehensive brand analysis...");const S=await pd.extractCompanyDNA({companyName:r.companyName,website:r.website||void 0,industry:r.industry||void 0,description:r.description||void 0});y(85,"Saving to MCP context..."),await gy.saveContext(S),y(100,"Analysis complete!"),n({status:"completed",progress:100,currentStep:"Analysis completed successfully",result:S}),d(!0)}catch(S){console.error("❌ Company DNA extraction failed:",S),n({status:"error",progress:0,currentStep:"",error:S instanceof Error?S.message:"Unknown error occurred"})}finally{console.log("🎉 Company DNA extraction process completed")}}},[r,a,p,y]),b=St.useCallback(()=>{if(!t.result)return;const S=pd.exportCompanyDNA(t.result),x=new Blob([S],{type:"application/json"}),E=URL.createObjectURL(x),R=document.createElement("a");R.href=E,R.download=`${r.companyName.toLowerCase().replace(/[^a-z0-9]/g,"-")}-dna.json`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(E)},[t.result,r.companyName]),v=St.useCallback(()=>{e({companyName:"",website:"",industry:"",description:""}),n({status:"idle",progress:0,currentStep:""}),d(!1),h({})},[]);return O.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:O.jsxs("div",{className:"max-w-4xl mx-auto",children:[O.jsxs("div",{className:"text-center mb-8",children:[O.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Company DNA Extractor"}),O.jsx("p",{className:"text-xl text-gray-600",children:"Get your complete brand profile in 30 minutes"})]}),u?O.jsx(GD,{result:t.result,onDownload:b,onStartOver:v}):O.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[O.jsxs("div",{className:"mb-8",children:[O.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"AI Configuration"}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AI Provider"}),O.jsxs("select",{value:a.provider,onChange:S=>o(x=>({...x,provider:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[O.jsx("option",{value:"anthropic",children:"Anthropic Claude"}),O.jsx("option",{value:"openai",children:"OpenAI GPT"}),O.jsx("option",{value:"google",children:"Google Gemini"})]})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model"}),O.jsxs("select",{value:a.model,onChange:S=>o(x=>({...x,model:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.provider==="anthropic"&&O.jsxs(O.Fragment,{children:[O.jsx("option",{value:"claude-3-5-sonnet-20241022",children:"Claude 3.5 Sonnet"}),O.jsx("option",{value:"claude-3-5-haiku-20241022",children:"Claude 3.5 Haiku"})]}),a.provider==="openai"&&O.jsxs(O.Fragment,{children:[O.jsx("option",{value:"gpt-4o",children:"GPT-4o"}),O.jsx("option",{value:"gpt-4-turbo-2024-04-09",children:"GPT-4 Turbo"})]}),a.provider==="google"&&O.jsxs(O.Fragment,{children:[O.jsx("option",{value:"gemini-2.0-flash",children:"Gemini 2.0 Flash"}),O.jsx("option",{value:"gemini-1.5-pro",children:"Gemini 1.5 Pro"})]})]})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Key"}),O.jsx("input",{type:"password",value:a.apiKey,onChange:S=>o(x=>({...x,apiKey:S.target.value})),placeholder:"Enter API key",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${f.apiKey?"border-red-500":"border-gray-300"}`}),f.apiKey&&O.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.apiKey})]})]})]}),O.jsxs("div",{className:"space-y-6",children:[O.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Company Information"}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),O.jsx("input",{type:"text",value:r.companyName,onChange:S=>e(x=>({...x,companyName:S.target.value})),placeholder:"Enter company name",className:`w-full px-4 py-3 border rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${f.companyName?"border-red-500":"border-gray-300"}`}),f.companyName&&O.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.companyName})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Website URL"}),O.jsx("input",{type:"url",value:r.website,onChange:S=>e(x=>({...x,website:S.target.value})),placeholder:"https://company.com",className:`w-full px-4 py-3 border rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${f.website?"border-red-500":"border-gray-300"}`}),f.website&&O.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.website}),O.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Optional: Provide website for automated brand analysis"})]}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),O.jsx("input",{type:"text",value:r.industry,onChange:S=>e(x=>({...x,industry:S.target.value})),placeholder:"e.g., SaaS, E-commerce, Healthcare",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Description"}),O.jsx("textarea",{value:r.description,onChange:S=>e(x=>({...x,description:S.target.value})),placeholder:"Brief description of what your company does",rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),t.status==="analyzing"&&O.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg",children:[O.jsxs("div",{className:"flex items-center justify-between mb-2",children:[O.jsx("span",{className:"text-sm font-medium text-blue-700",children:t.currentStep}),O.jsxs("span",{className:"text-sm text-blue-600",children:[t.progress,"%"]})]}),O.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:O.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:`${t.progress}%`}})})]}),t.status==="error"&&O.jsx("div",{className:"mt-8 p-4 bg-red-50 border border-red-200 rounded-lg",children:O.jsxs("div",{className:"flex items-center",children:[O.jsx("div",{className:"text-red-400 mr-3",children:O.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:O.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),O.jsxs("div",{children:[O.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Analysis Failed"}),O.jsx("p",{className:"text-sm text-red-700 mt-1",children:t.error})]})]})}),O.jsxs("div",{className:"flex justify-between mt-8",children:[O.jsx("button",{onClick:v,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Reset Form"}),O.jsx("button",{onClick:_,disabled:t.status==="analyzing",className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t.status==="analyzing"?"Analyzing...":"Extract Company DNA"})]})]})]})})},GD=({result:r,onDownload:e,onStartOver:t})=>O.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[O.jsxs("div",{className:"text-center mb-8",children:[O.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),O.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Analysis Complete!"}),O.jsx("p",{className:"text-gray-600",children:"Your company DNA has been successfully extracted"})]}),O.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[O.jsxs("div",{className:"space-y-6",children:[O.jsxs("div",{children:[O.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Company Profile"}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Name:"})," ",r.company.name]}),O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Industry:"})," ",r.company.industry]}),O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Size:"})," ",r.company.size]}),r.company.website&&O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Website:"})," ",r.company.website]})]})]}),O.jsxs("div",{children:[O.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Brand Voice"}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Personality:"})," ",r.brandDNA.brandVoice.personality.join(", ")]}),O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Tone:"})," ",r.brandDNA.brandVoice.tone]}),O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Style:"})," ",r.brandDNA.brandVoice.communicationStyle]})]})]})]}),O.jsxs("div",{className:"space-y-6",children:[O.jsxs("div",{children:[O.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Value Propositions"}),O.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:O.jsx("ul",{className:"space-y-1",children:r.brandDNA.valuePropositions.map((n,a)=>O.jsxs("li",{className:"flex items-start",children:[O.jsx("span",{className:"text-blue-500 mr-2",children:"•"}),n]},a))})})]}),O.jsxs("div",{children:[O.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Marketing Insights"}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Competitive Advantage:"})," ",r.marketingInsights.competitiveAdvantage]}),O.jsxs("p",{children:[O.jsx("span",{className:"font-medium",children:"Recommended Channels:"})," ",r.marketingInsights.recommendedChannels.join(", ")]})]})]})]})]}),O.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-8",children:[O.jsx("h3",{className:"text-sm font-semibold text-blue-800 mb-2",children:"Analysis Details"}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-blue-700",children:[O.jsxs("p",{children:["Confidence Score: ",Math.round(r.metadata.confidenceScore*100),"%"]}),O.jsxs("p",{children:["Website Analyzed: ",r.metadata.websiteAnalyzed?"Yes":"No"]}),O.jsxs("p",{children:["Extracted: ",new Date(r.metadata.extractedAt).toLocaleDateString()]})]})]}),O.jsxs("div",{className:"flex justify-between",children:[O.jsx("button",{onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Analyze Another Company"}),O.jsx("button",{onClick:e,className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Download JSON"})]})]});jt({id:xe(),name:xe(),description:xe(),price:$l(),currency:xe().default("usd"),features:vr(xe()),popular:$g().default(!1),limitations:jt({analysesPerMonth:$l().optional(),websiteAnalysis:$g(),aiModels:vr(xe()),exportFormats:vr(xe())})});const FD=[{id:"mvp1-basic",name:"Basic Analysis",description:"Perfect for trying out company DNA extraction",price:29,currency:"usd",features:["Company profile analysis","Basic brand voice detection","Target audience insights","JSON export","Email support"],popular:!1,limitations:{analysesPerMonth:1,websiteAnalysis:!1,aiModels:["gpt-4o"],exportFormats:["json"]}},{id:"mvp1-enhanced",name:"Enhanced Analysis",description:"Complete brand DNA with website analysis",price:49,currency:"usd",features:["Everything in Basic","Advanced website scraping","Visual brand analysis (colors, fonts)","Business insights extraction","All AI models available","Priority support"],popular:!0,limitations:{analysesPerMonth:1,websiteAnalysis:!0,aiModels:["gpt-4o","claude-3-5-sonnet","gemini-2.0-flash"],exportFormats:["json","pdf"]}},{id:"mvp1-bulk",name:"Bulk Package",description:"Best value for agencies and consultants",price:199,currency:"usd",features:["Everything in Enhanced","5 company analyses","Bulk export capabilities","White-label reports","API access (coming soon)","Dedicated support"],popular:!1,limitations:{analysesPerMonth:5,websiteAnalysis:!0,aiModels:["gpt-4o","claude-3-5-sonnet","gemini-2.0-flash"],exportFormats:["json","pdf","csv"]}}],ZD=[{id:"mvp2-basic",name:"Basic Calendar",description:"Perfect for small businesses starting their marketing",price:99,currency:"usd",features:["13-week marketing calendar","Strategic campaign topics","Content type recommendations","Basic channel strategy","CSV export","Email support"],popular:!1,limitations:{analysesPerMonth:1,websiteAnalysis:!1,aiModels:["gpt-4o"],exportFormats:["csv"]}},{id:"mvp2-enhanced",name:"Enhanced Calendar",description:"Complete marketing strategy with advanced planning",price:199,currency:"usd",features:["Everything in Basic","Company DNA integration","Advanced campaign themes","KPI tracking framework","Channel distribution strategy","All AI models available","Google Sheets formatting","Priority support"],popular:!0,limitations:{analysesPerMonth:1,websiteAnalysis:!0,aiModels:["gpt-4o","claude-3-5-sonnet","gemini-2.0-flash"],exportFormats:["csv","xlsx","json"]}},{id:"mvp2-agency",name:"Agency Package",description:"Best value for agencies and marketing teams",price:499,currency:"usd",features:["Everything in Enhanced","5 marketing calendars","Custom focus areas","Budget planning tools","Quarterly strategy reports","White-label exports","API access (coming soon)","Dedicated support"],popular:!1,limitations:{analysesPerMonth:5,websiteAnalysis:!0,aiModels:["gpt-4o","claude-3-5-sonnet","gemini-2.0-flash"],exportFormats:["csv","xlsx","json","pdf"]}}],VD=[{id:"mvp3-basic",name:"Basic Blog Post",description:"Professional blog content with SEO optimization",price:49,currency:"usd",features:["Single 1500-2000 word blog post","Basic SEO optimization","Keyword integration","Professional structure","Markdown export","Email support"],popular:!1,limitations:{analysesPerMonth:1,websiteAnalysis:!1,aiModels:["gpt-4o"],exportFormats:["markdown"]}},{id:"mvp3-enhanced",name:"Enhanced Blog Post",description:"Brand-optimized content with advanced features",price:99,currency:"usd",features:["Everything in Basic","Company DNA brand voice integration","Advanced SEO analysis","Campaign calendar integration","Multiple export formats","Real-time editing interface","Priority support"],popular:!0,limitations:{analysesPerMonth:1,websiteAnalysis:!0,aiModels:["gpt-4o","claude-3-5-sonnet"],exportFormats:["markdown","html","json"]}},{id:"mvp3-content-package",name:"Content Package",description:"Best value for content teams and agencies",price:299,currency:"usd",features:["Everything in Enhanced","5 blog posts","Campaign calendar integration","Keyword research included","White-label exports","Bulk generation tools","Content series planning","Dedicated support"],popular:!1,limitations:{analysesPerMonth:5,websiteAnalysis:!0,aiModels:["gpt-4o","claude-3-5-sonnet","gemini-2.0-flash"],exportFormats:["markdown","html","json","pdf"]}}];jt({sessionId:xe(),planId:xe(),customerEmail:xe().email(),companyName:xe(),status:Pl(["pending","completed","failed"]),createdAt:xe(),metadata:vy(Il()).optional()});class JD{constructor(){Jt(this,"purchases",new Map)}recordPurchase(e,t){const n=`${e}-${t}-${Date.now()}`;this.purchases.set(n,{email:e,planId:t,purchasedAt:new Date().toISOString(),analysesUsed:0}),typeof window<"u"&&localStorage.setItem("slotted_purchases",JSON.stringify(Array.from(this.purchases.entries())))}getRemainingAnalyses(e){const t=Array.from(this.purchases.values()).filter(a=>a.email===e);let n=0;for(const a of t){const u=[...FD,...ZD,...VD].find(d=>d.id===a.planId);if(u&&u.limitations.analysesPerMonth){const d=u.limitations.analysesPerMonth-a.analysesUsed;n+=Math.max(0,d)}}return n}useAnalysisCredit(e){if(this.getRemainingAnalyses(e)<=0)return!1;const n=Array.from(this.purchases.entries()).filter(([a,o])=>o.email===e).sort(([a,o],[u,d])=>new Date(d.purchasedAt).getTime()-new Date(o.purchasedAt).getTime());if(n.length>0){const[a,o]=n[0];o.analysesUsed+=1,this.purchases.set(a,o),typeof window<"u"&&localStorage.setItem("slotted_purchases",JSON.stringify(Array.from(this.purchases.entries())))}return!0}loadPurchases(){if(typeof window<"u"){const e=localStorage.getItem("slotted_purchases");if(e)try{const t=JSON.parse(e);this.purchases=new Map(t)}catch(t){console.error("Failed to load purchases:",t)}}}}const yy=new JD;yy.loadPurchases();const KD=({companyDNA:r,userEmail:e,onCalendarGenerated:t})=>{const[n,a]=St.useState(!1),[o,u]=St.useState(null),[d,f]=St.useState(""),[h,p]=St.useState(0),[y,_]=St.useState({weeks:13,startDate:new Date().toISOString().split("T")[0],focusAreas:[],budget:""}),b=async()=>{if(!r){alert("Company DNA required. Please complete DNA extraction first.");return}if(e&&yy.getRemainingAnalyses(e)<=0){alert("No remaining analysis credits. Please purchase more.");return}a(!0),p(0),f("Initializing calendar generation...");try{const E=new(await nA(async()=>{const{AdvancedCampaignGenerator:T}=await import("./campaign-generator-Disw7MEQ.js");return{AdvancedCampaignGenerator:T}},[])).AdvancedCampaignGenerator(pd);f("Generating strategic campaign topics..."),p(25);const R=await E.generateMarketingCalendar({companyDNA:r,weeks:y.weeks,startDate:new Date(y.startDate),focusAreas:y.focusAreas.length>0?y.focusAreas:void 0,budget:y.budget||void 0});f("Building content strategy..."),p(50),f("Creating channel distribution plan..."),p(75),f("Finalizing marketing calendar..."),p(100),u(R),t(R),e&&yy.useAnalysisCredit(e),f("Calendar generation complete!")}catch(E){console.error("Calendar generation failed:",E),alert("Calendar generation failed. Please try again."),f("Generation failed")}finally{a(!1)}},v=()=>{if(!o)return;const R=new(require("@/services/campaigns/campaign-generator")).AdvancedCampaignGenerator(null).exportToGoogleSheets(o);Object.entries(R).forEach(([T,j])=>{const $=j.map(oe=>oe.join(",")).join(`
`),q=new Blob([$],{type:"text/csv"}),Z=URL.createObjectURL(q),Y=document.createElement("a");Y.href=Z,Y.download=`${o.companyName}_${T.replace(" ","_")}.csv`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(Z)}),alert("Marketing calendar exported as CSV files!")},S=E=>{_(R=>({...R,focusAreas:R.focusAreas.includes(E)?R.focusAreas.filter(T=>T!==E):[...R.focusAreas,E]}))},x=["Brand Awareness","Lead Generation","Customer Retention","Product Launch","Thought Leadership","Community Building","SEO & Content Marketing","Social Media Growth"];return O.jsx("div",{className:"max-w-6xl mx-auto p-6",children:O.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[O.jsxs("div",{className:"text-center mb-8",children:[O.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"🗓️ Marketing Calendar Generator"}),O.jsx("p",{className:"text-xl text-gray-600",children:"Generate a comprehensive 13-week marketing strategy based on your company DNA"})]}),r&&O.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8",children:[O.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:["📊 Using Company DNA for: ",r.company.name]}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[O.jsxs("div",{children:[O.jsx("span",{className:"font-medium text-blue-800",children:"Industry:"}),O.jsx("span",{className:"ml-2 text-blue-700",children:r.company.industry})]}),O.jsxs("div",{children:[O.jsx("span",{className:"font-medium text-blue-800",children:"Target Audience:"}),O.jsx("span",{className:"ml-2 text-blue-700",children:r.brandDNA.targetAudience.demographics})]}),O.jsxs("div",{children:[O.jsx("span",{className:"font-medium text-blue-800",children:"Market Position:"}),O.jsx("span",{className:"ml-2 text-blue-700",children:r.marketingInsights.marketPosition})]})]})]}),O.jsxs("div",{className:"mb-8",children:[O.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Generation Settings"}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Calendar Duration (weeks)"}),O.jsxs("select",{value:y.weeks,onChange:E=>_(R=>({...R,weeks:parseInt(E.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:n,children:[O.jsx("option",{value:13,children:"13 weeks (1 quarter)"}),O.jsx("option",{value:26,children:"26 weeks (2 quarters)"}),O.jsx("option",{value:52,children:"52 weeks (1 year)"})]})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),O.jsx("input",{type:"date",value:y.startDate,onChange:E=>_(R=>({...R,startDate:E.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:n})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Budget Range (optional)"}),O.jsx("input",{type:"text",value:y.budget,onChange:E=>_(R=>({...R,budget:E.target.value})),placeholder:"e.g., $5,000/month, $60,000/year",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:n})]})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Focus Areas (select multiple)"}),O.jsx("div",{className:"grid grid-cols-2 gap-2",children:x.map(E=>O.jsxs("label",{className:"flex items-center space-x-2",children:[O.jsx("input",{type:"checkbox",checked:y.focusAreas.includes(E),onChange:()=>S(E),disabled:n,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),O.jsx("span",{className:"text-sm text-gray-700",children:E})]},E))})]})]})]}),n&&O.jsx("div",{className:"mb-8",children:O.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[O.jsxs("div",{className:"flex items-center justify-between mb-3",children:[O.jsx("span",{className:"text-sm font-medium text-gray-700",children:d}),O.jsxs("span",{className:"text-sm text-gray-500",children:[h,"%"]})]}),O.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:O.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})})]})}),O.jsx("div",{className:"text-center mb-8",children:O.jsx("button",{onClick:b,disabled:n||!r,className:`px-8 py-3 rounded-lg font-semibold text-white transition-colors ${n||!r?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:n?O.jsxs("div",{className:"flex items-center space-x-2",children:[O.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),O.jsx("span",{children:"Generating Calendar..."})]}):`Generate ${y.weeks}-Week Marketing Calendar`})}),o&&O.jsxs("div",{className:"border-t pt-8",children:[O.jsxs("div",{className:"flex items-center justify-between mb-6",children:[O.jsxs("h3",{className:"text-2xl font-bold text-gray-900",children:["📅 ",o.companyName," Marketing Calendar"]}),O.jsx("button",{onClick:v,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"📊 Export to CSV"})]}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[O.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[O.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Period"}),O.jsxs("p",{className:"text-sm text-gray-600",children:[new Date(o.period.startDate).toLocaleDateString()," -",new Date(o.period.endDate).toLocaleDateString()]}),O.jsxs("p",{className:"text-sm text-gray-600",children:[o.period.weeks," weeks"]})]}),O.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[O.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Strategy"}),O.jsx("p",{className:"text-sm text-gray-600",children:o.strategy.overallTheme})]}),O.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[O.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Campaigns"}),O.jsxs("p",{className:"text-sm text-gray-600",children:[o.campaigns.length," strategic campaigns"]})]})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Campaign Timeline"}),O.jsxs("div",{className:"grid gap-4",children:[o.campaigns.slice(0,6).map(E=>O.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:O.jsx("div",{className:"flex items-start justify-between",children:O.jsxs("div",{className:"flex-1",children:[O.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[O.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded",children:["Week ",E.week]}),O.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs font-medium px-2 py-1 rounded",children:E.theme}),O.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded",children:E.businessGoal})]}),O.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:E.title}),O.jsx("p",{className:"text-sm text-gray-600 mb-2",children:E.description}),O.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[O.jsxs("span",{children:["📢 ",E.primaryChannel]}),O.jsxs("span",{children:["💪 Effort: ",E.estimatedEffort,"/10"]}),O.jsxs("span",{children:["🎯 ",E.callToAction]})]})]})})},E.week)),o.campaigns.length>6&&O.jsx("div",{className:"text-center py-4",children:O.jsxs("span",{className:"text-gray-500",children:["+ ",o.campaigns.length-6," more campaigns in full calendar"]})})]})]}),O.jsxs("div",{className:"mt-8 pt-6 border-t",children:[O.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Channel Distribution"}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[O.jsxs("div",{children:[O.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Primary Channels"}),O.jsx("div",{className:"space-y-1",children:o.channelStrategy.primary.map(E=>O.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mr-1",children:E},E))})]}),O.jsxs("div",{children:[O.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Secondary Channels"}),O.jsx("div",{className:"space-y-1",children:o.channelStrategy.secondary.map(E=>O.jsx("span",{className:"inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded mr-1",children:E},E))})]}),O.jsxs("div",{children:[O.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Experimental"}),O.jsx("div",{className:"space-y-1",children:o.channelStrategy.experimental.map(E=>O.jsx("span",{className:"inline-block bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded mr-1",children:E},E))})]})]})]})]})]})})},YD=()=>{const[r,e]=St.useState({currentView:"landing",companyDNA:null,marketingCalendar:null,userEmail:"",isLoading:!0});if(St.useEffect(()=>{(async()=>{try{const n=await gy.loadContext();e(a=>({...a,companyDNA:n,isLoading:!1}))}catch(n){console.error("Failed to load context:",n),e(a=>({...a,isLoading:!1}))}})()},[]),St.useEffect(()=>gy.subscribe(n=>{e(a=>({...a,companyDNA:n}))}),[]),r.isLoading)return O.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600",children:"Loading Slotted..."})]})});switch(r.currentView){case"mvp1":return O.jsx(HD,{});case"mvp2":return O.jsxs("div",{className:"min-h-screen bg-gray-50",children:[O.jsx("div",{className:"bg-white shadow-sm mb-6",children:O.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:[O.jsxs("button",{onClick:()=>e(t=>({...t,currentView:"landing"})),className:"flex items-center text-blue-600 hover:text-blue-700",children:[O.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Home"]}),O.jsxs("div",{className:"flex items-center space-x-3",children:[O.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:O.jsx("span",{className:"text-white font-bold text-sm",children:"S"})}),O.jsx("span",{className:"text-xl font-bold text-gray-900",children:"Slotted"})]})]})}),O.jsx(KD,{companyDNA:r.companyDNA||void 0,userEmail:r.userEmail,onCalendarGenerated:t=>{e(n=>({...n,marketingCalendar:t}))}})]});case"mvp3":return O.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"MVP #3: Blog Content Engine"}),O.jsx("p",{className:"text-gray-600 mb-8",children:"Coming soon..."}),O.jsx("button",{onClick:()=>e(t=>({...t,currentView:"landing"})),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Home"})]})});case"mvp4":return O.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"MVP #4: Multi-Channel Asset Creator"}),O.jsx("p",{className:"text-gray-600 mb-8",children:"Coming soon..."}),O.jsx("button",{onClick:()=>e(t=>({...t,currentView:"landing"})),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Home"})]})});case"mvp5":return O.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"MVP #5: Campaign Orchestrator"}),O.jsx("p",{className:"text-gray-600 mb-8",children:"Coming soon..."}),O.jsx("button",{onClick:()=>e(t=>({...t,currentView:"landing"})),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Home"})]})});default:return O.jsx(XD,{appState:r,setAppState:e})}},XD=({appState:r,setAppState:e})=>{const t=[{id:"mvp1",title:"Company DNA Extractor",description:"Get your complete brand profile in 30 minutes",price:"$29-49",status:"available",features:["Automated website analysis","Brand voice detection","Value proposition extraction","Target audience insights","Downloadable JSON report"]},{id:"mvp2",title:"Marketing Calendar Generator",description:"Get a 13-week content calendar in 10 minutes",price:"$99-199",status:"available",features:["13-week strategic calendar","Campaign topic generation","Google Sheets integration","Content theme planning","Optimal timing recommendations"]},{id:"mvp3",title:"Blog Content Engine",description:"Turn any topic into a professional 2000+ word blog",price:"$49-99",status:"coming-soon",features:["2000+ word blog posts","Brand voice consistency","SEO optimization","Editing interface","Multiple format export"]},{id:"mvp4",title:"Multi-Channel Asset Creator",description:"Transform one blog into 20+ marketing assets",price:"$199-399",status:"coming-soon",features:["Multi-platform graphics","Social media adaptations","Email campaigns","Video scripts","Automated organization"]},{id:"mvp5",title:"Campaign Orchestrator",description:"Complete omnichannel campaigns on autopilot",price:"$499-999/mo",status:"coming-soon",features:["Full workflow automation","Campaign performance tracking","Asset management","Multi-agent coordination","Analytics dashboard"]}];return O.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:[O.jsx("header",{className:"bg-white shadow-sm",children:O.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsxs("div",{className:"flex items-center space-x-3",children:[O.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:O.jsx("span",{className:"text-white font-bold text-sm",children:"S"})}),O.jsx("span",{className:"text-xl font-bold text-gray-900",children:"Slotted"})]}),r.companyDNA&&O.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[O.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),O.jsxs("span",{children:["Company DNA: ",r.companyDNA.company.name]})]})]})})}),O.jsx("section",{className:"py-20 px-6",children:O.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[O.jsxs("h1",{className:"text-5xl font-bold text-gray-900 mb-6",children:["AI-Powered Marketing,"," ",O.jsx("span",{className:"text-blue-600",children:"One MVP at a Time"})]}),O.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Ship value incrementally with 5 standalone micro MVPs. Each tool provides immediate value and can be used independently or combined for maximum impact."}),!r.companyDNA&&O.jsx("button",{onClick:()=>e(n=>({...n,currentView:"mvp1"})),className:"px-8 py-4 bg-blue-600 text-white text-lg font-semibold rounded-xl hover:bg-blue-700 transition-colors shadow-lg",children:"Start with Company DNA Extractor"})]})}),O.jsx("section",{className:"py-16 px-6",children:O.jsxs("div",{className:"max-w-7xl mx-auto",children:[O.jsx("h2",{className:"text-3xl font-bold text-center text-gray-900 mb-12",children:"Choose Your Starting Point"}),O.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map((n,a)=>O.jsxs("div",{className:`bg-white rounded-2xl shadow-lg p-6 border-2 transition-all duration-200 ${n.status==="available"?"border-transparent hover:border-blue-200 hover:shadow-xl cursor-pointer":"border-gray-100 opacity-75"}`,onClick:()=>{n.status==="available"&&e(o=>({...o,currentView:n.id}))},children:[O.jsxs("div",{className:"flex items-center justify-between mb-4",children:[O.jsxs("span",{className:"text-sm font-semibold text-blue-600",children:["MVP #",a+1]}),n.status==="available"?O.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:"Available"}):O.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:"Coming Soon"})]}),O.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:n.title}),O.jsx("p",{className:"text-gray-600 mb-4",children:n.description}),O.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-4",children:n.price}),O.jsx("ul",{className:"space-y-2",children:n.features.map((o,u)=>O.jsxs("li",{className:"flex items-start text-sm text-gray-600",children:[O.jsx("svg",{className:"w-4 h-4 text-green-500 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:O.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),o]},u))}),n.status==="available"&&O.jsx("button",{className:"w-full mt-6 px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"Try Now"})]},n.id))})]})}),O.jsx("section",{className:"py-16 px-6 bg-white",children:O.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[O.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Why Build One MVP at a Time?"}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),O.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Immediate Value"}),O.jsx("p",{className:"text-gray-600",children:"Each MVP provides standalone value you can use immediately, without waiting for the complete system."})]}),O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),O.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Revenue Validation"}),O.jsx("p",{className:"text-gray-600",children:"Generate revenue from early MVPs to fund development of more advanced features."})]}),O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),O.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Iterative Learning"}),O.jsx("p",{className:"text-gray-600",children:"Learn from user feedback on each MVP to improve the next iteration and overall platform."})]})]})]})}),O.jsx("footer",{className:"bg-gray-900 text-white py-12 px-6",children:O.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[O.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Ready to Transform Your Marketing?"}),O.jsx("p",{className:"text-gray-300 mb-8",children:"Start with one MVP and scale as you see results. Each tool is designed to provide immediate value."}),!r.companyDNA&&O.jsx("button",{onClick:()=>e(n=>({...n,currentView:"mvp1"})),className:"px-8 py-4 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition-colors",children:"Get Started with MVP #1"})]})})]})};"performance"in window&&window.addEventListener("load",()=>{const r=performance.getEntriesByType("navigation")[0];console.log("Page load time:",r.loadEventEnd-r.fetchStart,"ms")});"serviceWorker"in navigator&&window.addEventListener("load",()=>{console.log("Service worker registration ready")});const oT=document.getElementById("root");if(!oT)throw new Error("Root element not found");const QD=HN.createRoot(oT);QD.render(O.jsx(PN.StrictMode,{children:O.jsx(YD,{})}));export{vr as a,PM as b,vs as c,$g as d,Pl as e,eU as g,$l as n,jt as o,vy as r,xe as s};
//# sourceMappingURL=index-x1NvUnkb.js.map
